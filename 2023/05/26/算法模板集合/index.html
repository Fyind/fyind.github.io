<!DOCTYPE html><html lang="en" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0,viewport-fit=cover"><title>算法模板集合 | Fyind's Blog</title><meta name="author" content="Fyind"><meta name="copyright" content="Fyind"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="#ffffff"><meta name="description" content="算法模板集合 [toc] 编译 1g++ name.cpp -Wall -Wextra --std&#x3D;c++17 -o name; .\name.out 对拍 1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950515253545556575859606162636465">
<meta property="og:type" content="article">
<meta property="og:title" content="算法模板集合">
<meta property="og:url" content="http://fyind.de/2023/05/26/%E7%AE%97%E6%B3%95%E6%A8%A1%E6%9D%BF%E9%9B%86%E5%90%88/index.html">
<meta property="og:site_name" content="Fyind&#39;s Blog">
<meta property="og:description" content="算法模板集合 [toc] 编译 1g++ name.cpp -Wall -Wextra --std&#x3D;c++17 -o name; .\name.out 对拍 1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950515253545556575859606162636465">
<meta property="og:locale" content="en_US">
<meta property="og:image" content="http://fyind.de/img/pic1.PNG">
<meta property="article:published_time" content="2023-05-26T08:03:26.000Z">
<meta property="article:modified_time" content="2025-07-18T10:49:53.881Z">
<meta property="article:author" content="Fyind">
<meta property="article:tag" content="算法">
<meta property="article:tag" content="算法模板">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="http://fyind.de/img/pic1.PNG"><script type="application/ld+json">{
  "@context": "https://schema.org",
  "@type": "BlogPosting",
  "headline": "算法模板集合",
  "url": "http://fyind.de/2023/05/26/%E7%AE%97%E6%B3%95%E6%A8%A1%E6%9D%BF%E9%9B%86%E5%90%88/",
  "image": "http://fyind.de/img/pic1.PNG",
  "datePublished": "2023-05-26T08:03:26.000Z",
  "dateModified": "2025-07-18T10:49:53.881Z",
  "author": [
    {
      "@type": "Person",
      "name": "Fyind",
      "url": "http://fyind.de"
    }
  ]
}</script><link rel="shortcut icon" href="/img/pic1.PNG"><link rel="canonical" href="http://fyind.de/2023/05/26/%E7%AE%97%E6%B3%95%E6%A8%A1%E6%9D%BF%E9%9B%86%E5%90%88/index.html"><link rel="preconnect" href="//cdn.jsdelivr.net"/><link rel="preconnect" href="//busuanzi.ibruce.info"/><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free/css/all.min.css"><script>
    (() => {
      
    const saveToLocal = {
      set: (key, value, ttl) => {
        if (!ttl) return
        const expiry = Date.now() + ttl * 86400000
        localStorage.setItem(key, JSON.stringify({ value, expiry }))
      },
      get: key => {
        const itemStr = localStorage.getItem(key)
        if (!itemStr) return undefined
        const { value, expiry } = JSON.parse(itemStr)
        if (Date.now() > expiry) {
          localStorage.removeItem(key)
          return undefined
        }
        return value
      }
    }

    window.btf = {
      saveToLocal,
      getScript: (url, attr = {}) => new Promise((resolve, reject) => {
        const script = document.createElement('script')
        script.src = url
        script.async = true
        Object.entries(attr).forEach(([key, val]) => script.setAttribute(key, val))
        script.onload = script.onreadystatechange = () => {
          if (!script.readyState || /loaded|complete/.test(script.readyState)) resolve()
        }
        script.onerror = reject
        document.head.appendChild(script)
      }),
      getCSS: (url, id) => new Promise((resolve, reject) => {
        const link = document.createElement('link')
        link.rel = 'stylesheet'
        link.href = url
        if (id) link.id = id
        link.onload = link.onreadystatechange = () => {
          if (!link.readyState || /loaded|complete/.test(link.readyState)) resolve()
        }
        link.onerror = reject
        document.head.appendChild(link)
      }),
      addGlobalFn: (key, fn, name = false, parent = window) => {
        if (!false && key.startsWith('pjax')) return
        const globalFn = parent.globalFn || {}
        globalFn[key] = globalFn[key] || {}
        globalFn[key][name || Object.keys(globalFn[key]).length] = fn
        parent.globalFn = globalFn
      }
    }
  
      
      const activateDarkMode = () => {
        document.documentElement.setAttribute('data-theme', 'dark')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#0d0d0d')
        }
      }
      const activateLightMode = () => {
        document.documentElement.setAttribute('data-theme', 'light')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#ffffff')
        }
      }

      btf.activateDarkMode = activateDarkMode
      btf.activateLightMode = activateLightMode

      const theme = saveToLocal.get('theme')
    
          theme === 'dark' ? activateDarkMode() : theme === 'light' ? activateLightMode() : null
        
      
      const asideStatus = saveToLocal.get('aside-status')
      if (asideStatus !== undefined) {
        document.documentElement.classList.toggle('hide-aside', asideStatus === 'hide')
      }
    
      
    const detectApple = () => {
      if (/iPad|iPhone|iPod|Macintosh/.test(navigator.userAgent)) {
        document.documentElement.classList.add('apple')
      }
    }
    detectApple()
  
    })()
  </script><script>const GLOBAL_CONFIG = {
  root: '/',
  algolia: undefined,
  localSearch: undefined,
  translate: undefined,
  highlight: {"plugin":"highlight.js","highlightCopy":true,"highlightLang":true,"highlightHeightLimit":false,"highlightFullpage":false,"highlightMacStyle":false},
  copy: {
    success: 'Copy Successful',
    error: 'Copy Failed',
    noSupport: 'Browser Not Supported'
  },
  relativeDate: {
    homepage: false,
    post: false
  },
  runtime: '',
  dateSuffix: {
    just: 'Just now',
    min: 'minutes ago',
    hour: 'hours ago',
    day: 'days ago',
    month: 'months ago'
  },
  copyright: undefined,
  lightbox: 'null',
  Snackbar: undefined,
  infinitegrid: {
    js: 'https://cdn.jsdelivr.net/npm/@egjs/infinitegrid/dist/infinitegrid.min.js',
    buttonText: 'Load More'
  },
  isPhotoFigcaption: false,
  islazyloadPlugin: false,
  isAnchor: false,
  percent: {
    toc: true,
    rightside: false,
  },
  autoDarkmode: false
}</script><script id="config-diff">var GLOBAL_CONFIG_SITE = {
  title: '算法模板集合',
  isHighlightShrink: false,
  isToc: true,
  pageType: 'post'
}</script><meta name="generator" content="Hexo 7.3.0"></head><body><div id="web_bg" style="background-image: url(https://fyindex.work/PicGo/liuyin.jpg);"></div><div id="sidebar"><div id="menu-mask"></div><div id="sidebar-menus"><div class="avatar-img text-center"><img src="/img/pic1.PNG" onerror="this.onerror=null;this.src='/img/friend_404.gif'" alt="avatar"/></div><div class="site-data text-center"><a href="/archives/"><div class="headline">Articles</div><div class="length-num">85</div></a><a href="/tags/"><div class="headline">Tags</div><div class="length-num">83</div></a><a href="/categories/"><div class="headline">Categories</div><div class="length-num">26</div></a></div><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> 首页</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> 归档</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> 标签</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> 分类</span></a></div><div class="menus_item"><a class="site-page" href="/categories/TUM%E7%AC%94%E8%AE%B0"><i class="fa-fw fas fa-folder-open"></i><span> TUM笔记</span></a></div><div class="menus_item"><a class="site-page" href="/link/"><i class="fa-fw fas fa-link"></i><span> 友情链接</span></a></div></div></div></div><div class="post" id="body-wrap"><header class="post-bg" id="page-header" style="background-image: url(/img/yae.jpg);"><nav id="nav"><span id="blog-info"><a class="nav-site-title" href="/"><span class="site-name">Fyind's Blog</span></a><a class="nav-page-title" href="/"><span class="site-name">算法模板集合</span><span class="site-name"><i class="fa-solid fa-circle-arrow-left"></i><span>  Back to Home</span></span></a></span><div id="menus"><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> 首页</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> 归档</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> 标签</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> 分类</span></a></div><div class="menus_item"><a class="site-page" href="/categories/TUM%E7%AC%94%E8%AE%B0"><i class="fa-fw fas fa-folder-open"></i><span> TUM笔记</span></a></div><div class="menus_item"><a class="site-page" href="/link/"><i class="fa-fw fas fa-link"></i><span> 友情链接</span></a></div></div><div id="toggle-menu"><span class="site-page"><i class="fas fa-bars fa-fw"></i></span></div></div></nav><div id="post-info"><h1 class="post-title">算法模板集合</h1><div id="post-meta"><div class="meta-firstline"><span class="post-meta-date"><i class="far fa-calendar-alt fa-fw post-meta-icon"></i><span class="post-meta-label">Created</span><time class="post-meta-date-created" datetime="2023-05-26T08:03:26.000Z" title="Created 2023-05-26 08:03:26">2023-05-26</time><span class="post-meta-separator">|</span><i class="fas fa-history fa-fw post-meta-icon"></i><span class="post-meta-label">Updated</span><time class="post-meta-date-updated" datetime="2025-07-18T10:49:53.881Z" title="Updated 2025-07-18 10:49:53">2025-07-18</time></span></div><div class="meta-secondline"><span class="post-meta-separator">|</span><span class="post-meta-pv-cv" id="" data-flag-title=""><i class="far fa-eye fa-fw post-meta-icon"></i><span class="post-meta-label">Post Views:</span><span id="busuanzi_value_page_pv"><i class="fa-solid fa-spinner fa-spin"></i></span></span></div></div></div></header><main class="layout" id="content-inner"><div id="post"><article class="container post-content" id="article-container"><h1 id="算法模板集合">算法模板集合</h1>
<p>[toc]</p>
<h2 id="编译">编译</h2>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">g++ name.cpp -Wall -Wextra --std=c++17 -o name; .\name.out</span><br></pre></td></tr></table></figure>
<h3 id="对拍">对拍</h3>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> os</span><br><span class="line"><span class="keyword">from</span> random <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">my = <span class="string">&#x27;m.exe&#x27;</span></span><br><span class="line">std = <span class="string">&#x27;std.exe&#x27;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">DSU</span>:</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self,n=<span class="number">0</span></span>) -&gt; <span class="literal">None</span>:</span><br><span class="line">        <span class="variable language_">self</span>.fa = [-<span class="number">1</span>]*(n+<span class="number">1</span>)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">find</span>(<span class="params">self, x: <span class="built_in">int</span></span>)-&gt;<span class="built_in">int</span>:</span><br><span class="line">        <span class="keyword">if</span> <span class="variable language_">self</span>.fa[x] == -<span class="number">1</span>:</span><br><span class="line">            <span class="keyword">return</span> x</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            <span class="variable language_">self</span>.fa[x] = <span class="variable language_">self</span>.find(<span class="variable language_">self</span>.fa[x])</span><br><span class="line">            <span class="keyword">return</span> <span class="variable language_">self</span>.fa[x]</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">join</span>(<span class="params">self, x, y</span>):</span><br><span class="line">        fax = <span class="variable language_">self</span>.find(x)</span><br><span class="line">        fay = <span class="variable language_">self</span>.find(y)</span><br><span class="line">        <span class="keyword">if</span> fax == fay:</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">False</span> </span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            <span class="variable language_">self</span>.fa[fax] = y</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">True</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">generateComplete</span>(<span class="params">n</span>):</span><br><span class="line">    all_edges = []</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">1</span>, n+<span class="number">1</span>):</span><br><span class="line">        <span class="keyword">for</span> j <span class="keyword">in</span> <span class="built_in">range</span>(i+<span class="number">1</span>,n+<span class="number">1</span>):</span><br><span class="line">            all_edges.append((i,j))</span><br><span class="line">    <span class="keyword">return</span> all_edges</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">generateTree</span>(<span class="params">n</span>):</span><br><span class="line">    all_edges = generateComplete(n)</span><br><span class="line">    shuffle(all_edges)</span><br><span class="line">    edges = []</span><br><span class="line">    dsu = DSU(n)</span><br><span class="line">    <span class="keyword">for</span> (a,b) <span class="keyword">in</span> all_edges:</span><br><span class="line">        <span class="keyword">if</span> dsu.join(a,b):</span><br><span class="line">            edges.append((a,b))</span><br><span class="line">    <span class="keyword">return</span> edges</span><br><span class="line">    </span><br><span class="line"><span class="keyword">def</span> <span class="title function_">generate_connected_Graph</span>(<span class="params">n,m</span>):</span><br><span class="line">    all_edges = generateComplete(n)</span><br><span class="line">    edges = []</span><br><span class="line">    dsu = DSU(n)</span><br><span class="line">    <span class="keyword">for</span> (a,b) <span class="keyword">in</span> all_edges:</span><br><span class="line">        <span class="keyword">if</span> <span class="built_in">len</span>(edges) &lt; n-<span class="number">1</span>:</span><br><span class="line">            <span class="keyword">if</span> dsu.join(a,b):</span><br><span class="line">                edges.append((a,b))</span><br><span class="line">        <span class="keyword">elif</span> <span class="built_in">len</span>(edges) == m:</span><br><span class="line">            <span class="keyword">break</span></span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            edges.append((a,b))</span><br><span class="line">    <span class="keyword">return</span> edges</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">genTests</span>(<span class="params">i</span>):</span><br><span class="line">    f = <span class="built_in">open</span>(<span class="string">&#x27;input.txt&#x27;</span>, <span class="string">&#x27;w&#x27;</span>)</span><br><span class="line">    N = randint(<span class="number">5</span>,<span class="number">15</span>)</span><br><span class="line">    edges = generateTree(N)</span><br><span class="line">    f.writelines(<span class="built_in">str</span>(N))</span><br><span class="line">    f.writelines(<span class="string">&#x27;\n&#x27;</span>)</span><br><span class="line">    <span class="keyword">for</span> (a,b) <span class="keyword">in</span> edges:</span><br><span class="line">        f.writelines(<span class="built_in">str</span>(a)+<span class="string">&quot; &quot;</span> + <span class="built_in">str</span>(b)+<span class="string">&quot;\n&quot;</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">duipai</span>():</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">1010</span>, <span class="number">1000000</span>):</span><br><span class="line">        genTests(i)</span><br><span class="line">        os.system(std + <span class="string">&#x27; &lt; input.txt &gt; std.out&#x27;</span>)</span><br><span class="line">        os.system(my + <span class="string">&#x27; &lt; input.txt &gt; my.out&#x27;</span>)</span><br><span class="line">        <span class="keyword">if</span> os.system(<span class="string">&#x27;fc std.out my.out&#x27;</span>):</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">&quot;WA&quot;</span>)</span><br><span class="line">            exit()</span><br><span class="line"></span><br><span class="line">duipai()</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&#x27;AC_all&#x27;</span>)</span><br></pre></td></tr></table></figure>
<h3 id="测时间">测时间</h3>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;chrono&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> chrono;</span><br><span class="line"></span><br><span class="line"><span class="keyword">auto</span> start = system_clock::<span class="built_in">now</span>();</span><br><span class="line">    <span class="comment">//Dij(mn); Code</span></span><br><span class="line"><span class="keyword">auto</span> finish = system_clock::<span class="built_in">now</span>();</span><br><span class="line"><span class="keyword">auto</span> duration = <span class="built_in">duration_cast</span>&lt;microseconds&gt;(finish - start);</span><br><span class="line"><span class="keyword">auto</span> cost = <span class="built_in">double</span>(duration.<span class="built_in">count</span>()) * microseconds::period::num / microseconds::period::den;</span><br><span class="line"></span><br><span class="line">cout &lt;&lt; <span class="string">&quot;cost: &quot;</span> &lt;&lt; cost &lt;&lt; <span class="string">&quot;s&quot;</span> &lt;&lt; endl;</span><br></pre></td></tr></table></figure>
<h2 id="debug">DEBUG</h2>
<ul>
<li>数组最大范围</li>
<li>long long 溢出</li>
<li>语句逻辑顺序，定义顺序</li>
<li>初始化</li>
<li>非法的转移 (从f[i-1]没判断边界)</li>
<li>特殊值，n=1，0</li>
<li>阅读题意</li>
<li>for变量正确</li>
</ul>
<h2 id="vscode-代码片段">VSCODE 代码片段</h2>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">	<span class="comment">// Place your snippets for cpp here. Each snippet is defined under a snippet name and has a prefix, body and </span></span><br><span class="line">	<span class="comment">// description. The prefix is what is used to trigger the snippet and the body will be expanded and inserted. Possible variables are:</span></span><br><span class="line">	<span class="comment">// $1, $2 for tab stops, $0 for the final cursor position, and $&#123;1:label&#125;, $&#123;2:another&#125; for placeholders. Placeholders with the </span></span><br><span class="line">	<span class="comment">// same ids are connected.</span></span><br><span class="line">	<span class="comment">// Example:</span></span><br><span class="line">	<span class="attr">&quot;Print to console&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">		<span class="attr">&quot;prefix&quot;</span><span class="punctuation">:</span> <span class="string">&quot;log&quot;</span><span class="punctuation">,</span></span><br><span class="line">		<span class="attr">&quot;body&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span></span><br><span class="line">			<span class="string">&quot;console.log(&#x27;$1&#x27;);&quot;</span><span class="punctuation">,</span></span><br><span class="line">			<span class="string">&quot;$2&quot;</span></span><br><span class="line">		<span class="punctuation">]</span><span class="punctuation">,</span></span><br><span class="line">		<span class="attr">&quot;description&quot;</span><span class="punctuation">:</span> <span class="string">&quot;Log output to console&quot;</span></span><br><span class="line">	<span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line"></span><br><span class="line">	<span class="attr">&quot;C++oimoretestcases&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">		<span class="attr">&quot;prefix&quot;</span><span class="punctuation">:</span> <span class="string">&quot;tbits&quot;</span><span class="punctuation">,</span></span><br><span class="line">		<span class="attr">&quot;body&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span></span><br><span class="line">			<span class="string">&quot;#include &lt;bits/stdc++.h&gt;&quot;</span><span class="punctuation">,</span></span><br><span class="line">			<span class="string">&quot;using namespace std;&quot;</span><span class="punctuation">,</span></span><br><span class="line">			<span class="string">&quot;#define _ &lt;&lt;\&quot; \&quot;&lt;&lt;&quot;</span><span class="punctuation">,</span></span><br><span class="line">			<span class="string">&quot;#define sz(x) ((int) (x).size())&quot;</span><span class="punctuation">,</span></span><br><span class="line">			<span class="string">&quot;typedef long long ll;&quot;</span><span class="punctuation">,</span></span><br><span class="line">			<span class="string">&quot;typedef pair&lt;int, int&gt; pii;&quot;</span><span class="punctuation">,</span></span><br><span class="line">			<span class="string">&quot;typedef vector&lt;vector&lt;int&gt;&gt; Graph;&quot;</span><span class="punctuation">,</span></span><br><span class="line">			<span class="string">&quot;typedef vector&lt;vector&lt;pair&lt;int,ll&gt;&gt;&gt; Graphl;&quot;</span><span class="punctuation">,</span></span><br><span class="line">			<span class="string">&quot;const int maxn = 5e5 + 5;&quot;</span><span class="punctuation">,</span></span><br><span class="line">			<span class="string">&quot;\n&quot;</span><span class="punctuation">,</span></span><br><span class="line">			<span class="string">&quot;int n, m, T;\n&quot;</span><span class="punctuation">,</span></span><br><span class="line">			<span class="string">&quot;void run_case() &#123;&quot;</span><span class="punctuation">,</span></span><br><span class="line">			<span class="string">&quot;\t&quot;</span><span class="punctuation">,</span></span><br><span class="line">			<span class="string">&quot;&#125;\n&quot;</span><span class="punctuation">,</span></span><br><span class="line">			<span class="string">&quot;int main() &#123;&quot;</span><span class="punctuation">,</span></span><br><span class="line">			<span class="string">&quot;\tios_base::sync_with_stdio(0);&quot;</span><span class="punctuation">,</span></span><br><span class="line">			<span class="string">&quot;\tcin.tie(0);&quot;</span><span class="punctuation">,</span></span><br><span class="line">			<span class="string">&quot;\tcin &gt;&gt; T;&quot;</span><span class="punctuation">,</span></span><br><span class="line">			<span class="string">&quot;\twhile (T--) run_case();&quot;</span><span class="punctuation">,</span></span><br><span class="line">			<span class="string">&quot;\treturn 0;&quot;</span><span class="punctuation">,</span></span><br><span class="line">			<span class="string">&quot;&#125;&quot;</span></span><br><span class="line">		<span class="punctuation">]</span><span class="punctuation">,</span></span><br><span class="line">		<span class="attr">&quot;description&quot;</span><span class="punctuation">:</span> <span class="string">&quot;c++snippets more testcases&quot;</span></span><br><span class="line">	<span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line"></span><br><span class="line">	<span class="attr">&quot;C++oistandard&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">		<span class="attr">&quot;prefix&quot;</span><span class="punctuation">:</span> <span class="string">&quot;bits&quot;</span><span class="punctuation">,</span></span><br><span class="line">		<span class="attr">&quot;body&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span></span><br><span class="line">			<span class="string">&quot;#include &lt;bits/stdc++.h&gt;&quot;</span><span class="punctuation">,</span></span><br><span class="line">			<span class="string">&quot;using namespace std;&quot;</span><span class="punctuation">,</span></span><br><span class="line">			<span class="string">&quot;#define _ &lt;&lt;\&quot; \&quot;&lt;&lt;&quot;</span><span class="punctuation">,</span></span><br><span class="line">			<span class="string">&quot;#define sz(x) ((int) (x).size())&quot;</span><span class="punctuation">,</span></span><br><span class="line">			<span class="string">&quot;typedef long long ll;&quot;</span><span class="punctuation">,</span></span><br><span class="line">			<span class="string">&quot;typedef pair&lt;int, int&gt; pii;&quot;</span><span class="punctuation">,</span></span><br><span class="line">			<span class="string">&quot;typedef vector&lt;vector&lt;int&gt;&gt; Graph;&quot;</span><span class="punctuation">,</span></span><br><span class="line">			<span class="string">&quot;typedef vector&lt;vector&lt;pair&lt;int,ll&gt;&gt;&gt; Graphl;&quot;</span><span class="punctuation">,</span></span><br><span class="line">			<span class="string">&quot;const int maxn = 5e5 + 5;&quot;</span><span class="punctuation">,</span></span><br><span class="line">			<span class="string">&quot;\n&quot;</span><span class="punctuation">,</span></span><br><span class="line">			<span class="string">&quot;int n, m;\n&quot;</span><span class="punctuation">,</span></span><br><span class="line">			<span class="string">&quot;int main() &#123;&quot;</span><span class="punctuation">,</span></span><br><span class="line">			<span class="string">&quot;\tios_base::sync_with_stdio(0);&quot;</span><span class="punctuation">,</span></span><br><span class="line">			<span class="string">&quot;\tcin.tie(0);&quot;</span><span class="punctuation">,</span></span><br><span class="line">			<span class="string">&quot;\t$1&quot;</span><span class="punctuation">,</span></span><br><span class="line">			<span class="string">&quot;\treturn 0;&quot;</span><span class="punctuation">,</span></span><br><span class="line">			<span class="string">&quot;&#125;&quot;</span></span><br><span class="line">		<span class="punctuation">]</span><span class="punctuation">,</span></span><br><span class="line">		<span class="attr">&quot;description&quot;</span><span class="punctuation">:</span> <span class="string">&quot;c++snippts&quot;</span></span><br><span class="line">	<span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">	</span><br><span class="line">	<span class="attr">&quot;filereadin&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">		<span class="attr">&quot;prefix&quot;</span><span class="punctuation">:</span> <span class="string">&quot;fre&quot;</span><span class="punctuation">,</span></span><br><span class="line">		<span class="attr">&quot;body&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span></span><br><span class="line">			<span class="string">&quot;freopen(\&quot;d.txt\&quot;,\&quot;r\&quot;,stdin);&quot;</span><span class="punctuation">,</span></span><br><span class="line">			<span class="string">&quot;$1&quot;</span></span><br><span class="line">		<span class="punctuation">]</span><span class="punctuation">,</span></span><br><span class="line">		<span class="attr">&quot;description&quot;</span><span class="punctuation">:</span> <span class="string">&quot;filereadin&quot;</span></span><br><span class="line">	<span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line"></span><br><span class="line">	<span class="attr">&quot;deltearray&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">		<span class="attr">&quot;prefix&quot;</span><span class="punctuation">:</span> <span class="string">&quot;delarr&quot;</span><span class="punctuation">,</span></span><br><span class="line">		<span class="attr">&quot;body&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span></span><br><span class="line">			<span class="string">&quot;if ($&#123;1:name&#125;) &#123; delete [] $&#123;1:name&#125;; $&#123;1:name&#125; = NULL; &#125;&quot;</span></span><br><span class="line">		<span class="punctuation">]</span><span class="punctuation">,</span></span><br><span class="line">		<span class="attr">&quot;description&quot;</span><span class="punctuation">:</span> <span class="string">&quot;delte an array&quot;</span></span><br><span class="line">	<span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line"></span><br><span class="line">	<span class="attr">&quot;forloopi&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">		<span class="attr">&quot;prefix&quot;</span><span class="punctuation">:</span> <span class="string">&quot;fori&quot;</span><span class="punctuation">,</span></span><br><span class="line">		<span class="attr">&quot;body&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span></span><br><span class="line">			<span class="string">&quot;for (int i = 1;i &lt;= $&#123;1:n&#125;; ++i) &#123;&quot;</span><span class="punctuation">,</span></span><br><span class="line">			<span class="string">&quot;\t$2&quot;</span><span class="punctuation">,</span></span><br><span class="line">			<span class="string">&quot;&#125;&quot;</span></span><br><span class="line">		<span class="punctuation">]</span><span class="punctuation">,</span></span><br><span class="line">		<span class="attr">&quot;description&quot;</span><span class="punctuation">:</span> <span class="string">&quot;fori&quot;</span></span><br><span class="line">	<span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line"></span><br><span class="line">	<span class="attr">&quot;forloopj&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">		<span class="attr">&quot;prefix&quot;</span><span class="punctuation">:</span> <span class="string">&quot;forj&quot;</span><span class="punctuation">,</span></span><br><span class="line">		<span class="attr">&quot;body&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span></span><br><span class="line">			<span class="string">&quot;for (int j = 1;j &lt;= $&#123;1:m&#125;; ++j) &#123;&quot;</span><span class="punctuation">,</span></span><br><span class="line">			<span class="string">&quot;\t$2&quot;</span><span class="punctuation">,</span></span><br><span class="line">			<span class="string">&quot;&#125;&quot;</span></span><br><span class="line">		<span class="punctuation">]</span></span><br><span class="line">	<span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line"></span><br><span class="line">	<span class="attr">&quot;forloopk&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">		<span class="attr">&quot;prefix&quot;</span><span class="punctuation">:</span> <span class="string">&quot;fork&quot;</span><span class="punctuation">,</span></span><br><span class="line">		<span class="attr">&quot;body&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span></span><br><span class="line">			<span class="string">&quot;for (int k = 1;k &lt;= $&#123;1:m&#125;; ++k) &#123;&quot;</span><span class="punctuation">,</span></span><br><span class="line">			<span class="string">&quot;\t$2&quot;</span><span class="punctuation">,</span></span><br><span class="line">			<span class="string">&quot;&#125;&quot;</span></span><br><span class="line">		<span class="punctuation">]</span></span><br><span class="line">	<span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">	<span class="attr">&quot;vector1&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">		<span class="attr">&quot;prefix&quot;</span><span class="punctuation">:</span> <span class="string">&quot;vec1&quot;</span><span class="punctuation">,</span></span><br><span class="line">		<span class="attr">&quot;body&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span></span><br><span class="line">			<span class="string">&quot;vector&lt;int&gt; $&#123;1:A&#125;(n+1);\n&quot;</span></span><br><span class="line">		<span class="punctuation">]</span></span><br><span class="line">	<span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">	<span class="attr">&quot;vector2&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">		<span class="attr">&quot;prefix&quot;</span><span class="punctuation">:</span> <span class="string">&quot;vec2&quot;</span><span class="punctuation">,</span></span><br><span class="line">		<span class="attr">&quot;body&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span></span><br><span class="line">			<span class="string">&quot;vector&lt;vector&lt;int&gt;&gt; $&#123;1:G&#125;(n+1, vector&lt;int&gt;($2));\n&quot;</span></span><br><span class="line">		<span class="punctuation">]</span></span><br><span class="line">	<span class="punctuation">&#125;</span></span><br><span class="line">	<span class="punctuation">,</span></span><br><span class="line">	<span class="attr">&quot;vector3&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">		<span class="attr">&quot;prefix&quot;</span><span class="punctuation">:</span> <span class="string">&quot;vec3&quot;</span><span class="punctuation">,</span></span><br><span class="line">		<span class="attr">&quot;body&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span></span><br><span class="line">			<span class="string">&quot;vector&lt;vector&lt;vector&lt;int&gt;&gt;&gt; $&#123;1:f&#125;(n+1, vector&lt;vector&lt;int&gt;&gt;(m+1, vector&lt;int&gt;($&#123;2:p+1&#125;, $&#123;3:oo&#125;)));\n&quot;</span></span><br><span class="line">		<span class="punctuation">]</span></span><br><span class="line">	<span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line"></span><br><span class="line">	<span class="attr">&quot;print arr&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">		<span class="attr">&quot;prefix&quot;</span><span class="punctuation">:</span> <span class="string">&quot;parr&quot;</span><span class="punctuation">,</span></span><br><span class="line">		<span class="attr">&quot;body&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span></span><br><span class="line">			<span class="string">&quot;for (int i = 1;i &lt;= $&#123;1:n&#125;; ++i) &#123;\n\tcout &lt;&lt; $&#123;2:A[i]&#125; &lt;&lt; \&quot; \&quot;;\n&#125;cout &lt;&lt; endl;&quot;</span></span><br><span class="line">		<span class="punctuation">]</span></span><br><span class="line">	<span class="punctuation">&#125;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure>
<h2 id="计算几何">计算几何</h2>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">const</span> <span class="type">double</span> eps = <span class="number">1e-13</span>;</span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">Point</span> &#123;</span><br><span class="line">    <span class="type">double</span> x, y;</span><br><span class="line">    <span class="built_in">Point</span>(<span class="type">double</span> x=<span class="number">0</span>, <span class="type">double</span> y=<span class="number">0</span>) : <span class="built_in">x</span>(x), <span class="built_in">y</span>(y) &#123;&#125;</span><br><span class="line">&#125;;</span><br><span class="line"><span class="keyword">typedef</span> Point Vector;</span><br><span class="line">Vector <span class="keyword">operator</span> + (Vector a, Vector b) &#123; <span class="keyword">return</span> <span class="built_in">Vector</span>(a.x + b.x, a.y + b.y); &#125;</span><br><span class="line">Vector <span class="keyword">operator</span> - (Vector a, Vector b) &#123; <span class="keyword">return</span> <span class="built_in">Vector</span>(a.x - b.x, a.y - b.y); &#125;</span><br><span class="line">Vector <span class="keyword">operator</span> * (Vector a, <span class="type">double</span> p) &#123; <span class="keyword">return</span> <span class="built_in">Vector</span>(a.x*p, a.y*p); &#125;</span><br><span class="line">Vector <span class="keyword">operator</span> / (Vector a, <span class="type">double</span> p) &#123; <span class="keyword">return</span> <span class="built_in">Vector</span>(a.x/p, a.y/p); &#125;</span><br><span class="line"><span class="type">bool</span> <span class="keyword">operator</span> &lt; (<span class="type">const</span> Point&amp; a, <span class="type">const</span> Point&amp; b) &#123;</span><br><span class="line">    <span class="keyword">return</span> a.x &lt; b.x || (a.x == b.x &amp;&amp; a.y &lt; b.y);</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">dcmp</span><span class="params">(<span class="type">double</span> x)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (<span class="built_in">fabs</span>(x) &lt; eps) <span class="keyword">return</span> <span class="number">0</span>; <span class="keyword">else</span> <span class="keyword">return</span> x &lt; <span class="number">0</span> ? <span class="number">-1</span> : <span class="number">1</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="type">bool</span> <span class="keyword">operator</span> == (<span class="type">const</span> Point&amp; a, <span class="type">const</span> Point&amp; b) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">dcmp</span>(a.x-b.x) == <span class="number">0</span> &amp;&amp; <span class="built_in">dcmp</span>(a.y-b.y) == <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">double</span> <span class="title">Dot</span><span class="params">(Vector a, Vector b)</span> </span>&#123; <span class="keyword">return</span> a.x*b.x + a.y*b.y; &#125;</span><br><span class="line"><span class="function"><span class="type">double</span> <span class="title">Length</span><span class="params">(Vector a)</span> </span>&#123; <span class="keyword">return</span> <span class="built_in">sqrt</span>(<span class="built_in">Dot</span>(a, a)); &#125;</span><br><span class="line"><span class="function"><span class="type">double</span> <span class="title">Angle</span><span class="params">(Vector a, Vector b)</span> </span>&#123; <span class="keyword">return</span> <span class="built_in">acos</span>(<span class="built_in">Dot</span>(a,b) / <span class="built_in">Length</span>(a) / <span class="built_in">Length</span>(b)); &#125;</span><br><span class="line"><span class="function"><span class="type">double</span> <span class="title">Cross</span><span class="params">(Vector a, Vector b)</span> </span>&#123; <span class="keyword">return</span> a.x*b.y - a.y*b.x; &#125;</span><br><span class="line"><span class="function"><span class="type">double</span> <span class="title">Area2</span><span class="params">(Point a, Point b, Point c)</span> </span>&#123; <span class="keyword">return</span> <span class="built_in">Cross</span>(b-a, c-a); &#125;</span><br><span class="line"><span class="function">Vector <span class="title">Rotate</span><span class="params">(Vector a, <span class="type">double</span> rad)</span> </span>&#123; <span class="keyword">return</span> <span class="built_in">Vector</span>(a.x*<span class="built_in">cos</span>(rad) - a.y*<span class="built_in">sin</span>(rad), a.x*<span class="built_in">sin</span>(rad)+a.y*<span class="built_in">cos</span>(rad)); &#125;</span><br><span class="line"><span class="function">Vector <span class="title">Normal</span><span class="params">(Vector a)</span> </span>&#123; <span class="type">double</span> L = <span class="built_in">Length</span>(a); <span class="keyword">return</span> <span class="built_in">Vector</span>(-a.y/L, a.x/L); &#125;</span><br><span class="line"></span><br><span class="line"><span class="function">vector&lt;Point&gt; <span class="title">convexhull</span><span class="params">(vector&lt;Point&gt; &amp;P)</span> </span>&#123;</span><br><span class="line">    vector&lt;Point&gt; h;</span><br><span class="line">    <span class="built_in">sort</span>(P.<span class="built_in">begin</span>(), P.<span class="built_in">end</span>()); P.<span class="built_in">erase</span>(<span class="built_in">unique</span>(P.<span class="built_in">begin</span>(), P.<span class="built_in">end</span>()), P.<span class="built_in">end</span>());</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>;i &lt; <span class="built_in">sz</span>(P); ++i) &#123;</span><br><span class="line">        <span class="keyword">while</span> (<span class="built_in">sz</span>(h) &gt; <span class="number">1</span> &amp;&amp; <span class="built_in">Cross</span>(h.<span class="built_in">back</span>()-h[<span class="built_in">sz</span>(h)<span class="number">-2</span>],P[i]-h[<span class="built_in">sz</span>(h)<span class="number">-2</span>]) +eps &lt; <span class="number">0</span>) h.<span class="built_in">pop_back</span>();</span><br><span class="line">        h.<span class="built_in">push_back</span>(P[i]);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="type">int</span> k = <span class="built_in">sz</span>(h);</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="built_in">sz</span>(P)<span class="number">-2</span>;i &gt;= <span class="number">0</span>; --i) &#123;</span><br><span class="line">        <span class="keyword">while</span> (<span class="built_in">sz</span>(h) &gt; k &amp;&amp; <span class="built_in">Cross</span>(h.<span class="built_in">back</span>()-h[<span class="built_in">sz</span>(h)<span class="number">-2</span>],P[i]-h[<span class="built_in">sz</span>(h)<span class="number">-2</span>]) +eps &lt; <span class="number">0</span>) h.<span class="built_in">pop_back</span>();</span><br><span class="line">        h.<span class="built_in">push_back</span>(P[i]);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (!h.<span class="built_in">empty</span>()) h.<span class="built_in">pop_back</span>();</span><br><span class="line">    <span class="keyword">return</span> h;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function">Point <span class="title">GetLineIntersection</span><span class="params">(Point p, Vector v, Point q, Vector w)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> p + v*(<span class="built_in">Cross</span>(w, p-q) / <span class="built_in">Cross</span>(v, w));</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">double</span> <span class="title">DistanceToLine</span><span class="params">(Point p, Point a, Point b)</span> </span>&#123;</span><br><span class="line">    Vector v1 = b-a, v2 = p-a;</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">fabs</span>(<span class="built_in">Cross</span>(v1, v2)) / <span class="built_in">Length</span>(v1); <span class="comment">// 不取绝对值是有向距离</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">double</span> <span class="title">DistanceToSegment</span><span class="params">(Point p, Point a, Point b)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (a == b) <span class="keyword">return</span> <span class="built_in">Length</span>(p-a);</span><br><span class="line">    Vector v1 = b-a, v2 = p-a, v3 = p-b;</span><br><span class="line">    <span class="keyword">if</span> (<span class="built_in">dcmp</span>(<span class="built_in">Dot</span>(v1, v2)) &lt; <span class="number">0</span>) <span class="keyword">return</span> <span class="built_in">Length</span>(v2);</span><br><span class="line">    <span class="keyword">else</span> <span class="keyword">if</span> (<span class="built_in">dcmp</span>(<span class="built_in">Dot</span>(v1, v3)) &gt; <span class="number">0</span>) <span class="keyword">return</span> <span class="built_in">Length</span>(v3);</span><br><span class="line">    <span class="keyword">else</span> <span class="keyword">return</span> <span class="built_in">fabs</span>(<span class="built_in">Cross</span>(v1,v2)) / <span class="built_in">Length</span>(v1);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function">Point <span class="title">GetLineProjection</span><span class="params">(Point p, Point a, Point b)</span> </span>&#123;</span><br><span class="line">    Vector v = b-a;</span><br><span class="line">    <span class="keyword">return</span> a+v*(<span class="built_in">Dot</span>(v, p-a) / <span class="built_in">Dot</span>(v, v));</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">bool</span> <span class="title">SegmentProperIntersection</span><span class="params">(Point a1, Point a2, Point b1, Point b2)</span> </span>&#123; <span class="comment">// 不包括端点,重合</span></span><br><span class="line">    <span class="type">double</span> c1 = <span class="built_in">Cross</span>(a2-a1, b1-a1), c2 = <span class="built_in">Cross</span>(a2-a1, b2-a1),</span><br><span class="line">           c3 = <span class="built_in">Cross</span>(b2-b1, a1-b1), c4 = <span class="built_in">Cross</span>(b2-b1, a2-b1);</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">dcmp</span>(c1)*<span class="built_in">dcmp</span>(c2) &lt; <span class="number">0</span> &amp;&amp; <span class="built_in">dcmp</span>(c3)*<span class="built_in">dcmp</span>(c4) &lt; <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">bool</span> <span class="title">OnSegment</span><span class="params">(Point p, Point a1, Point a2)</span> </span>&#123; <span class="comment">// 不包括端点</span></span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">dcmp</span>(<span class="built_in">Cross</span>(a1-p, a2-p)) == <span class="number">0</span> &amp;&amp; <span class="built_in">dcmp</span>(<span class="built_in">Dot</span>(a1-p, a2-p)) &lt; <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"> </span><br><span class="line"><span class="function"><span class="type">double</span> <span class="title">PolygonArea</span><span class="params">(vector&lt;Point&gt; &amp;P)</span> </span>&#123; <span class="comment">// following untest</span></span><br><span class="line">    <span class="type">double</span> area = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">1</span>;i &lt; <span class="built_in">sz</span>(P); ++i) &#123;</span><br><span class="line">        area += <span class="built_in">Cross</span>(P[i]-P[<span class="number">0</span>], P[(i<span class="number">+1</span>)%<span class="built_in">sz</span>(P)]-P[<span class="number">0</span>]);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">abs</span>(area/<span class="number">2</span>); <span class="comment">// directed without abs</span></span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">isPointInPolygon</span><span class="params">(Point p, vector&lt;Point&gt; &amp;P)</span> </span>&#123;</span><br><span class="line">    <span class="type">int</span> wn = <span class="number">0</span>;</span><br><span class="line">    <span class="type">int</span> n = <span class="built_in">sz</span>(P);</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>;i &lt; n; ++i) &#123;</span><br><span class="line">        <span class="keyword">if</span> (<span class="built_in">OnSegment</span>(p, P[i], P[(i<span class="number">+1</span>)%n])) <span class="keyword">return</span> <span class="number">-1</span>; <span class="comment">// on border</span></span><br><span class="line">        <span class="type">int</span> k = <span class="built_in">dcmp</span>(<span class="built_in">Cross</span>(P[(i<span class="number">+1</span>)%n]-P[i], p-P[i]));</span><br><span class="line">        <span class="type">int</span> d1 = <span class="built_in">dcmp</span>(P[i].y-p.y);</span><br><span class="line">        <span class="type">int</span> d2 = <span class="built_in">dcmp</span>(P[(i<span class="number">+1</span>)%n].y-p.y);</span><br><span class="line">        <span class="keyword">if</span> (k &gt; <span class="number">0</span> &amp;&amp; d1 &lt;= <span class="number">0</span> &amp;&amp; d2 &gt; <span class="number">0</span>) wn++;</span><br><span class="line">        <span class="keyword">if</span> (k &lt; <span class="number">0</span> &amp;&amp; d2 &lt;= <span class="number">0</span> &amp;&amp; d1 &gt; <span class="number">0</span>) wn--;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (wn != <span class="number">0</span>) <span class="keyword">return</span> <span class="number">1</span>; <span class="comment">// inside</span></span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>; <span class="comment">// outside</span></span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line"><span class="comment">// ball</span></span><br><span class="line"><span class="function"><span class="type">double</span> <span class="title">torad</span><span class="params">(<span class="type">double</span> deg)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> deg/<span class="number">180</span> * <span class="built_in">acos</span>(<span class="number">-1</span>); </span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line"><span class="comment">// change latitude,langtitude(degree) to (x,y,z) </span></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">get_coord</span><span class="params">(<span class="type">double</span> R, <span class="type">double</span> lat, <span class="type">double</span> lng, <span class="type">double</span> &amp;x, <span class="type">double</span> &amp;y, <span class="type">double</span> &amp;z)</span> </span>&#123;</span><br><span class="line">    lat = <span class="built_in">torad</span>(lat);</span><br><span class="line">    lng = <span class="built_in">torad</span>(lng);</span><br><span class="line">    x = R*<span class="built_in">cos</span>(lat)*<span class="built_in">cos</span>(lng);</span><br><span class="line">    y = R*<span class="built_in">cos</span>(lat)*<span class="built_in">sin</span>(lng);</span><br><span class="line">    z = R*<span class="built_in">sin</span>(lat);</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<h4 id="圆">圆</h4>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">struct</span> <span class="title class_">Circle</span> &#123;</span><br><span class="line">    Point c; <span class="type">double</span> r;</span><br><span class="line">    <span class="built_in">Circle</span>(Point c, <span class="type">double</span> r) : <span class="built_in">c</span>(c), <span class="built_in">r</span>(r) &#123;&#125;</span><br><span class="line">    <span class="function">Point <span class="title">point</span><span class="params">(<span class="type">double</span> a)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">Point</span>(c.x + <span class="built_in">cos</span>(a)*r, c.y + <span class="built_in">sin</span>(a)*r);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">Line</span> &#123;</span><br><span class="line">    Point p; Vector v;</span><br><span class="line">    <span class="built_in">Line</span>(Point p, Vector v) : <span class="built_in">p</span>(p), <span class="built_in">v</span>(v) &#123;&#125;</span><br><span class="line">    <span class="function">Point <span class="title">point</span><span class="params">(<span class="type">double</span> a)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">Point</span>(p.x + a*v.x, p.y + a*v.y);</span><br><span class="line">    &#125; </span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">getLineCircleIntersection</span><span class="params">(Line L, Circle C, <span class="type">double</span>&amp; t1, <span class="type">double</span>&amp; t2, vector&lt;Point&gt;&amp; sol)</span> </span>&#123;</span><br><span class="line">    <span class="type">double</span> a = L.v.x, b = L.p.x - C.c.x, c = L.v.y, d = L.p.y - C.c.y;</span><br><span class="line">    <span class="type">double</span> e = a*a + c*c, f = <span class="number">2</span>*(a*b + c*d), g = b*b + d*d - C.r*C.r;</span><br><span class="line">    <span class="type">double</span> delta = f*f - <span class="number">4</span>*e*g;</span><br><span class="line">    <span class="keyword">if</span> (<span class="built_in">dcmp</span>(delta) &lt; <span class="number">0</span>) <span class="keyword">return</span> <span class="number">0</span>; <span class="comment">// 相离</span></span><br><span class="line">    <span class="keyword">if</span> (<span class="built_in">dcmp</span>(delta) == <span class="number">0</span>) &#123;</span><br><span class="line">        t1 = t2 = -f / (<span class="number">2</span>*e); sol.<span class="built_in">push_back</span>(L.<span class="built_in">point</span>(t1));</span><br><span class="line">        <span class="keyword">return</span> <span class="number">1</span>; <span class="comment">// 相切</span></span><br><span class="line">    &#125; </span><br><span class="line">    t1 = (-f - <span class="built_in">sqrt</span>(delta)) / (<span class="number">2</span>*e); sol.<span class="built_in">push_back</span>(L.<span class="built_in">point</span>(t1));</span><br><span class="line">    t2 = (-f + <span class="built_in">sqrt</span>(delta)) / (<span class="number">2</span>*e); sol.<span class="built_in">push_back</span>(L.<span class="built_in">point</span>(t2));</span><br><span class="line">    <span class="keyword">return</span> <span class="number">2</span>; <span class="comment">// 相交</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">double</span> <span class="title">angle</span><span class="params">(Vector v)</span> </span>&#123; <span class="keyword">return</span> <span class="built_in">atan2</span>(v.y, v.x); &#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">getCircleCircleIntersection</span><span class="params">(Circle C1, Circle C2, vector&lt;Point&gt;&amp; sol)</span> </span>&#123;</span><br><span class="line">    <span class="type">double</span> d = <span class="built_in">Length</span>(C<span class="number">1.</span>c - C<span class="number">2.</span>c);</span><br><span class="line">    <span class="keyword">if</span> (<span class="built_in">dcmp</span>(d) == <span class="number">0</span>) &#123;</span><br><span class="line">        <span class="keyword">if</span> (<span class="built_in">dcmp</span>(C<span class="number">1.</span>r - C<span class="number">2.</span>r) == <span class="number">0</span>) <span class="keyword">return</span> <span class="number">-1</span>; <span class="comment">// 重合</span></span><br><span class="line">        <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (<span class="built_in">dcmp</span>(C<span class="number">1.</span>r + C<span class="number">2.</span>r - d) &lt; <span class="number">0</span>) <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">if</span> (<span class="built_in">dcmp</span>(<span class="built_in">fabs</span>(C<span class="number">1.</span>r-C<span class="number">2.</span>r) - d) &gt; <span class="number">0</span>) <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">    <span class="type">double</span> a = <span class="built_in">angle</span>(C<span class="number">2.</span>c - C<span class="number">1.</span>c);</span><br><span class="line">    <span class="type">double</span> da = <span class="built_in">acos</span>((C<span class="number">1.</span>r*C<span class="number">1.</span>r + d*d - C<span class="number">2.</span>r*C<span class="number">2.</span>r) / (<span class="number">2</span>*C<span class="number">1.</span>r*d));</span><br><span class="line">    Point p1 = C<span class="number">1.</span><span class="built_in">point</span>(a - da), p2 = C<span class="number">1.</span><span class="built_in">point</span>(a + da);</span><br><span class="line">    sol.<span class="built_in">push_back</span>(p1);</span><br><span class="line">    <span class="keyword">if</span> (p1 == p2) <span class="keyword">return</span> <span class="number">1</span>;</span><br><span class="line">    sol.<span class="built_in">push_back</span>(p2);</span><br><span class="line">    <span class="keyword">return</span> <span class="number">2</span>; </span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">getTangents</span><span class="params">(Point p, Circle C, vector&lt;Vector&gt;&amp; v)</span> </span>&#123;</span><br><span class="line">    Vector u = C.c - p;</span><br><span class="line">    <span class="type">double</span> dist = <span class="built_in">Length</span>(u);</span><br><span class="line">    <span class="keyword">if</span> (dist &lt; C.r) <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">else</span> <span class="keyword">if</span> (<span class="built_in">dcmp</span>(dist - C.r) == <span class="number">0</span> ) &#123;</span><br><span class="line">        v.<span class="built_in">push_back</span>(<span class="built_in">Rotate</span>(u, PI/<span class="number">2</span>));</span><br><span class="line">        <span class="keyword">return</span> <span class="number">1</span>;</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="type">double</span> ang = <span class="built_in">asin</span>(C.r / dist);</span><br><span class="line">        v.<span class="built_in">push_back</span>(<span class="built_in">Rotate</span>(u, -ang));</span><br><span class="line">        v.<span class="built_in">push_back</span>(<span class="built_in">Rotate</span>(u, +ang));</span><br><span class="line">        <span class="keyword">return</span> <span class="number">2</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function">Point <span class="title">midpoint</span><span class="params">(Point a, Point b)</span> </span>&#123; <span class="keyword">return</span> <span class="built_in">Point</span>((a.x+b.x)/<span class="number">2</span>, (a.y+b.y)/<span class="number">2</span>); &#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<h3 id="排序极角">排序极角</h3>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="function">ll <span class="title">Cross</span><span class="params">(Vector a, Vector b)</span> </span>&#123; <span class="keyword">return</span> a.x*b.y - a.y*b.x; &#125;</span><br><span class="line"><span class="type">int</span> n, m, T;</span><br><span class="line">vector&lt;Point&gt; P;</span><br><span class="line"><span class="function"><span class="type">bool</span> <span class="title">up</span><span class="params">(Point a)</span></span>&#123;</span><br><span class="line">    <span class="keyword">return</span> a.y &gt; <span class="number">0</span> || (a.y == <span class="number">0</span> &amp;&amp; a.x &gt;= <span class="number">0</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="built_in">sort</span>(P.<span class="built_in">begin</span>(), P.<span class="built_in">end</span>(), [&amp;](<span class="keyword">auto</span> a,<span class="keyword">auto</span> b) &#123;</span><br><span class="line">    <span class="keyword">if</span> (<span class="built_in">up</span>(a) != <span class="built_in">up</span>(b)) <span class="keyword">return</span> <span class="built_in">up</span>(a) &gt; <span class="built_in">up</span>(b);</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">Cross</span>(a, b) &gt; <span class="number">0</span>;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<h2 id="读入优化">读入优化</h2>
<h3 id="编译优化">编译优化</h3>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">pragma</span> GCC optimize(<span class="string">&quot;O3&quot;</span>, <span class="string">&quot;unroll-loops&quot;</span>)</span></span><br><span class="line"><span class="meta">#<span class="keyword">pragma</span> GCC target(<span class="string">&quot;avx2&quot;</span>)</span></span><br></pre></td></tr></table></figure>
<h3 id="cin优化">cin优化</h3>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ios_base::<span class="built_in">sync_with_stdio</span>(<span class="number">0</span>); cin.<span class="built_in">tie</span>(<span class="number">0</span>);</span><br></pre></td></tr></table></figure>
<h3 id="快读快写">快读快写</h3>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">int</span> <span class="title">read</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="type">int</span> x = <span class="number">0</span>; <span class="type">char</span> ch = <span class="number">0</span>, w = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">while</span>(!<span class="built_in">isdigit</span>(ch)) &#123;w |= ch == <span class="string">&#x27;-&#x27;</span>; ch=<span class="built_in">getchar</span>();&#125;</span><br><span class="line">    <span class="keyword">while</span>(<span class="built_in">isdigit</span>(ch)) x = (x&lt;&lt;<span class="number">3</span>) + (x&lt;&lt;<span class="number">1</span>) + (ch^<span class="number">48</span>), ch=<span class="built_in">getchar</span>();</span><br><span class="line">    <span class="keyword">return</span> w ? -x : x;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">void</span> <span class="title">write</span><span class="params">(<span class="type">int</span> x)</span> </span>&#123; <span class="comment">// long long 请勿使用</span></span><br><span class="line">    <span class="keyword">if</span>(x &lt; <span class="number">0</span>) &#123; <span class="built_in">putchar</span>(<span class="string">&#x27;-&#x27;</span>); x=-x; &#125;</span><br><span class="line">    <span class="keyword">if</span>(x&gt;<span class="number">9</span>) <span class="built_in">write</span>(x/<span class="number">10</span>);</span><br><span class="line">    <span class="built_in">putchar</span>(x%<span class="number">10</span>+<span class="string">&#x27;0&#x27;</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">#<span class="keyword">define</span> nl putchar(<span class="string">&#x27;\n&#x27;</span>)</span></span><br></pre></td></tr></table></figure>
<h3 id="多个测试数据">多个测试数据</h3>
<h4 id="以eof结尾">以EOF结尾</h4>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">while</span> (cin &gt;&gt; n) &#123;</span><br><span class="line">    </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="以0结尾">以0结尾</h4>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">while</span> ((cin &gt;&gt; n) &amp;&amp; n) &#123;</span><br><span class="line">    </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="给定数据组数">给定数据组数</h4>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">int</span> T; cin &gt;&gt; T;</span><br><span class="line"><span class="keyword">while</span>(T--) &#123;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="stl">STL</h2>
<h3 id="struct">struct</h3>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">struct</span> <span class="title class_">Node</span> &#123;</span><br><span class="line">    <span class="type">int</span> val, x, y;</span><br><span class="line">    <span class="built_in">Node</span>(<span class="type">int</span> val, <span class="type">int</span> x, <span class="type">int</span> y) : <span class="built_in">val</span>(val), <span class="built_in">x</span>(x), <span class="built_in">y</span>(y) &#123;&#125; <span class="comment">// init values</span></span><br><span class="line">    <span class="type">bool</span> <span class="keyword">operator</span>&lt;(<span class="type">const</span> Node&amp; other) <span class="type">const</span> &#123; <span class="comment">// define &lt;</span></span><br><span class="line">        <span class="keyword">if</span> (val == other.val) <span class="keyword">return</span> x &lt; other.x;</span><br><span class="line">        <span class="keyword">return</span> val &lt; other.val;</span><br><span class="line">    &#125;</span><br><span class="line">&#125; na, nb;  <span class="comment">// == Node na,nb;</span></span><br><span class="line">vector&lt;Node&gt; A;</span><br><span class="line">A.<span class="built_in">push_back</span>(&#123;<span class="number">3</span>, <span class="number">4</span>, <span class="number">5</span>&#125;); <span class="comment">// fast init</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> pii pair<span class="string">&lt;int, int&gt;</span>  </span></span><br><span class="line">pii a = &#123;<span class="number">1</span>, <span class="number">3</span>&#125;;</span><br><span class="line"><span class="keyword">auto</span> [x, y] = a;</span><br></pre></td></tr></table></figure>
<h3 id="sort">sort</h3>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">sort</span>(A<span class="number">+1</span>, A+n<span class="number">+1</span>);  <span class="comment">// sort for array in [1,n] from small to big</span></span><br><span class="line"><span class="built_in">sort</span>(A.<span class="built_in">begin</span>()<span class="number">+1</span>, A.<span class="built_in">end</span>()); <span class="comment">// for vector</span></span><br><span class="line"><span class="built_in">sort</span>(A.<span class="built_in">begin</span>(), A.<span class="built_in">end</span>(), greater&lt;&gt;()); <span class="comment">// from big to small</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">bool</span> <span class="title">cmp</span><span class="params">(<span class="type">int</span> a, <span class="type">int</span> b)</span> </span>&#123; <span class="keyword">return</span> a &gt; b; &#125; </span><br><span class="line"><span class="built_in">sort</span>(A.<span class="built_in">begin</span>(), A.<span class="built_in">end</span>(), cmp); <span class="comment">// use cmp</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">sort</span>(A.<span class="built_in">begin</span>(), A.<span class="built_in">end</span>()); <span class="comment">// for struct if &lt; is defined</span></span><br></pre></td></tr></table></figure>
<h3 id="vector">vector</h3>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="function">vector&lt;<span class="type">int</span>&gt; <span class="title">A</span><span class="params">(n<span class="number">+1</span>)</span></span>; <span class="comment">// set a vector of index [0,n], init with 0</span></span><br><span class="line"><span class="function">vector&lt;<span class="type">int</span>&gt; <span class="title">A</span><span class="params">(n<span class="number">+1</span>, INT_MAX)</span></span>; <span class="comment">// set a vector of index [0, n], init with 2e31 - 1</span></span><br><span class="line">vector&lt;vector&lt;<span class="type">int</span>&gt;&gt; <span class="built_in">G</span>(n<span class="number">+1</span>); <span class="comment">// set a 2d vector</span></span><br><span class="line">vector&lt;vector&lt;<span class="type">int</span>&gt;&gt; <span class="built_in">M</span>(n<span class="number">+1</span>, <span class="built_in">vector</span>&lt;<span class="type">int</span>&gt;(m<span class="number">+1</span>, <span class="number">1</span>)); <span class="comment">// n*m array</span></span><br><span class="line">A.<span class="built_in">push_back</span>(i); <span class="comment">// insert i to the back</span></span><br><span class="line">A.<span class="built_in">pop_back</span>(i); <span class="comment">// remove the last element</span></span><br><span class="line">A.<span class="built_in">assign</span>(n, <span class="number">1</span>); <span class="comment">// resize the vector to [0, n), init with 1</span></span><br><span class="line">A.<span class="built_in">back</span>(); <span class="comment">// get the last element</span></span><br><span class="line"><span class="type">int</span> pos = <span class="built_in">lower_bound</span>(A.<span class="built_in">begin</span>(), A.<span class="built_in">end</span>(), <span class="number">3</span>) - A.<span class="built_in">begin</span>(); <span class="comment">// get index of the position: A[i] &gt;= 3</span></span><br><span class="line"><span class="type">int</span> pos = <span class="built_in">upper_bound</span>(A.<span class="built_in">begin</span>()<span class="number">+1</span>, A.<span class="built_in">end</span>(), <span class="number">4</span>) - A.<span class="built_in">begin</span>(); <span class="comment">// search for [1, end) get positon: A[i] &gt; 3 </span></span><br><span class="line"></span><br><span class="line">vector&lt;<span class="type">int</span>&gt; B;</span><br><span class="line">vector&lt;pii&gt; A; </span><br><span class="line"><span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>;i &lt;= <span class="built_in">sz</span>(B); ++i) &#123; <span class="comment">// remove multiples</span></span><br><span class="line">    <span class="keyword">if</span> (A.<span class="built_in">empty</span>() || A[A.<span class="built_in">size</span>()<span class="number">-1</span>].first != x) A.<span class="built_in">push_back</span>(&#123;B[i], <span class="number">1</span>&#125;);</span><br><span class="line">    <span class="keyword">else</span> A[A.<span class="built_in">size</span>()<span class="number">-1</span>].second++;</span><br><span class="line">&#125;</span><br><span class="line"><span class="built_in">count</span>(a.<span class="built_in">begin</span>(), a.<span class="built_in">end</span>(), a[<span class="number">0</span>]) == n <span class="comment">// 判断是否都相等</span></span><br></pre></td></tr></table></figure>
<h3 id="map">map</h3>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">map&lt;pair&lt;<span class="type">int</span>,<span class="type">int</span>&gt;, <span class="type">int</span>&gt; M; <span class="comment">// O(logn)</span></span><br><span class="line">unordered_map&lt;string, <span class="type">int</span>&gt; hash_map; <span class="comment">// O(1)</span></span><br><span class="line">M[&#123;<span class="number">1</span>, <span class="number">3</span>&#125;] = <span class="number">4</span>; <span class="comment">// set key and value </span></span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">auto</span> [key, val] : M) &#123;</span><br><span class="line">    <span class="comment">// iterate over the map</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">custom_hash</span> &#123;</span><br><span class="line">	<span class="function"><span class="type">static</span> <span class="type">uint64_t</span> <span class="title">splitmix64</span><span class="params">(<span class="type">uint64_t</span> x)</span> </span>&#123;</span><br><span class="line">		x += <span class="number">0x9e3779b97f4a7c15</span>;</span><br><span class="line">		x = (x ^ (x &gt;&gt; <span class="number">30</span>)) * <span class="number">0xbf58476d1ce4e5b9</span>;</span><br><span class="line">		x = (x ^ (x &gt;&gt; <span class="number">27</span>)) * <span class="number">0x94d049bb133111eb</span>;</span><br><span class="line">		<span class="keyword">return</span> x ^ (x &gt;&gt; <span class="number">31</span>);</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="type">size_t</span> <span class="title">operator</span><span class="params">()</span><span class="params">(<span class="type">uint64_t</span> x)</span> <span class="type">const</span> </span>&#123;</span><br><span class="line">		<span class="type">static</span> <span class="type">const</span> <span class="type">uint64_t</span> FIXED_RANDOM = chrono::steady_clock::<span class="built_in">now</span>().<span class="built_in">time_since_epoch</span>().<span class="built_in">count</span>();</span><br><span class="line">		<span class="keyword">return</span> <span class="built_in">splitmix64</span>(x + FIXED_RANDOM);</span><br><span class="line">	&#125;</span><br><span class="line">&#125;;</span><br><span class="line">unordered_map&lt;<span class="type">int</span>, <span class="type">int</span>, custom_hash&gt; safe_map;</span><br></pre></td></tr></table></figure>
<h3 id="set">set</h3>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">set&lt;<span class="type">int</span>&gt; s;</span><br><span class="line">set&lt;<span class="type">int</span>, greater&lt;&gt;&gt; s; <span class="comment">// form big to small</span></span><br><span class="line">multiset&lt;<span class="type">int</span>&gt; ms; <span class="comment">// support for multiple values</span></span><br><span class="line">*s.<span class="built_in">begin</span>() <span class="comment">// first elem</span></span><br><span class="line">*s.<span class="built_in">rbegin</span>() <span class="comment">// last elem</span></span><br><span class="line">*(--s.<span class="built_in">end</span>()) <span class="comment">// last elem</span></span><br><span class="line">s.<span class="built_in">erase</span>(v); <span class="comment">// erase all v</span></span><br><span class="line">s.<span class="built_in">erase</span>(s.<span class="built_in">find</span>(v)); <span class="comment">// erase one of v</span></span><br><span class="line"><span class="keyword">auto</span> iter = s.<span class="built_in">upper_bound</span>(v);</span><br><span class="line"><span class="keyword">if</span> (iter != <span class="built_in">end</span>()) &#123;</span><br><span class="line">    cout &lt;&lt; (*++iter); <span class="comment">// successor</span></span><br><span class="line">    cout &lt;&lt; (<span class="built_in">next</span>(iter));</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">auto</span> iter = s.<span class="built_in">lower_bound</span>(v);</span><br><span class="line"><span class="keyword">if</span> (iter != s.<span class="built_in">begin</span>()) &#123;</span><br><span class="line">    cout &lt;&lt; (*(--iter)); <span class="comment">// predecessor</span></span><br><span class="line">    cout &lt;&lt; (*<span class="built_in">prev</span>(iter));</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">if</span> (s.<span class="built_in">find</span>(v) != s.<span class="built_in">end</span>()) &#123;</span><br><span class="line">    cout &lt;&lt; *(s.<span class="built_in">find</span>(v)); <span class="comment">// successful find </span></span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">auto</span> v : s) &#123;</span><br><span class="line">    cout &lt;&lt; v; <span class="comment">// output in sorted order</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="bitset">bitset</h3>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">bitset&lt;maxn&gt; s;</span><br><span class="line">s[<span class="number">1</span>];</span><br><span class="line">cout &lt;&lt; s &lt;&lt; endl;</span><br><span class="line">s.<span class="built_in">set</span>(<span class="number">3</span>);</span><br><span class="line">s[<span class="number">1</span>] &amp; s[<span class="number">2</span>];</span><br><span class="line">s.<span class="built_in">count</span>(); </span><br><span class="line">s.<span class="built_in">any</span>(); <span class="comment">// 是否有1</span></span><br><span class="line">s.<span class="built_in">none</span>(); <span class="comment">// whether none set bit</span></span><br></pre></td></tr></table></figure>
<h3 id="pbds">pbds</h3>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;bits/extc++.h&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> __gnu_pbds;</span><br><span class="line"></span><br><span class="line">tree&lt;pii,null_type,less&lt;pii&gt;,rb_tree_tag,tree_order_statistics_node_update&gt; tr;</span><br><span class="line">pii <span class="comment">//type to store</span></span><br><span class="line">null_type <span class="comment">//no map</span></span><br><span class="line">less&lt;pii&gt; <span class="comment">//form small to big</span></span><br><span class="line">rb_tree_tag <span class="comment">//red black tree</span></span><br><span class="line">tree_order_statistics_node_update <span class="comment">// update method</span></span><br><span class="line">tr.<span class="built_in">insert</span>(&#123;x,y&#125;); <span class="comment">// insert</span></span><br><span class="line">tr.<span class="built_in">erase</span>(&#123;x,y&#125;); <span class="comment">// erase</span></span><br><span class="line">tr.<span class="built_in">order_of_key</span>(&#123;x,y&#125;); <span class="comment">// get rank</span></span><br><span class="line">tr.<span class="built_in">find_by_order</span>(x); <span class="comment">// kth smallest value</span></span><br><span class="line">tr.<span class="built_in">join</span>(b); <span class="comment">// merge b to r</span></span><br><span class="line">tr.<span class="built_in">split</span>(v,b); <span class="comment">// split for tr: &lt;= v b: &gt; v </span></span><br><span class="line">tr.<span class="built_in">lower_bound</span>(x); </span><br><span class="line">tr.<span class="built_in">upper_bound</span>(x); </span><br><span class="line"></span><br><span class="line"><span class="comment">// support for multiple value</span></span><br><span class="line">tree&lt;ll, null_type, less&lt;ll&gt;, rb_tree_tag, tree_order_statistics_node_update&gt; bbt;</span><br><span class="line"><span class="type">int</span> sz;</span><br><span class="line"><span class="meta">#<span class="keyword">define</span> ins(k) (bbt.insert((k&lt;&lt;20)+(++sz)))</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> del(k) (bbt.erase(bbt.lower_bound(k&lt;&lt;20)))</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> rk(k) (bbt.order_of_key(k&lt;&lt;20)+1)</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> kth(k) ((*bbt.find_by_order(k-1))&gt;&gt;20)</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> lower(k) ((*--bbt.lower_bound(k<span class="string">&lt;&lt;20))&gt;</span>&gt;20)</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> upper(k) ((*bbt.upper_bound((k<span class="string">&lt;&lt;20)+n))&gt;</span>&gt;20)</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// hash table</span></span><br><span class="line">gp_hash_table&lt;<span class="type">int</span>,<span class="type">bool</span>&gt; h;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<h2 id="模拟">模拟</h2>
<h3 id="初始化">初始化</h3>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">memset</span>(A, <span class="number">0</span>, <span class="built_in">sizeof</span>(A)); <span class="comment">// 初始化成0</span></span><br><span class="line"><span class="built_in">memset</span>(A, <span class="number">127</span>, <span class="built_in">sizeof</span>(A)); <span class="comment">// 初始化成最大值 2139062143, ll: 9187201950435737471</span></span><br><span class="line"><span class="built_in">memset</span>(A, <span class="number">128</span>, <span class="built_in">sizeof</span>(A)); <span class="comment">// 初始化成最小值 -2139062144</span></span><br><span class="line"><span class="built_in">memset</span>(A, <span class="number">-1</span>, <span class="built_in">sizeof</span>(A)); <span class="comment">// 初始化成-1</span></span><br><span class="line"><span class="built_in">memset</span>(A, <span class="number">0x3f</span>, <span class="built_in">sizeof</span>(A)); <span class="comment">// 初始化成 1061109567, ll: 4557430888798830399</span></span><br></pre></td></tr></table></figure>
<h3 id="蛇形矩阵遍历">蛇形矩阵遍历</h3>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">1</span>;i &lt;= n; ++i) &#123;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> ind = <span class="number">1</span>;ind &lt;= m; ++ind) &#123;</span><br><span class="line">        <span class="type">int</span> j = i % <span class="number">2</span> == <span class="number">0</span> ? m-ind<span class="number">+1</span> : ind;  <span class="comment">// A[i][j]</span></span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>
<h3 id="二分">二分</h3>
<p><span class="math inline">\([L,M-1],[M,R]\)</span></p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">L = <span class="number">1</span>; R = n<span class="number">-1</span>;</span><br><span class="line"><span class="keyword">while</span> (L &lt; R) &#123;</span><br><span class="line">    M = (L + R)/<span class="number">2</span> + <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">if</span> (<span class="built_in">check</span>()) L = M;</span><br><span class="line">    <span class="keyword">else</span> R = M<span class="number">-1</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="离散化去重">离散化去重</h2>
<h3 id="离散化去重-1">离散化去重</h3>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">sort</span>(B<span class="number">+1</span>, B+n<span class="number">+1</span>); <span class="comment">// 所有数据堆在B里</span></span><br><span class="line"><span class="type">int</span> nm = <span class="built_in">unique</span>(B<span class="number">+1</span>, B+n<span class="number">+1</span>) - B<span class="number">-1</span>; <span class="comment">// 去重</span></span><br><span class="line"><span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">1</span>;i &lt;= n; ++i) </span><br><span class="line">    <span class="type">int</span> pos = <span class="built_in">lower_bound</span>(B<span class="number">+1</span>, B+nm<span class="number">+1</span>, A[i].second) - B; <span class="comment">// 原数组对应的值</span></span><br><span class="line"><span class="built_in">sort</span>(B.<span class="built_in">begin</span>(), B.<span class="built_in">end</span>());</span><br><span class="line"><span class="type">int</span> nm = <span class="built_in">unique</span>(B.<span class="built_in">begin</span>(), B.<span class="built_in">end</span>()) - B.<span class="built_in">begin</span>(); </span><br><span class="line"><span class="keyword">while</span> (<span class="built_in">sz</span>(B) != nm) B.<span class="built_in">pop_back</span>();</span><br></pre></td></tr></table></figure>
<h3 id="离散化">离散化</h3>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">typedef</span> <span class="type">int</span> Tl; </span><br><span class="line"><span class="function">vector&lt;<span class="type">int</span>&gt; <span class="title">discretize</span><span class="params">(vector&lt;Tl&gt; A,<span class="type">int</span> l,<span class="type">int</span> r)</span> </span>&#123;</span><br><span class="line">    vector&lt;Tl&gt; B;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = l; i &lt;= r; ++i) &#123;</span><br><span class="line">        B.<span class="built_in">push_back</span>(A[i]);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function">vector&lt;<span class="type">int</span>&gt; <span class="title">ret</span><span class="params">(sz(A))</span></span>;</span><br><span class="line">    <span class="built_in">sort</span>(B.<span class="built_in">begin</span>(), B.<span class="built_in">end</span>()); <span class="comment">// 所有数据堆在B里</span></span><br><span class="line">    <span class="type">int</span> nm = <span class="built_in">unique</span>(B.<span class="built_in">begin</span>(), B.<span class="built_in">end</span>()) - B.<span class="built_in">begin</span>(); <span class="comment">// 去重</span></span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = l;i &lt;= r; ++i) </span><br><span class="line">        ret[i] = <span class="built_in">lower_bound</span>(B.<span class="built_in">begin</span>(), B.<span class="built_in">begin</span>()+nm, A[i]) - B.<span class="built_in">begin</span>() + <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">return</span> ret;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="去重堆在一起">去重（堆在一起）</h3>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">sort</span>(A.<span class="built_in">begin</span>(), A.<span class="built_in">end</span>());</span><br><span class="line"><span class="keyword">if</span> (A.<span class="built_in">empty</span>() || A[A.<span class="built_in">size</span>()<span class="number">-1</span>].first != x) A.<span class="built_in">push_back</span>(&#123;x, <span class="number">1</span>&#125;);</span><br><span class="line"><span class="keyword">else</span> A[A.<span class="built_in">size</span>()<span class="number">-1</span>].second++;</span><br></pre></td></tr></table></figure>
<h3 id="字符串转换">字符串转换</h3>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="function">string <span class="title">tostr</span><span class="params">(ll x)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (x == <span class="number">0</span>) <span class="keyword">return</span> <span class="string">&quot;0&quot;</span>;</span><br><span class="line">    string ret = <span class="string">&quot;&quot;</span>;</span><br><span class="line">    <span class="keyword">while</span> (x) &#123;</span><br><span class="line">        ret += <span class="string">&#x27;0&#x27;</span> + (x % <span class="number">10</span>);</span><br><span class="line">        x /= <span class="number">10</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">reverse</span>(ret.<span class="built_in">begin</span>(), ret.<span class="built_in">end</span>());</span><br><span class="line">    <span class="keyword">return</span> ret;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function">ll <span class="title">toint</span><span class="params">(string x)</span> </span>&#123;</span><br><span class="line">    ll ret = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>;i &lt; <span class="built_in">sz</span>(x); ++i) &#123;</span><br><span class="line">        ret = ret*<span class="number">10</span> + x[i] - <span class="string">&#x27;0&#x27;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> ret;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="离散前缀和">离散前缀和</h3>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">vector&lt;pair&lt;<span class="type">int</span>,ll&gt;&gt; A, B;</span><br><span class="line">map&lt;<span class="type">int</span>,ll&gt; sum;</span><br><span class="line"><span class="comment">// insert values in A</span></span><br><span class="line"><span class="built_in">sort</span>(A.<span class="built_in">begin</span>(), A.<span class="built_in">end</span>());</span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">auto</span> [a, b] : A) &#123;</span><br><span class="line">    <span class="keyword">if</span> (B.<span class="built_in">empty</span>() || B.<span class="built_in">back</span>().first != a) B.<span class="built_in">push_back</span>(&#123;a, b&#125;);</span><br><span class="line">    <span class="keyword">else</span> B.<span class="built_in">back</span>().second += b;</span><br><span class="line">&#125;</span><br><span class="line"><span class="type">int</span> last = INT_MIN;</span><br><span class="line">ll a = <span class="number">0</span>, d = <span class="number">0</span>;</span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">auto</span> [xi, ai] : B) &#123;</span><br><span class="line">    a += d*(xi - last) + ai; <span class="comment">// 2d</span></span><br><span class="line">    d += ai; <span class="comment">// 1d</span></span><br><span class="line">    last = xi;</span><br><span class="line">    sum[xi] = a;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="数学">数学</h2>
<h4 id="向上向下取整">向上/向下取整</h4>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="function">ll <span class="title">up</span><span class="params">(ll a, ll b)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (a % b == <span class="number">0</span>) <span class="keyword">return</span> a/b;</span><br><span class="line">    <span class="keyword">if</span> ((a^b) &lt; <span class="number">0</span>) <span class="keyword">return</span> a/b;</span><br><span class="line">    <span class="keyword">else</span> <span class="keyword">return</span> a/b<span class="number">+1</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function">ll <span class="title">down</span><span class="params">(ll a, ll b)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (a % b == <span class="number">0</span>) <span class="keyword">return</span> a/b;</span><br><span class="line">    <span class="keyword">if</span> ((a^b) &lt; <span class="number">0</span>) <span class="keyword">return</span> a/b<span class="number">-1</span>;</span><br><span class="line">    <span class="keyword">else</span> <span class="keyword">return</span> a/b;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="随机数">随机数</h4>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">template</span> &lt;<span class="keyword">class</span> <span class="title class_">T</span>&gt;</span><br><span class="line"><span class="function">T <span class="title">randint</span><span class="params">(T l, T r = <span class="number">0</span>)</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="type">static</span> mt19937 <span class="title">eng</span><span class="params">(chrono::steady_clock::now().time_since_epoch().count())</span></span>;</span><br><span class="line">    <span class="keyword">if</span> (l &gt; r)</span><br><span class="line">        <span class="built_in">swap</span>(l, r);</span><br><span class="line">    <span class="function">uniform_int_distribution&lt;T&gt; <span class="title">dis</span><span class="params">(l, r)</span></span>;</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">dis</span>(eng);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="取模结构体">取模结构体</h3>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">const</span> <span class="type">int</span> MOD = <span class="number">1e9</span> + <span class="number">7</span>;</span><br><span class="line"><span class="comment">// assume -MOD &lt;= x &lt; 2MOD</span></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">getabs</span><span class="params">(<span class="type">int</span> x)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (x &lt; <span class="number">0</span>) x += MOD;</span><br><span class="line">    <span class="keyword">if</span> (x &gt;= MOD) x -= MOD;</span><br><span class="line">    <span class="keyword">return</span> x;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">template</span>&lt;<span class="keyword">class</span> T&gt;</span></span><br><span class="line"><span class="function">T <span class="title">fpow</span><span class="params">(T a, ll b)</span> </span>&#123;</span><br><span class="line">    T res = <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">for</span> (; b; b /= <span class="number">2</span>, a *= a) &#123;</span><br><span class="line">        <span class="keyword">if</span> (b % <span class="number">2</span>) &#123;</span><br><span class="line">            res *= a;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> res;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">Z</span> &#123;</span><br><span class="line">    <span class="type">int</span> x;</span><br><span class="line">    <span class="built_in">Z</span>(<span class="type">int</span> x = <span class="number">0</span>) : <span class="built_in">x</span>(<span class="built_in">getabs</span>(x)) &#123;&#125;</span><br><span class="line">    <span class="built_in">Z</span>(ll x) : <span class="built_in">x</span>(<span class="built_in">getabs</span>(x % MOD)) &#123;&#125;</span><br><span class="line">    <span class="function"><span class="type">int</span> <span class="title">val</span><span class="params">()</span> <span class="type">const</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> x;</span><br><span class="line">    &#125;</span><br><span class="line">    Z <span class="keyword">operator</span>-() <span class="type">const</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">Z</span>(<span class="built_in">getabs</span>(MOD - x));</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function">Z <span class="title">inv</span><span class="params">()</span> <span class="type">const</span> </span>&#123;</span><br><span class="line">        <span class="built_in">assert</span>(x != <span class="number">0</span>);</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">fpow</span>(*<span class="keyword">this</span>, MOD - <span class="number">2</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    Z &amp;<span class="keyword">operator</span>*=(<span class="type">const</span> Z &amp;rhs) &#123;</span><br><span class="line">        x = <span class="built_in">ll</span>(x) * rhs.x % MOD;</span><br><span class="line">        <span class="keyword">return</span> *<span class="keyword">this</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    Z &amp;<span class="keyword">operator</span>+=(<span class="type">const</span> Z &amp;rhs) &#123;</span><br><span class="line">        x = <span class="built_in">getabs</span>(x + rhs.x);</span><br><span class="line">        <span class="keyword">return</span> *<span class="keyword">this</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    Z &amp;<span class="keyword">operator</span>-=(<span class="type">const</span> Z &amp;rhs) &#123;</span><br><span class="line">        x = <span class="built_in">getabs</span>(x - rhs.x);</span><br><span class="line">        <span class="keyword">return</span> *<span class="keyword">this</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    Z &amp;<span class="keyword">operator</span>/=(<span class="type">const</span> Z &amp;rhs) &#123;</span><br><span class="line">        <span class="keyword">return</span> *<span class="keyword">this</span> *= rhs.<span class="built_in">inv</span>();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">friend</span> Z <span class="keyword">operator</span>*(<span class="type">const</span> Z &amp;lhs, <span class="type">const</span> Z &amp;rhs) &#123;</span><br><span class="line">        Z res = lhs;</span><br><span class="line">        res *= rhs;</span><br><span class="line">        <span class="keyword">return</span> res;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">friend</span> Z <span class="keyword">operator</span>+(<span class="type">const</span> Z &amp;lhs, <span class="type">const</span> Z &amp;rhs) &#123;</span><br><span class="line">        Z res = lhs;</span><br><span class="line">        res += rhs;</span><br><span class="line">        <span class="keyword">return</span> res;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">friend</span> Z <span class="keyword">operator</span>-(<span class="type">const</span> Z &amp;lhs, <span class="type">const</span> Z &amp;rhs) &#123;</span><br><span class="line">        Z res = lhs;</span><br><span class="line">        res -= rhs;</span><br><span class="line">        <span class="keyword">return</span> res;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">friend</span> Z <span class="keyword">operator</span>/(<span class="type">const</span> Z &amp;lhs, <span class="type">const</span> Z &amp;rhs) &#123;</span><br><span class="line">        Z res = lhs;</span><br><span class="line">        res /= rhs;</span><br><span class="line">        <span class="keyword">return</span> res;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">friend</span> std::istream &amp;<span class="keyword">operator</span>&gt;&gt;(std::istream &amp;is, Z &amp;a) &#123;</span><br><span class="line">        ll v;</span><br><span class="line">        is &gt;&gt; v;</span><br><span class="line">        a = <span class="built_in">Z</span>(v);</span><br><span class="line">        <span class="keyword">return</span> is;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">friend</span> std::ostream &amp;<span class="keyword">operator</span>&lt;&lt;(std::ostream &amp;os, <span class="type">const</span> Z &amp;a) &#123;</span><br><span class="line">        <span class="keyword">return</span> os &lt;&lt; a.<span class="built_in">val</span>();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="type">const</span> <span class="type">int</span> maxinv = <span class="number">5e5</span> + <span class="number">5</span>;</span><br><span class="line">Z inv[maxinv], fac[maxinv], invfac[maxinv];</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">init</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    inv[<span class="number">1</span>] = <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i = <span class="number">2</span>; i &lt; maxinv; ++ i) &#123;</span><br><span class="line">        inv[i] = <span class="built_in">Z</span>(MOD-MOD/i) * inv[MOD%i];</span><br><span class="line">    &#125;</span><br><span class="line">    fac[<span class="number">0</span>] = invfac[<span class="number">0</span>] = <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">1</span>;i &lt; maxinv; ++i) &#123;</span><br><span class="line">        fac[i] = fac[i<span class="number">-1</span>]*i;</span><br><span class="line">        invfac[i] = invfac[i<span class="number">-1</span>]*inv[i];</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function">Z <span class="title">c</span><span class="params">(<span class="type">int</span> n, <span class="type">int</span> k)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> (k &lt; <span class="number">0</span> || k &gt; n) ? <span class="number">0</span> : fac[n] * invfac[n-k] * invfac[k];</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="取模">取模</h4>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">inline</span> ll <span class="title">add</span><span class="params">(ll a, ll b)</span> </span>&#123; <span class="comment">// 带减法</span></span><br><span class="line">    <span class="keyword">return</span> ((a + b) % MOD + MOD) % MOD;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">inline</span> ll <span class="title">mul</span><span class="params">(ll a, ll b)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> (a * b) % MOD;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="快速幂龟速乘">快速幂/龟速乘</h4>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;cstdio&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"><span class="keyword">typedef</span> <span class="type">long</span> <span class="type">long</span> ll;</span><br><span class="line"><span class="type">const</span> <span class="type">int</span> MOD = <span class="number">998244353</span>;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">inline</span> ll <span class="title">add</span><span class="params">(ll a, ll b)</span> </span>&#123; <span class="comment">// 带减法</span></span><br><span class="line">    <span class="keyword">return</span> ((a + b) % MOD + MOD) % MOD;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function">ll <span class="title">mul</span><span class="params">(ll a, ll b)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> (a * b) % MOD;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function">ll <span class="title">fmul</span><span class="params">(ll a, ll b, ll&amp; Mod)</span>  </span>&#123;</span><br><span class="line">	<span class="function">ll <span class="title">rt</span> <span class="params">(<span class="number">0</span>)</span> </span>;</span><br><span class="line">	<span class="keyword">for</span> (; b; b &gt;&gt;= <span class="number">1</span>, ( a &lt;&lt;= <span class="number">1</span> ) %= Mod)</span><br><span class="line">		<span class="keyword">if</span> (b &amp; <span class="number">1</span>) &#123;</span><br><span class="line">			(rt += a) %= Mod ;</span><br><span class="line">		&#125;</span><br><span class="line">	<span class="keyword">return</span> rt;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function">ll <span class="title">fpow</span><span class="params">(ll a, ll n)</span> </span>&#123;</span><br><span class="line">    a %= MOD; ll ret = <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">for</span> (; n; n &gt;&gt;= <span class="number">1</span>, a = <span class="built_in">mul</span>(a, a))</span><br><span class="line">    	<span class="keyword">if</span> (n &amp; <span class="number">1</span>) ret = <span class="built_in">mul</span>(ret, a);</span><br><span class="line">    <span class="keyword">return</span> ret;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">	cout &lt;&lt; <span class="built_in">fpow</span>(<span class="number">2</span>,<span class="number">10</span>) &lt;&lt; endl;</span><br><span class="line">	<span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>特殊余数</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="function">ll <span class="title">mul</span><span class="params">(ll a, ll b, ll mod = MOD)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> (a * b) % mod;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function">ll <span class="title">fpow</span><span class="params">(ll a, ll n, ll mod)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (a % mod == <span class="number">0</span>) <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">    a %= mod; ll ret = <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">for</span> (; n; n &gt;&gt;= <span class="number">1</span>, a = <span class="built_in">mul</span>(a, a, mod))</span><br><span class="line">    	<span class="keyword">if</span> (n &amp; <span class="number">1</span>) ret = <span class="built_in">mul</span>(ret, a, mod);</span><br><span class="line">    <span class="keyword">return</span> ret;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<h4 id="费尔马小定理求逆元">费尔马小定理求逆元</h4>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="function">ll <span class="title">fpow</span><span class="params">(ll a, ll n)</span> </span>&#123;</span><br><span class="line">    a %= MOD;</span><br><span class="line">    ll ret = <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">for</span> (; n; n &gt;&gt;= <span class="number">1</span>, a = <span class="built_in">mul</span>(a, a) )</span><br><span class="line">    	<span class="keyword">if</span> (n &amp; <span class="number">1</span>) ret = <span class="built_in">mul</span>(ret, a);</span><br><span class="line">    <span class="keyword">return</span> ret;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function">ll <span class="title">inv</span><span class="params">(ll a)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">fpow</span>(a, MOD<span class="number">-2</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="on求n个逆元">O(n)求n个逆元</h4>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">inv[<span class="number">1</span>] = <span class="number">1</span>;</span><br><span class="line"><span class="keyword">for</span>(<span class="type">int</span> i = <span class="number">2</span>; i &lt;= n; ++ i) &#123;</span><br><span class="line">    inv[i]=(ll)(MOD-MOD/i)*inv[MOD%i]%MOD;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="阶乘与阶乘的逆元">阶乘与阶乘的逆元</h4>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 逆元数组大小开够</span></span><br><span class="line">inv[<span class="number">1</span>] = <span class="number">1</span>;</span><br><span class="line"><span class="keyword">for</span>(<span class="type">int</span> i = <span class="number">2</span>; i &lt;= n; ++ i) &#123;</span><br><span class="line">    inv[i]=(ll)(MOD-MOD/i)*inv[MOD%i]%MOD;</span><br><span class="line">&#125;</span><br><span class="line">f[<span class="number">0</span>] = rf[<span class="number">0</span>] = <span class="number">1</span>;</span><br><span class="line"><span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">1</span>;i &lt;= n; ++i) &#123;</span><br><span class="line">    f[i] = <span class="built_in">mul</span>(f[i<span class="number">-1</span>], i);</span><br><span class="line">    rf[i] = <span class="built_in">mul</span>(rf[i<span class="number">-1</span>], inv[i]);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="求组合数">求组合数</h4>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 需要逆元数组，费马尔小定理求逆元</span></span><br><span class="line"><span class="function"><span class="keyword">inline</span> ll <span class="title">mul</span><span class="params">(ll a, ll b)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> (a * b) % MOD;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function">ll <span class="title">c</span><span class="params">(<span class="type">int</span> n, <span class="type">int</span> k)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> (k &lt; <span class="number">0</span> || k &gt; n) ? <span class="number">0</span> : <span class="built_in">mul</span>(f[n], <span class="built_in">mul</span>(rf[n-k], rf[k]));</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="comment">// 预处理</span></span><br><span class="line">    inv[<span class="number">1</span>] = <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i = <span class="number">2</span>; i &lt;= n; ++ i) &#123;</span><br><span class="line">        inv[i]=(ll)(MOD-MOD/i)*inv[MOD%i]%MOD;</span><br><span class="line">    &#125;</span><br><span class="line">    f[<span class="number">0</span>] = rf[<span class="number">0</span>] = <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">1</span>;i &lt;= n; ++i) &#123;</span><br><span class="line">        f[i] = <span class="built_in">mul</span>(f[i<span class="number">-1</span>], i);</span><br><span class="line">        rf[i] = <span class="built_in">mul</span>(rf[i<span class="number">-1</span>], inv[i]);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h5 id="求大组合数-ok">求大组合数 <span
class="math inline">\(O(K)\)</span></h5>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="function">ll <span class="title">c</span><span class="params">(<span class="type">int</span> n, <span class="type">int</span> k)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (k &lt; <span class="number">0</span> || k &gt; n) <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">    ll ret = <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = n;i &gt;= n-k<span class="number">+1</span>; --i) &#123;</span><br><span class="line">        ret = <span class="built_in">mul</span>(ret, i);</span><br><span class="line">    &#125;</span><br><span class="line">    ret = <span class="built_in">mul</span>(ret, rf[k]);</span><br><span class="line">    <span class="keyword">return</span> ret;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="周期计数">周期计数</h3>
<p>求<span class="math inline">\([0,R]\)</span> 区间里 从 <span
class="math inline">\(x\)</span> 开始 周期为 <span
class="math inline">\(t\)</span> 的数的个数</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="function">ll <span class="title">numofperiod</span><span class="params">(ll R, ll x, ll t)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> (R+t-x)/t ; </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="扩展欧几里得exgcd">扩展欧几里得exgcd</h3>
<p>解决 <span class="math inline">\(ax+by=gcd(a,b)\)</span> 定义好d,x,y
最后 d 是gcd , x,y 是解</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="type">void</span> <span class="title">exgcd</span><span class="params">(ll a, ll b, ll&amp; d, ll&amp; x, ll&amp; y)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (!b) &#123; d = a; x = <span class="number">1</span>; y = <span class="number">0</span>; &#125;</span><br><span class="line">    <span class="keyword">else</span> &#123; <span class="built_in">exgcd</span>(b, a%b, d, y, x); y -= x*(a/b); &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="同余方程">同余方程</h3>
<p>解决 <span class="math inline">\(ax+by=c\)</span> 的最小正整数解，
若无解返回 false</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="type">void</span> <span class="title">exgcd</span><span class="params">(ll a, ll b, ll&amp; d, ll&amp; x, ll&amp; y)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (!b) &#123; d = a; x = <span class="number">1</span>; y = <span class="number">0</span>; &#125;</span><br><span class="line">    <span class="keyword">else</span> &#123; <span class="built_in">exgcd</span>(b, a%b, d, y, x); y -= x*(a/b); &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function">ll <span class="title">up</span><span class="params">(ll a, ll b)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (a % b == <span class="number">0</span>) <span class="keyword">return</span> a/b;</span><br><span class="line">    <span class="keyword">if</span> ((a^b) &lt; <span class="number">0</span>) <span class="keyword">return</span> a/b;</span><br><span class="line">    <span class="keyword">else</span> <span class="keyword">return</span> a/b<span class="number">+1</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function">ll <span class="title">down</span><span class="params">(ll a, ll b)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (a % b == <span class="number">0</span>) <span class="keyword">return</span> a/b;</span><br><span class="line">    <span class="keyword">if</span> ((a^b) &lt; <span class="number">0</span>) <span class="keyword">return</span> a/b<span class="number">-1</span>;</span><br><span class="line">    <span class="keyword">else</span> <span class="keyword">return</span> a/b;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">bool</span> <span class="title">equiv</span><span class="params">(ll a, ll b, ll c, ll&amp; x, ll&amp; y)</span> </span>&#123;</span><br><span class="line">    <span class="comment">// x 是最小正整数解</span></span><br><span class="line">    ll d;</span><br><span class="line">    <span class="built_in">exgcd</span>(a, b, d, x, y);</span><br><span class="line">    <span class="keyword">if</span> (c % d != <span class="number">0</span>) <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">    x *= c/d; y *= c/d;</span><br><span class="line">    ll k;</span><br><span class="line">    ll m = b/d;</span><br><span class="line">    <span class="keyword">if</span> (m &lt; <span class="number">0</span>) k = <span class="built_in">up</span>(-x,m)<span class="number">-1</span>;</span><br><span class="line">    <span class="keyword">else</span> k = <span class="built_in">down</span>(-x,m)<span class="number">+1</span>;</span><br><span class="line">    x += k*(b/d);</span><br><span class="line">    y -= k*(a/d);</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>非负情况</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="type">void</span> <span class="title">exgcd</span><span class="params">(ll a, ll b, ll&amp; d, ll&amp; x, ll&amp; y)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (!b) &#123; d = a; x = <span class="number">1</span>; y = <span class="number">0</span>; &#125;</span><br><span class="line">    <span class="keyword">else</span> &#123; <span class="built_in">exgcd</span>(b, a%b, d, y, x); y -= x*(a/b); &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">ll dx, dy; <span class="comment">// x, y 的步长</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">bool</span> <span class="title">equiv</span><span class="params">(ll a, ll b, ll c, ll&amp; x, ll&amp; y)</span> </span>&#123;</span><br><span class="line">    <span class="comment">// x, y 都是非负解</span></span><br><span class="line">    ll d;</span><br><span class="line">    <span class="built_in">exgcd</span>(a, b, d, x, y);</span><br><span class="line">    <span class="keyword">if</span> (c % d != <span class="number">0</span>) <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">    x *= c/d; y *= c/d;</span><br><span class="line"></span><br><span class="line">    ll k;</span><br><span class="line">    dx = <span class="built_in">max</span>(-b/d,b/d);</span><br><span class="line">    dy = <span class="built_in">max</span>(-a/d,a/d);</span><br><span class="line"></span><br><span class="line">    x = ((x % dx) + dx) % dx;</span><br><span class="line">    y = (c-a*x)/b;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (y &lt; <span class="number">0</span>) &#123;</span><br><span class="line">        y = ((y % dy) + dy) % dy;</span><br><span class="line">        x = (c-b*y)/a;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> ((a ^ b) &gt;= <span class="number">0</span>) dy = -dy;</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="欧拉函数sqrtn">欧拉函数<span
class="math inline">\(\sqrt(n)\)</span></h3>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="type">int</span> <span class="title">phi</span><span class="params">(<span class="type">int</span> n)</span></span>&#123;   </span><br><span class="line">     <span class="type">int</span> res=n,a=n;  </span><br><span class="line">     <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">2</span>;i*i&lt;=a;i++)&#123;  </span><br><span class="line">         <span class="keyword">if</span>(a%i==<span class="number">0</span>)&#123;  </span><br><span class="line">             res=res/i*(i<span class="number">-1</span>);  </span><br><span class="line">             <span class="keyword">while</span>(a%i==<span class="number">0</span>) a/=i;  </span><br><span class="line">         &#125;  </span><br><span class="line">     &#125;  </span><br><span class="line">     <span class="keyword">if</span>(a&gt;<span class="number">1</span>) res=res/a*(a<span class="number">-1</span>);  </span><br><span class="line">     <span class="keyword">return</span> res;  </span><br><span class="line">&#125; </span><br></pre></td></tr></table></figure>
<h3 id="e氏筛法">E氏筛法</h3>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">2</span>;i &lt; maxn; ++i) <span class="keyword">if</span> (!cnt[i]) </span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> j = i;j &lt; maxn; j += i) cnt[j]++;</span><br></pre></td></tr></table></figure>
<h3 id="线性筛分解质因数">线性筛/分解质因数</h3>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">struct</span> <span class="title class_">Prime</span> &#123;</span><br><span class="line">    <span class="type">int</span> n;</span><br><span class="line">    vector&lt;<span class="type">int</span>&gt; prime, nxt, mu;</span><br><span class="line">    vector&lt;<span class="type">bool</span>&gt; isp;</span><br><span class="line">    </span><br><span class="line">    <span class="built_in">Prime</span>(<span class="type">int</span> n) : <span class="built_in">n</span>(n), <span class="built_in">prime</span>(<span class="number">1</span>), <span class="built_in">nxt</span>(n<span class="number">+1</span>), <span class="built_in">mu</span>(n<span class="number">+1</span>), <span class="built_in">isp</span>(n<span class="number">+1</span>,<span class="number">1</span>) &#123; <span class="built_in">calc</span>(); &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">calc</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        isp[<span class="number">1</span>] = <span class="number">0</span>; mu[<span class="number">1</span>] = <span class="number">1</span>;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">2</span>;i &lt;= n; ++i) &#123;</span><br><span class="line">            <span class="keyword">if</span> (isp[i]) prime.<span class="built_in">push_back</span>(i), nxt[i] = i, mu[i] = <span class="number">-1</span>;</span><br><span class="line">            <span class="keyword">for</span> (<span class="type">int</span> j = <span class="number">1</span>;j &lt; <span class="built_in">sz</span>(prime) &amp;&amp; i*prime[j] &lt;= n; ++j) &#123;</span><br><span class="line">                isp[i*prime[j]] = <span class="number">0</span>;</span><br><span class="line">                nxt[i*prime[j]] = prime[j];</span><br><span class="line">                <span class="keyword">if</span> (i % prime[j] == <span class="number">0</span>) &#123;</span><br><span class="line">                    mu[prime[j] * i] = <span class="number">0</span>;</span><br><span class="line">                    <span class="keyword">break</span>;</span><br><span class="line">                &#125; <span class="keyword">else</span> mu[prime[j]*i] = mu[prime[j]] * mu[i];</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">1</span>;i &lt;= n; ++i) mu[i] += mu[i<span class="number">-1</span>];</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    vector&lt;pair&lt;<span class="type">int</span>,<span class="type">int</span>&gt;&gt; <span class="built_in">factorize</span>(<span class="type">int</span> x) &#123; </span><br><span class="line">        vector&lt;pair&lt;<span class="type">int</span>,<span class="type">int</span>&gt;&gt; ret;</span><br><span class="line">        <span class="keyword">while</span> (x != <span class="number">1</span>) &#123;</span><br><span class="line">            <span class="type">int</span> p = nxt[x];</span><br><span class="line">            <span class="keyword">if</span> (ret.<span class="built_in">empty</span>() || ret.<span class="built_in">back</span>().first != p) ret.<span class="built_in">push_back</span>(&#123;p, <span class="number">1</span>&#125;);</span><br><span class="line">            <span class="keyword">else</span> ret.<span class="built_in">back</span>().second++;</span><br><span class="line">            x /= p;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> ret;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<h4 id="低常数">低常数</h4>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">struct</span> <span class="title class_">Prime</span> &#123;</span><br><span class="line">    <span class="type">const</span> <span class="type">int</span> n = <span class="number">2e7</span> + <span class="number">5</span>;</span><br><span class="line">    vector&lt;<span class="type">int</span>&gt; primes;</span><br><span class="line">    vector&lt;<span class="type">bool</span>&gt; np; <span class="comment">// not prime</span></span><br><span class="line">    </span><br><span class="line">    <span class="built_in">Prime</span>() : <span class="built_in">np</span>(n<span class="number">+1</span>) &#123; <span class="built_in">calc</span>(); &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">calc</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        np[<span class="number">1</span>] = <span class="number">1</span>; </span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">2</span>;i &lt;= n; ++i) &#123;</span><br><span class="line">            <span class="keyword">if</span> (!np[i]) primes.<span class="built_in">push_back</span>(i);</span><br><span class="line">            <span class="keyword">for</span> (<span class="keyword">auto</span> p : primes) &#123;</span><br><span class="line">                <span class="keyword">if</span> (p * i &gt; n) <span class="keyword">break</span>;</span><br><span class="line">                np[p * i] = <span class="number">1</span>;</span><br><span class="line">                <span class="keyword">if</span> (i % p == <span class="number">0</span>) <span class="keyword">break</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<h3 id="所有因子">所有因子</h3>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="function">vector&lt;<span class="type">int</span>&gt; <span class="title">factors</span><span class="params">(<span class="type">int</span> x)</span> </span>&#123;</span><br><span class="line">    vector&lt;<span class="type">int</span>&gt; ret;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">1</span>;i*i &lt;= x; ++i) <span class="keyword">if</span> (x % i == <span class="number">0</span>) &#123;</span><br><span class="line">        ret.<span class="built_in">push_back</span>(i);</span><br><span class="line">        <span class="keyword">if</span> (i != x/i) ret.<span class="built_in">push_back</span>(x/i);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> ret;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="单个质因数分解osqrt-x">单个质因数分解<span
class="math inline">\(O(\sqrt x)\)</span></h3>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">vector&lt;pair&lt;ll,<span class="type">int</span>&gt;&gt; <span class="built_in">factorize</span>(ll x) &#123;</span><br><span class="line">    vector&lt;pair&lt;ll,<span class="type">int</span>&gt;&gt; ret;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">2</span>; (ll)i*i &lt;= x; ++i) <span class="keyword">if</span> (x % i == <span class="number">0</span>) &#123;</span><br><span class="line">        ret.<span class="built_in">push_back</span>(&#123;i, <span class="number">0</span>&#125;);</span><br><span class="line">        <span class="keyword">while</span> (x % i == <span class="number">0</span>) x /= i, ret.<span class="built_in">back</span>().second++;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (x &gt; <span class="number">1</span>) ret.<span class="built_in">push_back</span>(&#123;x, <span class="number">1</span>&#125;);</span><br><span class="line">    <span class="keyword">return</span> ret;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="数论分块">数论分块</h3>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">for</span> (ll l = <span class="number">1</span>, r = <span class="number">0</span>; l &lt;= n; l = r<span class="number">+1</span>) &#123;</span><br><span class="line">    r = n/(n/l);</span><br><span class="line">    ans = <span class="built_in">add</span>(ans, <span class="built_in">mul</span>(<span class="built_in">add</span>(<span class="built_in">sum</span>(r),MOD-<span class="built_in">sum</span>(l<span class="number">-1</span>)), n/l%MOD));</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="素数测试miller-rabin">素数测试Miller-Rabin</h3>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="function">ll <span class="title">fpow</span><span class="params">(ll a, ll n, ll p)</span> </span>&#123;</span><br><span class="line">    ll ans = <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">while</span> (n) &#123;</span><br><span class="line">        <span class="keyword">if</span> (n &amp; <span class="number">1</span>)</span><br><span class="line">            ans = (__int128)ans * a % p; </span><br><span class="line">        a = (__int128)a * a % p;</span><br><span class="line">        n &gt;&gt;= <span class="number">1</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> ans;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">bool</span> <span class="title">is_prime</span><span class="params">(ll x)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (x &lt; <span class="number">3</span>) </span><br><span class="line">        <span class="keyword">return</span> x == <span class="number">2</span>;</span><br><span class="line">    <span class="keyword">if</span> (x % <span class="number">2</span> == <span class="number">0</span>) </span><br><span class="line">        <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">    ll A[] = &#123;<span class="number">2</span>, <span class="number">325</span>, <span class="number">9375</span>, <span class="number">28178</span>, <span class="number">450775</span>, <span class="number">9780504</span>, <span class="number">1795265022</span>&#125;, d = x - <span class="number">1</span>, r = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">while</span> (d % <span class="number">2</span> == <span class="number">0</span>)  d /= <span class="number">2</span>, ++r;</span><br><span class="line">  </span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">auto</span> a : A) &#123;</span><br><span class="line">        ll v = <span class="built_in">fpow</span>(a, d, x); <span class="comment">// a^d</span></span><br><span class="line">        <span class="keyword">if</span> (v &lt;= <span class="number">1</span> || v == x - <span class="number">1</span>) </span><br><span class="line">            <span class="keyword">continue</span>;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; r; ++i) &#123;</span><br><span class="line">            v = (__int128)v * v % x; </span><br><span class="line">            <span class="keyword">if</span> (v == x - <span class="number">1</span> &amp;&amp; i != r - <span class="number">1</span>) &#123;</span><br><span class="line">                v = <span class="number">1</span>;</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">if</span> (v == <span class="number">1</span>)  </span><br><span class="line">                <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> (v != <span class="number">1</span>) </span><br><span class="line">            <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="pollard-rho找一个因子-分解质因数">Pollard Rho找一个因子,
分解质因数</h3>
<p>需要 Miller-Rabin</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">template</span> &lt;<span class="keyword">class</span> <span class="title class_">T</span>&gt;</span><br><span class="line"><span class="function">T <span class="title">randint</span><span class="params">(T l, T r = <span class="number">0</span>)</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="type">static</span> mt19937 <span class="title">eng</span><span class="params">(time(<span class="number">0</span>))</span></span>;</span><br><span class="line">    <span class="keyword">if</span> (l &gt; r)</span><br><span class="line">        <span class="built_in">swap</span>(l, r);</span><br><span class="line">    <span class="function">uniform_int_distribution&lt;T&gt; <span class="title">dis</span><span class="params">(l, r)</span></span>;</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">dis</span>(eng);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function">ll <span class="title">Pollard_Rho</span><span class="params">(ll N)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (N == <span class="number">4</span>)</span><br><span class="line">        <span class="keyword">return</span> <span class="number">2</span>;</span><br><span class="line">    <span class="keyword">if</span> (<span class="built_in">is_prime</span>(N))</span><br><span class="line">        <span class="keyword">return</span> N;</span><br><span class="line">    <span class="keyword">while</span> (<span class="number">1</span>) &#123;</span><br><span class="line">        ll c = <span class="built_in">randint</span>(<span class="number">1ll</span>, N - <span class="number">1</span>);</span><br><span class="line">        <span class="keyword">auto</span> f = [=](ll x) &#123; <span class="built_in">return</span> ((__int128)x * x + c) % N; &#125;;</span><br><span class="line">        ll t = <span class="number">0</span>, r = <span class="number">0</span>, p = <span class="number">1</span>, q;</span><br><span class="line">        <span class="keyword">do</span> &#123;</span><br><span class="line">            <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; <span class="number">128</span>; ++i) &#123;</span><br><span class="line">                t = <span class="built_in">f</span>(t), r = <span class="built_in">f</span>(<span class="built_in">f</span>(r));</span><br><span class="line">                <span class="keyword">if</span> (t == r || (q = (__int128)p * <span class="built_in">abs</span>(t - r) % N) == <span class="number">0</span>)</span><br><span class="line">                    <span class="keyword">break</span>;</span><br><span class="line">                p = q;</span><br><span class="line">            &#125;</span><br><span class="line">            ll d = <span class="built_in">gcd</span>(p, N);</span><br><span class="line">            <span class="keyword">if</span> (d &gt; <span class="number">1</span>)</span><br><span class="line">                <span class="keyword">return</span> d;</span><br><span class="line">        &#125; <span class="keyword">while</span> (t != r);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function">set&lt;ll&gt; <span class="title">prim_factors</span><span class="params">(ll n)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (<span class="built_in">is_prime</span>(n)) &#123;</span><br><span class="line">        <span class="keyword">return</span> &#123;n&#125;;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (n &lt;= <span class="number">1</span>) <span class="keyword">return</span> &#123;&#125;; <span class="comment">// n != 0</span></span><br><span class="line">    </span><br><span class="line">    ll p = <span class="built_in">Pollard_Rho</span>(n);</span><br><span class="line">    <span class="keyword">while</span> (n % p == <span class="number">0</span>) n /= p;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">auto</span> v1 = <span class="built_in">prim_factors</span>(p);</span><br><span class="line">    <span class="keyword">auto</span> v2 = <span class="built_in">prim_factors</span>(n);</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">auto</span> x : v2) v<span class="number">1.</span><span class="built_in">insert</span>(x);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> v1;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">vector&lt;pair&lt;ll,<span class="type">int</span>&gt;&gt; <span class="built_in">factorize</span>(ll n) &#123;</span><br><span class="line">    <span class="keyword">auto</span> v = <span class="built_in">prim_factors</span>(n);</span><br><span class="line">    vector&lt;pair&lt;ll,<span class="type">int</span>&gt;&gt; ret;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">auto</span> p : v) &#123;</span><br><span class="line">        ret.<span class="built_in">push_back</span>(&#123;p, <span class="number">0</span>&#125;);</span><br><span class="line">        <span class="keyword">while</span> (n % p == <span class="number">0</span>) &#123; </span><br><span class="line">            n /= p;</span><br><span class="line">            ret.<span class="built_in">back</span>().second++;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> ret;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="扩展中国剩余定理excrt">扩展中国剩余定理EXCRT</h3>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="type">void</span> <span class="title">exgcd</span><span class="params">(ll a, ll b, ll&amp; d, ll&amp; x, ll&amp; y)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (!b) &#123; d = a; x = <span class="number">1</span>; y = <span class="number">0</span>; &#125;</span><br><span class="line">    <span class="keyword">else</span> &#123; <span class="built_in">exgcd</span>(b, a%b, d, y, x); y -= x*(a/b); &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">bool</span> <span class="title">equiv</span><span class="params">(ll a, ll b, ll c, ll&amp; x, ll&amp; y)</span> </span>&#123;</span><br><span class="line">    <span class="comment">// x 是最小正整数解</span></span><br><span class="line">    ll d;</span><br><span class="line">    <span class="built_in">exgcd</span>(a, b, d, x, y);</span><br><span class="line">    <span class="keyword">if</span> (c % d != <span class="number">0</span>) <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">    x *= c/d;</span><br><span class="line">    ll k = b/d;</span><br><span class="line">    x = (x % k + k) % k;</span><br><span class="line">    y = (c - a*x)/b;</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">Excrt</span> &#123;</span><br><span class="line">    <span class="comment">// x === ai mod ni</span></span><br><span class="line">    ll a = <span class="number">0</span>, n = <span class="number">0</span>; <span class="comment">// answer in a</span></span><br><span class="line">    <span class="built_in">Excrt</span>() &#123;&#125;</span><br><span class="line">    <span class="function"><span class="type">bool</span> <span class="title">add</span><span class="params">(ll ta, ll tn)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (n == <span class="number">0</span>) &#123;</span><br><span class="line">            a = ta; n = tn;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            ll g = __gcd(n, tn);</span><br><span class="line">            ll x, y;</span><br><span class="line">            <span class="keyword">if</span> (!<span class="built_in">equiv</span>(n, tn, (ta-a%tn+tn)%tn, x, y)) <span class="keyword">return</span> <span class="literal">false</span>; <span class="comment">// no solution</span></span><br><span class="line">            a += n*x;</span><br><span class="line">            n = n/g*tn;</span><br><span class="line">            a = (a % n + n) % n;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<h3 id="快速傅里叶变换fft">快速傅里叶变换FFT</h3>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">typedef</span> <span class="type">double</span> ld;</span><br><span class="line"><span class="type">const</span> ld PI = <span class="built_in">acos</span>((ld)<span class="number">-1</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">cp</span> &#123;</span><br><span class="line">    ld x, y;</span><br><span class="line">    <span class="built_in">cp</span>(ld x=<span class="number">0</span>, ld y=<span class="number">0</span>) : <span class="built_in">x</span>(x),<span class="built_in">y</span>(y) &#123;&#125;</span><br><span class="line">    cp <span class="keyword">operator</span> + (<span class="type">const</span> cp &amp;c) <span class="type">const</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">cp</span>(x+c.x, y+c.y);</span><br><span class="line">    &#125;  </span><br><span class="line">    cp <span class="keyword">operator</span> - (<span class="type">const</span> cp &amp;c) <span class="type">const</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">cp</span>(x-c.x, y-c.y);</span><br><span class="line">    &#125;</span><br><span class="line">    cp <span class="keyword">operator</span> * (<span class="type">const</span> cp &amp;c) <span class="type">const</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">cp</span>(x*c.x - y*c.y, x*c.y + y*c.x);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function">cp <span class="title">conj</span><span class="params">()</span> <span class="type">const</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">cp</span>(x, -y);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">fft</span><span class="params">(vector&lt;cp&gt; &amp;a, <span class="type">int</span> len, <span class="type">int</span> op)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">while</span> (<span class="built_in">sz</span>(a) &lt; len) a.<span class="built_in">push_back</span>(<span class="built_in">cp</span>(<span class="number">0</span>,<span class="number">0</span>));</span><br><span class="line">    <span class="function">vector&lt;<span class="type">int</span>&gt; <span class="title">R</span><span class="params">(len)</span></span>;</span><br><span class="line">    R[<span class="number">0</span>] = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">1</span>;i &lt; len; ++i) &#123;</span><br><span class="line">        R[i] = (R[i&gt;&gt;<span class="number">1</span>]&gt;&gt;<span class="number">1</span>) + (i&amp;<span class="number">1</span>)*(len&gt;&gt;<span class="number">1</span>);</span><br><span class="line">        <span class="keyword">if</span> (i &lt; R[i]) <span class="built_in">swap</span>(a[i], a[R[i]]);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function">vector&lt;cp&gt; <span class="title">w</span><span class="params">(len/<span class="number">2</span>)</span></span>; w[<span class="number">0</span>] = <span class="built_in">cp</span>(<span class="number">1</span>,<span class="number">0</span>);</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> n = <span class="number">2</span>; n &lt;= len; n &lt;&lt;= <span class="number">1</span>) &#123;</span><br><span class="line">        cp wt = <span class="built_in">cp</span>(<span class="built_in">cos</span>(<span class="number">2</span>*PI*op/n), <span class="built_in">sin</span>(<span class="number">2</span>*PI*op/n));</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> k = <span class="number">1</span>;k &lt; n/<span class="number">2</span>; ++k) &#123;</span><br><span class="line">            <span class="keyword">if</span> (k % <span class="number">2</span>) w[k] = w[k&gt;&gt;<span class="number">1</span>] * w[k&gt;&gt;<span class="number">1</span>] * wt;</span><br><span class="line">            <span class="keyword">else</span> w[k] = w[k&gt;&gt;<span class="number">1</span>] * w[k&gt;&gt;<span class="number">1</span>];</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; len; i += n) &#123;</span><br><span class="line">            <span class="type">int</span> po = i + (n&gt;&gt;<span class="number">1</span>);</span><br><span class="line">            <span class="keyword">for</span> (<span class="type">int</span> k = <span class="number">0</span>; k &lt; n/<span class="number">2</span>; ++k) &#123;</span><br><span class="line">                <span class="keyword">auto</span> t = a[i+k];</span><br><span class="line">                a[i + k] = t + w[k] * a[po + k];</span><br><span class="line">                a[po + k] = t - w[k] * a[po + k]; </span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (!~op) </span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>;i &lt; len; ++i) a[i].x /= len;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function">vector&lt;cp&gt; <span class="title">convolution</span><span class="params">(vector&lt;cp&gt;&amp; a, vector&lt;cp&gt;&amp; b)</span> </span>&#123;</span><br><span class="line">    <span class="type">int</span> len = <span class="number">1</span>;</span><br><span class="line">    <span class="type">int</span> lans = <span class="built_in">sz</span>(a) + <span class="built_in">sz</span>(b) - <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">while</span> (len &lt; lans) len &lt;&lt;= <span class="number">1</span>;</span><br><span class="line">    <span class="built_in">fft</span>(a, len, <span class="number">1</span>);</span><br><span class="line">    <span class="built_in">fft</span>(b, len, <span class="number">1</span>);</span><br><span class="line">    <span class="function">vector&lt;cp&gt; <span class="title">ret</span><span class="params">(lans)</span></span>;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>;i &lt; len; ++i) a[i] = a[i] * b[i];</span><br><span class="line">    <span class="built_in">fft</span>(a, len, <span class="number">-1</span>);</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>;i &lt; lans; ++i) ret[i] = a[i];</span><br><span class="line">    <span class="keyword">return</span> ret;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="快速数论变换ntt">快速数论变换NTT</h3>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">const</span> ll MOD = <span class="number">4179340454199820289</span>;</span><br><span class="line"><span class="type">const</span> ll G = <span class="number">3</span>, Gi = <span class="number">1393113484733273430</span>;</span><br><span class="line"><span class="comment">// const ll MOD = 998244353;</span></span><br><span class="line"><span class="comment">// const ll G = 3, Gi = 332748118;</span></span><br><span class="line"><span class="function">ll <span class="title">mul</span><span class="params">(ll a, ll b)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> ((__int128)a * b) % MOD;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function">ll <span class="title">fpow</span><span class="params">(ll a, ll n)</span> </span>&#123;</span><br><span class="line">    a %= MOD; ll ret = <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">for</span> (; n; n &gt;&gt;= <span class="number">1</span>, a = <span class="built_in">mul</span>(a, a) )</span><br><span class="line">    	<span class="keyword">if</span> (n &amp; <span class="number">1</span>) ret = <span class="built_in">mul</span>(ret, a);</span><br><span class="line">    <span class="keyword">return</span> ret;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">ntt</span><span class="params">(vector&lt;ll&gt; &amp;a, <span class="type">int</span> len, <span class="type">int</span> op)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">while</span> (<span class="built_in">sz</span>(a) &lt; len) a.<span class="built_in">push_back</span>(<span class="number">0</span>);</span><br><span class="line">    <span class="function">vector&lt;<span class="type">int</span>&gt; <span class="title">R</span><span class="params">(len)</span></span>;</span><br><span class="line">    R[<span class="number">0</span>] = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">1</span>;i &lt; len; ++i) &#123;</span><br><span class="line">        R[i] = (R[i&gt;&gt;<span class="number">1</span>]&gt;&gt;<span class="number">1</span>) + (i&amp;<span class="number">1</span>)*(len&gt;&gt;<span class="number">1</span>);</span><br><span class="line">        <span class="keyword">if</span> (i &lt; R[i]) <span class="built_in">swap</span>(a[i], a[R[i]]);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> mid = <span class="number">1</span>; mid &lt; len; mid &lt;&lt;= <span class="number">1</span>) &#123;	</span><br><span class="line">		ll Wn = <span class="built_in">fpow</span>( op == <span class="number">1</span> ? G : Gi , (MOD - <span class="number">1</span>) / (mid &lt;&lt; <span class="number">1</span>));</span><br><span class="line">		<span class="keyword">for</span>(<span class="type">int</span> j = <span class="number">0</span>; j &lt; len; j += (mid &lt;&lt; <span class="number">1</span>)) &#123;</span><br><span class="line">			ll w = <span class="number">1</span>;</span><br><span class="line">			<span class="keyword">for</span>(<span class="type">int</span> k = <span class="number">0</span>; k &lt; mid; k++, w = <span class="built_in">mul</span>(w, Wn)) &#123;</span><br><span class="line">                ll x = a[j + k], y = <span class="built_in">mul</span>(w, a[j + k + mid]);</span><br><span class="line">                a[j + k] = (x + y) % MOD,</span><br><span class="line">                a[j + k + mid] = (x - y + MOD) % MOD;</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">    ll iv = <span class="built_in">fpow</span>(len, MOD - <span class="number">2</span>);</span><br><span class="line">    <span class="keyword">if</span> (op == <span class="number">-1</span>) <span class="keyword">for</span>(<span class="type">int</span> i = <span class="number">0</span>; i &lt; len; i++) a[i] = <span class="built_in">mul</span>(a[i], iv);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function">vector&lt;ll&gt; <span class="title">convolution</span><span class="params">(vector&lt;ll&gt;&amp; a, vector&lt;ll&gt;&amp; b)</span> </span>&#123;</span><br><span class="line">    <span class="type">int</span> len = <span class="number">1</span>;</span><br><span class="line">    <span class="type">int</span> lans = <span class="built_in">sz</span>(a) + <span class="built_in">sz</span>(b) - <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">while</span> (len &lt; lans) len &lt;&lt;= <span class="number">1</span>;</span><br><span class="line">    <span class="built_in">ntt</span>(a, len, <span class="number">1</span>);</span><br><span class="line">    <span class="built_in">ntt</span>(b, len, <span class="number">1</span>);</span><br><span class="line">    <span class="function">vector&lt;ll&gt; <span class="title">ret</span><span class="params">(lans)</span></span>;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>;i &lt; len; ++i) a[i] = <span class="built_in">mul</span>(a[i], b[i]);</span><br><span class="line">    <span class="built_in">ntt</span>(a, len, <span class="number">-1</span>);</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>;i &lt; lans; ++i) ret[i] = a[i];</span><br><span class="line">    <span class="keyword">return</span> ret;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="线性代数">线性代数</h2>
<h3 id="矩阵快速幂">矩阵快速幂</h3>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">const</span> ll MOD = <span class="number">1e9</span> + <span class="number">7</span>;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">Mat</span> &#123;</span><br><span class="line">    <span class="type">int</span> n, m;</span><br><span class="line">    vector&lt;vector&lt;ll&gt;&gt; A;</span><br><span class="line">    <span class="built_in">Mat</span>(<span class="type">int</span> n, <span class="type">int</span> m, ll v=<span class="number">0</span>) : <span class="built_in">n</span>(n), <span class="built_in">m</span>(m), <span class="built_in">A</span>(n, <span class="built_in">vector</span>&lt;ll&gt;(m, v)) &#123;&#125;</span><br><span class="line">    <span class="built_in">Mat</span>(<span class="type">int</span> n=<span class="number">0</span>) : <span class="built_in">n</span>(n), <span class="built_in">m</span>(n), <span class="built_in">A</span>(n, <span class="built_in">vector</span>&lt;ll&gt;(n)) &#123;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>;i &lt; n; ++i) A[i][i] = <span class="number">1</span>;</span><br><span class="line">    &#125; </span><br><span class="line">    vector&lt;ll&gt;&amp; <span class="keyword">operator</span>[](<span class="type">const</span> <span class="type">int</span> k) &#123;</span><br><span class="line">        <span class="keyword">return</span> A[k];</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function">Mat <span class="title">T</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="function">Mat <span class="title">ret</span><span class="params">(m, n)</span></span>;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>;i &lt; n; ++i) &#123;</span><br><span class="line">            <span class="keyword">for</span> (<span class="type">int</span> j = <span class="number">0</span>;j &lt; m; ++j) &#123;</span><br><span class="line">                ret[j][i] = A[i][j];</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> ret;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">ostream&amp; <span class="keyword">operator</span>&lt;&lt;(ostream &amp;os, Mat &amp;x) &#123;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>;i &lt; x.n; ++i) &#123;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> j = <span class="number">0</span>;j &lt; x.m; ++j) &#123;</span><br><span class="line">            os &lt;&lt; x.A[i][j] &lt;&lt; <span class="string">&quot; &quot;</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> (i &lt; x.n<span class="number">-1</span>) os &lt;&lt; endl;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> os;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">istream&amp; <span class="keyword">operator</span>&gt;&gt;(istream &amp;is, Mat &amp;x) &#123;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>;i &lt; x.n; ++i) </span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> j = <span class="number">0</span>;j &lt; x.m; ++j) </span><br><span class="line">            is &gt;&gt; x.A[i][j];</span><br><span class="line">    <span class="keyword">return</span> is;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function">ll <span class="title">add</span><span class="params">(ll a, ll b)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (b &lt; <span class="number">0</span>) b = MOD + b%MOD;</span><br><span class="line">    <span class="keyword">return</span> (a + b) % MOD;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function">ll <span class="title">mul</span><span class="params">(ll a, ll b)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> (a * b) % MOD;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function">Mat <span class="title">Add</span><span class="params">(Mat&amp; a, Mat&amp; b)</span> </span>&#123;</span><br><span class="line">    <span class="function">Mat <span class="title">ret</span><span class="params">(a.n, b.m, <span class="number">0</span>)</span></span>;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>;i &lt; ret.n; ++i) </span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> j = <span class="number">0</span>;j &lt; ret.m; ++j) </span><br><span class="line">                ret.A[i][j] = <span class="built_in">add</span>(ret.A[i][j], <span class="built_in">add</span>(a.A[i][j], b.A[i][j]));</span><br><span class="line">    <span class="keyword">return</span> ret;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function">Mat <span class="title">Mul</span><span class="params">(Mat&amp; a, Mat&amp; b)</span> </span>&#123;</span><br><span class="line">    <span class="function">Mat <span class="title">ret</span><span class="params">(a.n, b.m, <span class="number">0</span>)</span></span>;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>;i &lt; ret.n; ++i) </span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> j = <span class="number">0</span>;j &lt; ret.m; ++j) </span><br><span class="line">            <span class="keyword">for</span> (<span class="type">int</span> k = <span class="number">0</span>;k &lt; a.m; ++k) </span><br><span class="line">                ret.A[i][j] = <span class="built_in">add</span>(ret.A[i][j], <span class="built_in">mul</span>(a.A[i][k], b.A[k][j]));</span><br><span class="line">    <span class="keyword">return</span> ret;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function">Mat&amp; <span class="title">Mul</span><span class="params">(Mat&amp; a, ll v)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>;i &lt; a.n; ++i) </span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> j = <span class="number">0</span>;j &lt; a.m; ++j) </span><br><span class="line">            a.A[i][j] = <span class="built_in">mul</span>(a.A[i][j], v);</span><br><span class="line">    <span class="keyword">return</span> a;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function">Mat&amp; <span class="title">Add</span><span class="params">(Mat&amp; a, ll v)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>;i &lt; a.n; ++i) </span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> j = <span class="number">0</span>;j &lt; a.m; ++j) </span><br><span class="line">            a.A[i][j] = <span class="built_in">add</span>(a.A[i][j], v);</span><br><span class="line">    <span class="keyword">return</span> a;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function">Mat <span class="title">Mfpow</span><span class="params">(Mat a, ll n)</span> </span>&#123;</span><br><span class="line">    Mat ret = <span class="built_in">Mat</span>(a.n);</span><br><span class="line">    <span class="keyword">for</span> (; n; n &gt;&gt;= <span class="number">1</span>, a = <span class="built_in">Mul</span>(a, a) )</span><br><span class="line">    	<span class="keyword">if</span> (n &amp; <span class="number">1</span>) ret = <span class="built_in">Mul</span>(ret, a);</span><br><span class="line">    <span class="keyword">return</span> ret;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 使用</span></span><br><span class="line">cin &gt;&gt; n &gt;&gt; m;</span><br><span class="line"><span class="function">Mat <span class="title">a</span><span class="params">(n, n)</span></span>;</span><br><span class="line">cin &gt;&gt; a;</span><br><span class="line">Mat r = <span class="built_in">Mfpow</span>(a, m); </span><br><span class="line">cout &lt;&lt; r &lt;&lt; endl;</span><br></pre></td></tr></table></figure>
<h3 id="矩阵求逆取模">矩阵求逆(取模)</h3>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line"><span class="function">ll <span class="title">fpow</span><span class="params">(ll a, ll n)</span> </span>&#123;</span><br><span class="line">    a %= MOD;</span><br><span class="line">    ll ret = <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">for</span> (; n; n &gt;&gt;= <span class="number">1</span>, a = <span class="built_in">mul</span>(a, a) )</span><br><span class="line">    	<span class="keyword">if</span> (n &amp; <span class="number">1</span>) ret = <span class="built_in">mul</span>(ret, a);</span><br><span class="line">    <span class="keyword">return</span> ret;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function">ll <span class="title">inv</span><span class="params">(ll x)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">fpow</span>(x, MOD<span class="number">-2</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function">Mat <span class="title">Inv</span><span class="params">(Mat&amp; a)</span> </span>&#123; <span class="comment">// 需要费尔马求逆元，求和支持减法</span></span><br><span class="line">    <span class="keyword">if</span> (a.n != a.m) <span class="keyword">return</span> <span class="built_in">Mat</span>(<span class="number">0</span>); <span class="comment">// 无效</span></span><br><span class="line">    <span class="function">Mat <span class="title">B</span><span class="params">(a.n,a.n*<span class="number">2</span>)</span></span>;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>;i &lt; a.n; ++i) &#123;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> j = <span class="number">0</span>;j &lt; a.n; ++j) &#123;</span><br><span class="line">            B.A[i][j] = a.A[i][j];</span><br><span class="line">        &#125;</span><br><span class="line">        B.A[i][i+a.n] = <span class="number">1</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> k = <span class="number">0</span>;k &lt; a.n; ++k) &#123;</span><br><span class="line">        <span class="type">int</span> row = k;</span><br><span class="line">        <span class="keyword">while</span> (row &lt; a.n &amp;&amp; !B.A[row][k]) row++;</span><br><span class="line">        <span class="keyword">if</span> (row &gt;= a.n) <span class="keyword">return</span> <span class="built_in">Mat</span>(<span class="number">0</span>);</span><br><span class="line">        <span class="built_in">swap</span>(B.A[row], B.A[k]);</span><br><span class="line">        ll iv = <span class="built_in">inv</span>(B.A[k][k]);</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> j = <span class="number">0</span>;j &lt; a.n*<span class="number">2</span>; ++j) &#123;</span><br><span class="line">            B.A[k][j] = <span class="built_in">mul</span>(B.A[k][j], iv);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>;i &lt; a.n; ++i) <span class="keyword">if</span> (k != i) &#123;</span><br><span class="line">            ll v = B.A[i][k];</span><br><span class="line">            <span class="keyword">for</span> (<span class="type">int</span> j = <span class="number">0</span>;j &lt; a.n*<span class="number">2</span>; ++j) &#123;</span><br><span class="line">                B.A[i][j] = <span class="built_in">add</span>(B.A[i][j], -<span class="built_in">mul</span>(v,B.A[k][j]));</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function">Mat <span class="title">ret</span><span class="params">(a.n,a.n)</span></span>;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>;i &lt; a.n; ++i) &#123;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> j = <span class="number">0</span>;j &lt; a.n; ++j) &#123;</span><br><span class="line">            ret.A[i][j] = B.A[i][j+a.n];</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> ret;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="线性基">线性基</h3>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">1</span>;i &lt;= n; ++i) &#123;</span><br><span class="line">    ll x = A[i];</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> k = <span class="number">50</span>;k &gt;= <span class="number">0</span>; --k) <span class="keyword">if</span> (x&gt;&gt;k &amp; <span class="number">1</span>) &#123;</span><br><span class="line">        <span class="keyword">if</span> (!B[k]) B[k] = x;</span><br><span class="line">        x ^= B[k];</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="高斯消元老">高斯消元（老）</h3>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">namespace</span> PG &#123; <span class="comment">// projective geometry</span></span><br><span class="line"></span><br><span class="line">	<span class="keyword">struct</span> <span class="title class_">Vector</span> &#123;</span><br><span class="line">		<span class="type">int</span> n;</span><br><span class="line">		<span class="type">double</span> data[maxn];</span><br><span class="line">		</span><br><span class="line">		<span class="built_in">Vector</span>(<span class="type">int</span> x=<span class="number">13</span>) &#123;</span><br><span class="line">			n = x;</span><br><span class="line">			<span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">1</span>;i &lt;= n; ++i) &#123;</span><br><span class="line">				data[i] = <span class="number">0</span>;</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;</span><br><span class="line">		</span><br><span class="line">	&#125;;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">struct</span> <span class="title class_">Matrix</span> &#123;</span><br><span class="line">		<span class="type">int</span> n, m;</span><br><span class="line">		<span class="type">double</span> data[maxn][maxn];</span><br><span class="line">		<span class="built_in">Matrix</span>(<span class="type">int</span> x, <span class="type">int</span> y) &#123;</span><br><span class="line">			n = x; m = y;</span><br><span class="line">		&#125;</span><br><span class="line"></span><br><span class="line">		<span class="function"><span class="type">void</span> <span class="title">multline</span><span class="params">(<span class="type">int</span> line, <span class="type">double</span> value)</span> </span>&#123;</span><br><span class="line">			<span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">1</span>;i &lt;= m; ++i) data[line][i] *= value;</span><br><span class="line">		&#125;</span><br><span class="line"></span><br><span class="line">		<span class="function"><span class="type">void</span> <span class="title">addwith</span><span class="params">(<span class="type">int</span> line, <span class="type">int</span> other)</span> </span>&#123;</span><br><span class="line">			<span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">1</span>;i &lt;= m; ++i) data[line][i] += data[other][i];</span><br><span class="line">		&#125;</span><br><span class="line"></span><br><span class="line">		<span class="function"><span class="type">void</span> <span class="title">appendline</span><span class="params">(Vector v)</span> </span>&#123;</span><br><span class="line">			<span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">1</span>;i &lt;= v.n; ++i) &#123;</span><br><span class="line">				data[n<span class="number">+1</span>][i] = v.data[i];</span><br><span class="line">			&#125;</span><br><span class="line">			n++;</span><br><span class="line">		&#125;</span><br><span class="line"></span><br><span class="line">		<span class="function"><span class="type">void</span> <span class="title">mul</span><span class="params">(<span class="type">double</span> val)</span> </span>&#123;</span><br><span class="line">			<span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">1</span>;i &lt;= n; ++i) &#123;</span><br><span class="line">				<span class="keyword">for</span> (<span class="type">int</span> j = <span class="number">1</span>;j &lt;= m; ++j) &#123;</span><br><span class="line">					data[i][j] *= val;</span><br><span class="line">				&#125;</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;</span><br><span class="line"></span><br><span class="line">		<span class="function"><span class="type">void</span> <span class="title">add</span><span class="params">(Vector v)</span> </span>&#123;</span><br><span class="line">			<span class="type">int</span> cnt = <span class="number">1</span>;</span><br><span class="line">			<span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">1</span>;i &lt;= n; ++i) &#123;</span><br><span class="line">				<span class="keyword">for</span> (<span class="type">int</span> j = <span class="number">1</span>;j &lt;= m; ++j) &#123;</span><br><span class="line">					data[i][j] = v.data[cnt++];</span><br><span class="line">				&#125;</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;</span><br><span class="line"></span><br><span class="line">		Matrix&amp; <span class="keyword">operator</span> = (<span class="type">const</span> Matrix&amp; other) &#123;</span><br><span class="line">			n = other.n; m = other.m;</span><br><span class="line">			<span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">1</span>;i &lt;= n; ++i) &#123;</span><br><span class="line">				<span class="keyword">for</span> (<span class="type">int</span> j = <span class="number">1</span>;j &lt;= m; ++j) &#123;</span><br><span class="line">					data[i][j] = other.data[i][j];</span><br><span class="line">				&#125;</span><br><span class="line">			&#125;</span><br><span class="line">			<span class="keyword">return</span> *<span class="keyword">this</span>;</span><br><span class="line">		&#125;</span><br><span class="line"></span><br><span class="line">		<span class="function">Vector <span class="title">gauss</span><span class="params">()</span> </span>&#123;</span><br><span class="line">			<span class="type">int</span> vis[n<span class="number">+1</span>], used[n<span class="number">+1</span>];</span><br><span class="line">			<span class="built_in">memset</span>(vis,<span class="number">0</span>,<span class="built_in">sizeof</span>(vis)); <span class="built_in">memset</span>(used,<span class="number">0</span>,<span class="built_in">sizeof</span>(used));</span><br><span class="line"></span><br><span class="line">			<span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">1</span>;i &lt;= n; ++i) &#123; <span class="comment">// 选择主元</span></span><br><span class="line">				<span class="type">int</span> flag = <span class="number">0</span>;</span><br><span class="line">				<span class="keyword">for</span> (<span class="type">int</span> j = <span class="number">1</span>;j &lt;= n; ++j) &#123; <span class="comment">// 选择方程</span></span><br><span class="line">					<span class="keyword">if</span> (data[j][i] != <span class="number">0</span> &amp;&amp; !used[j]) &#123;</span><br><span class="line">						flag = <span class="number">1</span>;</span><br><span class="line">						vis[i] = j;</span><br><span class="line">						used[j] = <span class="number">1</span>;</span><br><span class="line">						<span class="built_in">multline</span>(j, <span class="number">1.0</span>/data[j][i]);</span><br><span class="line">						<span class="keyword">for</span> (<span class="type">int</span> k = <span class="number">1</span>;k &lt;= n; ++k) &#123;</span><br><span class="line">							<span class="keyword">if</span> (used[k] || <span class="built_in">abs</span>(data[k][i]) &lt; ZERO) <span class="keyword">continue</span>; <span class="comment">// 不选择j</span></span><br><span class="line">							<span class="built_in">multline</span>(k, <span class="number">-1.0</span>/data[k][i]);</span><br><span class="line">							<span class="built_in">addwith</span>(k, j); <span class="comment">//消元i</span></span><br><span class="line">						&#125;</span><br><span class="line">						<span class="keyword">break</span>;</span><br><span class="line">					&#125;</span><br><span class="line">				&#125;</span><br><span class="line">				<span class="keyword">if</span> (!flag) <span class="keyword">return</span> <span class="built_in">Vector</span>(<span class="number">-1</span>);</span><br><span class="line">			&#125;</span><br><span class="line"></span><br><span class="line">			<span class="function">Vector <span class="title">ret</span><span class="params">(n)</span></span>;</span><br><span class="line"></span><br><span class="line">			<span class="keyword">for</span> (<span class="type">int</span> i = n; i &gt;= <span class="number">1</span>; --i) &#123;</span><br><span class="line">				<span class="type">int</span> now = vis[i];</span><br><span class="line">				<span class="type">double</span> v = data[now][m];</span><br><span class="line">				<span class="keyword">for</span> (<span class="type">int</span> j = <span class="number">1</span>;j &lt;= n; ++j) &#123;</span><br><span class="line">					<span class="keyword">if</span> (j == now) <span class="keyword">continue</span>;</span><br><span class="line">					data[j][m] -= data[j][i] * v;</span><br><span class="line">					data[j][i] = <span class="number">0</span>;</span><br><span class="line">				&#125;</span><br><span class="line">				ret.data[i] = v;</span><br><span class="line">			&#125;</span><br><span class="line"></span><br><span class="line">			<span class="keyword">return</span> ret;</span><br><span class="line">		&#125;</span><br><span class="line"></span><br><span class="line">		<span class="function"><span class="type">void</span> <span class="title">gauss_jordan</span><span class="params">()</span> </span>&#123;</span><br><span class="line">			<span class="keyword">for</span>(<span class="type">int</span> i = <span class="number">1</span>,r;i &lt;= n; ++i)&#123;	</span><br><span class="line">				r = i;</span><br><span class="line">				<span class="keyword">for</span>(<span class="type">int</span> j=i<span class="number">+1</span>;j&lt;=n;++j) </span><br><span class="line">					<span class="keyword">if</span>(<span class="built_in">abs</span>(data[j][i]) &gt; <span class="built_in">abs</span>(data[r][i])) r = j;</span><br><span class="line">				<span class="keyword">if</span>(<span class="built_in">abs</span>(data[r][i]) &lt; ZERO) &#123;</span><br><span class="line">					n = <span class="number">-1</span>; <span class="keyword">return</span>; <span class="comment">// no solution</span></span><br><span class="line">				&#125;</span><br><span class="line">				<span class="keyword">if</span>(i != r) <span class="built_in">swap</span>(data[i],data[r]);</span><br><span class="line">				</span><br><span class="line">				<span class="keyword">for</span>(<span class="type">int</span> k = <span class="number">1</span>;k &lt;= n; ++k)&#123;</span><br><span class="line">					<span class="keyword">if</span>(k == i || <span class="built_in">abs</span>(data[k][i]) &lt; ZERO) <span class="keyword">continue</span>;</span><br><span class="line">				</span><br><span class="line">					<span class="built_in">multline</span>(k, -data[i][i]/data[k][i]);</span><br><span class="line">					<span class="built_in">addwith</span>(k, i);</span><br><span class="line">				</span><br><span class="line">				&#125; </span><br><span class="line">			&#125;	</span><br><span class="line">			<span class="keyword">for</span>(<span class="type">int</span> i = <span class="number">1</span>;i &lt;= n; ++i) <span class="built_in">multline</span>(i, <span class="number">1.0</span>/data[i][i]);</span><br><span class="line">		&#125;</span><br><span class="line"></span><br><span class="line">		<span class="function">Matrix <span class="title">getI</span><span class="params">(<span class="type">int</span> size)</span> </span>&#123;</span><br><span class="line">			<span class="function">Matrix <span class="title">ret</span><span class="params">(size, size)</span></span>;</span><br><span class="line">			<span class="built_in">memset</span>(ret.data,<span class="number">0</span>,<span class="built_in">sizeof</span>(ret.data));</span><br><span class="line">			<span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">1</span>;i &lt;= size; ++i) ret.data[i][i] = <span class="number">1</span>;</span><br><span class="line">			<span class="keyword">return</span> ret;</span><br><span class="line">		&#125;</span><br><span class="line"></span><br><span class="line">		<span class="function"><span class="type">void</span> <span class="title">concat</span><span class="params">(Matrix other)</span> </span>&#123;</span><br><span class="line">			<span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">1</span>;i &lt;= other.n; ++i) &#123;</span><br><span class="line">				<span class="keyword">for</span> (<span class="type">int</span> j = <span class="number">1</span>;j &lt;= other.m; ++j) &#123;</span><br><span class="line">					data[i][j+m] = other.data[i][j];</span><br><span class="line">				&#125;</span><br><span class="line">			&#125;</span><br><span class="line">			m = m + other.m;</span><br><span class="line">		&#125;</span><br><span class="line"></span><br><span class="line">		<span class="function"><span class="type">void</span> <span class="title">spilt</span><span class="params">(<span class="type">int</span> a, <span class="type">int</span> b)</span> </span>&#123; <span class="comment">//分割位a-b列</span></span><br><span class="line">			<span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">1</span>;i &lt;= n; ++i) &#123;</span><br><span class="line">				<span class="keyword">for</span> (<span class="type">int</span> j = <span class="number">1</span>;j &lt;= b-a<span class="number">+1</span>; ++j) &#123;</span><br><span class="line">					data[i][j] = data[i][a+j<span class="number">-1</span>];</span><br><span class="line">				&#125;</span><br><span class="line">			&#125;</span><br><span class="line">			m = b-a<span class="number">+1</span>;</span><br><span class="line">		&#125;</span><br><span class="line"></span><br><span class="line">		<span class="function"><span class="type">void</span> <span class="title">print</span><span class="params">()</span> </span>&#123;</span><br><span class="line">			<span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">1</span>;i &lt;= n; ++i) &#123;</span><br><span class="line">				<span class="keyword">for</span> (<span class="type">int</span> j = <span class="number">1</span>;j &lt;= m; ++j) &#123;</span><br><span class="line">					cout &lt;&lt; data[i][j] &lt;&lt; <span class="string">&quot; &quot;</span>;</span><br><span class="line">				&#125;</span><br><span class="line">				cout &lt;&lt; endl;</span><br><span class="line">			&#125;</span><br><span class="line">			cout &lt;&lt; endl;</span><br><span class="line">		&#125;</span><br><span class="line"></span><br><span class="line">		<span class="function">Matrix <span class="title">inverse</span><span class="params">()</span> </span>&#123;</span><br><span class="line">			<span class="function">Matrix <span class="title">now</span><span class="params">(n,m)</span></span>; now = *<span class="keyword">this</span>;</span><br><span class="line">			now.<span class="built_in">concat</span>(<span class="built_in">getI</span>(n));</span><br><span class="line">			now.<span class="built_in">gauss_jordan</span>();</span><br><span class="line">			now.<span class="built_in">spilt</span>(now.n<span class="number">+1</span>,now.m);</span><br><span class="line">			<span class="keyword">return</span> now;</span><br><span class="line">		&#125;</span><br><span class="line"></span><br><span class="line">		Matrix <span class="keyword">operator</span> *(Matrix other) &#123;</span><br><span class="line">			<span class="function">Matrix <span class="title">ret</span><span class="params">(n, other.m)</span></span>;</span><br><span class="line">			<span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">1</span>;i &lt;= n; ++i) &#123;</span><br><span class="line">				<span class="keyword">for</span> (<span class="type">int</span> j = <span class="number">1</span>;j &lt;= other.m; ++j) &#123;</span><br><span class="line">					ret.data[i][j] = <span class="number">0</span>;</span><br><span class="line">					<span class="keyword">for</span> (<span class="type">int</span> k = <span class="number">1</span>;k &lt;= m; ++k) ret.data[i][j] += data[i][k]*other.data[k][j];</span><br><span class="line">				&#125;</span><br><span class="line">			&#125;</span><br><span class="line">			<span class="keyword">return</span> ret;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="动态规划">动态规划</h2>
<h3 id="最长不下降子序列-onlogn">最长不下降子序列 <span
class="math inline">\(O(nlogn)\)</span></h3>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">int</span> low[maxn];</span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">LIS</span><span class="params">(<span class="type">int</span> *A, <span class="type">int</span> n)</span> </span>&#123; <span class="comment">// 最长不下降子序列</span></span><br><span class="line">    <span class="type">int</span> ans = <span class="number">0</span>;</span><br><span class="line">    <span class="built_in">fill</span>(low<span class="number">+1</span>, low+n<span class="number">+1</span>, <span class="number">1e9</span>);</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">1</span>;i &lt;= n; ++i) &#123;</span><br><span class="line">        <span class="keyword">if</span> (ans == <span class="number">0</span> || A[i] &gt;= low[ans]) low[++ans] = A[i];</span><br><span class="line">        <span class="keyword">else</span> low[<span class="built_in">upper_bound</span>(low<span class="number">+1</span>, low+ans<span class="number">+1</span>, A[i]) - low] = A[i];</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> ans;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">LIS</span><span class="params">(<span class="type">int</span> *A, <span class="type">int</span> n)</span> </span>&#123; <span class="comment">// 最长严格上升子序列</span></span><br><span class="line">    <span class="type">int</span> ans = <span class="number">0</span>;</span><br><span class="line">    <span class="built_in">fill</span>(low<span class="number">+1</span>, low+n<span class="number">+1</span>, <span class="number">1e9</span>);</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">1</span>;i &lt;= n; ++i) &#123;</span><br><span class="line">        <span class="keyword">if</span> (ans == <span class="number">0</span> || A[i] &gt; low[ans]) low[++ans] = A[i];</span><br><span class="line">        <span class="keyword">else</span> low[<span class="built_in">lower_bound</span>(low<span class="number">+1</span>, low+ans<span class="number">+1</span>, A[i]) - low] = A[i];</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> ans;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">LDS</span><span class="params">(<span class="type">int</span> *A, <span class="type">int</span> n)</span> </span>&#123; <span class="comment">// 最长不下降子序列</span></span><br><span class="line">    <span class="type">int</span> ans = <span class="number">0</span>;</span><br><span class="line">    <span class="built_in">fill</span>(low<span class="number">+1</span>, low+n<span class="number">+1</span>, <span class="number">1e9</span>);</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">1</span>;i &lt;= n; ++i) &#123;</span><br><span class="line">        <span class="keyword">if</span> (ans == <span class="number">0</span> || -A[i] &gt;= low[ans]) low[++ans] = -A[i];</span><br><span class="line">        <span class="keyword">else</span> low[<span class="built_in">upper_bound</span>(low<span class="number">+1</span>, low+ans<span class="number">+1</span>, -A[i]) - low] = -A[i];</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> ans;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="最长公共子序列-onlogn">最长公共子序列 <span
class="math inline">\(O(nlogn)\)</span></h3>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">int</span> M[maxn], low[maxn];</span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">LIS</span><span class="params">(<span class="type">int</span> *A, <span class="type">int</span> n)</span> </span>&#123;</span><br><span class="line">    <span class="type">int</span> ans = <span class="number">0</span>;</span><br><span class="line">    <span class="built_in">fill</span>(low<span class="number">+1</span>, low+n<span class="number">+1</span>, <span class="number">1e9</span>);</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">1</span>;i &lt;= n; ++i) &#123;</span><br><span class="line">        <span class="keyword">if</span> (ans == <span class="number">0</span> || A[i] &gt;= low[ans]) low[++ans] = A[i];</span><br><span class="line">        <span class="keyword">else</span> low[<span class="built_in">upper_bound</span>(low<span class="number">+1</span>, low+ans<span class="number">+1</span>, A[i]) - low] = A[i];</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> ans;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">LCS</span><span class="params">(<span class="type">int</span> *A, <span class="type">int</span> *B, <span class="type">int</span> n)</span> </span>&#123;</span><br><span class="line">    <span class="built_in">fill</span>(M, M+n<span class="number">+1</span>, <span class="number">1e9</span>);</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">1</span>;i &lt;= n; ++i) M[A[i]] = i;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">1</span>;i &lt;= n; ++i) B[i] = M[B[i]];</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">LIS</span>(B, n);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="dag最长路">DAG最长路</h3>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">ll n, m, dp[maxn], book[maxn];</span><br><span class="line">vector&lt;pair&lt;<span class="type">int</span>, ll&gt;&gt; G[maxn];</span><br><span class="line"><span class="function">ll <span class="title">dfs</span><span class="params">(<span class="type">int</span> x, <span class="type">int</span> t)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (book[x]) <span class="keyword">return</span> dp[x];</span><br><span class="line">    <span class="keyword">if</span> (x == t) <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">    dp[x] = -oo;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">auto</span> v : G[x]) &#123;</span><br><span class="line">        dp[x] = <span class="built_in">max</span>(dp[x], <span class="built_in">dfs</span>(v.first, t) + v.second);</span><br><span class="line">    &#125;</span><br><span class="line">    book[x] = <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">return</span> dp[x];</span><br><span class="line">&#125;</span><br><span class="line"><span class="function">ll <span class="title">DAG</span><span class="params">(vector&lt;pair&lt;<span class="type">int</span>, ll&gt;&gt;* G, <span class="type">int</span> s, <span class="type">int</span> t)</span> </span>&#123;</span><br><span class="line">    <span class="built_in">fill</span>(book<span class="number">+1</span>, book+n<span class="number">+1</span>, <span class="number">0</span>); </span><br><span class="line">    ll ret = <span class="built_in">dfs</span>(s, t);</span><br><span class="line">    <span class="keyword">return</span> ret &gt;= <span class="number">0</span> ? ret : <span class="number">-1</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//    cout &lt;&lt; DAG(G, 1, n) &lt;&lt; endl;</span></span><br></pre></td></tr></table></figure>
<h3 id="树形dp">树形dp</h3>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 01状态dp：没有上司的舞会</span></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">dfs</span><span class="params">(<span class="type">int</span> x)</span> </span>&#123;</span><br><span class="line">    dp[x][<span class="number">0</span>] = <span class="number">0</span>; dp[x][<span class="number">1</span>] = r[x];</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">auto</span> v : G[x]) <span class="keyword">if</span> (v != fa[x]) &#123;</span><br><span class="line">        <span class="built_in">dfs</span>(v);</span><br><span class="line">        dp[x][<span class="number">0</span>] += <span class="built_in">max</span>(dp[v][<span class="number">0</span>],dp[v][<span class="number">1</span>]);</span><br><span class="line">        dp[x][<span class="number">1</span>] += dp[v][<span class="number">0</span>];</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="树形背包简单版">树形背包（简单版）</h4>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="type">void</span> <span class="title">dfs</span><span class="params">(<span class="type">int</span> x)</span> </span>&#123;</span><br><span class="line">    dp[x][<span class="number">1</span>][<span class="number">1</span>] = s[x]; <span class="comment">// 第一个点是自己</span></span><br><span class="line">    <span class="comment">// x: x  前 i个儿子(自己是1)选 j 个   f[x][i][j] = max(f[x][i-1][j-k] + g[son][all][k]) // 这个节点选k个  f[1][1] = s[x] </span></span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">2</span>;i &lt;= <span class="built_in">sz</span>(G[x])<span class="number">+1</span>; ++i) &#123;</span><br><span class="line">        <span class="type">int</span> v = G[x][i<span class="number">-2</span>];</span><br><span class="line">        <span class="built_in">dfs</span>(v);</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> j = <span class="number">1</span>;j &lt;= m; ++j) &#123;</span><br><span class="line">            <span class="keyword">for</span> (<span class="type">int</span> k = <span class="number">0</span>;k &lt; j; ++k) &#123;</span><br><span class="line">                dp[x][i][j] = <span class="built_in">max</span>(dp[x][i][j], dp[x][i<span class="number">-1</span>][j-k] + dp[v][<span class="built_in">sz</span>(G[v]) + <span class="number">1</span>][k]);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="树形背包on2">树形背包（<span
class="math inline">\(O(n^2)\)</span>）</h4>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;bits/stdc++.h&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"><span class="meta">#<span class="keyword">define</span> _ &lt;&lt;<span class="string">&quot; &quot;</span>&lt;&lt;</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> sz(x) ((int) (x).size())</span></span><br><span class="line"><span class="keyword">typedef</span> pair&lt;<span class="type">int</span>, <span class="type">int</span>&gt; pii;</span><br><span class="line"><span class="keyword">typedef</span> <span class="type">long</span> <span class="type">long</span> ll;</span><br><span class="line"><span class="type">const</span> <span class="type">int</span> maxn = <span class="number">2e3</span> + <span class="number">5</span>;</span><br><span class="line"><span class="type">const</span> ll oo = <span class="number">1e18</span>;</span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">int</span> <span class="title">read</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="type">int</span> x = <span class="number">0</span>; <span class="type">char</span> ch = <span class="number">0</span>, w = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">while</span>(!<span class="built_in">isdigit</span>(ch)) &#123;w |= ch == <span class="string">&#x27;-&#x27;</span>; ch=<span class="built_in">getchar</span>();&#125;</span><br><span class="line">    <span class="keyword">while</span>(<span class="built_in">isdigit</span>(ch)) x = (x&lt;&lt;<span class="number">3</span>) + (x&lt;&lt;<span class="number">1</span>) + (ch^<span class="number">48</span>), ch=<span class="built_in">getchar</span>();</span><br><span class="line">    <span class="keyword">return</span> w ? -x : x;</span><br><span class="line">&#125;</span><br><span class="line"><span class="type">int</span> n, m;</span><br><span class="line">vector&lt;<span class="type">int</span>&gt; G[maxn];</span><br><span class="line">ll dp[maxn][maxn][<span class="number">2</span>], cnt[maxn], val[maxn];</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">dfs</span><span class="params">(<span class="type">int</span> x)</span> </span>&#123;</span><br><span class="line">    dp[x][<span class="number">1</span>][<span class="number">0</span>] = <span class="number">0</span>;</span><br><span class="line">    dp[x][<span class="number">0</span>][<span class="number">1</span>] = val[x];</span><br><span class="line">    cnt[x] = <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">1</span>;i &lt;= <span class="built_in">sz</span>(G[x]); ++i) &#123;</span><br><span class="line">        <span class="type">int</span> v = G[x][i<span class="number">-1</span>];</span><br><span class="line">        <span class="built_in">dfs</span>(v);</span><br><span class="line">        <span class="function">vector&lt;ll&gt; <span class="title">ans0</span><span class="params">(cnt[x]+cnt[v]<span class="number">+1</span>, oo)</span>,<span class="title">ans1</span><span class="params">(cnt[x]+cnt[v]<span class="number">+1</span>, oo)</span></span>;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> j = <span class="number">0</span>;j &lt;= cnt[x]; ++j) &#123;</span><br><span class="line">            <span class="keyword">for</span> (<span class="type">int</span> k = <span class="number">0</span>;k &lt;= cnt[v]; ++k) &#123;</span><br><span class="line">                ans0[j+k] = <span class="built_in">min</span>(ans0[j+k], dp[x][j][<span class="number">0</span>] + <span class="built_in">min</span>(dp[v][k][<span class="number">0</span>], dp[v][k][<span class="number">1</span>]));</span><br><span class="line">                ans1[j+k] = <span class="built_in">min</span>(ans1[j+k], dp[x][j][<span class="number">1</span>] + <span class="built_in">min</span>(dp[v][k][<span class="number">0</span>], dp[v][k][<span class="number">1</span>] + val[v]));</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        cnt[x] += cnt[v]; <span class="comment">// important</span></span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> j = <span class="number">0</span>;j &lt;= cnt[x]; ++j)</span><br><span class="line">            dp[x][j][<span class="number">0</span>] = ans0[j], dp[x][j][<span class="number">1</span>] = ans1[j];</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="type">int</span> T;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    T = <span class="built_in">read</span>();</span><br><span class="line">    <span class="keyword">while</span> (T--) &#123;</span><br><span class="line">        n = <span class="built_in">read</span>();</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">1</span>;i &lt;= n; ++i) &#123;</span><br><span class="line">            G[i].<span class="built_in">clear</span>();</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        </span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">2</span>, x;i &lt;= n; ++i) &#123;</span><br><span class="line">            x = <span class="built_in">read</span>();</span><br><span class="line">            G[x].<span class="built_in">push_back</span>(i);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">1</span>;i &lt;= n; ++i) &#123;</span><br><span class="line">            val[i] = <span class="built_in">read</span>();</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">0</span>;i&lt;=n;i++)&#123;</span><br><span class="line">            <span class="keyword">for</span>(<span class="type">int</span> j=<span class="number">0</span>;j&lt;=n;j++)&#123;</span><br><span class="line">                dp[i][j][<span class="number">0</span>]=dp[i][j][<span class="number">1</span>]=oo;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="built_in">dfs</span>(<span class="number">1</span>);</span><br><span class="line">        <span class="comment">// cout &lt;&lt; dp[4][0][1] &lt;&lt; endl;</span></span><br><span class="line">        <span class="comment">// cout &lt;&lt; dp[5][0][1] &lt;&lt; endl;</span></span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>;i &lt;= n; ++i) &#123;</span><br><span class="line">           <span class="built_in">printf</span>(<span class="string">&quot;%lld &quot;</span>, <span class="built_in">min</span>(dp[<span class="number">1</span>][i][<span class="number">1</span>],dp[<span class="number">1</span>][i][<span class="number">0</span>]));</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="built_in">putchar</span>(<span class="string">&#x27;\n&#x27;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>树形背包（DFS序）</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="type">void</span> <span class="title">dfs</span><span class="params">(<span class="type">int</span> i)</span> </span>&#123;</span><br><span class="line">    cnt[i] = <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">auto</span> v : G[i]) &#123;</span><br><span class="line">        <span class="built_in">dfs</span>(v);</span><br><span class="line">        cnt[i] += cnt[v];</span><br><span class="line">    &#125; </span><br><span class="line">    num[i] = ++tot;</span><br><span class="line">  <span class="comment">//  cout &lt;&lt; i _ num[i] &lt;&lt; endl;</span></span><br><span class="line">    dp[num[i]][<span class="number">0</span>] = dp[num[i] - cnt[i]][<span class="number">0</span>];</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> j = <span class="number">1</span>;j &lt;= m; ++j) &#123;</span><br><span class="line">        dp[num[i]][j] = <span class="built_in">max</span>(dp[num[i]<span class="number">-1</span>][j<span class="number">-1</span>] + s[i], dp[num[i] - cnt[i]][j]);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="状态压缩位运算">状态压缩位运算</h3>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="type">int</span> <span class="title">seti</span><span class="params">(<span class="type">int</span> mask, <span class="type">int</span> i)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> mask | (<span class="number">1</span>&lt;&lt;(i<span class="number">-1</span>));</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">deli</span><span class="params">(<span class="type">int</span> mask, <span class="type">int</span> i)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> mask &amp; (~(<span class="number">1</span>&lt;&lt;(i<span class="number">-1</span>)));</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">hasi</span><span class="params">(<span class="type">int</span> mask, <span class="type">int</span> i)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> mask &amp; (<span class="number">1</span>&lt;&lt;(i<span class="number">-1</span>));</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">toint</span><span class="params">(string s)</span> </span>&#123;</span><br><span class="line">    <span class="type">int</span> k = <span class="number">1</span>; <span class="type">int</span> ret = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = (<span class="type">int</span>)s.<span class="built_in">length</span>()<span class="number">-1</span>;i &gt;= <span class="number">0</span>; --i) &#123;</span><br><span class="line">        ret += (s[i] - <span class="string">&#x27;0&#x27;</span>) * k;</span><br><span class="line">        k *= <span class="number">2</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> ret;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>计算二进制中 <span class="math inline">\(1\)</span> 的个数</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">__builtin_popcount(x)</span><br></pre></td></tr></table></figure>
<h3 id="数位dp">数位dp</h3>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">int</span> A[<span class="number">20</span>];</span><br><span class="line"><span class="type">int</span> dp[<span class="number">11</span>][<span class="number">91</span>][<span class="number">91</span>]; <span class="comment">// sum &lt;= 90 优化</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">dfs</span><span class="params">(<span class="type">int</span> pos, <span class="type">int</span> sum, <span class="type">int</span> r, <span class="type">int</span> limit)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (pos == <span class="number">0</span>) &#123;</span><br><span class="line">        <span class="keyword">if</span> (sum % k == <span class="number">0</span> &amp;&amp; r == <span class="number">0</span>) <span class="keyword">return</span> <span class="number">1</span>;</span><br><span class="line">        <span class="keyword">else</span> <span class="keyword">return</span> <span class="number">0</span>; </span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">auto</span> cur = dp[pos][sum][r];</span><br><span class="line">    <span class="keyword">if</span> (!limit &amp;&amp; cur != <span class="number">-1</span>) <span class="keyword">return</span> cur; </span><br><span class="line">    cur = <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">    <span class="type">int</span> mxnum = limit ? A[pos] : <span class="number">9</span>;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>;i &lt;= mxnum; ++i) &#123;</span><br><span class="line">        cur += <span class="built_in">dfs</span>(pos<span class="number">-1</span>, sum + i, (r*<span class="number">10</span> + i) % k, limit &amp;&amp; (i == A[pos]));</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">if</span> (!limit) dp[pos][sum][r] = cur;</span><br><span class="line">    <span class="keyword">return</span> cur;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">solve</span><span class="params">(<span class="type">int</span> num)</span> </span>&#123; <span class="comment">// A 数组倒着存，数字大用string</span></span><br><span class="line">    <span class="type">int</span> tot = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">while</span> (num) &#123;</span><br><span class="line">        A[++tot] = (num % <span class="number">10</span>);</span><br><span class="line">        num /= <span class="number">10</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">memset</span>(dp, <span class="number">-1</span>, <span class="built_in">sizeof</span>(dp)); <span class="comment">// 初始化成0会炸</span></span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">dfs</span>(tot, <span class="number">0</span>, <span class="number">0</span>, <span class="number">1</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>双边界</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line">ll tl = l;</span><br><span class="line"><span class="type">int</span> tota = <span class="number">0</span>;</span><br><span class="line"><span class="keyword">while</span> (tl) &#123;</span><br><span class="line">    A[++tota] = tl % <span class="number">10</span>;</span><br><span class="line">    tl /= <span class="number">10</span>;</span><br><span class="line">&#125;</span><br><span class="line">ll tr = r;</span><br><span class="line"><span class="type">int</span> totb = <span class="number">0</span>;</span><br><span class="line"><span class="keyword">while</span> (tr) &#123;</span><br><span class="line">    B[++totb] = tr % <span class="number">10</span>;</span><br><span class="line">    tr /= <span class="number">10</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="type">int</span> tot = <span class="built_in">max</span>(tota, totb);</span><br><span class="line"></span><br><span class="line"><span class="function">pair&lt;ll,ll&gt; <span class="title">dfs</span><span class="params">(<span class="type">int</span> pos, <span class="type">int</span> l1, <span class="type">int</span> l2)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (pos == <span class="number">0</span> || (l1 == <span class="number">0</span> &amp;&amp; l2 == <span class="number">0</span>)) &#123;</span><br><span class="line">        <span class="comment">// 边界</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">auto</span> &amp;cur = dp[pos][l1][l2];</span><br><span class="line">    <span class="keyword">if</span> (cur.first != <span class="number">-1</span>) <span class="keyword">return</span> dp[pos][l1][l2];</span><br><span class="line">    cur = &#123;<span class="number">-1</span>,<span class="number">0</span>&#125;;</span><br><span class="line"></span><br><span class="line">    <span class="type">int</span> down = l1 ? A[pos] : <span class="number">0</span>;</span><br><span class="line">    <span class="type">int</span> up = l2 ? B[pos] : <span class="number">9</span>;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = down;i &lt;= up; ++i) &#123;</span><br><span class="line">        <span class="comment">// ...</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> cur;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="sos-dp">SOS DP</h3>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">for</span>(<span class="type">int</span> i = <span class="number">0</span>; i&lt;(<span class="number">1</span>&lt;&lt;N); ++i)</span><br><span class="line">	F[i] = A[i];</span><br><span class="line"><span class="keyword">for</span>(<span class="type">int</span> i = <span class="number">0</span>;i &lt; N; ++i) <span class="keyword">for</span>(<span class="type">int</span> mask = <span class="number">0</span>; mask &lt; (<span class="number">1</span>&lt;&lt;N); ++mask)&#123;</span><br><span class="line">	<span class="keyword">if</span>(mask &amp; (<span class="number">1</span>&lt;&lt;i))</span><br><span class="line">		F[mask] += F[mask^(<span class="number">1</span>&lt;&lt;i)];</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="convexhull-trick">Convexhull Trick</h3>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">struct</span> <span class="title class_">ConvexHullTrick</span> &#123;</span><br><span class="line">    <span class="comment">// find minimun,  k decreases</span></span><br><span class="line">    <span class="comment">// find maximum,  k increases</span></span><br><span class="line">    <span class="keyword">typedef</span> ll T;</span><br><span class="line">    <span class="keyword">typedef</span> pair&lt;T,T&gt; line;</span><br><span class="line">    vector&lt;<span class="type">long</span> <span class="type">double</span>&gt; x;</span><br><span class="line">    vector&lt;line&gt; q;</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="type">long</span> <span class="type">double</span> <span class="title">intersect</span><span class="params">(line l1, line l2)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> (<span class="type">long</span> <span class="type">double</span>)(l<span class="number">2.</span>second-l<span class="number">1.</span>second)/(l<span class="number">1.f</span>irst-l<span class="number">2.f</span>irst);;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">addline</span><span class="params">(T k, T b)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">while</span> (!q.<span class="built_in">empty</span>() &amp;&amp; <span class="built_in">intersect</span>(q.<span class="built_in">back</span>(), &#123;k,b&#125;) &lt;= x.<span class="built_in">back</span>()) q.<span class="built_in">pop_back</span>(), x.<span class="built_in">pop_back</span>();</span><br><span class="line">        x.<span class="built_in">push_back</span>(q.<span class="built_in">empty</span>()?-(<span class="number">1e18</span>):<span class="built_in">intersect</span>(q.<span class="built_in">back</span>(), &#123;k,b&#125;)), q.<span class="built_in">push_back</span>(&#123;k,b&#125;);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function">T <span class="title">query</span><span class="params">(<span class="type">int</span> pos)</span> </span>&#123;</span><br><span class="line">        <span class="type">int</span> k = <span class="built_in">upper_bound</span>(x.<span class="built_in">begin</span>(), x.<span class="built_in">end</span>(), pos) - x.<span class="built_in">begin</span>()<span class="number">-1</span>;</span><br><span class="line">        <span class="keyword">return</span> q[k].first * pos + q[k].second;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<h3 id="changeroot">Changeroot</h3>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">struct</span> <span class="title class_">Node</span> &#123;</span><br><span class="line">    ll h, d, p;</span><br><span class="line">&#125;;</span><br><span class="line"> </span><br><span class="line">vector&lt;pair&lt;<span class="type">int</span>,ll&gt;&gt; G[maxn];</span><br><span class="line"> </span><br><span class="line"><span class="keyword">typedef</span> Node T;</span><br><span class="line"><span class="type">static</span> T zero = &#123;<span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>&#125;;</span><br><span class="line"> </span><br><span class="line">T f[maxn], g[maxn];</span><br><span class="line"> </span><br><span class="line"><span class="comment">// f(x) = ti(x, addt(fi(x,v1), fi(x,v2)...))</span></span><br><span class="line"><span class="function">T <span class="title">calc</span><span class="params">(<span class="type">int</span> x, T gx)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> &#123;gx.h, gx.d, gx.p&#125;;</span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line"><span class="function">T <span class="title">addt</span><span class="params">(T a, <span class="type">int</span> x, pair&lt;<span class="type">int</span>,ll&gt; e)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">auto</span> [v, len] = e;</span><br><span class="line">    <span class="keyword">return</span> &#123;<span class="built_in">max</span>(a.h, f[v].h + len), </span><br><span class="line">      <span class="built_in">max</span>(a.d, <span class="built_in">max</span>(f[v].d, a.h + f[v].h + len)),</span><br><span class="line">      <span class="built_in">max</span>(a.p, a.h + f[v].h + len)&#125;;</span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">dsqueue</span> &#123;</span><br><span class="line">	<span class="keyword">struct</span> <span class="title class_">operation</span> &#123; <span class="type">int</span> x; pair&lt;<span class="type">int</span>,ll&gt; v; &#125;;</span><br><span class="line">	<span class="keyword">struct</span> <span class="title class_">dat</span> &#123;</span><br><span class="line">		vector&lt;T&gt; a = &#123;zero&#125;;</span><br><span class="line">		<span class="function">T <span class="title">query</span><span class="params">()</span> </span>&#123; <span class="keyword">return</span> a.<span class="built_in">back</span>(); &#125;</span><br><span class="line">		<span class="function"><span class="type">void</span> <span class="title">undo</span><span class="params">()</span> </span>&#123; a.<span class="built_in">pop_back</span>(); &#125;</span><br><span class="line">		<span class="function"><span class="type">void</span> <span class="title">apply</span><span class="params">(operation o)</span> </span>&#123; a.<span class="built_in">push_back</span>(<span class="built_in">addt</span>(a.<span class="built_in">back</span>(), o.x, o.v)); &#125;</span><br><span class="line">	&#125;;</span><br><span class="line">	dat ds;</span><br><span class="line">	vector&lt;pair&lt;<span class="type">int</span>, operation&gt;&gt; a;</span><br><span class="line">	<span class="type">int</span> cnt = <span class="number">0</span>;</span><br><span class="line">	<span class="built_in">dsqueue</span>() &#123;&#125;</span><br><span class="line">	<span class="function"><span class="type">void</span> <span class="title">pop</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		<span class="keyword">if</span> (!cnt) &#123;</span><br><span class="line">			cnt = (<span class="type">int</span>)a.<span class="built_in">size</span>();</span><br><span class="line">			<span class="built_in">reverse</span>(a.<span class="built_in">begin</span>(), a.<span class="built_in">end</span>());</span><br><span class="line">			<span class="keyword">for</span> (<span class="keyword">auto</span>&amp; [t, o]: a)</span><br><span class="line">			ds.<span class="built_in">undo</span>(), t = <span class="number">0</span>;</span><br><span class="line">			<span class="keyword">for</span> (<span class="keyword">auto</span>&amp; [t, o]: a)</span><br><span class="line">			ds.<span class="built_in">apply</span>(o);</span><br><span class="line">		&#125;</span><br><span class="line">		deque&lt;operation&gt; b[<span class="number">2</span>];</span><br><span class="line">		<span class="keyword">for</span> (<span class="type">int</span> t : &#123;<span class="number">1</span>, <span class="number">0</span>&#125;) &#123;</span><br><span class="line">			<span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; !t ? i &lt; (cnt &amp; -cnt) : a.<span class="built_in">back</span>().first; i++) &#123;</span><br><span class="line">			b[t].<span class="built_in">push_front</span>(a.<span class="built_in">back</span>().second);</span><br><span class="line">			a.<span class="built_in">pop_back</span>();</span><br><span class="line">			ds.<span class="built_in">undo</span>();</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">for</span> (<span class="type">int</span> t : &#123;<span class="number">1</span>, <span class="number">0</span>&#125;) &#123;</span><br><span class="line">			<span class="keyword">for</span> (<span class="keyword">auto</span>&amp; o: b[t]) &#123;</span><br><span class="line">			ds.<span class="built_in">apply</span>(o);</span><br><span class="line">			a.<span class="built_in">emplace_back</span>(t, o);</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;</span><br><span class="line">		cnt--;</span><br><span class="line">		ds.<span class="built_in">undo</span>();</span><br><span class="line">		a.<span class="built_in">pop_back</span>();</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function"><span class="type">void</span> <span class="title">push</span><span class="params">(operation o)</span> </span>&#123;</span><br><span class="line">		a.<span class="built_in">emplace_back</span>(<span class="number">1</span>, o);</span><br><span class="line">		ds.<span class="built_in">apply</span>(o);</span><br><span class="line">	&#125;</span><br><span class="line">&#125;;</span><br><span class="line"> </span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">dfs1</span><span class="params">(<span class="type">int</span> x, <span class="type">int</span> fa)</span> </span>&#123;</span><br><span class="line">    g[x] = zero;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">auto</span> [v,len] : G[x]) <span class="keyword">if</span> (v != fa) &#123;</span><br><span class="line">        <span class="built_in">dfs1</span>(v, x);</span><br><span class="line">        g[x] = <span class="built_in">addt</span>(g[x], x, &#123;v,len&#125;);</span><br><span class="line">    &#125;</span><br><span class="line">    f[x] = <span class="built_in">calc</span>(x, g[x]);</span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">dfs</span><span class="params">(<span class="type">int</span> x, <span class="type">int</span> fa, ll lf)</span> </span>&#123;</span><br><span class="line">    vector&lt;ll&gt; vec;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">auto</span> [v, len] : G[x]) &#123;</span><br><span class="line">        <span class="keyword">if</span>(v != fa) vec.<span class="built_in">push_back</span>(f[v].h + len);</span><br><span class="line">        <span class="keyword">else</span> vec.<span class="built_in">push_back</span>(f[fa].h + lf);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">sort</span>(vec.<span class="built_in">begin</span>(), vec.<span class="built_in">end</span>(), greater&lt;&gt;());</span><br><span class="line">    <span class="keyword">if</span> (<span class="built_in">sz</span>(vec) &gt;= <span class="number">4</span>) &#123;</span><br><span class="line">        ans = <span class="built_in">max</span>(ans, vec[<span class="number">0</span>] + vec[<span class="number">1</span>] + vec[<span class="number">2</span>] + vec[<span class="number">3</span>]);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (<span class="built_in">sz</span>(vec) &gt;= <span class="number">3</span>) &#123;</span><br><span class="line">        ans = <span class="built_in">max</span>(ans, vec[<span class="number">0</span>] + vec[<span class="number">1</span>] + vec[<span class="number">2</span>]);</span><br><span class="line">    &#125;</span><br><span class="line">    ans = <span class="built_in">max</span>(ans, f[x].d);</span><br><span class="line">    dsqueue q;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">auto</span> [v, len] : G[x]) <span class="keyword">if</span> (v != fa) q.<span class="built_in">push</span>(&#123;x, &#123;v,len&#125;&#125;);</span><br><span class="line">    <span class="keyword">if</span> (fa) q.<span class="built_in">push</span>(&#123;x, &#123;fa, lf&#125;&#125;);</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">auto</span> [v, len] : G[x]) <span class="keyword">if</span> (v != fa) &#123;</span><br><span class="line">        q.<span class="built_in">pop</span>();</span><br><span class="line">        T tfv = f[v], tgv = g[v];</span><br><span class="line">        g[x] = q.ds.<span class="built_in">query</span>();</span><br><span class="line">        f[x] = <span class="built_in">calc</span>(x, g[x]);</span><br><span class="line">		ans = <span class="built_in">max</span>(ans, f[x].p + len*<span class="number">2</span> + f[v].p);</span><br><span class="line">        ans = <span class="built_in">max</span>(ans, f[x].d + f[v].d + len*<span class="number">2</span>);</span><br><span class="line">        g[v] = <span class="built_in">addt</span>(g[v], v, &#123;x,len&#125;);</span><br><span class="line">        f[v] = <span class="built_in">calc</span>(v, g[v]);</span><br><span class="line">        <span class="built_in">dfs</span>(v, x, len);</span><br><span class="line">        f[v] = tfv; g[v] = tgv;</span><br><span class="line">        q.<span class="built_in">push</span>(&#123;x, &#123;v, len&#125;&#125;);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="数据结构">数据结构</h2>
<h3 id="差分数组">差分数组</h3>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">template</span>&lt;<span class="keyword">typename</span> T&gt;</span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">Darray</span> &#123;</span><br><span class="line">    <span class="type">int</span> n;</span><br><span class="line">    vector&lt;T&gt; A;</span><br><span class="line">    <span class="built_in">Darray</span>(<span class="type">int</span> n=<span class="number">0</span>) : <span class="built_in">n</span>(n), <span class="built_in">A</span>(n<span class="number">+2</span>) &#123;&#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">add</span><span class="params">(<span class="type">int</span> l,<span class="type">int</span> r, T v=<span class="number">1</span>)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (l &gt; r) <span class="keyword">return</span>;</span><br><span class="line">        A[l] += v;</span><br><span class="line">        A[r<span class="number">+1</span>] -= v;</span><br><span class="line">    &#125; </span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">calc</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">1</span>;i &lt;= n; ++i) &#123;</span><br><span class="line">            A[i] += A[i<span class="number">-1</span>];</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    T&amp; <span class="keyword">operator</span>[] (<span class="type">int</span> i) &#123;</span><br><span class="line">        <span class="keyword">return</span> A[i];</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<h3 id="单调队列求区间最值">单调队列求区间最值</h3>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">n = <span class="built_in">read</span>(); m = <span class="built_in">read</span>();</span><br><span class="line">deque&lt;pair&lt;<span class="type">int</span>, <span class="type">int</span>&gt;&gt; q;</span><br><span class="line"><span class="built_in">write</span>(<span class="number">0</span>); nl;</span><br><span class="line"><span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">1</span>;i &lt;= n; ++i) &#123;</span><br><span class="line">    <span class="type">int</span> x; x = <span class="built_in">read</span>();</span><br><span class="line">    <span class="keyword">if</span> (!q.<span class="built_in">empty</span>() &amp;&amp; q.<span class="built_in">front</span>().second &lt; i-m) q.<span class="built_in">pop_front</span>();</span><br><span class="line">    <span class="keyword">if</span> (!q.<span class="built_in">empty</span>()) <span class="built_in">write</span>(q.<span class="built_in">front</span>().first),nl;</span><br><span class="line">    <span class="keyword">while</span> (!q.<span class="built_in">empty</span>() &amp;&amp; x &lt; q.<span class="built_in">back</span>().first) q.<span class="built_in">pop_back</span>();</span><br><span class="line">    q.<span class="built_in">push_back</span>(&#123;x, i&#125;);</span><br><span class="line">&#125;   </span><br></pre></td></tr></table></figure>
<h3
id="单调栈求右边下一个比自己大的位置">单调栈求右边下一个比自己大的位置</h3>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">stack&lt;pii&gt; s; <span class="comment">// type &lt;int,int&gt;  arr: A[i]</span></span><br><span class="line"><span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">1</span>;i &lt;= n; ++i) &#123; <span class="comment">// for n .. 1 (on the left)</span></span><br><span class="line">    <span class="keyword">if</span> (s.<span class="built_in">empty</span>() || A[i] &lt;= s.<span class="built_in">top</span>().first) s.<span class="built_in">push</span>(&#123;A[i], i&#125;);</span><br><span class="line">    <span class="keyword">else</span> &#123; <span class="comment">//  greater elem: &lt;= ,smaller elem: &gt;= </span></span><br><span class="line">        <span class="comment">// greater elem: &lt; , smaller elem &gt;</span></span><br><span class="line">        <span class="keyword">while</span> (!s.<span class="built_in">empty</span>() &amp;&amp; s.<span class="built_in">top</span>().first &lt; A[i]) &#123;</span><br><span class="line">            bigr[s.<span class="built_in">top</span>().second] = i;</span><br><span class="line">            s.<span class="built_in">pop</span>();</span><br><span class="line">        &#125; </span><br><span class="line">        s.<span class="built_in">push</span>(&#123;A[i], i&#125;);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="minmaxqueue">MinMaxQueue</h3>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">struct</span> <span class="title class_">MinMaxStack</span> &#123;</span><br><span class="line">    vector&lt;ll&gt; s, maxs, mins;</span><br><span class="line">    <span class="built_in">MinMaxStack</span>() &#123;&#125;</span><br><span class="line"></span><br><span class="line">    <span class="function">ll <span class="title">min</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (mins.<span class="built_in">empty</span>()) <span class="keyword">return</span> <span class="number">1e18</span>;</span><br><span class="line">        <span class="keyword">return</span> mins.<span class="built_in">back</span>();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function">ll <span class="title">max</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (maxs.<span class="built_in">empty</span>()) <span class="keyword">return</span> -(<span class="number">1e18</span>);</span><br><span class="line">        <span class="keyword">return</span> maxs.<span class="built_in">back</span>();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">push</span><span class="params">(ll x)</span> </span>&#123;</span><br><span class="line">        s.<span class="built_in">push_back</span>(x);</span><br><span class="line">        maxs.<span class="built_in">push_back</span>(std::<span class="built_in">max</span>(<span class="built_in">max</span>(), x));</span><br><span class="line">        mins.<span class="built_in">push_back</span>(std::<span class="built_in">min</span>(<span class="built_in">min</span>(), x));</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function">ll <span class="title">pop</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        ll ret = s.<span class="built_in">back</span>();</span><br><span class="line">        s.<span class="built_in">pop_back</span>();</span><br><span class="line">        maxs.<span class="built_in">pop_back</span>();</span><br><span class="line">        mins.<span class="built_in">pop_back</span>();</span><br><span class="line">        <span class="keyword">return</span> ret;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="type">bool</span> <span class="title">empty</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> s.<span class="built_in">empty</span>();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">MinMaxQueue</span> &#123;</span><br><span class="line">    MinMaxStack s1, s2;</span><br><span class="line"></span><br><span class="line">    <span class="built_in">MinMaxQueue</span>() &#123;&#125;</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">push</span><span class="params">(ll x)</span> </span>&#123;</span><br><span class="line">        s<span class="number">2.</span><span class="built_in">push</span>(x);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="function">ll <span class="title">max</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> std::<span class="built_in">max</span>(s<span class="number">1.</span><span class="built_in">max</span>(), s<span class="number">2.</span><span class="built_in">max</span>());</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function">ll <span class="title">min</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> std::<span class="built_in">min</span>(s<span class="number">1.</span><span class="built_in">min</span>(), s<span class="number">2.</span><span class="built_in">min</span>());</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">pop</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (s<span class="number">1.</span><span class="built_in">empty</span>()) &#123;</span><br><span class="line">            <span class="keyword">while</span> (!s<span class="number">2.</span><span class="built_in">empty</span>()) s<span class="number">1.</span><span class="built_in">push</span>(s<span class="number">2.</span><span class="built_in">pop</span>());</span><br><span class="line">        &#125;</span><br><span class="line">        s<span class="number">1.</span><span class="built_in">pop</span>();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="type">bool</span> <span class="title">empty</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> s<span class="number">1.</span><span class="built_in">empty</span>() &amp;&amp; s<span class="number">2.</span><span class="built_in">empty</span>();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<h3 id="propertyqueue">PropertyQueue</h3>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">struct</span> <span class="title class_">PropertyQueue</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">typedef</span> ll T;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="type">static</span> T <span class="title">zero</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="type">static</span> T <span class="title">calc</span><span class="params">(T x, T y)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> x + y;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">struct</span> <span class="title class_">PropertyStack</span> &#123;</span><br><span class="line">        vector&lt;T&gt; maxs;   </span><br><span class="line">        vector&lt;T&gt; s;</span><br><span class="line"></span><br><span class="line">        <span class="function">T <span class="title">get</span><span class="params">()</span> </span>&#123;</span><br><span class="line">            <span class="keyword">if</span> (maxs.<span class="built_in">empty</span>()) <span class="keyword">return</span> <span class="built_in">zero</span>();</span><br><span class="line">            <span class="keyword">return</span> maxs.<span class="built_in">back</span>();</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="type">void</span> <span class="title">push</span><span class="params">(T x)</span> </span>&#123;</span><br><span class="line">            s.<span class="built_in">push_back</span>(x);</span><br><span class="line">            maxs.<span class="built_in">push_back</span>(<span class="built_in">calc</span>(<span class="built_in">get</span>(), x));</span><br><span class="line">        &#125;     </span><br><span class="line"></span><br><span class="line">        <span class="function">T <span class="title">pop</span><span class="params">()</span> </span>&#123;</span><br><span class="line">            T ret = s.<span class="built_in">back</span>();</span><br><span class="line">            s.<span class="built_in">pop_back</span>();</span><br><span class="line">            maxs.<span class="built_in">pop_back</span>();</span><br><span class="line">            <span class="keyword">return</span> ret;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="type">bool</span> <span class="title">empty</span><span class="params">()</span> </span>&#123;</span><br><span class="line">            <span class="keyword">return</span> s.<span class="built_in">empty</span>();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;;</span><br><span class="line"></span><br><span class="line">    PropertyStack s1, s2;</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">push</span><span class="params">(T x)</span> </span>&#123;</span><br><span class="line">        s<span class="number">2.</span><span class="built_in">push</span>(x);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">pop</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (s<span class="number">1.</span><span class="built_in">empty</span>()) &#123;</span><br><span class="line">            <span class="keyword">while</span> (!s<span class="number">2.</span><span class="built_in">empty</span>()) s<span class="number">1.</span><span class="built_in">push</span>(s<span class="number">2.</span><span class="built_in">pop</span>());</span><br><span class="line">        &#125;</span><br><span class="line">        s<span class="number">1.</span><span class="built_in">pop</span>();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function">T <span class="title">get</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">calc</span>(s<span class="number">1.</span><span class="built_in">get</span>(), s<span class="number">2.</span><span class="built_in">get</span>());</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="type">bool</span> <span class="title">empty</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> s<span class="number">1.</span><span class="built_in">empty</span>() &amp;&amp; s<span class="number">2.</span><span class="built_in">empty</span>();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<h3 id="单栈队列">单栈队列</h3>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">struct</span> <span class="title class_">dsqueue</span> &#123;</span><br><span class="line">	<span class="keyword">struct</span> <span class="title class_">operation</span> &#123; <span class="type">int</span> x; pair&lt;<span class="type">int</span>,ll&gt; v; &#125;;</span><br><span class="line">	<span class="keyword">struct</span> <span class="title class_">dat</span> &#123;</span><br><span class="line">		vector&lt;T&gt; a = &#123;zero&#125;;</span><br><span class="line">		<span class="function">T <span class="title">query</span><span class="params">()</span> </span>&#123; <span class="keyword">return</span> a.<span class="built_in">back</span>(); &#125;</span><br><span class="line">		<span class="function"><span class="type">void</span> <span class="title">undo</span><span class="params">()</span> </span>&#123; a.<span class="built_in">pop_back</span>(); &#125;</span><br><span class="line">		<span class="function"><span class="type">void</span> <span class="title">apply</span><span class="params">(operation o)</span> </span>&#123; a.<span class="built_in">push_back</span>(<span class="built_in">addt</span>(a.<span class="built_in">back</span>(), o.x, o.v)); &#125;</span><br><span class="line">	&#125;;</span><br><span class="line">	dat ds;</span><br><span class="line">	vector&lt;pair&lt;<span class="type">int</span>, operation&gt;&gt; a;</span><br><span class="line">	<span class="type">int</span> cnt = <span class="number">0</span>;</span><br><span class="line">	<span class="built_in">dsqueue</span>() &#123;&#125;</span><br><span class="line">	<span class="function"><span class="type">void</span> <span class="title">pop</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		<span class="keyword">if</span> (!cnt) &#123;</span><br><span class="line">			cnt = (<span class="type">int</span>)a.<span class="built_in">size</span>();</span><br><span class="line">			<span class="built_in">reverse</span>(a.<span class="built_in">begin</span>(), a.<span class="built_in">end</span>());</span><br><span class="line">			<span class="keyword">for</span> (<span class="keyword">auto</span>&amp; [t, o]: a)</span><br><span class="line">			ds.<span class="built_in">undo</span>(), t = <span class="number">0</span>;</span><br><span class="line">			<span class="keyword">for</span> (<span class="keyword">auto</span>&amp; [t, o]: a)</span><br><span class="line">			ds.<span class="built_in">apply</span>(o);</span><br><span class="line">		&#125;</span><br><span class="line">		deque&lt;operation&gt; b[<span class="number">2</span>];</span><br><span class="line">		<span class="keyword">for</span> (<span class="type">int</span> t : &#123;<span class="number">1</span>, <span class="number">0</span>&#125;) &#123;</span><br><span class="line">			<span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; !t ? i &lt; (cnt &amp; -cnt) : a.<span class="built_in">back</span>().first; i++) &#123;</span><br><span class="line">			b[t].<span class="built_in">push_front</span>(a.<span class="built_in">back</span>().second);</span><br><span class="line">			a.<span class="built_in">pop_back</span>();</span><br><span class="line">			ds.<span class="built_in">undo</span>();</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">for</span> (<span class="type">int</span> t : &#123;<span class="number">1</span>, <span class="number">0</span>&#125;) &#123;</span><br><span class="line">			<span class="keyword">for</span> (<span class="keyword">auto</span>&amp; o: b[t]) &#123;</span><br><span class="line">			ds.<span class="built_in">apply</span>(o);</span><br><span class="line">			a.<span class="built_in">emplace_back</span>(t, o);</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;</span><br><span class="line">		cnt--;</span><br><span class="line">		ds.<span class="built_in">undo</span>();</span><br><span class="line">		a.<span class="built_in">pop_back</span>();</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function"><span class="type">void</span> <span class="title">push</span><span class="params">(operation o)</span> </span>&#123;</span><br><span class="line">		a.<span class="built_in">emplace_back</span>(<span class="number">1</span>, o);</span><br><span class="line">		ds.<span class="built_in">apply</span>(o);</span><br><span class="line">	&#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<h3 id="双指针">双指针</h3>
<h4 id="小的可以那么大的也可以">小的可以那么大的也可以</h4>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">int</span> r = <span class="number">0</span>;</span><br><span class="line">ll ans = <span class="number">0</span>;  </span><br><span class="line"><span class="keyword">for</span> (<span class="type">int</span> l = <span class="number">1</span>;l &lt;= n; ++l) &#123;</span><br><span class="line">    <span class="keyword">while</span> (r &lt;= n &amp;&amp; !<span class="built_in">good</span>()) &#123;</span><br><span class="line">        r++;</span><br><span class="line">        q.<span class="built_in">push</span>(A[r]);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (r &lt;= n)</span><br><span class="line">        ans += n-r<span class="number">+1</span>;  <span class="comment">// [l,r] good</span></span><br><span class="line">    q.<span class="built_in">pop</span>();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="大的可以那么小的也可以">大的可以那么小的也可以</h4>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">int</span> r = <span class="number">0</span>;</span><br><span class="line">ll ans = <span class="number">0</span>;  </span><br><span class="line"><span class="keyword">for</span> (<span class="type">int</span> l = <span class="number">1</span>;l &lt;= n; ++l) &#123;</span><br><span class="line">    <span class="keyword">while</span> (r &lt;= n &amp;&amp; <span class="built_in">good</span>()) &#123;</span><br><span class="line">        r++;</span><br><span class="line">        q.<span class="built_in">push</span>(A[r]);</span><br><span class="line">    &#125;</span><br><span class="line">    ans += r - l;  <span class="comment">// [l,r-1] good</span></span><br><span class="line">    q.<span class="built_in">pop</span>();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="rmqst表">RMQ/ST表</h3>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">template</span>&lt;<span class="keyword">class</span> <span class="title class_">It</span>,<span class="keyword">class</span> <span class="title class_">Func</span>,<span class="keyword">class</span> <span class="title class_">T</span>=<span class="keyword">typename</span> iterator_traits&lt;It&gt;::value_type&gt;</span><br><span class="line"><span class="keyword">struct</span> ST &#123;</span><br><span class="line">    vector&lt;vector&lt;T&gt;&gt; M; Func f; <span class="comment">// f=lambda</span></span><br><span class="line">    <span class="built_in">ST</span>() &#123;&#125;</span><br><span class="line">    <span class="meta">#<span class="keyword">define</span> log2_floor(i) (bit_width((unsigned long)i) - 1)</span></span><br><span class="line">    <span class="built_in">ST</span>(It l, It r, Func f) :</span><br><span class="line">         <span class="built_in">M</span>(<span class="built_in">log2_floor</span>(<span class="built_in">distance</span>(l,r)) + <span class="number">1</span>, <span class="built_in">vector</span>&lt;T&gt;(<span class="built_in">distance</span>(l,r))), <span class="built_in">f</span>(f) &#123;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">auto</span> i = <span class="number">0</span>;i &lt; <span class="built_in">sz</span>(M[<span class="number">0</span>]); ++i) M[<span class="number">0</span>][i] = *(l+i); </span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> j = <span class="number">1</span>;j &lt; <span class="built_in">sz</span>(M); ++j) <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>;i+(<span class="number">1</span>&lt;&lt;j)<span class="number">-1</span> &lt; <span class="built_in">sz</span>(M[<span class="number">0</span>]); ++i) </span><br><span class="line">            M[j][i] = <span class="built_in">f</span>(M[j<span class="number">-1</span>][i], M[j<span class="number">-1</span>][i+(<span class="number">1</span>&lt;&lt;(j<span class="number">-1</span>))]);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">inline</span> T <span class="title">get</span><span class="params">(<span class="type">int</span> l, <span class="type">int</span> r)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (l &gt; r) <span class="keyword">return</span> T&#123;&#125;; <span class="comment">// index from 0</span></span><br><span class="line">        <span class="type">int</span> k = <span class="built_in">log2_floor</span>(r - l + <span class="number">1</span>);</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">f</span>(M[k][l],M[k][r-(<span class="number">1</span>&lt;&lt;k)<span class="number">+1</span>]);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// ST st(A.begin(), A.end(),[](auto a,auto b) &#123; return max(a,b); &#125;);</span></span><br><span class="line">    <span class="comment">// get(x,y) = max(A[x,y])</span></span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<h3 id="trie">01Trie</h3>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">struct</span> <span class="title class_">Trie01</span> &#123;</span><br><span class="line">    <span class="type">int</span> ch[maxn*<span class="number">33</span>][<span class="number">2</span>];</span><br><span class="line">    <span class="type">int</span> val[maxn*<span class="number">33</span>], sum[maxn*<span class="number">33</span>];</span><br><span class="line">    <span class="type">int</span> tot;</span><br><span class="line"></span><br><span class="line">    <span class="built_in">Trie01</span>() &#123;</span><br><span class="line">        tot = <span class="number">0</span>;</span><br><span class="line">        <span class="built_in">memset</span>(ch, <span class="number">0</span>, <span class="built_in">sizeof</span>(ch));</span><br><span class="line">        <span class="built_in">memset</span>(val, <span class="number">0</span>, <span class="built_in">sizeof</span>(val));</span><br><span class="line">        <span class="built_in">memset</span>(sum, <span class="number">0</span>, <span class="built_in">sizeof</span>(sum));</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="type">int</span> <span class="title">hasi</span><span class="params">(<span class="type">int</span> mask, <span class="type">int</span> i)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> (mask &amp; (<span class="number">1</span>&lt;&lt;(i<span class="number">-1</span>))) != <span class="number">0</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="type">int</span> <span class="title">seti</span><span class="params">(<span class="type">int</span> mask, <span class="type">int</span> i)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> mask | (<span class="number">1</span>&lt;&lt;(i<span class="number">-1</span>));</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">insert</span><span class="params">(<span class="type">int</span> x, <span class="type">int</span> cnt)</span> </span>&#123;</span><br><span class="line">        <span class="type">int</span> u = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">32</span>; i &gt;= <span class="number">1</span>; --i) &#123;</span><br><span class="line">            <span class="type">int</span> nxt = <span class="built_in">hasi</span>(x, i);</span><br><span class="line">            <span class="keyword">if</span> (!ch[u][nxt]) ch[u][nxt] = ++tot;</span><br><span class="line">            u = ch[u][nxt];</span><br><span class="line">            sum[u] += cnt;</span><br><span class="line">        &#125;</span><br><span class="line">        val[u] += cnt;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="type">int</span> <span class="title">find</span><span class="params">(<span class="type">int</span> x)</span> </span>&#123;</span><br><span class="line">        <span class="type">int</span> u = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">32</span>; i &gt;= <span class="number">1</span>; --i) &#123;</span><br><span class="line">            <span class="type">int</span> nxt = <span class="built_in">hasi</span>(x, i);</span><br><span class="line">            u = ch[u][nxt];</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> val[u];</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">del</span><span class="params">(<span class="type">int</span> x, <span class="type">int</span> cnt)</span> </span>&#123;</span><br><span class="line">        <span class="type">int</span> u = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">32</span>; i &gt;= <span class="number">1</span>; --i) &#123;</span><br><span class="line">            <span class="type">int</span> nxt = <span class="built_in">hasi</span>(x, i);</span><br><span class="line">            u = ch[u][nxt];</span><br><span class="line">            sum[u] -= cnt;</span><br><span class="line">        &#125;</span><br><span class="line">        val[u] = <span class="number">0</span>; <span class="comment">// val[u] -= cnt</span></span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="type">int</span> <span class="title">maxxor</span><span class="params">(<span class="type">int</span> x)</span> </span>&#123;</span><br><span class="line">        <span class="type">int</span> u = <span class="number">0</span>;</span><br><span class="line">        <span class="type">int</span> ans = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">32</span>; i &gt;= <span class="number">1</span>; --i) &#123;</span><br><span class="line">            <span class="type">int</span> nxt = <span class="built_in">hasi</span>(x, i);</span><br><span class="line">            <span class="keyword">if</span> (sum[ch[u][!nxt]] &gt; <span class="number">0</span>) &#123; u = ch[u][!nxt]; ans = <span class="built_in">seti</span>(ans, i); &#125;</span><br><span class="line">            <span class="keyword">else</span> u = ch[u][nxt];</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> ans;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<h3 id="并查集">并查集</h3>
<h4 id="普通并查集">普通并查集</h4>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">struct</span> <span class="title class_">DSU</span> &#123;</span><br><span class="line">    vector&lt;<span class="type">int</span>&gt; fa, s;</span><br><span class="line">    <span class="type">int</span> cnt; <span class="comment">// connect area number</span></span><br><span class="line">    <span class="built_in">DSU</span>(<span class="type">int</span> n=<span class="number">1</span>) : <span class="built_in">fa</span>(n<span class="number">+1</span>,<span class="number">-1</span>), <span class="built_in">s</span>(n<span class="number">+1</span>,<span class="number">1</span>), <span class="built_in">cnt</span>(n) &#123;&#125;</span><br><span class="line">    <span class="function"><span class="type">int</span> <span class="title">size</span><span class="params">(<span class="type">int</span> x)</span> </span>&#123; <span class="keyword">return</span> s[<span class="built_in">find</span>(x)]; &#125;</span><br><span class="line">    <span class="function"><span class="type">int</span> <span class="title">find</span><span class="params">(<span class="type">int</span> x)</span> </span>&#123; <span class="keyword">return</span> <span class="number">-1</span> == fa[x] ? x : fa[x] = <span class="built_in">find</span>(fa[x]); &#125;</span><br><span class="line">    <span class="function"><span class="type">bool</span> <span class="title">connect</span><span class="params">(<span class="type">int</span> x, <span class="type">int</span> y)</span> </span>&#123;</span><br><span class="line">        x = <span class="built_in">find</span>(x), y = <span class="built_in">find</span>(y);  </span><br><span class="line">        <span class="keyword">if</span> (x == y) <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">        <span class="keyword">if</span> (s[x] &gt; s[y]) <span class="built_in">swap</span>(x, y);</span><br><span class="line">        cnt--; s[y] += s[x]; </span><br><span class="line">        fa[x] = y;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<h3 id="树状数组">树状数组</h3>
<p>简单版, 单点修改</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">define</span> lowbit(x) (x&amp;-x)</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> add(x,k)  while(x&lt;=n) sumv[x]+=k,x+=lowbit(x)</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> query(x,a) while(x) a+=sumv[x],x-=lowbit(x)</span></span><br><span class="line"></span><br><span class="line"><span class="type">int</span> sumv[maxn];</span><br><span class="line"><span class="comment">// 要定义好k</span></span><br><span class="line"><span class="built_in">add</span>(k,y);</span><br><span class="line"><span class="comment">// 查询: 要定义好l,r</span></span><br><span class="line">l--; ansl = <span class="number">0</span>; ansr = <span class="number">0</span>;</span><br><span class="line"><span class="built_in">query</span>(l,ansl); <span class="built_in">query</span>(r,ansr);</span><br><span class="line"><span class="built_in">printf</span>(<span class="string">&quot;%d\n&quot;</span>, ansr-ansl);</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>结构体版，单点修改</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">struct</span> <span class="title class_">fenwick_tree</span> &#123;</span><br><span class="line">    <span class="type">int</span> n; vector&lt;ll&gt; sumv;</span><br><span class="line">    <span class="built_in">fenwick_tree</span>(<span class="type">int</span> n = <span class="number">0</span>) : <span class="built_in">n</span>(n), <span class="built_in">sumv</span>(n<span class="number">+1</span>) &#123;&#125;</span><br><span class="line">    <span class="meta">#<span class="keyword">define</span> lowbit(x) (x&amp;-x) </span></span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">add</span><span class="params">(<span class="type">int</span> x, ll k)</span> </span>&#123; <span class="keyword">while</span>(x&lt;=n) sumv[x]+=k,x+=<span class="built_in">lowbit</span>(x); &#125;</span><br><span class="line">    <span class="function">ll <span class="title">query</span><span class="params">(<span class="type">int</span> x)</span> </span>&#123; ll a = <span class="number">0</span>;<span class="keyword">while</span>(x) a+=sumv[x],x-=<span class="built_in">lowbit</span>(x); <span class="keyword">return</span> a; &#125;</span><br><span class="line">    <span class="function"><span class="keyword">template</span>&lt;<span class="keyword">typename</span> F&gt; </span></span><br><span class="line"><span class="function">  	<span class="type">int</span> <span class="title">lower_bound</span><span class="params">(F f, <span class="type">int</span> limit)</span> </span>&#123;</span><br><span class="line">        ll sum = <span class="number">0</span>; <span class="type">int</span> cur = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> i = <span class="built_in">log2</span>(limit); i &gt;= <span class="number">0</span>; --i) &#123;</span><br><span class="line">            <span class="keyword">if</span> (cur + (<span class="number">1</span>&lt;&lt;i) &lt;= limit &amp;&amp; <span class="built_in">f</span>(sum + sumv[cur + (<span class="number">1</span>&lt;&lt;i)])) &#123;</span><br><span class="line">                sum += sumv[cur + (<span class="number">1</span>&lt;&lt;i)];</span><br><span class="line">                cur += <span class="number">1</span>&lt;&lt;i;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> cur;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<p>结构体版，区间修改</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">struct</span> <span class="title class_">fenwick_tree</span> &#123;</span><br><span class="line">    <span class="type">int</span> n; vector&lt;ll&gt; c, b;</span><br><span class="line">    <span class="built_in">fenwick_tree</span>(<span class="type">int</span> n = <span class="number">0</span>) : <span class="built_in">n</span>(n), <span class="built_in">c</span>(n<span class="number">+2</span>), <span class="built_in">b</span>(n<span class="number">+2</span>) &#123;&#125;</span><br><span class="line">    <span class="meta">#<span class="keyword">define</span> lowbit(x) (x&amp;-x) </span></span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">add</span><span class="params">(<span class="type">int</span> x, ll k)</span> </span>&#123; <span class="type">int</span> t = x<span class="number">-1</span>; <span class="keyword">while</span>(x &lt;= n) c[x] += k, b[x] += k*t, x += <span class="built_in">lowbit</span>(x); &#125;</span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">add</span><span class="params">(<span class="type">int</span> x, <span class="type">int</span> y, ll k)</span> </span>&#123; <span class="built_in">add</span>(x, k); <span class="built_in">add</span>(y<span class="number">+1</span>, -k); &#125;</span><br><span class="line">    <span class="comment">// 点查询： query(x, c);</span></span><br><span class="line">    <span class="function">ll <span class="title">query</span><span class="params">(<span class="type">int</span> x, vector&lt;ll&gt;&amp; cur)</span> </span>&#123; ll a = <span class="number">0</span>; <span class="keyword">while</span>(x) a += cur[x],x -= <span class="built_in">lowbit</span>(x); <span class="keyword">return</span> a; &#125;</span><br><span class="line">    <span class="function">ll <span class="title">querySum</span><span class="params">(<span class="type">int</span> x)</span> </span>&#123; <span class="keyword">return</span> <span class="built_in">query</span>(x, c)*x - <span class="built_in">query</span>(x, b); &#125;</span><br><span class="line">    <span class="function">ll <span class="title">query</span><span class="params">(<span class="type">int</span> x, <span class="type">int</span> y)</span> </span>&#123; <span class="keyword">return</span> <span class="built_in">querySum</span>(y) - <span class="built_in">querySum</span>(x<span class="number">-1</span>); &#125;</span><br><span class="line">&#125;;	</span><br></pre></td></tr></table></figure>
<h4
id="删除一个点在前面后面插入一个点">删除一个点，在前面/后面插入一个点</h4>
<p>若n个点，m次删除。建立大小为n+m的树状数组，然后维护pos[i]表示i当前插在树状数组的哪个位置上。如果在前面插入，就把原来的数的初始位置插入在m+i的位置上，然后用cur记录前面可插入的位置，往前面插入即可。</p>
<h3 id="分块">分块</h3>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">int</span> bl;</span><br><span class="line"><span class="type">int</span> bi[maxn], bv[maxn], tag[maxn], ans[maxn];</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">update</span><span class="params">(<span class="type">int</span> l, <span class="type">int</span> r)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i = l;i &lt;= <span class="built_in">min</span>(bi[l]*bl, r); ++i) &#123; <span class="comment">// 边角料</span></span><br><span class="line">        <span class="keyword">if</span> (tag[bi[i]]^bv[i]) ans[bi[i]]--;</span><br><span class="line">        <span class="keyword">else</span> ans[bi[i]]++;</span><br><span class="line">        bv[i] ^= <span class="number">1</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span>(bi[l] != bi[r])</span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> i = (bi[r]<span class="number">-1</span>)*bl + <span class="number">1</span>;i &lt;= r; ++i) &#123;</span><br><span class="line">           <span class="keyword">if</span> (tag[bi[i]]^bv[i]) ans[bi[i]]--;</span><br><span class="line">            <span class="keyword">else</span> ans[bi[i]]++;</span><br><span class="line">            bv[i] ^= <span class="number">1</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i = bi[l]<span class="number">+1</span>;i &lt;= bi[r]<span class="number">-1</span>; ++i) &#123; <span class="comment">// 分块修改</span></span><br><span class="line">        tag[i] ^= <span class="number">1</span>;</span><br><span class="line">        ans[i] = bl - ans[i];</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">query</span><span class="params">(<span class="type">int</span> l, <span class="type">int</span> r)</span> </span>&#123;</span><br><span class="line">    <span class="type">int</span> ret = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = l; i &lt;= <span class="built_in">min</span>(bi[l]*bl, r); ++i) ret += tag[bi[i]] ^ bv[i];</span><br><span class="line">    <span class="keyword">if</span>(bi[l] != bi[r])</span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> i = (bi[r]<span class="number">-1</span>)*bl + <span class="number">1</span>;i &lt;= r; ++i) ret +=  tag[bi[i]] ^ bv[i];</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i = bi[l]<span class="number">+1</span>;i &lt;= bi[r]<span class="number">-1</span>; ++i)</span><br><span class="line">        ret += ans[i];</span><br><span class="line">    <span class="keyword">return</span> ret;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">bl = <span class="built_in">sqrt</span>(n);</span><br><span class="line"><span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">1</span>;i &lt;= n; ++i) &#123;</span><br><span class="line">    bi[i] = (i<span class="number">-1</span>) / bl + <span class="number">1</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="逆序对">逆序对</h3>
<p>归并排序：</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">template</span>&lt;<span class="keyword">class</span> It&gt;</span></span><br><span class="line"><span class="function">ll <span class="title">cnt_inv</span><span class="params">(It l, It r)</span> </span>&#123;</span><br><span class="line">	<span class="keyword">if</span> (r-l &lt;= <span class="number">1</span>) <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">	<span class="keyword">auto</span> m = l + (r-l)/<span class="number">2</span>;</span><br><span class="line">	ll ans = <span class="built_in">cnt_inv</span>(l,m) + <span class="built_in">cnt_inv</span>(m,r);</span><br><span class="line">	<span class="keyword">auto</span> p = l, q = m; <span class="type">int</span> i = <span class="number">0</span>;</span><br><span class="line">    vector&lt;<span class="keyword">typename</span> iterator_traits&lt;It&gt;::value_type&gt; <span class="built_in">buf</span>(r-l);</span><br><span class="line">	<span class="keyword">while</span> (p &lt; m || q &lt; r)&#123;</span><br><span class="line">		<span class="keyword">if</span> (q &gt;= r || (p &lt; m &amp;&amp; *p &lt;= *q)) buf[i++] = *p++;</span><br><span class="line">		<span class="keyword">else</span> buf[i++] = *q++, ans += m-p;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">for</span>(<span class="type">int</span> i = <span class="number">0</span>; i &lt; <span class="built_in">sz</span>(buf); ++i) *l++ = buf[i]; </span><br><span class="line">	<span class="keyword">return</span> ans;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>树状数组：</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">struct</span> <span class="title class_">fenwick_tree</span> &#123;</span><br><span class="line">    <span class="type">int</span> n; vector&lt;ll&gt; sumv;</span><br><span class="line">    <span class="built_in">fenwick_tree</span>(<span class="type">int</span> n = <span class="number">0</span>) : <span class="built_in">n</span>(n), <span class="built_in">sumv</span>(n <span class="number">+1</span>) &#123;&#125;</span><br><span class="line">    <span class="meta">#<span class="keyword">define</span> lowbit(x) (x&amp;-x) </span></span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">add</span><span class="params">(<span class="type">int</span> x, ll k)</span> </span>&#123; <span class="keyword">while</span>(x&lt;=n) sumv[x]+=k,x+=<span class="built_in">lowbit</span>(x); &#125;</span><br><span class="line">    <span class="function">ll <span class="title">query</span><span class="params">(<span class="type">int</span> x)</span> </span>&#123; ll a = <span class="number">0</span>;<span class="keyword">while</span>(x) a+=sumv[x],x-=<span class="built_in">lowbit</span>(x); <span class="keyword">return</span> a; &#125;</span><br><span class="line">&#125;;</span><br><span class="line"><span class="keyword">typedef</span> <span class="type">int</span> Ti;</span><br><span class="line"><span class="function">ll <span class="title">inversions</span><span class="params">(vector&lt;Ti&gt; A,<span class="type">int</span> l,<span class="type">int</span> r)</span> </span>&#123;</span><br><span class="line">    vector&lt;Ti&gt; B;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = l; i &lt;= r; ++i) &#123;</span><br><span class="line">        B.<span class="built_in">push_back</span>(A[i]);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">sort</span>(B.<span class="built_in">begin</span>(), B.<span class="built_in">end</span>()); <span class="comment">// 所有数据堆在B里</span></span><br><span class="line">    <span class="type">int</span> nm = <span class="built_in">unique</span>(B.<span class="built_in">begin</span>(), B.<span class="built_in">end</span>()) - B.<span class="built_in">begin</span>(); <span class="comment">// 去重</span></span><br><span class="line">    <span class="function">fenwick_tree <span class="title">tree</span><span class="params">(nm<span class="number">+1</span>)</span></span>;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = l;i &lt;= r; ++i) </span><br><span class="line">        A[i] = <span class="built_in">lower_bound</span>(B.<span class="built_in">begin</span>(), B.<span class="built_in">begin</span>()+nm, A[i]) - B.<span class="built_in">begin</span>() + <span class="number">1</span>; <span class="comment">// 原数组对应的值</span></span><br><span class="line">    ll ans = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = l;i &lt;= r; ++i) &#123;</span><br><span class="line">        ans += tree.<span class="built_in">query</span>(nm<span class="number">+1</span>) - tree.<span class="built_in">query</span>(A[i]);</span><br><span class="line">        tree.<span class="built_in">add</span>(A[i], <span class="number">1</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> ans;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="线段树">线段树</h3>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">struct</span> <span class="title class_">SegTree</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">struct</span> <span class="title class_">data</span> &#123;</span><br><span class="line">        <span class="type">int</span> v;</span><br><span class="line">    &#125;;  </span><br><span class="line">    <span class="keyword">struct</span> <span class="title class_">lztag</span> &#123;</span><br><span class="line">        <span class="type">int</span> v;</span><br><span class="line">    &#125;;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">typedef</span> ll T;</span><br><span class="line">    <span class="keyword">typedef</span> ll Lz;</span><br><span class="line"></span><br><span class="line">    <span class="meta">#<span class="keyword">define</span> M ((L+R)&gt;&gt;1)</span></span><br><span class="line">    <span class="meta">#<span class="keyword">define</span> lson (o&lt;&lt;1)</span></span><br><span class="line">    <span class="meta">#<span class="keyword">define</span> rson (o&lt;&lt;1|1)</span></span><br><span class="line"></span><br><span class="line">    <span class="type">int</span> LEFT, RIGHT;  <span class="comment">// 维护的区间范围</span></span><br><span class="line">    vector&lt;T&gt; sumv; <span class="comment">// 维护的值</span></span><br><span class="line">    vector&lt;Lz&gt; tag; <span class="comment">// 懒标记</span></span><br><span class="line">    vector&lt;<span class="type">bool</span>&gt; islazy;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 四种操作</span></span><br><span class="line">    <span class="function">T <span class="title">add</span><span class="params">(T a, T b)</span> </span>&#123;   <span class="comment">// merge data with data</span></span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">min</span>(a,b);</span><br><span class="line">    &#125; </span><br><span class="line">    <span class="function">T <span class="title">addt</span><span class="params">(T a, Lz b, <span class="type">int</span> l, <span class="type">int</span> r)</span> </span>&#123; <span class="comment">// merge data with tag</span></span><br><span class="line">        <span class="keyword">return</span> a + b;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function">Lz <span class="title">addtt</span> <span class="params">(Lz a, Lz b)</span> </span>&#123; <span class="comment">// merge tag with tag</span></span><br><span class="line">        <span class="keyword">return</span> a + b;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="built_in">SegTree</span>(vector&lt;T&gt; &amp;arr, <span class="type">int</span> left, <span class="type">int</span> right) </span><br><span class="line">        : <span class="built_in">LEFT</span>(left), <span class="built_in">RIGHT</span>(right), <span class="built_in">sumv</span>(right&lt;&lt;<span class="number">2</span>), <span class="built_in">tag</span>(right&lt;&lt;<span class="number">2</span>), <span class="built_in">islazy</span>(right&lt;&lt;<span class="number">2</span>) &#123; </span><br><span class="line">        <span class="built_in">build</span>(arr, <span class="number">1</span>, LEFT, RIGHT);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">inline</span> <span class="type">void</span> <span class="title">build</span><span class="params">(vector&lt;T&gt; &amp;A, <span class="type">int</span> o=<span class="number">1</span>, <span class="type">int</span> L=<span class="number">1</span>, <span class="type">int</span> R=<span class="number">-1</span>)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (R == <span class="number">-1</span>) &#123;L = LEFT; R = RIGHT;&#125;</span><br><span class="line">        <span class="keyword">if</span> (L == R) sumv[o] = A[L];</span><br><span class="line">        <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="built_in">build</span>(A, lson, L, M);</span><br><span class="line">            <span class="built_in">build</span>(A, rson, M<span class="number">+1</span>, R);</span><br><span class="line">            sumv[o] = <span class="built_in">add</span>(sumv[lson], sumv[rson]);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">inline</span> <span class="type">void</span> <span class="title">mergetag</span><span class="params">(<span class="type">int</span> o, Lz val)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (!islazy[o]) tag[o] = val, islazy[o] = <span class="number">1</span>;</span><br><span class="line">        <span class="keyword">else</span> tag[o] = <span class="built_in">addtt</span>(tag[o], val);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">inline</span> <span class="type">void</span> <span class="title">pushdown</span><span class="params">(<span class="type">int</span> o, <span class="type">int</span> L, <span class="type">int</span> R)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (L == R || !islazy[o]) <span class="keyword">return</span>;</span><br><span class="line">        sumv[lson] = <span class="built_in">addt</span>(sumv[lson], tag[o], L, M);</span><br><span class="line">        sumv[rson] = <span class="built_in">addt</span>(sumv[rson], tag[o], M<span class="number">+1</span>, R);</span><br><span class="line">        <span class="built_in">mergetag</span>(lson, tag[o]);</span><br><span class="line">        <span class="built_in">mergetag</span>(rson, tag[o]);</span><br><span class="line">        islazy[o] = <span class="number">0</span>;</span><br><span class="line">    &#125;</span><br><span class="line">	<span class="comment">// max positon in [L,R] that fullfills function v, else return -1</span></span><br><span class="line">    <span class="function"><span class="keyword">template</span>&lt;<span class="keyword">typename</span> valid&gt;</span></span><br><span class="line"><span class="function">    <span class="type">int</span> <span class="title">lowerbound</span><span class="params">(<span class="type">int</span> x, valid v , <span class="type">int</span> o=<span class="number">1</span>, <span class="type">int</span> L=<span class="number">1</span>, <span class="type">int</span> R=<span class="number">-1</span>)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (R == <span class="number">-1</span>) &#123;L = LEFT; R = RIGHT;&#125;</span><br><span class="line">        <span class="keyword">if</span> (L &gt;= x &amp;&amp; <span class="built_in">v</span>(sumv[o])) <span class="keyword">return</span> R;</span><br><span class="line">        <span class="keyword">if</span> (L == R) <span class="keyword">return</span> <span class="number">-1</span>;</span><br><span class="line">        <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="built_in">pushdown</span>(o, L, R);</span><br><span class="line">            <span class="type">int</span> lr = <span class="number">-1</span>, rr = <span class="number">-1</span>;</span><br><span class="line">            <span class="keyword">if</span> (x &lt;= M) lr = <span class="built_in">lowerbound</span>(x, v, lson, L, M);</span><br><span class="line">            <span class="keyword">if</span> (x &gt; M || lr == M) rr = <span class="built_in">lowerbound</span>(x, v, rson, M<span class="number">+1</span>, R);</span><br><span class="line">            <span class="keyword">return</span> <span class="built_in">max</span>(lr, rr);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">inline</span> <span class="type">void</span> <span class="title">update</span><span class="params">(<span class="type">int</span> x, <span class="type">int</span> y, Lz val, <span class="type">int</span> o=<span class="number">1</span>, <span class="type">int</span> L=<span class="number">1</span>, <span class="type">int</span> R=<span class="number">-1</span>)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (R == <span class="number">-1</span>) &#123;L = LEFT; R = RIGHT;&#125;</span><br><span class="line">        <span class="keyword">if</span> (x &lt;= L &amp;&amp; R &lt;= y) sumv[o] = <span class="built_in">addt</span>(sumv[o], val, L, R), <span class="built_in">mergetag</span>(o, val);</span><br><span class="line">        <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="built_in">pushdown</span>(o, L, R);</span><br><span class="line">            <span class="keyword">if</span> (x &lt;= M) <span class="built_in">update</span>(x, y, val, lson, L, M);</span><br><span class="line">            <span class="keyword">if</span> (y &gt; M) <span class="built_in">update</span>(x, y, val, rson, M<span class="number">+1</span>, R);</span><br><span class="line">            sumv[o] = <span class="built_in">add</span>(sumv[lson], sumv[rson]); </span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">inline</span> T <span class="title">query</span><span class="params">(<span class="type">int</span> x, <span class="type">int</span> y, <span class="type">int</span> o=<span class="number">1</span>, <span class="type">int</span> L=<span class="number">1</span>, <span class="type">int</span> R=<span class="number">-1</span>)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (R == <span class="number">-1</span>) &#123;L = LEFT; R = RIGHT;&#125;</span><br><span class="line">        <span class="built_in">pushdown</span>(o, L, R);</span><br><span class="line">        <span class="keyword">if</span> (x &lt;= L &amp;&amp; R &lt;= y) <span class="keyword">return</span> sumv[o];</span><br><span class="line">        <span class="keyword">else</span> <span class="keyword">if</span> (x &lt;= M &amp;&amp; y &gt; M) <span class="keyword">return</span> <span class="built_in">add</span>(<span class="built_in">query</span>(x, M, lson, L, M), <span class="built_in">query</span>(M<span class="number">+1</span>, y, rson, M<span class="number">+1</span>, R));</span><br><span class="line">        <span class="keyword">else</span> <span class="keyword">if</span> (x &lt;= M)  <span class="keyword">return</span> <span class="built_in">query</span>(x, y, lson, L, M);</span><br><span class="line">        <span class="keyword">else</span> <span class="keyword">return</span> <span class="built_in">query</span>(x, y, rson, M<span class="number">+1</span>, R); </span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<h4 id="动态开点">动态开点</h4>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">struct</span> <span class="title class_">SegTree</span> &#123;</span><br><span class="line">    <span class="keyword">struct</span> <span class="title class_">data</span> &#123;</span><br><span class="line">        ll minv, cnt;</span><br><span class="line">    &#125;;  </span><br><span class="line">    <span class="keyword">struct</span> <span class="title class_">lztag</span> &#123;</span><br><span class="line">        <span class="type">int</span> v;</span><br><span class="line">    &#125;;</span><br><span class="line">    <span class="keyword">typedef</span> data T;</span><br><span class="line">    <span class="keyword">typedef</span> <span class="type">int</span> Lz;</span><br><span class="line"></span><br><span class="line">    <span class="meta">#<span class="keyword">define</span> M ((L+R)&gt;&gt;1)</span></span><br><span class="line"></span><br><span class="line">    <span class="type">int</span> LEFT, RIGHT;  <span class="comment">// 维护的区间范围</span></span><br><span class="line">    vector&lt;T&gt; sumv; <span class="comment">// 维护的值 ,=</span></span><br><span class="line"></span><br><span class="line">    vector&lt;Lz&gt; tag; <span class="comment">// 懒标记</span></span><br><span class="line">    vector&lt;<span class="type">int</span>&gt; ls, rs;</span><br><span class="line">    vector&lt;<span class="type">int</span>&gt; raw; <span class="comment">// 离散化数组</span></span><br><span class="line">    <span class="comment">// 四种操作</span></span><br><span class="line">    <span class="function">T <span class="title">add</span><span class="params">(T a, T b,<span class="type">int</span> L, <span class="type">int</span> R)</span> </span>&#123;   <span class="comment">// merge data with data</span></span><br><span class="line">        <span class="keyword">if</span> (a.minv == b.minv) <span class="keyword">return</span> &#123;a.minv, a.cnt + b.cnt&#125;;</span><br><span class="line">        <span class="keyword">if</span> (a.minv &lt; b.minv) <span class="keyword">return</span> &#123;a.minv, a.cnt + raw[R]-raw[M]&#125;;</span><br><span class="line">        <span class="keyword">return</span> &#123;b.minv, b.cnt + raw[M]-raw[L<span class="number">-1</span>]&#125;;</span><br><span class="line">    &#125; </span><br><span class="line">    <span class="function">T <span class="title">addt</span><span class="params">(T a, Lz b, <span class="type">int</span> o, <span class="type">int</span> l, <span class="type">int</span> r)</span> </span>&#123; <span class="comment">// merge data with tag</span></span><br><span class="line">        a.minv += b; </span><br><span class="line">        <span class="keyword">return</span> a;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function">Lz <span class="title">addtt</span> <span class="params">(Lz a, Lz b)</span> </span>&#123; <span class="comment">// merge tag with tag</span></span><br><span class="line">        <span class="keyword">return</span> a + b;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    T zeroT = &#123;<span class="number">0</span>,<span class="number">0</span>&#125;;</span><br><span class="line">    Lz zeroLz = <span class="number">0</span>; <span class="comment">// 懒标记的零状态</span></span><br><span class="line">    </span><br><span class="line">    <span class="built_in">SegTree</span>(<span class="type">int</span> left, <span class="type">int</span> right) : <span class="built_in">LEFT</span>(left), <span class="built_in">RIGHT</span>(right), <span class="built_in">sumv</span>(<span class="number">1</span>), <span class="built_in">tag</span>(<span class="number">1</span>), <span class="built_in">ls</span>(<span class="number">1</span>), <span class="built_in">rs</span>(<span class="number">1</span>) &#123;&#125;</span><br><span class="line">    <span class="built_in">SegTree</span>(vector&lt;<span class="type">int</span>&gt;&amp; raw) : <span class="built_in">LEFT</span>(<span class="number">1</span>), <span class="built_in">RIGHT</span>(<span class="built_in">sz</span>(raw)<span class="number">-1</span>), <span class="built_in">sumv</span>(<span class="number">1</span>), <span class="built_in">tag</span>(<span class="number">1</span>), <span class="built_in">ls</span>(<span class="number">1</span>), <span class="built_in">rs</span>(<span class="number">1</span>), <span class="built_in">raw</span>(raw) &#123;&#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">inline</span> <span class="type">int</span> <span class="title">getpos</span><span class="params">(<span class="type">int</span> x)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">lower_bound</span>(raw.<span class="built_in">begin</span>(), raw.<span class="built_in">end</span>(), x) - raw.<span class="built_in">begin</span>();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">inline</span> <span class="type">void</span> <span class="title">pushdown</span><span class="params">(<span class="type">int</span> o, <span class="type">int</span> L, <span class="type">int</span> R)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (L != R &amp;&amp; !ls[o]) <span class="built_in">newnode</span>(o); </span><br><span class="line">        <span class="keyword">if</span> (L == R || tag[o] == zeroLz) <span class="keyword">return</span>;</span><br><span class="line">        sumv[ls[o]] = <span class="built_in">addt</span>(sumv[ls[o]], tag[o],o, L, M);</span><br><span class="line">        sumv[rs[o]] = <span class="built_in">addt</span>(sumv[rs[o]], tag[o],o, M<span class="number">+1</span>, R);</span><br><span class="line">        tag[ls[o]] = <span class="built_in">addtt</span>(tag[ls[o]], tag[o]);</span><br><span class="line">        tag[rs[o]] = <span class="built_in">addtt</span>(tag[rs[o]], tag[o]);</span><br><span class="line">        tag[o] = zeroLz; </span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">newnode</span><span class="params">(<span class="type">int</span> o)</span> </span>&#123;</span><br><span class="line">        sumv.<span class="built_in">push_back</span>(zeroT); sumv.<span class="built_in">push_back</span>(zeroT);</span><br><span class="line">        tag.<span class="built_in">push_back</span>(zeroLz); tag.<span class="built_in">push_back</span>(zeroLz);</span><br><span class="line">        ls.<span class="built_in">push_back</span>(<span class="number">0</span>); ls.<span class="built_in">push_back</span>(<span class="number">0</span>);</span><br><span class="line">        rs.<span class="built_in">push_back</span>(<span class="number">0</span>); rs.<span class="built_in">push_back</span>(<span class="number">0</span>);</span><br><span class="line">        ls[o] = <span class="built_in">sz</span>(sumv)<span class="number">-2</span>; rs[o] = <span class="built_in">sz</span>(sumv)<span class="number">-1</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">inline</span> <span class="type">void</span> <span class="title">insert</span><span class="params">(<span class="type">int</span> x, Lz val, <span class="type">int</span> o=<span class="number">0</span>, <span class="type">int</span> L=<span class="number">1</span>, <span class="type">int</span> R=<span class="number">-1</span>)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (R == <span class="number">-1</span>) &#123;L = LEFT; R = RIGHT; x = <span class="built_in">getpos</span>(x); &#125;</span><br><span class="line">        <span class="keyword">if</span> (L == R) sumv[o] = <span class="built_in">addt</span>(sumv[o], val,o, L, R);</span><br><span class="line">        <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="built_in">pushdown</span>(o, L, R);</span><br><span class="line">            <span class="keyword">if</span> (x &lt;= M) <span class="built_in">insert</span>(x, val, ls[o], L, M);</span><br><span class="line">            <span class="keyword">else</span> <span class="built_in">insert</span>(x, val, rs[o], M<span class="number">+1</span>, R);</span><br><span class="line">            sumv[o] = <span class="built_in">add</span>(sumv[ls[o]], sumv[rs[o]],L,R);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">inline</span> <span class="type">void</span> <span class="title">update</span><span class="params">(<span class="type">int</span> x, <span class="type">int</span> y, Lz val, <span class="type">int</span> o=<span class="number">0</span>, <span class="type">int</span> L=<span class="number">1</span>, <span class="type">int</span> R=<span class="number">-1</span>)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (R == <span class="number">-1</span>) &#123;L = LEFT; R = RIGHT; <span class="keyword">if</span> (!raw.<span class="built_in">empty</span>()) x = <span class="built_in">getpos</span>(x)<span class="number">+1</span>, y = <span class="built_in">getpos</span>(y); &#125;</span><br><span class="line">        <span class="keyword">if</span> (x &lt;= L &amp;&amp; R &lt;= y) sumv[o] = <span class="built_in">addt</span>(sumv[o], val,o, L, R), tag[o] = <span class="built_in">addtt</span>(tag[o], val);</span><br><span class="line">        <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="built_in">pushdown</span>(o, L, R);</span><br><span class="line">            <span class="keyword">if</span> (x &lt;= M) <span class="built_in">update</span>(x, y, val, ls[o], L, M);</span><br><span class="line">            <span class="keyword">if</span> (y &gt; M) <span class="built_in">update</span>(x, y, val, rs[o], M<span class="number">+1</span>, R);</span><br><span class="line">            sumv[o] = <span class="built_in">add</span>(sumv[ls[o]], sumv[rs[o]],L,R); </span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">inline</span> T <span class="title">query</span><span class="params">(<span class="type">int</span> x=<span class="number">-1</span>, <span class="type">int</span> y=<span class="number">-1</span>, <span class="type">int</span> o=<span class="number">0</span>, <span class="type">int</span> L=<span class="number">1</span>, <span class="type">int</span> R=<span class="number">-1</span>)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (R == <span class="number">-1</span>) &#123;L = LEFT; R = RIGHT; <span class="keyword">if</span> (x==<span class="number">-1</span>) x=LEFT,y=RIGHT; <span class="keyword">else</span> <span class="keyword">if</span> (!raw.<span class="built_in">empty</span>()) x = <span class="built_in">getpos</span>(x)<span class="number">+1</span>, y = <span class="built_in">getpos</span>(y); &#125;</span><br><span class="line">        <span class="built_in">pushdown</span>(o, L, R);</span><br><span class="line">        <span class="keyword">if</span> (x &lt;= L &amp;&amp; R &lt;= y) <span class="keyword">return</span> sumv[o];</span><br><span class="line">        <span class="keyword">else</span> <span class="keyword">if</span> (x &lt;= M &amp;&amp; y &gt; M) <span class="keyword">return</span> <span class="built_in">add</span>(<span class="built_in">query</span>(x, M, ls[o], L, M), <span class="built_in">query</span>(M<span class="number">+1</span>, y, rs[o], M<span class="number">+1</span>, R),L,R);</span><br><span class="line">        <span class="keyword">else</span> <span class="keyword">if</span> (x &lt;= M)  <span class="keyword">return</span> <span class="built_in">query</span>(x, y, ls[o], L, M);</span><br><span class="line">        <span class="keyword">else</span> <span class="keyword">return</span> <span class="built_in">query</span>(x, y, rs[o], M<span class="number">+1</span>, R); </span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<h3 id="扫描线">扫描线</h3>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">struct</span> <span class="title class_">SegTree</span> &#123;</span><br><span class="line">    <span class="keyword">struct</span> <span class="title class_">data</span> &#123;</span><br><span class="line">        ll minv, cnt;</span><br><span class="line">    &#125;;  </span><br><span class="line">    <span class="keyword">struct</span> <span class="title class_">lztag</span> &#123;</span><br><span class="line">        <span class="type">int</span> v;</span><br><span class="line">    &#125;;</span><br><span class="line">    <span class="keyword">typedef</span> data T;</span><br><span class="line">    <span class="keyword">typedef</span> <span class="type">int</span> Lz;</span><br><span class="line"></span><br><span class="line">    <span class="meta">#<span class="keyword">define</span> M ((L+R)&gt;&gt;1)</span></span><br><span class="line"></span><br><span class="line">    <span class="type">int</span> LEFT, RIGHT;  <span class="comment">// 维护的区间范围</span></span><br><span class="line">    vector&lt;T&gt; sumv; <span class="comment">// 维护的值 ,=</span></span><br><span class="line"></span><br><span class="line">    vector&lt;Lz&gt; tag; <span class="comment">// 懒标记</span></span><br><span class="line">    vector&lt;<span class="type">int</span>&gt; ls, rs;</span><br><span class="line">    vector&lt;<span class="type">int</span>&gt; raw; <span class="comment">// 离散化数组</span></span><br><span class="line">    <span class="comment">// 四种操作</span></span><br><span class="line">    <span class="function">T <span class="title">add</span><span class="params">(T a, T b,<span class="type">int</span> L, <span class="type">int</span> R)</span> </span>&#123;   <span class="comment">// merge data with data</span></span><br><span class="line">        <span class="keyword">if</span> (a.minv == b.minv) <span class="keyword">return</span> &#123;a.minv, a.cnt + b.cnt&#125;;</span><br><span class="line">        <span class="keyword">if</span> (a.minv &lt; b.minv) <span class="keyword">return</span> &#123;a.minv, a.cnt + raw[R]-raw[M]&#125;;</span><br><span class="line">        <span class="keyword">return</span> &#123;b.minv, b.cnt + raw[M]-raw[L<span class="number">-1</span>]&#125;;</span><br><span class="line">    &#125; </span><br><span class="line">    <span class="function">T <span class="title">addt</span><span class="params">(T a, Lz b, <span class="type">int</span> o, <span class="type">int</span> l, <span class="type">int</span> r)</span> </span>&#123; <span class="comment">// merge data with tag</span></span><br><span class="line">        a.minv += b; </span><br><span class="line">        <span class="keyword">return</span> a;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function">Lz <span class="title">addtt</span> <span class="params">(Lz a, Lz b)</span> </span>&#123; <span class="comment">// merge tag with tag</span></span><br><span class="line">        <span class="keyword">return</span> a + b;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    T zeroT = &#123;<span class="number">0</span>,<span class="number">0</span>&#125;;</span><br><span class="line">    Lz zeroLz = <span class="number">0</span>; <span class="comment">// 懒标记的零状态</span></span><br><span class="line">    </span><br><span class="line">    <span class="built_in">SegTree</span>(<span class="type">int</span> left, <span class="type">int</span> right) : <span class="built_in">LEFT</span>(left), <span class="built_in">RIGHT</span>(right), <span class="built_in">sumv</span>(<span class="number">1</span>), <span class="built_in">tag</span>(<span class="number">1</span>), <span class="built_in">ls</span>(<span class="number">1</span>), <span class="built_in">rs</span>(<span class="number">1</span>) &#123;&#125;</span><br><span class="line">    <span class="built_in">SegTree</span>(vector&lt;<span class="type">int</span>&gt;&amp; raw) : <span class="built_in">LEFT</span>(<span class="number">1</span>), <span class="built_in">RIGHT</span>(<span class="built_in">sz</span>(raw)<span class="number">-1</span>), <span class="built_in">sumv</span>(<span class="number">1</span>), <span class="built_in">tag</span>(<span class="number">1</span>), <span class="built_in">ls</span>(<span class="number">1</span>), <span class="built_in">rs</span>(<span class="number">1</span>), <span class="built_in">raw</span>(raw) &#123;&#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">inline</span> <span class="type">int</span> <span class="title">getpos</span><span class="params">(<span class="type">int</span> x)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">lower_bound</span>(raw.<span class="built_in">begin</span>(), raw.<span class="built_in">end</span>(), x) - raw.<span class="built_in">begin</span>();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">inline</span> <span class="type">void</span> <span class="title">pushdown</span><span class="params">(<span class="type">int</span> o, <span class="type">int</span> L, <span class="type">int</span> R)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (L != R &amp;&amp; !ls[o]) <span class="built_in">newnode</span>(o); </span><br><span class="line">        <span class="keyword">if</span> (L == R || tag[o] == zeroLz) <span class="keyword">return</span>;</span><br><span class="line">        sumv[ls[o]] = <span class="built_in">addt</span>(sumv[ls[o]], tag[o],o, L, M);</span><br><span class="line">        sumv[rs[o]] = <span class="built_in">addt</span>(sumv[rs[o]], tag[o],o, M<span class="number">+1</span>, R);</span><br><span class="line">        tag[ls[o]] = <span class="built_in">addtt</span>(tag[ls[o]], tag[o]);</span><br><span class="line">        tag[rs[o]] = <span class="built_in">addtt</span>(tag[rs[o]], tag[o]);</span><br><span class="line">        tag[o] = zeroLz; </span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">newnode</span><span class="params">(<span class="type">int</span> o)</span> </span>&#123;</span><br><span class="line">        sumv.<span class="built_in">push_back</span>(zeroT); sumv.<span class="built_in">push_back</span>(zeroT);</span><br><span class="line">        tag.<span class="built_in">push_back</span>(zeroLz); tag.<span class="built_in">push_back</span>(zeroLz);</span><br><span class="line">        ls.<span class="built_in">push_back</span>(<span class="number">0</span>); ls.<span class="built_in">push_back</span>(<span class="number">0</span>);</span><br><span class="line">        rs.<span class="built_in">push_back</span>(<span class="number">0</span>); rs.<span class="built_in">push_back</span>(<span class="number">0</span>);</span><br><span class="line">        ls[o] = <span class="built_in">sz</span>(sumv)<span class="number">-2</span>; rs[o] = <span class="built_in">sz</span>(sumv)<span class="number">-1</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">inline</span> <span class="type">void</span> <span class="title">insert</span><span class="params">(<span class="type">int</span> x, Lz val, <span class="type">int</span> o=<span class="number">0</span>, <span class="type">int</span> L=<span class="number">1</span>, <span class="type">int</span> R=<span class="number">-1</span>)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (R == <span class="number">-1</span>) &#123;L = LEFT; R = RIGHT; x = <span class="built_in">getpos</span>(x); &#125;</span><br><span class="line">        <span class="keyword">if</span> (L == R) sumv[o] = <span class="built_in">addt</span>(sumv[o], val,o, L, R);</span><br><span class="line">        <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="built_in">pushdown</span>(o, L, R);</span><br><span class="line">            <span class="keyword">if</span> (x &lt;= M) <span class="built_in">insert</span>(x, val, ls[o], L, M);</span><br><span class="line">            <span class="keyword">else</span> <span class="built_in">insert</span>(x, val, rs[o], M<span class="number">+1</span>, R);</span><br><span class="line">            sumv[o] = <span class="built_in">add</span>(sumv[ls[o]], sumv[rs[o]],L,R);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">inline</span> <span class="type">void</span> <span class="title">update</span><span class="params">(<span class="type">int</span> x, <span class="type">int</span> y, Lz val, <span class="type">int</span> o=<span class="number">0</span>, <span class="type">int</span> L=<span class="number">1</span>, <span class="type">int</span> R=<span class="number">-1</span>)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (R == <span class="number">-1</span>) &#123;L = LEFT; R = RIGHT; <span class="keyword">if</span> (!raw.<span class="built_in">empty</span>()) x = <span class="built_in">getpos</span>(x)<span class="number">+1</span>, y = <span class="built_in">getpos</span>(y); &#125;</span><br><span class="line">        <span class="keyword">if</span> (x &lt;= L &amp;&amp; R &lt;= y) sumv[o] = <span class="built_in">addt</span>(sumv[o], val,o, L, R), tag[o] = <span class="built_in">addtt</span>(tag[o], val);</span><br><span class="line">        <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="built_in">pushdown</span>(o, L, R);</span><br><span class="line">            <span class="keyword">if</span> (x &lt;= M) <span class="built_in">update</span>(x, y, val, ls[o], L, M);</span><br><span class="line">            <span class="keyword">if</span> (y &gt; M) <span class="built_in">update</span>(x, y, val, rs[o], M<span class="number">+1</span>, R);</span><br><span class="line">            sumv[o] = <span class="built_in">add</span>(sumv[ls[o]], sumv[rs[o]],L,R); </span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">inline</span> T <span class="title">query</span><span class="params">(<span class="type">int</span> x=<span class="number">-1</span>, <span class="type">int</span> y=<span class="number">-1</span>, <span class="type">int</span> o=<span class="number">0</span>, <span class="type">int</span> L=<span class="number">1</span>, <span class="type">int</span> R=<span class="number">-1</span>)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (R == <span class="number">-1</span>) &#123;L = LEFT; R = RIGHT; <span class="keyword">if</span> (x==<span class="number">-1</span>) x=LEFT,y=RIGHT; <span class="keyword">else</span> <span class="keyword">if</span> (!raw.<span class="built_in">empty</span>()) x = <span class="built_in">getpos</span>(x)<span class="number">+1</span>, y = <span class="built_in">getpos</span>(y); &#125;</span><br><span class="line">        <span class="built_in">pushdown</span>(o, L, R);</span><br><span class="line">        <span class="keyword">if</span> (x &lt;= L &amp;&amp; R &lt;= y) <span class="keyword">return</span> sumv[o];</span><br><span class="line">        <span class="keyword">else</span> <span class="keyword">if</span> (x &lt;= M &amp;&amp; y &gt; M) <span class="keyword">return</span> <span class="built_in">add</span>(<span class="built_in">query</span>(x, M, ls[o], L, M), <span class="built_in">query</span>(M<span class="number">+1</span>, y, rs[o], M<span class="number">+1</span>, R),L,R);</span><br><span class="line">        <span class="keyword">else</span> <span class="keyword">if</span> (x &lt;= M)  <span class="keyword">return</span> <span class="built_in">query</span>(x, y, ls[o], L, M);</span><br><span class="line">        <span class="keyword">else</span> <span class="keyword">return</span> <span class="built_in">query</span>(x, y, rs[o], M<span class="number">+1</span>, R); </span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="function">ll <span class="title">sweepline</span><span class="params">(vector&lt;tuple&lt;<span class="type">int</span>,<span class="type">int</span>,<span class="type">int</span>,<span class="type">int</span>&gt;&gt;&amp; A)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">struct</span> <span class="title class_">Line</span> &#123;</span><br><span class="line">        ll y1, y2, x, k;</span><br><span class="line">        <span class="type">bool</span> <span class="keyword">operator</span>&lt;(<span class="type">const</span> Line&amp; l) <span class="type">const</span> &#123;</span><br><span class="line">            <span class="keyword">if</span> (x == l.x) <span class="keyword">return</span> k &gt; l.k;</span><br><span class="line">            <span class="keyword">return</span> x &lt; l.x; </span><br><span class="line">        &#125;</span><br><span class="line">    &#125;;</span><br><span class="line">    vector&lt;Line&gt; v; </span><br><span class="line">    vector&lt;<span class="type">int</span>&gt; B; </span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">auto</span> [x1,y1,x2,y2] : A) &#123;</span><br><span class="line">        v.<span class="built_in">push_back</span>(&#123;y1,y2,x1,<span class="number">1</span>&#125;);</span><br><span class="line">        v.<span class="built_in">push_back</span>(&#123;y1,y2,x2,<span class="number">-1</span>&#125;);</span><br><span class="line">        B.<span class="built_in">push_back</span>(y1);</span><br><span class="line">        B.<span class="built_in">push_back</span>(y2);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">sort</span>(v.<span class="built_in">begin</span>(), v.<span class="built_in">end</span>());</span><br><span class="line">    <span class="built_in">sort</span>(B.<span class="built_in">begin</span>(), B.<span class="built_in">end</span>());</span><br><span class="line">    <span class="type">int</span> nm = <span class="built_in">unique</span>(B.<span class="built_in">begin</span>(), B.<span class="built_in">end</span>()) - B.<span class="built_in">begin</span>(); </span><br><span class="line">    <span class="keyword">while</span> (<span class="built_in">sz</span>(B) != nm) B.<span class="built_in">pop_back</span>();</span><br><span class="line">    <span class="function">SegTree <span class="title">seg</span><span class="params">(B)</span></span>;</span><br><span class="line">    ll prex = <span class="number">0</span>;</span><br><span class="line">    ll ans = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">auto</span> [y1,y2,x,k] : v) &#123;</span><br><span class="line">        <span class="keyword">auto</span> [minv, cnt] = seg.<span class="built_in">query</span>();</span><br><span class="line">        cnt = minv ? B.<span class="built_in">back</span>()-B[<span class="number">0</span>] : cnt;</span><br><span class="line">        ans += (x - prex)*cnt;</span><br><span class="line">        seg.<span class="built_in">update</span>(y1,y2, k);</span><br><span class="line">        prex = x;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> ans;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="权值线段树">权值线段树</h3>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">ll sumv[maxn*<span class="number">4</span>];</span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> mid ((l+r)&gt;&gt;1)</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> ls (o&lt;&lt;1)</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> rs (o&lt;&lt;1|1)</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">insert</span><span class="params">(<span class="type">int</span> o, <span class="type">int</span> l, <span class="type">int</span> r, <span class="type">int</span> x)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (l == r) sumv[o]++;</span><br><span class="line">    <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (x &lt;= mid) <span class="built_in">insert</span>(ls, l, mid, x);</span><br><span class="line">        <span class="keyword">else</span> <span class="built_in">insert</span>(rs, mid<span class="number">+1</span>, r, x);</span><br><span class="line">        sumv[o] = sumv[ls] + sumv[rs];</span><br><span class="line">    &#125; </span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function">ll <span class="title">query</span><span class="params">(<span class="type">int</span> o, <span class="type">int</span> l, <span class="type">int</span> r, <span class="type">int</span> ql, <span class="type">int</span> qr)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (l &gt; r) <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">if</span> (ql &lt;= l &amp;&amp; r &lt;= qr) <span class="keyword">return</span> sumv[o];</span><br><span class="line">    <span class="keyword">else</span> &#123;</span><br><span class="line">        ll ret = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">if</span> (ql &lt;= mid) ret += <span class="built_in">query</span>(ls, l, mid, ql, qr);</span><br><span class="line">        <span class="keyword">if</span> (qr &gt; mid) ret += <span class="built_in">query</span>(rs, mid<span class="number">+1</span>, r, ql, qr); </span><br><span class="line">        <span class="keyword">return</span> ret;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="splay">Splay</h3>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">typedef</span> <span class="type">int</span> T;</span><br><span class="line"></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">SplayTree</span> &#123;</span><br><span class="line">    <span class="keyword">struct</span> <span class="title class_">node</span> &#123;</span><br><span class="line">        T v; <span class="comment">// key;</span></span><br><span class="line">        node* f=<span class="literal">nullptr</span>;</span><br><span class="line">        node* c[<span class="number">2</span>] = &#123;<span class="literal">nullptr</span>, <span class="literal">nullptr</span>&#125;;</span><br><span class="line">        <span class="type">int</span> siz=<span class="number">0</span>;</span><br><span class="line">        <span class="built_in">node</span>() &#123;&#125;</span><br><span class="line">        <span class="built_in">node</span>(node* f,<span class="type">int</span> k, <span class="type">int</span> x) : <span class="built_in">v</span>(x),<span class="built_in">f</span>(f),<span class="built_in">siz</span>(<span class="number">1</span>) &#123;</span><br><span class="line">            <span class="keyword">if</span> (f) f-&gt;c[k] = <span class="keyword">this</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="function"><span class="type">void</span> <span class="title">pushup</span><span class="params">()</span> </span>&#123;</span><br><span class="line">            <span class="keyword">if</span> (!c[<span class="number">0</span>] &amp;&amp; !c[<span class="number">1</span>]) &#123;</span><br><span class="line">                siz = <span class="number">1</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">else</span> <span class="keyword">if</span> (!c[<span class="number">0</span>]) &#123;</span><br><span class="line">                siz = c[<span class="number">1</span>]-&gt;siz + <span class="number">1</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">else</span> <span class="keyword">if</span> (!c[<span class="number">1</span>]) &#123;</span><br><span class="line">                siz = c[<span class="number">0</span>]-&gt;siz + <span class="number">1</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">else</span> &#123;</span><br><span class="line">                siz = c[<span class="number">0</span>]-&gt;siz + c[<span class="number">1</span>]-&gt;siz + <span class="number">1</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125; *root = <span class="literal">nullptr</span>;</span><br><span class="line">    <span class="built_in">SplayTree</span>() &#123;&#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">rotate</span><span class="params">(node* n)</span> </span>&#123; <span class="comment">// assume this is not root</span></span><br><span class="line">        <span class="type">int</span> v = n-&gt;f-&gt;c[<span class="number">0</span>] == n;</span><br><span class="line">        <span class="keyword">auto</span> p = n-&gt;f, m = n-&gt;c[v];</span><br><span class="line">        <span class="keyword">if</span> (p-&gt;f) p-&gt;f-&gt;c[p-&gt;f-&gt;c[<span class="number">1</span>] == p] = n;</span><br><span class="line">        n-&gt;f = p-&gt;f, n-&gt;c[v] = p;</span><br><span class="line">        p-&gt;f = n, p-&gt;c[v^<span class="number">1</span>] = m;</span><br><span class="line">        <span class="keyword">if</span> (m) m-&gt;f = p;</span><br><span class="line">        p-&gt;<span class="built_in">pushup</span>(), n-&gt;<span class="built_in">pushup</span>();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">splay</span><span class="params">(node*n, node *s=<span class="literal">nullptr</span>)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">while</span> (n-&gt;f != s) &#123;</span><br><span class="line">            <span class="keyword">auto</span> m = n-&gt;f, l = m-&gt;f;</span><br><span class="line">            <span class="keyword">if</span> (l == s) <span class="built_in">rotate</span>(n);</span><br><span class="line">            <span class="keyword">else</span> <span class="keyword">if</span> ((l-&gt;c[<span class="number">0</span>] == m) == (m-&gt;c[<span class="number">0</span>] == n)) <span class="built_in">rotate</span>(m), <span class="built_in">rotate</span>(n);</span><br><span class="line">            <span class="keyword">else</span> <span class="built_in">rotate</span>(n), <span class="built_in">rotate</span>(n);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> (!s) root = n;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">insert</span><span class="params">(T v)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (!root) &#123; root = <span class="keyword">new</span> <span class="built_in">node</span>(<span class="literal">nullptr</span>,<span class="number">0</span>,v); <span class="keyword">return</span>;&#125;</span><br><span class="line">        <span class="keyword">for</span> (node* x = root;;) </span><br><span class="line">            <span class="keyword">if</span> (v &lt;= x-&gt;v &amp;&amp; x-&gt;c[<span class="number">0</span>]) x = x-&gt;c[<span class="number">0</span>];</span><br><span class="line">            <span class="keyword">else</span> <span class="keyword">if</span> (v &gt; x-&gt;v &amp;&amp; x-&gt;c[<span class="number">1</span>]) x = x-&gt;c[<span class="number">1</span>];</span><br><span class="line">            <span class="keyword">else</span> &#123; <span class="type">int</span> k = v &gt; x-&gt;v; x-&gt;c[k] = <span class="keyword">new</span> <span class="built_in">node</span>(x,k,v),<span class="built_in">splay</span>(x-&gt;c[k]);<span class="keyword">return</span>;&#125;  </span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function">node* <span class="title">getelement</span><span class="params">(node* x,<span class="type">int</span> k)</span> </span>&#123; <span class="keyword">for</span> (node* v = x; ; v = v-&gt;c[k]) <span class="keyword">if</span> (!v-&gt;c[k]) <span class="keyword">return</span> v; &#125;</span><br><span class="line">    <span class="function">node* <span class="title">gethelper</span><span class="params">(node* x,<span class="type">int</span> k)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (x == <span class="literal">nullptr</span>) x = <span class="built_in">getelement</span>(root,k);</span><br><span class="line">        <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="built_in">splay</span>(x);</span><br><span class="line">            <span class="keyword">if</span> (!x-&gt;c[k^<span class="number">1</span>]) <span class="keyword">return</span> <span class="literal">nullptr</span>;</span><br><span class="line">            x = <span class="built_in">getelement</span>(x-&gt;c[k^<span class="number">1</span>],k);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="built_in">splay</span>(x);  <span class="keyword">return</span> x;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function">node* <span class="title">getprev</span><span class="params">(node* x)</span> </span>&#123; <span class="keyword">return</span> <span class="built_in">gethelper</span>(x, <span class="number">1</span>); &#125;</span><br><span class="line">    <span class="function">node* <span class="title">getnext</span><span class="params">(node* x)</span> </span>&#123; <span class="keyword">return</span> <span class="built_in">gethelper</span>(x, <span class="number">0</span>); &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">erase</span><span class="params">(node* x)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (!root) <span class="keyword">return</span>; </span><br><span class="line">        <span class="built_in">splay</span>(x);</span><br><span class="line">        node* l = x-&gt;c[<span class="number">0</span>] ? <span class="built_in">getelement</span>(x-&gt;c[<span class="number">0</span>],<span class="number">1</span>) : <span class="literal">nullptr</span>; </span><br><span class="line">        node* rs = x-&gt;c[<span class="number">1</span>];</span><br><span class="line">        <span class="keyword">if</span> (!l &amp;&amp; !rs) root = <span class="literal">nullptr</span>;</span><br><span class="line">        <span class="keyword">else</span> <span class="keyword">if</span> (!l) root = rs, root-&gt;f = <span class="literal">nullptr</span>;</span><br><span class="line">        <span class="keyword">else</span> <span class="keyword">if</span> (!rs) root = x-&gt;c[<span class="number">0</span>], root-&gt;f = <span class="literal">nullptr</span>;</span><br><span class="line">        <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="comment">// print(root); </span></span><br><span class="line">            l-&gt;c[<span class="number">1</span>] = x-&gt;c[<span class="number">1</span>]; <span class="keyword">if</span> (rs) rs-&gt;f = l;</span><br><span class="line">            x-&gt;c[<span class="number">0</span>]-&gt;f = <span class="literal">nullptr</span>; root = x-&gt;c[<span class="number">0</span>];</span><br><span class="line">            <span class="built_in">splay</span>(rs);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function">node* <span class="title">lower_bound</span><span class="params">(T v)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (!root) <span class="keyword">return</span> <span class="literal">nullptr</span>;</span><br><span class="line">        <span class="keyword">for</span> (node* x = root, *ret = <span class="literal">nullptr</span>; ; ) &#123;</span><br><span class="line">            <span class="built_in">assert</span>(x); </span><br><span class="line">            <span class="keyword">if</span> (x-&gt;v &gt;= v &amp;&amp; (!ret || x-&gt;v &lt;= ret-&gt;v)) ret = x;</span><br><span class="line">            <span class="keyword">if</span> (x-&gt;v &gt;= v &amp;&amp; x-&gt;c[<span class="number">0</span>]) x = x-&gt;c[<span class="number">0</span>];</span><br><span class="line">            <span class="keyword">else</span> <span class="keyword">if</span> (x-&gt;v &lt; v &amp;&amp; x-&gt;c[<span class="number">1</span>]) x = x-&gt;c[<span class="number">1</span>];</span><br><span class="line">            <span class="keyword">else</span> &#123;  <span class="built_in">splay</span>(x); <span class="keyword">return</span> ret;&#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function">node* <span class="title">upper_bound</span><span class="params">(T v)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (!root) <span class="keyword">return</span> <span class="literal">nullptr</span>;</span><br><span class="line">        <span class="keyword">for</span> (node* x = root, *ret = <span class="literal">nullptr</span>; ; ) &#123;</span><br><span class="line">            <span class="keyword">if</span> (x-&gt;v &gt; v &amp;&amp; (!ret || x-&gt;v &lt;= ret-&gt;v)) ret = x;</span><br><span class="line">            <span class="keyword">if</span> (x-&gt;v &gt; v &amp;&amp; x-&gt;c[<span class="number">0</span>]) x = x-&gt;c[<span class="number">0</span>];</span><br><span class="line">            <span class="keyword">else</span> <span class="keyword">if</span> (x-&gt;v &lt;= v &amp;&amp; x-&gt;c[<span class="number">1</span>]) x = x-&gt;c[<span class="number">1</span>];</span><br><span class="line">            <span class="keyword">else</span> &#123; <span class="built_in">splay</span>(x); <span class="keyword">return</span> ret;&#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function">node* <span class="title">kth</span><span class="params">(<span class="type">int</span> k)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">for</span> (node* x = root; ; ) &#123;</span><br><span class="line">            <span class="type">int</span> l = x-&gt;c[<span class="number">0</span>] ? x-&gt;c[<span class="number">0</span>]-&gt;siz + <span class="number">1</span> : <span class="number">1</span>;</span><br><span class="line">            <span class="keyword">if</span> (l == k) &#123; <span class="built_in">splay</span>(x); <span class="keyword">return</span> x; &#125;</span><br><span class="line">            <span class="keyword">else</span> <span class="keyword">if</span> (l &lt; k) x = x-&gt;c[<span class="number">1</span>], k -= l;</span><br><span class="line">            <span class="keyword">else</span> x = x-&gt;c[<span class="number">0</span>];</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="type">int</span> <span class="title">getrank</span><span class="params">(T v)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (!root || !<span class="built_in">getprev</span>(<span class="built_in">lower_bound</span>(v))) <span class="keyword">return</span> <span class="number">1</span>;</span><br><span class="line">        <span class="keyword">return</span> root-&gt;c[<span class="number">0</span>] ? root-&gt;c[<span class="number">0</span>]-&gt;siz + <span class="number">2</span> : <span class="number">2</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<h4 id="splay压行">Splay压行</h4>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">template</span>&lt;<span class="keyword">class</span> <span class="title class_">data_t</span>=<span class="type">int</span>, <span class="keyword">class</span> Comp=std::less&lt;<span class="type">data_t</span>&gt;&gt; </span><br><span class="line"><span class="keyword">struct</span> Splay &#123;</span><br><span class="line">    <span class="keyword">struct</span> node &#123;</span><br><span class="line">        <span class="type">int</span> p=<span class="number">0</span>, c[<span class="number">2</span>]=&#123;&#125;, siz=<span class="number">0</span>;</span><br><span class="line">        <span class="type">data_t</span> v;</span><br><span class="line">        <span class="built_in">node</span>() &#123;&#125;</span><br><span class="line">        <span class="built_in">node</span>(<span class="type">int</span> fa,<span class="type">data_t</span> v) : <span class="built_in">p</span>(fa), <span class="built_in">siz</span>(<span class="number">1</span>), <span class="built_in">v</span>(v) &#123;&#125;</span><br><span class="line">        <span class="function"><span class="keyword">operator</span> <span class="title">data_t</span><span class="params">()</span> <span class="type">const</span> </span>&#123; <span class="keyword">return</span> v; &#125;</span><br><span class="line">    &#125;;</span><br><span class="line">    vector&lt;node&gt; t;</span><br><span class="line">    <span class="type">int</span> root = <span class="number">0</span>;</span><br><span class="line">    <span class="built_in">Splay</span>() : <span class="built_in">t</span>(<span class="number">1</span>) &#123;&#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">inline</span> <span class="type">int</span> <span class="title">newnode</span><span class="params">(<span class="type">int</span> fa,<span class="type">int</span> k,<span class="type">data_t</span> v)</span> </span>&#123;</span><br><span class="line">        t.<span class="built_in">push_back</span>(<span class="built_in">node</span>(fa, v));</span><br><span class="line">        <span class="keyword">if</span> (fa) t[fa].c[k] = <span class="built_in">sz</span>(t)<span class="number">-1</span>;</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">sz</span>(t)<span class="number">-1</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">inline</span> <span class="type">void</span> <span class="title">pushup</span><span class="params">(<span class="type">int</span> x)</span> </span>&#123;</span><br><span class="line">        t[x].siz = t[t[x].c[<span class="number">0</span>]].siz + t[t[x].c[<span class="number">1</span>]].siz + <span class="number">1</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">inline</span> <span class="type">void</span> <span class="title">connect</span><span class="params">(<span class="type">int</span> p, <span class="type">int</span> x, <span class="type">int</span> k=<span class="number">0</span>)</span> </span>&#123;</span><br><span class="line">        t[x].p = p;</span><br><span class="line">        <span class="keyword">if</span> (p) t[p].c[k] = x;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">inline</span> <span class="type">void</span> <span class="title">rotate</span><span class="params">(<span class="type">int</span> n)</span> </span>&#123; <span class="comment">// assume this is not root</span></span><br><span class="line">        <span class="type">int</span> p = t[n].p,pp = t[p].p,k = t[p].c[<span class="number">1</span>] == n;</span><br><span class="line">        <span class="built_in">connect</span>(p, t[n].c[k^<span class="number">1</span>], k),<span class="built_in">connect</span>(pp, n, t[pp].c[<span class="number">1</span>]==p),<span class="built_in">connect</span>(n,p,k^<span class="number">1</span>);</span><br><span class="line">        <span class="built_in">pushup</span>(p), <span class="built_in">pushup</span>(n);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">inline</span> node* <span class="title">gethelper</span><span class="params">(<span class="type">int</span> x,<span class="type">int</span> k)</span> </span>&#123;</span><br><span class="line">        x = x ? t[x].c[k^<span class="number">1</span>] : root;</span><br><span class="line">        <span class="keyword">while</span> (t[x].c[k]) x = t[x].c[k];</span><br><span class="line">        <span class="keyword">return</span> &amp;t[<span class="built_in">splay</span>(x)];</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">inline</span> node* <span class="title">getprev</span><span class="params">(node* x)</span> </span>&#123; <span class="keyword">return</span> <span class="built_in">gethelper</span>(<span class="built_in">splay</span>(x - &amp;t[<span class="number">0</span>]),<span class="number">1</span>); &#125;</span><br><span class="line">    <span class="function"><span class="keyword">inline</span> node* <span class="title">getnext</span><span class="params">(node* x)</span> </span>&#123; <span class="keyword">return</span> <span class="built_in">gethelper</span>(<span class="built_in">splay</span>(x - &amp;t[<span class="number">0</span>]),<span class="number">0</span>); &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">inline</span> <span class="type">bool</span> <span class="title">empty</span><span class="params">()</span> </span>&#123; <span class="keyword">return</span> <span class="built_in">size</span>() == <span class="number">0</span>; &#125;</span><br><span class="line">    <span class="function"><span class="keyword">inline</span> <span class="type">int</span> <span class="title">size</span><span class="params">()</span> </span>&#123; <span class="keyword">return</span> t[root].siz; &#125;</span><br><span class="line">    <span class="function"><span class="keyword">inline</span> node* <span class="title">end</span><span class="params">()</span> </span>&#123; <span class="keyword">return</span> &amp;t[<span class="number">0</span>]; &#125;</span><br><span class="line">    <span class="function"><span class="keyword">inline</span> node* <span class="title">begin</span><span class="params">()</span> </span>&#123; <span class="keyword">return</span> <span class="built_in">kth</span>(<span class="number">1</span>); &#125;</span><br><span class="line">    <span class="function"><span class="keyword">inline</span> node* <span class="title">find</span><span class="params">(<span class="type">data_t</span> v)</span> </span>&#123; <span class="keyword">auto</span> it =  <span class="built_in">lower_bound</span>(v); <span class="keyword">return</span> it-&gt;v==v ? it : <span class="built_in">end</span>(); &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="type">int</span> <span class="title">splay</span><span class="params">(<span class="type">int</span> n, <span class="type">int</span> s=<span class="number">0</span>)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (!n) <span class="keyword">return</span> <span class="number">0</span>; </span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> m=t[n].p,l=t[m].p; t[n].p != s; <span class="built_in">rotate</span>(n),m=t[n].p,l=t[m].p) </span><br><span class="line">            <span class="keyword">if</span> (l != s) (t[l].c[<span class="number">0</span>] == m) == (t[m].c[<span class="number">0</span>] == n) ? <span class="built_in">rotate</span>(m) : <span class="built_in">rotate</span>(n);</span><br><span class="line">        <span class="keyword">return</span> s ? n : root=n;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">insert</span><span class="params">(<span class="type">data_t</span> v)</span> </span>&#123;</span><br><span class="line">        <span class="type">int</span> x=root, fa=<span class="number">0</span>;</span><br><span class="line">        <span class="keyword">while</span> (x) fa=x, x=t[x].c[Comp&#123;&#125;(t[x].v,v)];</span><br><span class="line">        <span class="built_in">splay</span>(<span class="built_in">newnode</span>(fa,Comp&#123;&#125;(t[fa].v,v),v));</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">inline</span> <span class="type">void</span> <span class="title">erase</span><span class="params">(node* x)</span> </span>&#123; <span class="built_in">erase</span>(x - &amp;t[<span class="number">0</span>]); &#125;</span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">erase</span><span class="params">(<span class="type">int</span> x)</span> </span>&#123; </span><br><span class="line">        <span class="built_in">splay</span>(x);</span><br><span class="line">        <span class="type">int</span> l = t[x].c[<span class="number">0</span>],ls=l, rs = t[x].c[<span class="number">1</span>]; <span class="keyword">while</span> (t[l].c[<span class="number">1</span>]) l = t[l].c[<span class="number">1</span>]; </span><br><span class="line">        <span class="keyword">if</span> (!l || !rs) root = t[x].c[l==<span class="number">0</span>], t[root].p = <span class="number">0</span>,<span class="built_in">splay</span>(l);</span><br><span class="line">        <span class="keyword">else</span> <span class="built_in">connect</span>(l,rs,<span class="number">1</span>), <span class="built_in">connect</span>(<span class="number">0</span>,ls,<span class="number">0</span>),<span class="built_in">splay</span>(rs);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function">node* <span class="title">lower_bound</span><span class="params">(<span class="type">data_t</span> v)</span> </span>&#123;</span><br><span class="line">        <span class="type">int</span> x=root, ret=<span class="number">0</span>, fa=<span class="number">0</span>;</span><br><span class="line">        <span class="keyword">while</span> (x) ret = !Comp&#123;&#125;(t[x].v, v) &amp;&amp; (!ret || !Comp&#123;&#125;(t[ret].v, t[x].v)) ? </span><br><span class="line">            x : ret, fa=x, x = t[x].c[Comp&#123;&#125;(t[x].v, v)];</span><br><span class="line">        <span class="built_in">splay</span>(fa); <span class="keyword">return</span> &amp;t[ret]; </span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">inline</span> node* <span class="title">upper_bound</span><span class="params">(<span class="type">data_t</span> v)</span> </span>&#123;</span><br><span class="line">        <span class="type">int</span> x=root, ret=<span class="number">0</span>, fa=<span class="number">0</span>;</span><br><span class="line">        <span class="keyword">while</span> (x) ret =  Comp&#123;&#125;(v,t[x].v)  &amp;&amp; (!ret || !Comp&#123;&#125;(t[ret].v, t[x].v)) ? </span><br><span class="line">            x : ret,fa=x, x = t[x].c[!Comp&#123;&#125;(v,t[x].v)];</span><br><span class="line">        <span class="built_in">splay</span>(fa); <span class="keyword">return</span> &amp;t[ret]; </span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">inline</span> node* <span class="title">kth</span><span class="params">(<span class="type">int</span> k)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (k &lt;= <span class="number">0</span> || k &gt; <span class="built_in">size</span>()) <span class="keyword">return</span> <span class="built_in">end</span>();</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> x=root,l;;x = t[x].c[l&lt;k], k -= (l&lt;k?l:<span class="number">0</span>)) </span><br><span class="line">            <span class="keyword">if</span> ((l=t[x].c[<span class="number">0</span>] ? t[t[x].c[<span class="number">0</span>]].siz + <span class="number">1</span> : <span class="number">1</span>)==k) <span class="keyword">return</span> &amp;t[<span class="built_in">splay</span>(x)];</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">inline</span> <span class="type">int</span> <span class="title">getrank</span><span class="params">(<span class="type">int</span> v)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (!root || <span class="built_in">getprev</span>(<span class="built_in">lower_bound</span>(v)) == <span class="built_in">end</span>()) <span class="keyword">return</span> <span class="number">1</span>;</span><br><span class="line">        <span class="keyword">return</span> t[root].c[<span class="number">0</span>] ? t[t[root].c[<span class="number">0</span>]].siz + <span class="number">2</span> : <span class="number">2</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<h4 id="文艺splay">文艺Splay</h4>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">template</span>&lt;<span class="keyword">class</span> <span class="title class_">data_t</span>=<span class="type">int</span>,<span class="keyword">class</span> <span class="type">meta_t</span>=<span class="type">int</span>, <span class="keyword">class</span> <span class="type">lazy_t</span>=<span class="type">meta_t</span>&gt; </span><br><span class="line"><span class="keyword">struct</span> Splay &#123;</span><br><span class="line">    <span class="keyword">struct</span> node &#123;</span><br><span class="line">        <span class="type">int</span> p=<span class="number">0</span>, c[<span class="number">2</span>]=&#123;&#125;, siz=<span class="number">0</span>;</span><br><span class="line">        <span class="type">data_t</span> v; <span class="type">meta_t</span> mv, sum; <span class="type">lazy_t</span> lz;</span><br><span class="line">        <span class="type">bool</span> islazy=<span class="number">0</span>;</span><br><span class="line">        <span class="built_in">node</span>() &#123;&#125;</span><br><span class="line">        <span class="built_in">node</span>(<span class="type">int</span> fa,<span class="type">data_t</span> v,<span class="type">meta_t</span> mv) : <span class="built_in">p</span>(fa), <span class="built_in">siz</span>(<span class="number">1</span>), <span class="built_in">v</span>(v), <span class="built_in">mv</span>(mv),<span class="built_in">sum</span>(mv) &#123;&#125;</span><br><span class="line">        <span class="function"><span class="keyword">operator</span> <span class="title">meta_t</span><span class="params">()</span> <span class="type">const</span> </span>&#123; <span class="keyword">return</span> mv; &#125;</span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="type">static</span> <span class="type">meta_t</span> <span class="title">combine</span><span class="params">(<span class="type">meta_t</span> a,<span class="type">meta_t</span> b)</span> </span>&#123; <span class="comment">// change pushup</span></span><br><span class="line">            <span class="keyword">return</span> <span class="type">meta_t</span>&#123;&#125;; <span class="comment">// pass</span></span><br><span class="line">        &#125;</span><br><span class="line">        <span class="function"><span class="type">void</span> <span class="title">apply</span><span class="params">(<span class="type">lazy_t</span> op, node* ls, node* rs)</span> </span>&#123;</span><br><span class="line">            <span class="comment">// update mv, sum, lz</span></span><br><span class="line">            <span class="keyword">auto</span> [ai, bi] = op;</span><br><span class="line">            v.f += ai * ls-&gt;siz + bi;</span><br><span class="line">            v.rf += ai * (siz<span class="number">-1</span>) + bi; </span><br><span class="line">            <span class="keyword">if</span> (islazy) &#123;</span><br><span class="line">                lz.first += ai;</span><br><span class="line">                lz.second += bi;</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                lz = op;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;;</span><br><span class="line">    <span class="meta">#<span class="keyword">define</span> lson t[t[x].c[0]]</span></span><br><span class="line">    <span class="meta">#<span class="keyword">define</span> rson t[t[x].c[1]]</span></span><br><span class="line">    vector&lt;node&gt; t;</span><br><span class="line">    <span class="type">int</span> root = <span class="number">0</span>;</span><br><span class="line">    <span class="built_in">Splay</span>() : <span class="built_in">t</span>(<span class="number">1</span>) &#123;&#125;</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">inline</span> <span class="type">int</span> <span class="title">newnode</span><span class="params">(<span class="type">int</span> fa,<span class="type">int</span> k,<span class="type">data_t</span> v, <span class="type">meta_t</span> mv)</span> </span>&#123;</span><br><span class="line">        t.<span class="built_in">push_back</span>(<span class="built_in">node</span>(fa, v, mv));</span><br><span class="line">        <span class="keyword">if</span> (fa) t[fa].c[k] = <span class="built_in">sz</span>(t)<span class="number">-1</span>;</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">sz</span>(t)<span class="number">-1</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">inline</span> <span class="type">void</span> <span class="title">pushdown</span><span class="params">(<span class="type">int</span> x)</span> </span>&#123; <span class="comment">// tochange</span></span><br><span class="line">        <span class="keyword">if</span> (!t[x].islazy) <span class="keyword">return</span>;</span><br><span class="line">        <span class="keyword">if</span> (t[x].c[<span class="number">0</span>]) t[t[x].c[<span class="number">0</span>]].<span class="built_in">apply</span>(t[x].lz, &amp;t[t[t[x].c[<span class="number">0</span>]].c[<span class="number">0</span>]], &amp;t[t[t[x].c[<span class="number">0</span>]].c[<span class="number">1</span>]]), t[t[x].c[<span class="number">0</span>]].islazy = <span class="number">1</span>;</span><br><span class="line">        <span class="keyword">if</span> (t[x].c[<span class="number">1</span>]) t[t[x].c[<span class="number">1</span>]].<span class="built_in">apply</span>(&#123;t[x].lz.first, t[x].lz.second + t[x].lz.first * (t[t[x].c[<span class="number">0</span>]].siz<span class="number">+1</span>)&#125;, &amp;t[t[t[x].c[<span class="number">1</span>]].c[<span class="number">0</span>]], &amp;t[t[t[x].c[<span class="number">1</span>]].c[<span class="number">1</span>]]), t[t[x].c[<span class="number">1</span>]].islazy = <span class="number">1</span>;</span><br><span class="line">        t[x].islazy = <span class="literal">false</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">inline</span> <span class="type">void</span> <span class="title">pushup</span><span class="params">(<span class="type">int</span> x)</span> </span>&#123;</span><br><span class="line">        t[x].siz = t[t[x].c[<span class="number">0</span>]].siz + t[t[x].c[<span class="number">1</span>]].siz + <span class="number">1</span>; </span><br><span class="line">        <span class="keyword">if</span> (t[x].c[<span class="number">0</span>]) t[x].sum = node::<span class="built_in">combine</span>(t[t[x].c[<span class="number">0</span>]].sum, t[x].mv);</span><br><span class="line">        <span class="keyword">else</span> t[x].sum = t[x].mv;</span><br><span class="line">        t[x].v.rf = t[x].v.f;</span><br><span class="line">        <span class="keyword">if</span> (t[x].c[<span class="number">1</span>]) t[x].sum = node::<span class="built_in">combine</span>(t[x].sum, t[t[x].c[<span class="number">1</span>]].sum), t[x].v.rf = t[t[x].c[<span class="number">1</span>]].v.rf;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">inline</span> <span class="type">void</span> <span class="title">connect</span><span class="params">(<span class="type">int</span> p, <span class="type">int</span> x, <span class="type">int</span> k=<span class="number">0</span>)</span> </span>&#123;</span><br><span class="line">        t[x].p = p;</span><br><span class="line">        <span class="keyword">if</span> (p) t[p].c[k] = x;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">inline</span> <span class="type">void</span> <span class="title">rotate</span><span class="params">(<span class="type">int</span> n)</span> </span>&#123; <span class="comment">// assume this is not root</span></span><br><span class="line">        <span class="type">int</span> p = t[n].p,pp = t[p].p,k = t[p].c[<span class="number">1</span>] == n;</span><br><span class="line">        <span class="built_in">connect</span>(p, t[n].c[k^<span class="number">1</span>], k),<span class="built_in">connect</span>(pp, n, t[pp].c[<span class="number">1</span>]==p),<span class="built_in">connect</span>(n,p,k^<span class="number">1</span>);</span><br><span class="line">        <span class="built_in">pushup</span>(p), <span class="built_in">pushup</span>(n);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="type">int</span> <span class="title">splay</span><span class="params">(<span class="type">int</span> n, <span class="type">int</span> s=<span class="number">0</span>)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (!n) <span class="keyword">return</span> <span class="number">0</span>; </span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> m=t[n].p,l=t[m].p; t[n].p != s; <span class="built_in">rotate</span>(n),m=t[n].p,l=t[m].p) </span><br><span class="line">            <span class="keyword">if</span> (l != s) (t[l].c[<span class="number">0</span>] == m) == (t[m].c[<span class="number">0</span>] == n) ? <span class="built_in">rotate</span>(m) : <span class="built_in">rotate</span>(n);</span><br><span class="line">        <span class="keyword">return</span> s ? n : root=n;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">inline</span> <span class="type">bool</span> <span class="title">empty</span><span class="params">()</span> </span>&#123; <span class="keyword">return</span> <span class="built_in">size</span>() == <span class="number">0</span>; &#125;</span><br><span class="line">    <span class="function"><span class="keyword">inline</span> <span class="type">int</span> <span class="title">size</span><span class="params">()</span> </span>&#123; <span class="keyword">return</span> t[root].siz; &#125;</span><br><span class="line">    <span class="function"><span class="keyword">inline</span> node* <span class="title">end</span><span class="params">()</span> </span>&#123; <span class="keyword">return</span> &amp;t[<span class="number">0</span>]; &#125;</span><br><span class="line">    <span class="function"><span class="keyword">inline</span> node* <span class="title">begin</span><span class="params">()</span> </span>&#123; <span class="keyword">return</span> <span class="built_in">kth</span>(<span class="number">1</span>); &#125;</span><br><span class="line">    node&amp; <span class="keyword">operator</span>[](<span class="type">int</span> i) &#123; <span class="keyword">return</span> *<span class="built_in">kth</span>(i); &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">push_back</span><span class="params">(<span class="type">data_t</span> v, <span class="type">meta_t</span> mv)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (!root) &#123;</span><br><span class="line">            root = <span class="built_in">newnode</span>(<span class="number">0</span>, <span class="number">1</span>, v, mv);</span><br><span class="line">            <span class="keyword">return</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="type">int</span> x = root, p = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">while</span> (x) &#123;</span><br><span class="line">            <span class="built_in">pushdown</span>(x);</span><br><span class="line">            p = x;</span><br><span class="line">            x = t[x].c[<span class="number">1</span>];</span><br><span class="line">        &#125;</span><br><span class="line">        t[p].c[<span class="number">1</span>] = <span class="built_in">newnode</span>(p, <span class="number">1</span>, v, mv);</span><br><span class="line">        <span class="built_in">splay</span>(t[p].c[<span class="number">1</span>]);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">push_front</span><span class="params">(<span class="type">data_t</span> v, <span class="type">meta_t</span> mv)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (!root) &#123;</span><br><span class="line">            root = <span class="built_in">newnode</span>(<span class="number">0</span>, <span class="number">1</span>, v, mv);</span><br><span class="line">            <span class="keyword">return</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="type">int</span> x = root, p = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">while</span> (x) &#123;</span><br><span class="line">            <span class="built_in">pushdown</span>(x);</span><br><span class="line">            p = x;</span><br><span class="line">            x = t[x].c[<span class="number">0</span>];</span><br><span class="line">        &#125;</span><br><span class="line">        t[p].c[<span class="number">0</span>] = <span class="built_in">newnode</span>(p, <span class="number">0</span>, v, mv);</span><br><span class="line">        <span class="built_in">splay</span>(t[p].c[<span class="number">0</span>]);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function">node* <span class="title">kth</span><span class="params">(<span class="type">int</span> k)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (k &lt;= <span class="number">0</span> || k &gt; <span class="built_in">size</span>()) <span class="keyword">return</span> <span class="built_in">end</span>();</span><br><span class="line">        <span class="type">int</span> x = root;</span><br><span class="line">        <span class="keyword">while</span> (<span class="literal">true</span>) &#123;</span><br><span class="line">            <span class="built_in">pushdown</span>(x);</span><br><span class="line">            <span class="type">int</span> rank = lson.siz + <span class="number">1</span>;</span><br><span class="line">            <span class="keyword">if</span> (rank == k) <span class="keyword">return</span> &amp;t[<span class="built_in">splay</span>(x)];</span><br><span class="line"></span><br><span class="line">            <span class="keyword">if</span> (rank &gt; k) x = t[x].c[<span class="number">0</span>];</span><br><span class="line">            <span class="keyword">else</span> x = t[x].c[<span class="number">1</span>], k -= rank;  </span><br><span class="line">        &#125;</span><br><span class="line">        <span class="built_in">assert</span>(<span class="literal">false</span>);</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">end</span>();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function">node* <span class="title">query</span><span class="params">(<span class="type">int</span> l,<span class="type">int</span> r)</span> </span>&#123;</span><br><span class="line">        <span class="comment">// assert(!(l &lt;= 0 || r &gt; size() || l &gt; r)); </span></span><br><span class="line">        <span class="type">int</span> pre = <span class="built_in">kth</span>(l<span class="number">-1</span>) - &amp;t[<span class="number">0</span>];</span><br><span class="line">        <span class="type">int</span> nxt = <span class="built_in">kth</span>(r<span class="number">+1</span>) - &amp;t[<span class="number">0</span>];</span><br><span class="line">        <span class="keyword">if</span> (!pre &amp;&amp; !nxt) <span class="keyword">return</span> &amp;t[root];</span><br><span class="line">        <span class="keyword">if</span> (!pre) <span class="keyword">return</span> &amp;t[t[nxt].c[<span class="number">0</span>]];</span><br><span class="line">        <span class="keyword">if</span> (!nxt) <span class="keyword">return</span> &amp;t[t[pre].c[<span class="number">1</span>]];</span><br><span class="line">        <span class="built_in">splay</span>(pre, nxt);</span><br><span class="line">        <span class="keyword">return</span> &amp;t[t[pre].c[<span class="number">1</span>]];</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">update</span><span class="params">(<span class="type">int</span> l,<span class="type">int</span> r,<span class="type">lazy_t</span> lz)</span> </span>&#123;</span><br><span class="line">        <span class="type">int</span> x = <span class="built_in">query</span>(l, r) - &amp;t[<span class="number">0</span>];</span><br><span class="line">        t[x].<span class="built_in">apply</span>(lz, &amp;lson, &amp;rson); t[x].islazy = <span class="literal">true</span>;</span><br><span class="line">        <span class="built_in">pushdown</span>(x); <span class="built_in">splay</span>(x);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">insert</span><span class="params">(<span class="type">int</span> i, <span class="type">data_t</span> v, <span class="type">meta_t</span> mv)</span> </span>&#123;</span><br><span class="line">        <span class="comment">// insert after index i</span></span><br><span class="line">        <span class="keyword">if</span> (i == <span class="number">0</span>) <span class="built_in">push_front</span>(v, mv);</span><br><span class="line">        <span class="keyword">else</span> <span class="keyword">if</span> (i == <span class="built_in">size</span>()) <span class="built_in">push_back</span>(v, mv);</span><br><span class="line">        <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="type">int</span> p1 = <span class="built_in">kth</span>(i<span class="number">+1</span>) - &amp;t[<span class="number">0</span>];</span><br><span class="line">            <span class="type">int</span> p0 = <span class="built_in">kth</span>(i) - &amp;t[<span class="number">0</span>];</span><br><span class="line">            <span class="built_in">splay</span>(p1, p0);</span><br><span class="line">            t[p1].c[<span class="number">0</span>] = <span class="built_in">newnode</span>(p1, <span class="number">0</span>, v, mv);</span><br><span class="line">            <span class="built_in">splay</span>(t[p1].c[<span class="number">0</span>]);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">erase</span><span class="params">(<span class="type">int</span> l, <span class="type">int</span> r)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">auto</span> x = <span class="built_in">query</span>(l, r) - &amp;t[<span class="number">0</span>];</span><br><span class="line">        <span class="type">int</span> fa = t[x].p;</span><br><span class="line">        <span class="keyword">if</span> (!fa) &#123;</span><br><span class="line">            root = <span class="number">0</span>;</span><br><span class="line">            <span class="keyword">return</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="type">int</span> k = t[fa].c[<span class="number">1</span>] == x;</span><br><span class="line">        t[fa].c[k] = <span class="number">0</span>;</span><br><span class="line">        <span class="built_in">pushup</span>(fa); <span class="built_in">splay</span>(fa);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<h3 id="文艺指针splay">文艺指针Splay</h3>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">template</span>&lt;<span class="keyword">typename</span> T, <span class="keyword">typename</span> Lz&gt;</span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">Splay</span> &#123;</span><br><span class="line">    Lz ZERO;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">struct</span> <span class="title class_">Node</span> &#123;</span><br><span class="line">        Node **ch, *fa; </span><br><span class="line">        <span class="type">int</span> sz, rep;</span><br><span class="line">        T v; Lz tag;</span><br><span class="line">        <span class="built_in">Node</span>() &#123;</span><br><span class="line">            ch = <span class="keyword">new</span> Node*[<span class="number">2</span>];</span><br><span class="line">            ch[<span class="number">0</span>] = <span class="literal">NULL</span>;</span><br><span class="line">            ch[<span class="number">1</span>] = <span class="literal">NULL</span>;</span><br><span class="line">            fa = <span class="literal">NULL</span>;</span><br><span class="line">            sz = <span class="number">1</span>; rep = <span class="number">1</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="built_in">Node</span>(T tv, Node* tfa = <span class="literal">NULL</span>) &#123;</span><br><span class="line">            ch = <span class="keyword">new</span> Node*[<span class="number">2</span>];</span><br><span class="line">            ch[<span class="number">0</span>] = <span class="literal">NULL</span>;</span><br><span class="line">            ch[<span class="number">1</span>] = <span class="literal">NULL</span>;</span><br><span class="line">            fa = tfa;</span><br><span class="line">            sz = <span class="number">1</span>; rep = <span class="number">1</span>;</span><br><span class="line">            v = tv;</span><br><span class="line">        &#125;</span><br><span class="line">        ~<span class="built_in">Node</span>() &#123;</span><br><span class="line">            <span class="keyword">if</span> (ch != <span class="literal">NULL</span>) &#123;</span><br><span class="line">                <span class="keyword">delete</span> ch;</span><br><span class="line">            &#125; </span><br><span class="line">        &#125;</span><br><span class="line">    &#125;;</span><br><span class="line"></span><br><span class="line">    Node* root0;</span><br><span class="line"></span><br><span class="line">    <span class="built_in">void</span> (*add)(Node*);</span><br><span class="line">    <span class="built_in">void</span> (*addt)(Node*, Lz, <span class="type">int</span>, <span class="type">int</span>);</span><br><span class="line">    <span class="built_in">Lz</span> (*addtt)(Lz, Lz);</span><br><span class="line">    <span class="type">int</span> LEFT, RIGHT;</span><br><span class="line"></span><br><span class="line">    <span class="meta">#<span class="keyword">define</span> child x-&gt;ch[nxt]</span></span><br><span class="line">    <span class="meta">#<span class="keyword">define</span> ls(x) x-&gt;ch[0]</span></span><br><span class="line">    <span class="meta">#<span class="keyword">define</span> rs(x) x-&gt;ch[1]</span></span><br><span class="line">    <span class="meta">#<span class="keyword">define</span> fa(x) x-&gt;fa</span></span><br><span class="line">    <span class="meta">#<span class="keyword">define</span> root rs(root0)</span></span><br><span class="line">    <span class="function"><span class="keyword">inline</span> <span class="type">int</span> <span class="title">size</span><span class="params">(Node* x)</span> </span>&#123; <span class="keyword">return</span> x? x-&gt;sz : <span class="number">0</span>; &#125;</span><br><span class="line"></span><br><span class="line">    </span><br><span class="line">    <span class="meta">#<span class="keyword">define</span> ident(x) (x == rs(fa(x)))</span></span><br><span class="line">    <span class="function"><span class="keyword">inline</span> <span class="type">void</span> <span class="title">connect</span><span class="params">(Node* x, Node* f, <span class="type">int</span> k)</span> </span>&#123; f-&gt;ch[k] = x; <span class="keyword">if</span>(x) <span class="built_in">fa</span>(x) = f; &#125;</span><br><span class="line">    <span class="meta">#<span class="keyword">define</span> update(x)  x-&gt;sz = size(ls(x)) + size(rs(x)) + x-&gt;rep, add(x)</span></span><br><span class="line">    <span class="function"><span class="keyword">inline</span> <span class="type">int</span> <span class="title">size</span><span class="params">()</span> </span>&#123; <span class="keyword">return</span> <span class="built_in">size</span>(root);&#125;</span><br><span class="line">    <span class="function"><span class="keyword">inline</span> Node* <span class="title">newnode</span><span class="params">(T v, Node* fa)</span> </span>&#123; Node *ret = <span class="keyword">new</span> <span class="built_in">Node</span>(v, fa); ret-&gt;tag = ZERO; <span class="keyword">return</span> ret; &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="built_in">Splay</span>(vector&lt;T&gt; &amp;A, <span class="type">int</span> left = <span class="number">1</span>, <span class="type">int</span> right = <span class="number">-1</span>,</span><br><span class="line">          <span class="built_in">void</span> (*fadd)(Node*) = [](Node *a) &#123; <span class="keyword">if</span> (!a) <span class="keyword">return</span>; <span class="keyword">if</span> (<span class="built_in">ls</span>(a)) a-&gt;v += <span class="built_in">ls</span>(a)-&gt;v; <span class="keyword">if</span> (<span class="built_in">rs</span>(a)) a-&gt;v += <span class="built_in">rs</span>(a)-&gt;v; &#125;, </span><br><span class="line">          <span class="built_in">void</span> (*faddt)(Node*, Lz,<span class="type">int</span>,<span class="type">int</span>) = [](Node *a, Lz t, <span class="type">int</span> l=<span class="number">0</span>, <span class="type">int</span> r=<span class="number">0</span>)  &#123; <span class="keyword">if</span> (!a) <span class="keyword">return</span>; a-&gt;v += t * (r-l<span class="number">+1</span>); &#125;,</span><br><span class="line">          <span class="built_in">Lz</span> (*faddtt)(Lz, Lz) = [](Lz a, Lz b) &#123; <span class="keyword">return</span> a + b; &#125;,</span><br><span class="line">          Lz zero = <span class="number">0</span>, T maxv = INT_MAX, T minv = INT_MIN) &#123;</span><br><span class="line">        <span class="keyword">if</span> (right == <span class="number">-1</span>) right = A.<span class="built_in">size</span>()<span class="number">-1</span>;</span><br><span class="line">        <span class="keyword">else</span> RIGHT = right;</span><br><span class="line">        LEFT = left; </span><br><span class="line">        add = fadd; addt = faddt; addtt = faddtt; ZERO = zero;</span><br><span class="line"></span><br><span class="line">        T mxv = maxv; T mnv = minv; </span><br><span class="line"></span><br><span class="line">        root0 = <span class="keyword">new</span> Node;</span><br><span class="line">        root0-&gt;ch[<span class="number">1</span>] = <span class="built_in">newnode</span>(mnv, root0); </span><br><span class="line">        root-&gt;ch[<span class="number">1</span>] = <span class="built_in">newnode</span>(mxv, root); </span><br><span class="line">        <span class="built_in">ls</span>(root-&gt;ch[<span class="number">1</span>]) = <span class="built_in">build</span>(A, LEFT, RIGHT, root-&gt;ch[<span class="number">1</span>]); </span><br><span class="line">        <span class="built_in">update</span>(root-&gt;ch[<span class="number">1</span>]);</span><br><span class="line">        <span class="built_in">update</span>(root);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">delAll</span><span class="params">(Node *x)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (x == <span class="literal">NULL</span>) <span class="keyword">return</span>;</span><br><span class="line">        <span class="keyword">if</span> (<span class="built_in">ls</span>(x) != <span class="literal">NULL</span>) <span class="built_in">delAll</span>(<span class="built_in">ls</span>(x));</span><br><span class="line">        <span class="keyword">if</span> (<span class="built_in">rs</span>(x) != <span class="literal">NULL</span>) <span class="built_in">delAll</span>(<span class="built_in">rs</span>(x));</span><br><span class="line">        <span class="keyword">delete</span> x;</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    ~<span class="built_in">Splay</span>() &#123;</span><br><span class="line">        <span class="keyword">if</span> (root != <span class="literal">NULL</span>) <span class="built_in">delAll</span>(root); </span><br><span class="line">        <span class="keyword">if</span> (root0 != <span class="literal">NULL</span>) &#123;</span><br><span class="line">            <span class="keyword">delete</span> root0;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function">Node* <span class="title">build</span><span class="params">(vector&lt;T&gt; &amp;A, <span class="type">int</span> l, <span class="type">int</span> r, Node* fa)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (l &gt; r) <span class="keyword">return</span> <span class="literal">NULL</span>;</span><br><span class="line">        <span class="type">int</span> m = (l + r) &gt;&gt; <span class="number">1</span>;</span><br><span class="line">        Node* x = <span class="built_in">newnode</span>(A[m], fa);</span><br><span class="line">        x-&gt;tag = ZERO;</span><br><span class="line">        <span class="built_in">ls</span>(x) = <span class="built_in">build</span>(A, l, m<span class="number">-1</span>, x);</span><br><span class="line">        <span class="built_in">rs</span>(x) = <span class="built_in">build</span>(A, m<span class="number">+1</span>, r, x);</span><br><span class="line">        <span class="built_in">update</span>(x);</span><br><span class="line">        <span class="keyword">return</span> x;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">pushdown</span><span class="params">(Node* x)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (!x || x == root0) <span class="keyword">return</span>;</span><br><span class="line">        <span class="keyword">if</span> (<span class="built_in">ls</span>(x)) <span class="built_in">addt</span>(<span class="built_in">ls</span>(x), x-&gt;tag, <span class="number">1</span>, <span class="built_in">size</span>(<span class="built_in">ls</span>(x))), <span class="built_in">ls</span>(x)-&gt;tag = <span class="built_in">addtt</span>(<span class="built_in">ls</span>(x)-&gt;tag, x-&gt;tag);</span><br><span class="line">        <span class="keyword">if</span> (<span class="built_in">rs</span>(x)) <span class="built_in">addt</span>(<span class="built_in">rs</span>(x), x-&gt;tag, <span class="number">1</span>, <span class="built_in">size</span>(<span class="built_in">rs</span>(x))), <span class="built_in">rs</span>(x)-&gt;tag = <span class="built_in">addtt</span>(<span class="built_in">rs</span>(x)-&gt;tag, x-&gt;tag);</span><br><span class="line">        x-&gt;tag = ZERO;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">rotate</span><span class="params">(Node* x)</span> </span>&#123;</span><br><span class="line">        Node *f = <span class="built_in">fa</span>(x), *ff = <span class="built_in">fa</span>(f); <span class="type">int</span> k = <span class="built_in">ident</span>(x);</span><br><span class="line">        <span class="keyword">if</span> (x-&gt;ch[k^<span class="number">1</span>]) <span class="built_in">connect</span>(x-&gt;ch[k^<span class="number">1</span>], f, k); </span><br><span class="line">        <span class="keyword">else</span> f-&gt;ch[k] = <span class="literal">NULL</span>;</span><br><span class="line">        <span class="built_in">connect</span>(x, ff, <span class="built_in">ident</span>(f)); </span><br><span class="line">        <span class="built_in">connect</span>(f, x, k^<span class="number">1</span>);       </span><br><span class="line">        <span class="built_in">update</span>(f); <span class="built_in">update</span>(x);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">splay</span><span class="params">(Node* x, Node* top)</span> </span>&#123;</span><br><span class="line">        Node* to = <span class="built_in">fa</span>(top); </span><br><span class="line">        <span class="keyword">while</span> (<span class="built_in">fa</span>(x) != to) &#123; </span><br><span class="line">            <span class="keyword">if</span> (<span class="built_in">fa</span>(<span class="built_in">fa</span>(x)) == to) <span class="built_in">rotate</span>(x); </span><br><span class="line">            <span class="keyword">else</span> <span class="keyword">if</span> (<span class="built_in">ident</span>(x) == <span class="built_in">ident</span>(<span class="built_in">fa</span>(x))) &#123; <span class="built_in">rotate</span>(<span class="built_in">fa</span>(x)); <span class="built_in">rotate</span>(x); &#125; </span><br><span class="line">            <span class="keyword">else</span> <span class="built_in">rotate</span>(x), <span class="built_in">rotate</span>(x);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function">Node* <span class="title">kth</span><span class="params">(<span class="type">int</span> k)</span> </span>&#123; </span><br><span class="line">        Node* x = root; <span class="type">int</span> ret = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">while</span> (<span class="literal">true</span>) &#123;</span><br><span class="line">            <span class="built_in">pushdown</span>(x);</span><br><span class="line">            <span class="type">int</span> used = x-&gt;sz - <span class="built_in">size</span>(<span class="built_in">rs</span>(x));</span><br><span class="line">            <span class="keyword">if</span> (<span class="built_in">size</span>(<span class="built_in">ls</span>(x)) &lt; k &amp;&amp; k &lt;= used) &#123; <span class="built_in">splay</span>(x, root); <span class="keyword">return</span> x; &#125;</span><br><span class="line">            <span class="keyword">if</span> (k &lt; used) x = <span class="built_in">ls</span>(x);</span><br><span class="line">            <span class="keyword">else</span> x = <span class="built_in">rs</span>(x), k -= used;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">    <span class="function"><span class="keyword">inline</span> <span class="type">void</span> <span class="title">operate</span><span class="params">(<span class="type">int</span> l, <span class="type">int</span> r, Lz lz)</span> </span>&#123;</span><br><span class="line">        Node *lx = <span class="built_in">kth</span>(l); Node *rx = <span class="built_in">kth</span>(r<span class="number">+2</span>);</span><br><span class="line">        <span class="built_in">splay</span>(lx, root); <span class="built_in">splay</span>(rx, <span class="built_in">rs</span>(lx)); Node* rt = <span class="built_in">ls</span>(rx);</span><br><span class="line">        <span class="keyword">if</span> (!rt) <span class="keyword">return</span>;</span><br><span class="line">        <span class="built_in">addt</span>(rt, lz, l, r);</span><br><span class="line">        rt-&gt;tag = <span class="built_in">addtt</span>(rt-&gt;tag, lz);</span><br><span class="line">        <span class="built_in">update</span>(rx); <span class="built_in">update</span>(lx);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">print</span><span class="params">(Node* x, <span class="type">void</span> (*myprint)(Node*))</span> </span>&#123;</span><br><span class="line">        <span class="built_in">pushdown</span>(x);</span><br><span class="line">        <span class="keyword">if</span> (!x) <span class="keyword">return</span>;</span><br><span class="line">        <span class="keyword">if</span> (x-&gt;ch[<span class="number">0</span>]) <span class="built_in">print</span>(x-&gt;ch[<span class="number">0</span>], myprint);</span><br><span class="line">        <span class="built_in">myprint</span>(x);</span><br><span class="line">        <span class="keyword">if</span> (x-&gt;ch[<span class="number">1</span>]) <span class="built_in">print</span>(x-&gt;ch[<span class="number">1</span>], myprint);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">print</span><span class="params">(<span class="type">void</span> (*myprint)(Node*) = </span></span></span><br><span class="line"><span class="params"><span class="function">        [](Node* x) &#123; <span class="keyword">if</span> (x-&gt;v != INT_MAX &amp;&amp; x-&gt;v != INT_MIN) cout &lt;&lt; x-&gt;v &lt;&lt; <span class="string">&quot; &quot;</span>; &#125;)</span> </span>&#123;</span><br><span class="line">        Node *lx = <span class="built_in">kth</span>(<span class="number">1</span>);</span><br><span class="line">        Node *rx = <span class="built_in">kth</span>(RIGHT<span class="number">+2</span>);</span><br><span class="line">        <span class="built_in">splay</span>(lx, root); </span><br><span class="line">        <span class="built_in">splay</span>(rx, <span class="built_in">rs</span>(lx)); Node* rt = <span class="built_in">ls</span>(rx);</span><br><span class="line">        <span class="keyword">if</span> (!rt) <span class="keyword">return</span>;</span><br><span class="line">        <span class="built_in">print</span>(rt, myprint); cout &lt;&lt; endl;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">insert</span><span class="params">(<span class="type">int</span> pos, vector&lt;T&gt; &amp;A)</span> </span>&#123;</span><br><span class="line">       Node *lx = <span class="built_in">kth</span>(pos<span class="number">+1</span>); Node *rx = <span class="built_in">kth</span>(pos<span class="number">+2</span>); </span><br><span class="line">       <span class="built_in">splay</span>(lx, root); <span class="built_in">splay</span>(rx, <span class="built_in">rs</span>(lx));</span><br><span class="line">       <span class="built_in">ls</span>(rx) = <span class="built_in">build</span>(A, <span class="number">1</span>, A.<span class="built_in">size</span>()<span class="number">-1</span>, rx);</span><br><span class="line">       Node* rt = <span class="built_in">ls</span>(rx);</span><br><span class="line">        <span class="built_in">update</span>(rx); <span class="built_in">update</span>(lx);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">del</span><span class="params">(<span class="type">int</span> l, <span class="type">int</span> r)</span> </span>&#123;</span><br><span class="line">        Node *lx = <span class="built_in">kth</span>(l); Node *rx = <span class="built_in">kth</span>(r<span class="number">+2</span>);</span><br><span class="line">        <span class="built_in">splay</span>(lx, root); <span class="built_in">splay</span>(rx, <span class="built_in">rs</span>(lx)); </span><br><span class="line">        <span class="built_in">delAll</span>(<span class="built_in">ls</span>(rx)); <span class="built_in">ls</span>(rx) = <span class="literal">NULL</span>;</span><br><span class="line">        Node* rt = <span class="built_in">ls</span>(rx);</span><br><span class="line">        <span class="built_in">update</span>(rx); <span class="built_in">update</span>(lx);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function">T <span class="title">query</span><span class="params">(<span class="type">int</span> l, <span class="type">int</span> r)</span> </span>&#123;</span><br><span class="line">        Node *lx = <span class="built_in">kth</span>(l); Node *rx = <span class="built_in">kth</span>(r<span class="number">+2</span>);</span><br><span class="line">        <span class="built_in">splay</span>(lx, root); <span class="built_in">splay</span>(rx, <span class="built_in">rs</span>(lx));</span><br><span class="line">        Node* rt = <span class="built_in">ls</span>(rx);</span><br><span class="line">        <span class="built_in">update</span>(rx); <span class="built_in">update</span>(lx);</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">ls</span>(rx)-&gt;v;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<h3 id="主席树">主席树</h3>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">struct</span> <span class="title class_">Persistable_SegTree</span> &#123;</span><br><span class="line">    <span class="keyword">struct</span> <span class="title class_">data</span> &#123;</span><br><span class="line">        ll minv, cnt;</span><br><span class="line">    &#125;;  </span><br><span class="line">    <span class="keyword">struct</span> <span class="title class_">lztag</span> &#123;</span><br><span class="line">        <span class="type">int</span> v;</span><br><span class="line">    &#125;;</span><br><span class="line">    <span class="keyword">typedef</span> <span class="type">int</span> T;</span><br><span class="line">    <span class="keyword">typedef</span> <span class="type">int</span> Lz;</span><br><span class="line"></span><br><span class="line">    <span class="meta">#<span class="keyword">define</span> M ((L+R)&gt;&gt;1)</span></span><br><span class="line"></span><br><span class="line">    <span class="type">int</span> LEFT, RIGHT;  <span class="comment">// 维护的区间范围</span></span><br><span class="line">    vector&lt;T&gt; sumv; <span class="comment">// 维护的值 ,=</span></span><br><span class="line"></span><br><span class="line">    vector&lt;Lz&gt; tag; <span class="comment">// 懒标记</span></span><br><span class="line">    vector&lt;<span class="type">int</span>&gt; ls, rs;</span><br><span class="line">    vector&lt;<span class="type">int</span>&gt; raw; <span class="comment">// 离散化数组</span></span><br><span class="line">    <span class="comment">// 四种操作</span></span><br><span class="line">    <span class="function">T <span class="title">add</span><span class="params">(T a, T b,<span class="type">int</span> L, <span class="type">int</span> R)</span> </span>&#123;   <span class="comment">// merge data with data</span></span><br><span class="line">        <span class="keyword">return</span> a + b;</span><br><span class="line">    &#125; </span><br><span class="line">    <span class="function">T <span class="title">addt</span><span class="params">(T a, Lz b, <span class="type">int</span> o, <span class="type">int</span> l, <span class="type">int</span> r)</span> </span>&#123; <span class="comment">// merge data with tag</span></span><br><span class="line">        <span class="keyword">if</span> (!raw.<span class="built_in">empty</span>()) l = raw[l], r = raw[r];</span><br><span class="line">        <span class="keyword">if</span> (b == INT_MAX) <span class="keyword">return</span> a;</span><br><span class="line">        <span class="keyword">return</span> (r-l<span class="number">+1</span>) *<span class="number">1ll</span> * b;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function">Lz <span class="title">addtt</span> <span class="params">(Lz a, Lz b)</span> </span>&#123; <span class="comment">// merge tag with tag</span></span><br><span class="line">        <span class="keyword">if</span> (b == INT_MAX) <span class="keyword">return</span> a;</span><br><span class="line">        <span class="keyword">return</span> b;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    T zeroT = <span class="number">0</span>;</span><br><span class="line">    Lz zeroLz = INT_MAX; <span class="comment">// 懒标记的零状态</span></span><br><span class="line">    vector&lt;<span class="type">int</span>&gt; his, ver;</span><br><span class="line">    </span><br><span class="line">    <span class="built_in">Persistable_SegTree</span>(<span class="type">int</span> left, <span class="type">int</span> right) : <span class="built_in">LEFT</span>(left), <span class="built_in">RIGHT</span>(right), <span class="built_in">sumv</span>(<span class="number">1</span>), <span class="built_in">tag</span>(<span class="number">1</span>), <span class="built_in">ls</span>(<span class="number">1</span>), <span class="built_in">rs</span>(<span class="number">1</span>), <span class="built_in">his</span>(<span class="number">1</span>), <span class="built_in">ver</span>(<span class="number">1</span>) &#123;&#125;</span><br><span class="line">    <span class="built_in">Persistable_SegTree</span>(vector&lt;<span class="type">int</span>&gt;&amp; raw) : <span class="built_in">LEFT</span>(<span class="number">1</span>), <span class="built_in">RIGHT</span>(<span class="built_in">sz</span>(raw)<span class="number">-1</span>), <span class="built_in">sumv</span>(<span class="number">1</span>), <span class="built_in">tag</span>(<span class="number">1</span>), <span class="built_in">ls</span>(<span class="number">1</span>), <span class="built_in">rs</span>(<span class="number">1</span>), <span class="built_in">raw</span>(raw), <span class="built_in">his</span>(<span class="number">1</span>), <span class="built_in">ver</span>(<span class="number">1</span>) &#123;&#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">inline</span> <span class="type">int</span> <span class="title">getpos</span><span class="params">(<span class="type">int</span> x)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">lower_bound</span>(raw.<span class="built_in">begin</span>(), raw.<span class="built_in">end</span>(), x) - raw.<span class="built_in">begin</span>();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">inline</span> <span class="type">void</span> <span class="title">pushdown</span><span class="params">(<span class="type">int</span> o, <span class="type">int</span> L, <span class="type">int</span> R)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (L != R) <span class="built_in">newnode</span>(o);</span><br><span class="line">        <span class="keyword">if</span> (L == R || tag[o] == zeroLz) <span class="keyword">return</span>;</span><br><span class="line">        sumv[ls[o]] = <span class="built_in">addt</span>(sumv[ls[o]], tag[o],o, L, M);</span><br><span class="line">        sumv[rs[o]] = <span class="built_in">addt</span>(sumv[rs[o]], tag[o],o, M<span class="number">+1</span>, R);</span><br><span class="line">        tag[ls[o]] = <span class="built_in">addtt</span>(tag[ls[o]], tag[o]);</span><br><span class="line">        tag[rs[o]] = <span class="built_in">addtt</span>(tag[rs[o]], tag[o]);</span><br><span class="line">        tag[o] = zeroLz; </span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">inline</span> <span class="type">void</span> <span class="title">newnode</span><span class="params">(<span class="type">int</span> o)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (!ls[o])&#123;</span><br><span class="line">            ls[o] = <span class="built_in">addnode</span>(ver[o]); rs[o] = <span class="built_in">addnode</span>(ver[o]);</span><br><span class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span> (ver[ls[o]] != ver[o]) &#123;</span><br><span class="line">            ls[o] = <span class="built_in">addnode</span>(ver[o], ls[o]);</span><br><span class="line">            rs[o] = <span class="built_in">addnode</span>(ver[o], rs[o]);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">inline</span> <span class="type">int</span> <span class="title">addnode</span><span class="params">(<span class="type">int</span> v, <span class="type">int</span> o=<span class="number">-1</span>)</span> </span>&#123;</span><br><span class="line">        sumv.<span class="built_in">push_back</span>(zeroT);</span><br><span class="line">        tag.<span class="built_in">push_back</span>(zeroLz);</span><br><span class="line">        ls.<span class="built_in">push_back</span>(<span class="number">0</span>);</span><br><span class="line">        rs.<span class="built_in">push_back</span>(<span class="number">0</span>);</span><br><span class="line">        ver.<span class="built_in">push_back</span>(v);</span><br><span class="line">        <span class="keyword">if</span> (o != <span class="number">-1</span>) &#123;</span><br><span class="line">            sumv.<span class="built_in">back</span>() = sumv[o];</span><br><span class="line">            tag.<span class="built_in">back</span>() = tag[o];</span><br><span class="line">            ls.<span class="built_in">back</span>() = ls[o];</span><br><span class="line">            rs.<span class="built_in">back</span>() = rs[o];</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">sz</span>(sumv)<span class="number">-1</span>;</span><br><span class="line">    &#125;</span><br><span class="line">	<span class="comment">// tim version based on, c: create new version</span></span><br><span class="line">    <span class="function"><span class="keyword">inline</span> <span class="type">void</span> <span class="title">update</span><span class="params">(<span class="type">int</span> x, <span class="type">int</span> y, Lz val,<span class="type">int</span> tim=<span class="number">-1</span>,<span class="type">bool</span> c = <span class="literal">true</span>, <span class="type">int</span> o=<span class="number">0</span>, <span class="type">int</span> L=<span class="number">1</span>, <span class="type">int</span> R=<span class="number">-1</span>)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (R == <span class="number">-1</span>) &#123;</span><br><span class="line">            L = LEFT; R = RIGHT; </span><br><span class="line">            <span class="keyword">if</span> (!raw.<span class="built_in">empty</span>()) x = <span class="built_in">getpos</span>(x)<span class="number">+1</span>, y = <span class="built_in">getpos</span>(y); </span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> (x &lt;= L &amp;&amp; R &lt;= y) sumv[o] = <span class="built_in">addt</span>(sumv[o], val,o, L, R), tag[o] = <span class="built_in">addtt</span>(tag[o], val);</span><br><span class="line">        <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="keyword">if</span> (L == LEFT &amp;&amp; R == RIGHT) &#123;</span><br><span class="line">                <span class="keyword">if</span> (tim == <span class="number">-1</span>) tim = <span class="built_in">sz</span>(his)<span class="number">-1</span>;</span><br><span class="line">                <span class="keyword">if</span> (c) &#123;</span><br><span class="line">                    o = <span class="built_in">addnode</span>(<span class="built_in">sz</span>(his), his[tim]);</span><br><span class="line">                    his.<span class="built_in">push_back</span>(o);    </span><br><span class="line">                &#125; <span class="keyword">else</span> o = his[tim];</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="built_in">pushdown</span>(o, L, R);</span><br><span class="line">            <span class="keyword">if</span> (x &lt;= M) <span class="built_in">update</span>(x, y, val,tim,c, ls[o], L, M);</span><br><span class="line">            <span class="keyword">if</span> (y &gt; M) <span class="built_in">update</span>(x, y, val,tim,c, rs[o], M<span class="number">+1</span>, R);</span><br><span class="line">            sumv[o] = <span class="built_in">add</span>(sumv[ls[o]], sumv[rs[o]],L,R); </span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">inline</span> T <span class="title">query</span><span class="params">(<span class="type">int</span> x=<span class="number">-1</span>, <span class="type">int</span> y=<span class="number">-1</span>,<span class="type">int</span> tim=<span class="number">-1</span>,<span class="type">bool</span> c=<span class="literal">true</span>,  <span class="type">int</span> o=<span class="number">0</span>, <span class="type">int</span> L=<span class="number">1</span>, <span class="type">int</span> R=<span class="number">-1</span>)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (R == <span class="number">-1</span>) &#123;</span><br><span class="line">            L = LEFT; R = RIGHT; </span><br><span class="line">            <span class="keyword">if</span> (x==<span class="number">-1</span>) x=LEFT,y=RIGHT; </span><br><span class="line">            <span class="keyword">else</span> <span class="keyword">if</span> (!raw.<span class="built_in">empty</span>()) x = <span class="built_in">getpos</span>(x)<span class="number">+1</span>, y = <span class="built_in">getpos</span>(y); </span><br><span class="line">        &#125;</span><br><span class="line">         <span class="keyword">if</span> (L == LEFT &amp;&amp; R == RIGHT) &#123;</span><br><span class="line">            <span class="keyword">if</span> (tim == <span class="number">-1</span>) tim = <span class="built_in">sz</span>(his)<span class="number">-1</span>;</span><br><span class="line">            <span class="keyword">if</span> (c) &#123;</span><br><span class="line">                o = <span class="built_in">addnode</span>(<span class="built_in">sz</span>(his), his[tim]);</span><br><span class="line">                his.<span class="built_in">push_back</span>(o);    </span><br><span class="line">            &#125; <span class="keyword">else</span> o = his[tim];</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="built_in">pushdown</span>(o, L, R);</span><br><span class="line">        <span class="keyword">if</span> (x &lt;= L &amp;&amp; R &lt;= y) <span class="keyword">return</span> sumv[o];</span><br><span class="line">        <span class="keyword">else</span> <span class="keyword">if</span> (x &lt;= M &amp;&amp; y &gt; M) <span class="keyword">return</span> <span class="built_in">add</span>(<span class="built_in">query</span>(x, M, ls[o], L, M), <span class="built_in">query</span>(M<span class="number">+1</span>, y, rs[o], M<span class="number">+1</span>, R),L,R);</span><br><span class="line">        <span class="keyword">else</span> <span class="keyword">if</span> (x &lt;= M)  <span class="keyword">return</span> <span class="built_in">query</span>(x, y, tim,c, ls[o], L, M);</span><br><span class="line">        <span class="keyword">else</span> <span class="keyword">return</span> <span class="built_in">query</span>(x, y, tim,c, rs[o], M<span class="number">+1</span>, R); </span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<h3 id="红黑树pbds">红黑树PBDS</h3>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line">/by shenben</span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;cstdio&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;bits/extc++.h&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> __gnu_pbds;</span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"><span class="keyword">typedef</span> <span class="type">long</span> <span class="type">long</span> ll;</span><br><span class="line">tree&lt;ll,null_type,less&lt;ll&gt;,rb_tree_tag,tree_order_statistics_node_update&gt; bbt;</span><br><span class="line"><span class="type">int</span> n;ll k,ans;</span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">int</span> <span class="title">read</span><span class="params">()</span></span>&#123;</span><br><span class="line">    <span class="type">int</span> x=<span class="number">0</span>,f=<span class="number">1</span>;<span class="type">char</span> ch=<span class="built_in">getchar</span>();</span><br><span class="line">    <span class="keyword">while</span>(ch&lt;<span class="string">&#x27;0&#x27;</span>||ch&gt;<span class="string">&#x27;9&#x27;</span>)&#123;<span class="keyword">if</span>(ch==<span class="string">&#x27;-&#x27;</span>)f=<span class="number">-1</span>;ch=<span class="built_in">getchar</span>();&#125;</span><br><span class="line">    <span class="keyword">while</span>(ch&gt;=<span class="string">&#x27;0&#x27;</span>&amp;&amp;ch&lt;=<span class="string">&#x27;9&#x27;</span>)&#123;x=x*<span class="number">10</span>+ch-<span class="string">&#x27;0&#x27;</span>;ch=<span class="built_in">getchar</span>();&#125;</span><br><span class="line">    <span class="keyword">return</span> x*f;</span><br><span class="line">&#125; </span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line">    n=<span class="built_in">read</span>();</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">1</span>,opt;i&lt;=n;i++)&#123;</span><br><span class="line">        opt=<span class="built_in">read</span>();k=<span class="built_in">read</span>();</span><br><span class="line">        <span class="keyword">if</span>(opt==<span class="number">1</span>) bbt.<span class="built_in">insert</span>((k&lt;&lt;<span class="number">20</span>)+i);</span><br><span class="line">        <span class="keyword">if</span>(opt==<span class="number">2</span>) bbt.<span class="built_in">erase</span>(bbt.<span class="built_in">lower_bound</span>(k&lt;&lt;<span class="number">20</span>));</span><br><span class="line">        <span class="keyword">if</span>(opt==<span class="number">3</span>) <span class="built_in">printf</span>(<span class="string">&quot;%d\n&quot;</span>,bbt.<span class="built_in">order_of_key</span>(k&lt;&lt;<span class="number">20</span>)<span class="number">+1</span>);</span><br><span class="line">        <span class="keyword">if</span>(opt==<span class="number">4</span>) ans=*bbt.<span class="built_in">find_by_order</span>(k<span class="number">-1</span>),<span class="built_in">printf</span>(<span class="string">&quot;%lld\n&quot;</span>,ans&gt;&gt;<span class="number">20</span>);</span><br><span class="line">        <span class="keyword">if</span>(opt==<span class="number">5</span>) ans=*--bbt.<span class="built_in">lower_bound</span>(k&lt;&lt;<span class="number">20</span>),<span class="built_in">printf</span>(<span class="string">&quot;%lld\n&quot;</span>,ans&gt;&gt;<span class="number">20</span>);</span><br><span class="line">        <span class="keyword">if</span>(opt==<span class="number">6</span>) ans=*bbt.<span class="built_in">upper_bound</span>((k&lt;&lt;<span class="number">20</span>)+n),<span class="built_in">printf</span>(<span class="string">&quot;%lld\n&quot;</span>,ans&gt;&gt;<span class="number">20</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="哈希表pbds">哈希表pbds</h3>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">gp_hash_table&lt;<span class="type">int</span>,<span class="type">bool</span>&gt; h;</span><br></pre></td></tr></table></figure>
<h3 id="莫队">莫队</h3>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">struct</span> <span class="title class_">Mo</span> &#123;</span><br><span class="line">    <span class="keyword">typedef</span> <span class="type">int</span> T; <span class="comment">// 答案的类型</span></span><br><span class="line"> </span><br><span class="line">    <span class="type">int</span> l = <span class="number">1</span>, r = <span class="number">0</span>; </span><br><span class="line">    T cur; <span class="comment">// 当前答案</span></span><br><span class="line"> </span><br><span class="line">    <span class="function"><span class="keyword">inline</span> <span class="type">void</span> <span class="title">init</span><span class="params">()</span> </span>&#123; <span class="comment">// 计算初始情况</span></span><br><span class="line">        cur = <span class="number">0</span>;</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">    <span class="function"><span class="keyword">inline</span> <span class="type">void</span> <span class="title">Add</span><span class="params">(<span class="type">int</span> x)</span> </span>&#123; <span class="comment">// 增加一个元素,位置为x</span></span><br><span class="line">        cnt[A[x]]++;</span><br><span class="line">        <span class="keyword">if</span> (cnt[A[x]] == <span class="number">1</span>) cur++;</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">    <span class="function"><span class="keyword">inline</span> <span class="type">void</span> <span class="title">Sub</span><span class="params">(<span class="type">int</span> x)</span> </span>&#123; <span class="comment">// 减少一个元素</span></span><br><span class="line">        cnt[A[x]]--;</span><br><span class="line">        <span class="keyword">if</span> (cnt[A[x]] == <span class="number">0</span>) cur--;</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">    <span class="function"><span class="keyword">inline</span> <span class="type">void</span> <span class="title">getanswer</span><span class="params">(<span class="type">int</span> l, <span class="type">int</span> r, <span class="type">int</span> k, <span class="type">int</span> id)</span> </span>&#123;</span><br><span class="line">        ans[id] = cur;</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">    <span class="keyword">struct</span> <span class="title class_">Q</span> &#123;</span><br><span class="line">        <span class="type">int</span> l, r, k, id;</span><br><span class="line">    &#125;;</span><br><span class="line"> </span><br><span class="line">    vector&lt;Q&gt; qes;</span><br><span class="line">    <span class="type">int</span> m = <span class="number">0</span>, siz = <span class="number">0</span>;</span><br><span class="line"> </span><br><span class="line">    <span class="built_in">Mo</span>() &#123;&#125;</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">inline</span> <span class="type">void</span> <span class="title">addquery</span><span class="params">(<span class="type">int</span> l,<span class="type">int</span> r,<span class="type">int</span> id)</span> </span>&#123;</span><br><span class="line">        qes.<span class="built_in">push_back</span>(&#123;l, r, m++,id&#125;);</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">calc</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        siz = <span class="built_in">sqrt</span>(m); </span><br><span class="line">        <span class="built_in">sort</span>(qes.<span class="built_in">begin</span>(), qes.<span class="built_in">end</span>(), [&amp;](Q a, Q b) &#123;</span><br><span class="line">            <span class="keyword">return</span> a.l/siz == b.l/siz ? a.r &lt; b.r : a.l/siz &lt; b.l/siz;</span><br><span class="line">        &#125;);</span><br><span class="line">        <span class="built_in">init</span>();</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">auto</span>&amp; [ql, qr, ind, id] : qes) &#123;</span><br><span class="line">            <span class="keyword">while</span> (ql &lt; l) <span class="built_in">Add</span>(--l);</span><br><span class="line">            <span class="keyword">while</span> (qr &gt; r) <span class="built_in">Add</span>(++r);</span><br><span class="line">            <span class="keyword">while</span> (ql &gt; l) <span class="built_in">Sub</span>(l++);</span><br><span class="line">            <span class="keyword">while</span> (qr &lt; r) <span class="built_in">Sub</span>(r--);</span><br><span class="line">            <span class="built_in">getanswer</span>(l, r, ind, id);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<h2 id="图论">图论</h2>
<h3 id="拓扑排序">拓扑排序</h3>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">struct</span> <span class="title class_">Topo</span> &#123; <span class="comment">// index from 1</span></span><br><span class="line">    <span class="type">int</span> t, ok=<span class="number">1</span>; <span class="comment">// ok is whether there is a cycle</span></span><br><span class="line">    vector&lt;<span class="type">int</span>&gt; topo, c; <span class="comment">// sorted in topo(1..n)</span></span><br><span class="line">    vector&lt;<span class="type">int</span>&gt; s, cycle; <span class="comment">// give cycle if false</span></span><br><span class="line">    <span class="built_in">Topo</span>(<span class="type">int</span> n) : <span class="built_in">t</span>(n<span class="number">+1</span>),<span class="built_in">topo</span>(n<span class="number">+1</span>),<span class="built_in">c</span>(n<span class="number">+1</span>)  &#123;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">1</span>;i &lt;= n; ++i,s.<span class="built_in">clear</span>()) </span><br><span class="line">            <span class="keyword">if</span> (ok &amp;&amp; !c[i] &amp;&amp; !<span class="built_in">dfs</span>(i)) ok = <span class="number">0</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="type">bool</span> <span class="title">dfs</span><span class="params">(<span class="type">int</span> x)</span> </span>&#123;</span><br><span class="line">        c[x] = <span class="number">-1</span>; s.<span class="built_in">push_back</span>(x);</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">auto</span> v : G[x]) &#123;</span><br><span class="line">            <span class="keyword">if</span> (c[v] &lt; <span class="number">0</span>) &#123;</span><br><span class="line">                s.<span class="built_in">erase</span>(s.<span class="built_in">begin</span>(), <span class="built_in">find</span>(s.<span class="built_in">begin</span>(), s.<span class="built_in">end</span>(),v)), cycle = s; </span><br><span class="line">                <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">else</span> <span class="keyword">if</span> (!c[v] &amp;&amp; !<span class="built_in">dfs</span>(v)) <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        c[x] = <span class="number">1</span>; topo[--t] = x; s.<span class="built_in">pop_back</span>();</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<h3 id="二分图染色">二分图染色</h3>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">vector&lt;<span class="type">int</span>&gt; G[maxn];</span><br><span class="line"><span class="type">int</span> col[maxn];</span><br><span class="line"><span class="function"><span class="type">bool</span> <span class="title">dfs</span><span class="params">(<span class="type">int</span> x,<span class="type">int</span> c)</span> </span>&#123;</span><br><span class="line">    col[x] = c;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">auto</span> v : G[x]) &#123;</span><br><span class="line">        <span class="keyword">if</span> (col[v] &amp;&amp; col[v] != <span class="number">3</span> - c) <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">        <span class="keyword">if</span> (!col[v] &amp;&amp; !<span class="built_in">dfs</span>(v, <span class="number">3</span> - c)) <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// main</span></span><br><span class="line"><span class="type">int</span> ok = <span class="number">1</span>;</span><br><span class="line"><span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">1</span>;i &lt;= n; ++i) &#123;</span><br><span class="line">    <span class="keyword">if</span> (!col[i] &amp;&amp; !<span class="built_in">dfs</span>(i, <span class="number">1</span>)) &#123;</span><br><span class="line">        ok = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="搜简单环">搜简单环</h3>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line">vector&lt;<span class="type">int</span>&gt; ring;</span><br><span class="line">vector&lt;<span class="type">int</span>&gt; st = &#123;<span class="number">0</span>&#125;;</span><br><span class="line"><span class="type">int</span> vis[maxn];</span><br><span class="line">vector&lt;<span class="type">int</span>&gt; G[maxn];</span><br><span class="line"> </span><br><span class="line"><span class="function"><span class="type">bool</span> <span class="title">dfs</span><span class="params">(<span class="type">int</span> x)</span> </span>&#123;</span><br><span class="line">    vis[x] = <span class="number">-1</span>;</span><br><span class="line">    st.<span class="built_in">push_back</span>(x);</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">auto</span> v : G[x]) &#123;</span><br><span class="line">        <span class="keyword">if</span> (vis[v] == <span class="number">-1</span> &amp;&amp; v != st[<span class="built_in">sz</span>(st)<span class="number">-2</span>]) &#123;</span><br><span class="line">            <span class="keyword">while</span> (st.<span class="built_in">back</span>() != v) &#123;</span><br><span class="line">                ring.<span class="built_in">push_back</span>(st.<span class="built_in">back</span>());</span><br><span class="line">                st.<span class="built_in">pop_back</span>();</span><br><span class="line">            &#125;</span><br><span class="line">            ring.<span class="built_in">push_back</span>(v);</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span> <span class="keyword">if</span> (!vis[v] &amp;&amp; <span class="built_in">dfs</span>(v)) <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    st.<span class="built_in">pop_back</span>();</span><br><span class="line">    vis[x] = <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// main</span></span><br><span class="line"><span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">1</span>;i &lt;= n; ++i) &#123;</span><br><span class="line">    st = &#123;<span class="number">0</span>&#125;;</span><br><span class="line">    <span class="keyword">if</span> (ring.<span class="built_in">empty</span>()) <span class="built_in">dfs</span>(i);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">if</span> (ring.<span class="built_in">empty</span>()) &#123;</span><br><span class="line">    cout &lt;&lt; <span class="string">&quot;IMPOSSIBLE\n&quot;</span>;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="spfabellman求负环">SPFA,Bellman求负环</h3>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br></pre></td><td class="code"><pre><span class="line"><span class="function">vector&lt;<span class="type">int</span>&gt; <span class="title">negCycle</span><span class="params">(<span class="type">int</span> n)</span> </span>&#123;</span><br><span class="line">    <span class="function">vector&lt;ll&gt; <span class="title">d</span><span class="params">(n<span class="number">+1</span>, <span class="number">1e18</span>)</span>, <span class="title">p</span><span class="params">(n<span class="number">+1</span>)</span></span>;</span><br><span class="line">    d[<span class="number">1</span>] = <span class="number">0</span>; <span class="type">int</span> y = <span class="number">-1</span>;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">1</span>;i &lt;= n; ++i) &#123;</span><br><span class="line">        y = <span class="number">-1</span>;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> x = <span class="number">1</span>;x &lt;= n; ++x) <span class="keyword">for</span> (<span class="keyword">auto</span> [v, len] : G[x]) </span><br><span class="line">            <span class="keyword">if</span> (d[v] &gt; d[x] + len) </span><br><span class="line">                d[v] = d[x] + len, p[v] = x, y = v;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (y == <span class="number">-1</span>) <span class="keyword">return</span> &#123;&#125;;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">1</span>;i &lt;= n; ++i) y = p[y];</span><br><span class="line">    vector&lt;<span class="type">int</span>&gt; ret;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> v = y; v != y || ret.<span class="built_in">empty</span>(); v = p[v]) ret.<span class="built_in">push_back</span>(v);</span><br><span class="line">    <span class="built_in">reverse</span>(ret.<span class="built_in">begin</span>(),ret.<span class="built_in">end</span>());</span><br><span class="line">    <span class="keyword">return</span> ret;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">SPFA</span> &#123;</span><br><span class="line">    <span class="type">int</span> n, m; </span><br><span class="line">    <span class="keyword">struct</span> <span class="title class_">Node</span> &#123;</span><br><span class="line">        <span class="type">int</span> v; ll len;</span><br><span class="line">    &#125;;</span><br><span class="line">    vector&lt;vector&lt;Node&gt;&gt; G;</span><br><span class="line">    vector&lt;ll&gt; d;</span><br><span class="line"></span><br><span class="line">    <span class="built_in">SPFA</span>(<span class="type">int</span> n, <span class="type">int</span> m) : <span class="built_in">n</span>(n), <span class="built_in">m</span>(m), <span class="built_in">G</span>(n<span class="number">+1</span>) &#123;&#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">addedge</span><span class="params">(<span class="type">int</span> x, <span class="type">int</span> y, ll val)</span> </span>&#123;</span><br><span class="line">        G[x].<span class="built_in">push_back</span>(&#123;y, val&#125;);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="type">bool</span> <span class="title">calc</span><span class="params">(<span class="type">int</span> s)</span> </span>&#123;</span><br><span class="line">        queue&lt;<span class="type">int</span>&gt; Q;</span><br><span class="line">        <span class="function">vector&lt;<span class="type">bool</span>&gt; <span class="title">inq</span><span class="params">(n<span class="number">+1</span>)</span></span>;</span><br><span class="line">        <span class="function">vector&lt;<span class="type">int</span>&gt; <span class="title">cnt</span><span class="params">(n<span class="number">+1</span>)</span></span>;</span><br><span class="line">        d = <span class="built_in">vector</span>&lt;ll&gt;(n<span class="number">+1</span>, <span class="number">1e18</span>);</span><br><span class="line">        Q.<span class="built_in">push</span>(s); inq[s] = <span class="literal">true</span>; d[s] = <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">while</span>(!Q.<span class="built_in">empty</span>()) &#123;</span><br><span class="line">            <span class="type">int</span> x = Q.<span class="built_in">front</span>(); Q.<span class="built_in">pop</span>();</span><br><span class="line">            inq[x] = <span class="literal">false</span>;</span><br><span class="line">            <span class="keyword">for</span> (<span class="keyword">auto</span> [v, len] : G[x]) &#123;</span><br><span class="line">                <span class="keyword">if</span> (d[v] &gt; d[x] + len) &#123;</span><br><span class="line">                    d[v] = d[x] + len;</span><br><span class="line">                    <span class="keyword">if</span> (!inq[v]) &#123; </span><br><span class="line">                        cnt[v]++; </span><br><span class="line">                        <span class="keyword">if</span> (cnt[v] &gt;= n) <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">                        Q.<span class="built_in">push</span>(v); inq[v] = <span class="literal">true</span>; </span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<h3 id="dijkstra">Dijkstra</h3>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">struct</span> <span class="title class_">Dijkstra</span> &#123;</span><br><span class="line">    vector&lt;vector&lt;pair&lt;<span class="type">int</span>, ll&gt;&gt;&gt; G;</span><br><span class="line">    vector&lt;ll&gt; d;</span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">addedge</span><span class="params">(<span class="type">int</span> x, <span class="type">int</span> y, ll val)</span> </span>&#123; </span><br><span class="line">        <span class="keyword">if</span> (<span class="built_in">sz</span>(G) &lt;= <span class="built_in">max</span>(x,y)) &#123;</span><br><span class="line">            G.<span class="built_in">resize</span>(<span class="built_in">max</span>(x,y)<span class="number">+1</span>);</span><br><span class="line">            d.<span class="built_in">resize</span>(<span class="built_in">max</span>(x,y)<span class="number">+1</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        G[x].<span class="built_in">push_back</span>(&#123;y, val&#125;); </span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">calc</span><span class="params">(<span class="type">int</span> s)</span> </span>&#123;</span><br><span class="line">        priority_queue&lt;pair&lt;ll, <span class="type">int</span>&gt;, vector&lt;pair&lt;ll, <span class="type">int</span>&gt;&gt;, greater&lt;pair&lt;ll, <span class="type">int</span>&gt;&gt;&gt; Q;</span><br><span class="line">        <span class="type">int</span> n = <span class="built_in">sz</span>(G)<span class="number">-1</span>;</span><br><span class="line">        <span class="function">vector&lt;<span class="type">bool</span>&gt; <span class="title">done</span><span class="params">(n<span class="number">+1</span>)</span></span>;</span><br><span class="line">        d.<span class="built_in">assign</span>(n<span class="number">+1</span>, <span class="number">1e18</span>); d[s] = <span class="number">0</span>;</span><br><span class="line">        Q.<span class="built_in">push</span>(&#123;d[s], s&#125;);</span><br><span class="line">        <span class="keyword">while</span>(!Q.<span class="built_in">empty</span>()) &#123;</span><br><span class="line">            <span class="type">int</span> x = Q.<span class="built_in">top</span>().second; Q.<span class="built_in">pop</span>();</span><br><span class="line">            <span class="keyword">if</span> (done[x]) <span class="keyword">continue</span>; <span class="keyword">else</span> done[x] = <span class="literal">true</span>;</span><br><span class="line">            <span class="keyword">for</span> (<span class="keyword">auto</span> [v, len] : G[x]) <span class="keyword">if</span> (d[v] &gt; d[x] + len) &#123;</span><br><span class="line">                d[v] = d[x] + len;</span><br><span class="line">                Q.<span class="built_in">push</span>(&#123;d[v], v&#125;);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<h3 id="k短路">k短路</h3>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">vector&lt;pair&lt;<span class="type">int</span>,ll&gt;&gt; G[maxn];</span><br><span class="line"><span class="function">vector&lt;ll&gt; <span class="title">kShortestPath</span><span class="params">(<span class="type">int</span> n, <span class="type">int</span> s,<span class="type">int</span> t, <span class="type">int</span> k)</span> </span>&#123;</span><br><span class="line">    <span class="function">vector&lt;ll&gt; <span class="title">d</span><span class="params">(n<span class="number">+1</span>, <span class="number">1e18</span>)</span>, ans</span>; d[s] = <span class="number">0</span>;</span><br><span class="line">    <span class="function">vector&lt;<span class="type">int</span>&gt; <span class="title">done</span><span class="params">(n<span class="number">+1</span>)</span>, <span class="title">cnt</span><span class="params">(n<span class="number">+1</span>)</span></span>;</span><br><span class="line">    priority_queue&lt;pair&lt;ll,<span class="type">int</span>&gt;,vector&lt;pair&lt;ll,<span class="type">int</span>&gt;&gt;,greater&lt;pair&lt;ll,<span class="type">int</span>&gt;&gt;&gt; q;</span><br><span class="line">    q.<span class="built_in">push</span>(&#123;d[s],s&#125;);</span><br><span class="line">    <span class="keyword">while</span> (!q.<span class="built_in">empty</span>()) &#123;</span><br><span class="line">        <span class="type">int</span> x = q.<span class="built_in">top</span>().second; q.<span class="built_in">pop</span>();</span><br><span class="line">        <span class="keyword">if</span> (done[x]) <span class="keyword">continue</span>; <span class="keyword">else</span> done[x] = <span class="number">1</span>;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">auto</span> [v,len] : G[x]) <span class="keyword">if</span> (d[v] &gt; d[x] + len) </span><br><span class="line">            d[v] = d[x] + len, q.<span class="built_in">push</span>(&#123;d[v],v&#125;);</span><br><span class="line">    &#125;</span><br><span class="line">    q.<span class="built_in">push</span>(&#123;d[s],s&#125;);</span><br><span class="line">    <span class="keyword">while</span> (!q.<span class="built_in">empty</span>()) &#123;</span><br><span class="line">        <span class="keyword">auto</span> [pl,x] = q.<span class="built_in">top</span>(); q.<span class="built_in">pop</span>();</span><br><span class="line">        <span class="keyword">if</span> (++cnt[x] &gt; k) <span class="keyword">continue</span>;</span><br><span class="line">        <span class="keyword">if</span> (x == t) ans.<span class="built_in">push_back</span>(pl);</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">auto</span> [v,len] : G[x]) q.<span class="built_in">push</span>(&#123;pl+len, v&#125;);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">sort</span>(ans.<span class="built_in">begin</span>(),ans.<span class="built_in">end</span>());</span><br><span class="line">    <span class="keyword">return</span> ans;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="势能dijkstra">势能Dijkstra</h4>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">struct</span> <span class="title class_">Dijkstra</span> &#123;    </span><br><span class="line">    <span class="function"><span class="keyword">inline</span> <span class="type">static</span> ll <span class="title">phi</span><span class="params">(<span class="type">int</span> i)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> H[i];</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="type">int</span> n; </span><br><span class="line">    vector&lt;vector&lt;pair&lt;<span class="type">int</span>, ll&gt;&gt;&gt; G;</span><br><span class="line">    vector&lt;ll&gt; d;</span><br><span class="line">    <span class="built_in">Dijkstra</span>(<span class="type">int</span> n) : <span class="built_in">n</span>(n<span class="number">+1</span>), <span class="built_in">G</span>(n<span class="number">+1</span>) &#123;&#125;</span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">addedge</span><span class="params">(<span class="type">int</span> x, <span class="type">int</span> y, ll val)</span> </span>&#123; G[x].<span class="built_in">push_back</span>(&#123;y, val + <span class="built_in">phi</span>(x) - <span class="built_in">phi</span>(y)&#125;); &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">calc</span><span class="params">(<span class="type">int</span> s)</span> </span>&#123;</span><br><span class="line">        priority_queue&lt;pair&lt;ll, <span class="type">int</span>&gt;, vector&lt;pair&lt;ll, <span class="type">int</span>&gt;&gt;, greater&lt;pair&lt;ll, <span class="type">int</span>&gt;&gt;&gt; Q;</span><br><span class="line">        <span class="function">vector&lt;<span class="type">bool</span>&gt; <span class="title">done</span><span class="params">(n<span class="number">+1</span>)</span></span>;</span><br><span class="line">        d.<span class="built_in">assign</span>(n<span class="number">+1</span>, <span class="number">1e18</span>); d[s] = <span class="number">0</span>;</span><br><span class="line">        Q.<span class="built_in">push</span>(&#123;d[s], s&#125;);</span><br><span class="line">        <span class="keyword">while</span>(!Q.<span class="built_in">empty</span>()) &#123;</span><br><span class="line">            <span class="type">int</span> x = Q.<span class="built_in">top</span>().second; Q.<span class="built_in">pop</span>();</span><br><span class="line">            <span class="keyword">if</span> (done[x]) <span class="keyword">continue</span>; <span class="keyword">else</span> done[x] = <span class="literal">true</span>;</span><br><span class="line">            <span class="keyword">for</span> (<span class="keyword">auto</span> [v, len] : G[x]) <span class="keyword">if</span> (d[v] &gt; d[x] + len) &#123;</span><br><span class="line">                d[v] = d[x] + len;</span><br><span class="line">                Q.<span class="built_in">push</span>(&#123;d[v], v&#125;);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>;i &lt;= n; ++i) &#123;</span><br><span class="line">            d[i] -= <span class="built_in">phi</span>(s) - <span class="built_in">phi</span>(i);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<h3 id="floyd">Floyd</h3>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// init: d[i][j] = len(i, j); d[i][i] = 0; else = INF</span></span><br><span class="line"><span class="keyword">for</span> (<span class="type">int</span> k = <span class="number">1</span>;k &lt;= n; ++k) </span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">1</span>;i &lt;= n; ++i) </span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> j = <span class="number">1</span>;j &lt;= n; ++j) </span><br><span class="line">            d[i][j] = <span class="built_in">min</span>(d[i][j], d[i][k] + d[k][j]);</span><br></pre></td></tr></table></figure>
<h3 id="johnson全源最短路">Johnson全源最短路</h3>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">struct</span> <span class="title class_">Johnson</span> &#123;</span><br><span class="line">    <span class="type">int</span> tot, n; </span><br><span class="line">    <span class="keyword">struct</span> <span class="title class_">Node</span> &#123;</span><br><span class="line">        <span class="type">int</span> nxt, v; ll len;</span><br><span class="line">    &#125;;</span><br><span class="line">    vector&lt;Node&gt; edges;</span><br><span class="line">    vector&lt;<span class="type">int</span>&gt; head;</span><br><span class="line">    vector&lt;ll&gt; h;</span><br><span class="line">    vector&lt;vector&lt;ll&gt;&gt; d;</span><br><span class="line"></span><br><span class="line">    <span class="built_in">Johnson</span>(<span class="type">int</span> tn) &#123;</span><br><span class="line">        n = tn, tot = <span class="number">0</span>;</span><br><span class="line">        head = <span class="built_in">vector</span>&lt;<span class="type">int</span>&gt;(tn<span class="number">+2</span>, <span class="number">-1</span>);</span><br><span class="line">        h = <span class="built_in">vector</span>&lt;ll&gt;(tn<span class="number">+2</span>);</span><br><span class="line">        d = vector&lt;vector&lt;ll&gt;&gt;(n<span class="number">+2</span>, <span class="built_in">vector</span>&lt;ll&gt;(n<span class="number">+2</span>, <span class="number">1e18</span>));</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">addedge</span><span class="params">(<span class="type">int</span> x, <span class="type">int</span> y, ll val)</span> </span>&#123;</span><br><span class="line">        edges.<span class="built_in">push_back</span>(&#123;head[x], y, val&#125;);</span><br><span class="line">        head[x] = <span class="built_in">sz</span>(edges)<span class="number">-1</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="type">bool</span> <span class="title">neg</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">1</span>;i &lt;= n; ++i) &#123;</span><br><span class="line">            <span class="built_in">addedge</span>(n<span class="number">+1</span>, i, <span class="number">0</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        queue&lt;<span class="type">int</span>&gt; Q;</span><br><span class="line">        <span class="function">vector&lt;<span class="type">bool</span>&gt; <span class="title">inq</span><span class="params">(n<span class="number">+2</span>)</span></span>;</span><br><span class="line">        <span class="function">vector&lt;<span class="type">int</span>&gt; <span class="title">cnt</span><span class="params">(n<span class="number">+2</span>)</span></span>; <span class="type">int</span> s = n<span class="number">+1</span>;</span><br><span class="line">        Q.<span class="built_in">push</span>(s); inq[s] = <span class="literal">true</span>; d[s][s] = <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">while</span>(!Q.<span class="built_in">empty</span>()) &#123;</span><br><span class="line">            <span class="type">int</span> x = Q.<span class="built_in">front</span>(); Q.<span class="built_in">pop</span>();</span><br><span class="line">            inq[x] = <span class="literal">false</span>;</span><br><span class="line">            <span class="keyword">for</span> (<span class="type">int</span> i = head[x]; ~i; i = edges[i].nxt) &#123;</span><br><span class="line">                <span class="type">int</span> v = edges[i].v; ll len = edges[i].len;</span><br><span class="line">                <span class="keyword">if</span> (d[s][v] &gt; d[s][x] + len) &#123;</span><br><span class="line">                    d[s][v] = d[s][x] + len;</span><br><span class="line">                    <span class="keyword">if</span> (!inq[v]) &#123; </span><br><span class="line">                        cnt[v]++; </span><br><span class="line">                        <span class="keyword">if</span> (cnt[v] &gt;= n<span class="number">+1</span>) <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">                        Q.<span class="built_in">push</span>(v); inq[v] = <span class="literal">true</span>; </span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">1</span>;i &lt;= n; ++i) h[i] = d[s][i];</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="type">bool</span> <span class="title">calc</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (<span class="built_in">neg</span>()) <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">1</span>;i &lt;= n; ++i) </span><br><span class="line">            <span class="keyword">for</span> (<span class="type">int</span> j = head[i]; ~j ; j = edges[j].nxt) </span><br><span class="line">                edges[j].len += h[i] - h[edges[j].v];</span><br><span class="line">    </span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> s = <span class="number">1</span>;s &lt;= n; ++s) &#123;</span><br><span class="line">            priority_queue&lt;pair&lt;ll, <span class="type">int</span>&gt;, vector&lt;pair&lt;ll, <span class="type">int</span>&gt;&gt;, greater&lt;pair&lt;ll, <span class="type">int</span>&gt;&gt;&gt; Q;</span><br><span class="line">            <span class="function">vector&lt;<span class="type">bool</span>&gt; <span class="title">done</span><span class="params">(n<span class="number">+1</span>)</span></span>;</span><br><span class="line">            d[s][s] = <span class="number">0</span>;</span><br><span class="line">            Q.<span class="built_in">push</span>(&#123;d[s][s], s&#125;);</span><br><span class="line">            <span class="keyword">while</span>(!Q.<span class="built_in">empty</span>()) &#123;</span><br><span class="line">                <span class="type">int</span> x = Q.<span class="built_in">top</span>().second; Q.<span class="built_in">pop</span>();</span><br><span class="line">                <span class="keyword">if</span> (done[x]) <span class="keyword">continue</span>; <span class="keyword">else</span> done[x] = <span class="literal">true</span>;</span><br><span class="line">                <span class="keyword">for</span> (<span class="type">int</span> i = head[x]; ~i; i = edges[i].nxt) &#123;</span><br><span class="line">                    <span class="type">int</span> v = edges[i].v; ll len = edges[i].len;</span><br><span class="line">                    <span class="keyword">if</span> (d[s][v] &gt; d[s][x] + len) &#123;</span><br><span class="line">                        d[s][v] = d[s][x] + len;</span><br><span class="line">                        Q.<span class="built_in">push</span>(&#123;d[s][v], v&#125;);</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">1</span>;i &lt;= n; ++i) </span><br><span class="line">            <span class="keyword">for</span> (<span class="type">int</span> j = <span class="number">1</span>;j &lt;= n; ++j) &#123;</span><br><span class="line">                d[i][j] += h[j] - h[i];</span><br><span class="line">            &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<h3 id="最小生成树">最小生成树</h3>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">struct</span> <span class="title class_">DSU</span> &#123;</span><br><span class="line">    vector&lt;<span class="type">int</span>&gt; fa, sz;</span><br><span class="line">    <span class="type">int</span> cnum; <span class="comment">// connect area number</span></span><br><span class="line">    <span class="built_in">DSU</span>(<span class="type">int</span> n) &#123;</span><br><span class="line">        fa = <span class="built_in">vector</span>&lt;<span class="type">int</span>&gt;(n<span class="number">+1</span>, <span class="number">-1</span>);</span><br><span class="line">        sz = <span class="built_in">vector</span>&lt;<span class="type">int</span>&gt;(n<span class="number">+1</span>, <span class="number">1</span>);</span><br><span class="line">        cnum = n;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">inline</span> <span class="type">int</span> <span class="title">num</span><span class="params">()</span> </span>&#123; <span class="keyword">return</span> cnum; &#125;</span><br><span class="line">    <span class="function"><span class="keyword">inline</span> <span class="type">int</span> <span class="title">size</span><span class="params">(<span class="type">int</span> x)</span> </span>&#123; <span class="keyword">return</span> sz[<span class="built_in">find</span>(x)]; &#125;</span><br><span class="line">    <span class="function"><span class="type">int</span> <span class="title">find</span><span class="params">(<span class="type">int</span> x)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (<span class="number">-1</span> == fa[x]) <span class="keyword">return</span> x;</span><br><span class="line">        <span class="type">int</span> k = <span class="built_in">find</span>(fa[x]);</span><br><span class="line">        fa[x] = k;</span><br><span class="line">        <span class="keyword">return</span> fa[x];</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">inline</span> <span class="type">void</span> <span class="title">connect</span><span class="params">(<span class="type">int</span> x, <span class="type">int</span> y)</span> </span>&#123;</span><br><span class="line">        <span class="type">int</span> fax = <span class="built_in">find</span>(x), fay = <span class="built_in">find</span>(y);  </span><br><span class="line">        <span class="keyword">if</span> (fax == fay) <span class="keyword">return</span>;</span><br><span class="line">        cnum--; sz[fay] += sz[fax]; </span><br><span class="line">        fa[fax] = fay;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">MST</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">struct</span> <span class="title class_">Node</span> &#123;</span><br><span class="line">        <span class="type">int</span> fr, to;</span><br><span class="line">        ll len;</span><br><span class="line">        <span class="type">bool</span> <span class="keyword">operator</span>&lt;(<span class="type">const</span> Node &amp;x) <span class="type">const</span> &#123;</span><br><span class="line">            <span class="keyword">return</span> len &lt; x.len;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;;</span><br><span class="line">    <span class="type">int</span> n, mxn;</span><br><span class="line"></span><br><span class="line">    vector&lt;Node&gt; edges;</span><br><span class="line">    <span class="built_in">MST</span>(<span class="type">int</span> tn) &#123;</span><br><span class="line">        n = tn;</span><br><span class="line">        mxn = <span class="number">0</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">inline</span> <span class="type">void</span> <span class="title">addedge</span><span class="params">(<span class="type">int</span> a, <span class="type">int</span> b, ll c)</span> </span>&#123;</span><br><span class="line">        edges.<span class="built_in">push_back</span>(&#123;a, b, c&#125;);</span><br><span class="line">        mxn = <span class="built_in">max</span>(mxn, <span class="built_in">max</span>(a, b));</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function">ll <span class="title">calc</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="type">int</span> cnt = n - <span class="number">1</span>, i = <span class="number">0</span>;</span><br><span class="line">        ll ans = <span class="number">0</span>;</span><br><span class="line">        <span class="built_in">sort</span>(edges.<span class="built_in">begin</span>(), edges.<span class="built_in">end</span>());</span><br><span class="line">        <span class="function">DSU <span class="title">dsu</span><span class="params">(mxn)</span></span>;</span><br><span class="line">        <span class="keyword">while</span> (cnt &gt; <span class="number">0</span> &amp;&amp; i &lt; (<span class="type">int</span>) edges.<span class="built_in">size</span>()) &#123;</span><br><span class="line">            <span class="type">int</span> a = dsu.<span class="built_in">find</span>(edges[i].fr);</span><br><span class="line">            <span class="type">int</span> b = dsu.<span class="built_in">find</span>(edges[i].to);</span><br><span class="line">            <span class="keyword">if</span> (a != b) &#123;</span><br><span class="line">                dsu.<span class="built_in">connect</span>(a, b);</span><br><span class="line">                cnt--; </span><br><span class="line">                ans += edges[i].len;</span><br><span class="line">            &#125;</span><br><span class="line">            i++;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> cnt == <span class="number">0</span> ? ans : <span class="number">-1</span>; <span class="comment">// -1: not connected</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<h3 id="tarjan-缩点割点桥">Tarjan 缩点,割点,桥</h3>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">struct</span> <span class="title class_">Tarjan</span> &#123;</span><br><span class="line">    <span class="comment">// G 编号从1开始 , no multiple edges</span></span><br><span class="line">    <span class="type">int</span> n, m, timer, cnt;</span><br><span class="line">    vector&lt;vector&lt;<span class="type">int</span>&gt;&gt; oG, bcc, G; <span class="comment">// original graph, G: out graph, bcc[i] 第i个强连通分量所有的点</span></span><br><span class="line">    vector&lt;<span class="type">int</span>&gt; dfn, low, low2,belong, cutv, iscut; <span class="comment">// belong: 原图的点缩点后的编号, cutv: cut vertex</span></span><br><span class="line">    vector&lt;pii&gt; cute; </span><br><span class="line">    vector&lt;<span class="type">bool</span>&gt; ins;</span><br><span class="line">    stack&lt;<span class="type">int</span>&gt; s;</span><br><span class="line">    </span><br><span class="line">    <span class="built_in">Tarjan</span>(<span class="type">int</span> n=<span class="number">0</span>) : <span class="built_in">n</span>(n), <span class="built_in">m</span>(<span class="number">0</span>), <span class="built_in">timer</span>(<span class="number">0</span>), <span class="built_in">cnt</span>(<span class="number">0</span>), <span class="built_in">oG</span>(n<span class="number">+1</span>), </span><br><span class="line">        <span class="built_in">bcc</span>(<span class="number">1</span>),<span class="built_in">G</span>(<span class="number">1</span>),<span class="built_in">dfn</span>(n<span class="number">+1</span>,<span class="number">-1</span>),<span class="built_in">low</span>(n<span class="number">+1</span>),<span class="built_in">low2</span>(n<span class="number">+1</span>),<span class="built_in">belong</span>(n<span class="number">+1</span>),<span class="built_in">iscut</span>(n<span class="number">+1</span>),<span class="built_in">ins</span>(n<span class="number">+1</span>) &#123;&#125;</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">addedge</span><span class="params">(<span class="type">int</span> a, <span class="type">int</span> b)</span> </span>&#123;</span><br><span class="line">        oG[a].<span class="built_in">push_back</span>(b);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">dfs</span><span class="params">(<span class="type">int</span> x, <span class="type">int</span> fa)</span> </span>&#123;</span><br><span class="line">        dfn[x] = low[x] = low2[x] = ++timer;</span><br><span class="line">        s.<span class="built_in">push</span>(x); ins[x] = <span class="number">1</span>;</span><br><span class="line">        <span class="type">int</span> tot = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">auto</span> v : oG[x]) &#123;</span><br><span class="line">            <span class="keyword">if</span> (!~dfn[v]) &#123;</span><br><span class="line">                <span class="built_in">dfs</span>(v, x);</span><br><span class="line">                <span class="keyword">if</span> (x == fa) tot++;</span><br><span class="line">                low[x] = <span class="built_in">min</span>(low[x], low[v]);</span><br><span class="line">                low2[x] = <span class="built_in">min</span>(low2[x], low2[v]);</span><br><span class="line">                <span class="keyword">if</span> (low[v] &gt;= dfn[x] &amp;&amp; x != fa) &#123;</span><br><span class="line">                    iscut[x] = <span class="number">1</span>;</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="keyword">if</span> (low2[v] &gt; dfn[x]) cute.<span class="built_in">push_back</span>(&#123;x, v&#125;);</span><br><span class="line">            &#125; <span class="keyword">else</span> <span class="keyword">if</span> (ins[v]) low[x] = <span class="built_in">min</span>(low[x], dfn[v]);</span><br><span class="line">            <span class="keyword">if</span> (v != fa) low2[x] = <span class="built_in">min</span>(low2[x], dfn[v]);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> (tot &gt; <span class="number">1</span>) iscut[x] = <span class="number">1</span>;</span><br><span class="line">        <span class="keyword">if</span> (low[x] == dfn[x]) &#123;</span><br><span class="line">            <span class="type">int</span> now; bcc.<span class="built_in">push_back</span>(<span class="built_in">vector</span>&lt;<span class="type">int</span>&gt;()); G.<span class="built_in">push_back</span>(<span class="built_in">vector</span>&lt;<span class="type">int</span>&gt;());</span><br><span class="line">            <span class="type">int</span> cur = ++cnt;</span><br><span class="line">            <span class="keyword">do</span> &#123;</span><br><span class="line">                now = s.<span class="built_in">top</span>(); s.<span class="built_in">pop</span>(); ins[now] = <span class="number">0</span>;</span><br><span class="line">                belong[now] = cur;</span><br><span class="line">                bcc.<span class="built_in">back</span>().<span class="built_in">push_back</span>(now);</span><br><span class="line">            &#125; <span class="keyword">while</span> (now != x);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">calc</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">1</span>;i &lt;= n; ++i) <span class="keyword">if</span> (!~dfn[i]) <span class="built_in">dfs</span>(i, i);  </span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">1</span>;i &lt;= n; ++i) &#123;</span><br><span class="line">            <span class="keyword">if</span> (iscut[i]) cutv.<span class="built_in">push_back</span>(i);</span><br><span class="line">            <span class="type">int</span> u = belong[i];</span><br><span class="line">            <span class="keyword">for</span> (<span class="keyword">auto</span> j : oG[i]) &#123; </span><br><span class="line">                <span class="type">int</span> v = belong[j];</span><br><span class="line">                <span class="keyword">if</span> (v != u) G[u].<span class="built_in">push_back</span>(v);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125; </span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<h3 id="染色">2染色</h3>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">vector&lt;<span class="type">int</span>&gt; col[<span class="number">3</span>];</span><br><span class="line"><span class="type">int</span> vis[maxn];</span><br><span class="line"><span class="function"><span class="type">bool</span> <span class="title">color2</span><span class="params">(<span class="type">int</span> x, <span class="type">int</span> c)</span> </span>&#123;</span><br><span class="line">    col[c].<span class="built_in">push_back</span>(x);</span><br><span class="line">    vis[x] = c;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">auto</span> v : G[x]) &#123;</span><br><span class="line">        <span class="keyword">if</span> (!vis[v] &amp;&amp; !<span class="built_in">color2</span>(v, <span class="number">3</span> - c)) <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">        <span class="keyword">else</span> <span class="keyword">if</span> (vis[v] == c) <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="基环树">基环树</h3>
<h4 id="无向图基环树">无向图基环树</h4>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">struct</span> <span class="title class_">RingTree</span> &#123;</span><br><span class="line">    <span class="type">int</span> n;</span><br><span class="line">    vector&lt;vector&lt;<span class="type">int</span>&gt;&gt; G;</span><br><span class="line">    vector&lt;<span class="type">bool</span>&gt; isr;</span><br><span class="line">    vector&lt;<span class="type">int</span>&gt; in, ring;</span><br><span class="line"></span><br><span class="line">    <span class="built_in">RingTree</span>(<span class="type">int</span> n) : <span class="built_in">n</span>(n), <span class="built_in">G</span>(n<span class="number">+1</span>), <span class="built_in">isr</span>(n<span class="number">+1</span>, <span class="number">1</span>), <span class="built_in">in</span>(n<span class="number">+1</span>) &#123;&#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">addedge</span><span class="params">(<span class="type">int</span> a, <span class="type">int</span> b)</span> </span>&#123; <span class="comment">// 无向边</span></span><br><span class="line">        G[a].<span class="built_in">push_back</span>(b);</span><br><span class="line">        G[b].<span class="built_in">push_back</span>(a);</span><br><span class="line">        in[a]++; in[b]++;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">calc</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        queue&lt;<span class="type">int</span>&gt; q;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">1</span>;i &lt;= n; ++i) <span class="keyword">if</span> (in[i] == <span class="number">1</span>) q.<span class="built_in">push</span>(i);</span><br><span class="line">        <span class="keyword">while</span> (!q.<span class="built_in">empty</span>()) &#123;</span><br><span class="line">            <span class="type">int</span> hd = q.<span class="built_in">front</span>(); q.<span class="built_in">pop</span>();</span><br><span class="line">            isr[hd] = <span class="number">0</span>;</span><br><span class="line">            <span class="keyword">for</span> (<span class="keyword">auto</span> v : G[hd]) <span class="keyword">if</span> (in[v] &gt; <span class="number">1</span>) &#123;</span><br><span class="line">                in[v]--;</span><br><span class="line">                <span class="keyword">if</span> (in[v] == <span class="number">1</span>) q.<span class="built_in">push</span>(v);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">1</span>;i &lt;= n; ++i) <span class="keyword">if</span> (isr[i]) &#123;</span><br><span class="line">            ring.<span class="built_in">push_back</span>(i);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<h3 id="最大团">最大团</h3>
<p><span class="math inline">\(n\le 50\)</span></p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// n = |V| d = adj matrix</span></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">maxClique</span><span class="params">(<span class="type">int</span> n, <span class="keyword">auto</span> d)</span> </span>&#123;</span><br><span class="line">    <span class="function">vector&lt;ll&gt; <span class="title">G</span><span class="params">(n<span class="number">+1</span>)</span></span>;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">1</span>;i &lt;= n; ++i) &#123;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> j = <span class="number">1</span>;j &lt;= n; ++j) &#123;</span><br><span class="line">            <span class="keyword">if</span> (d[i][j]) G[i] |= <span class="number">1ll</span>&lt;&lt;(j<span class="number">-1</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">struct</span> <span class="title class_">custom_hash</span> &#123;</span><br><span class="line">        <span class="function"><span class="type">static</span> <span class="type">uint64_t</span> <span class="title">splitmix64</span><span class="params">(<span class="type">uint64_t</span> x)</span> </span>&#123;</span><br><span class="line">            x += <span class="number">0x9e3779b97f4a7c15</span>;</span><br><span class="line">            x = (x ^ (x &gt;&gt; <span class="number">30</span>)) * <span class="number">0xbf58476d1ce4e5b9</span>;</span><br><span class="line">            x = (x ^ (x &gt;&gt; <span class="number">27</span>)) * <span class="number">0x94d049bb133111eb</span>;</span><br><span class="line">            <span class="keyword">return</span> x ^ (x &gt;&gt; <span class="number">31</span>);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="type">size_t</span> <span class="title">operator</span><span class="params">()</span><span class="params">(<span class="type">uint64_t</span> x)</span> <span class="type">const</span> </span>&#123;</span><br><span class="line">            <span class="type">static</span> <span class="type">const</span> <span class="type">uint64_t</span> FIXED_RANDOM = chrono::steady_clock::<span class="built_in">now</span>().<span class="built_in">time_since_epoch</span>().<span class="built_in">count</span>();</span><br><span class="line">            <span class="keyword">return</span> <span class="built_in">splitmix64</span>(x + FIXED_RANDOM);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;;</span><br><span class="line">    unordered_map&lt;ll,<span class="type">int</span>,custom_hash&gt; f;</span><br><span class="line">    function&lt;<span class="type">int</span>(ll)&gt; solve = [&amp;](ll mask) &#123;</span><br><span class="line">        <span class="keyword">if</span> (f.<span class="built_in">find</span>(mask) != f.<span class="built_in">end</span>()) <span class="keyword">return</span> f[mask];</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> i = n<span class="number">-1</span>;i &gt;= <span class="number">0</span>; --i) <span class="keyword">if</span> (mask&gt;&gt;i &amp; <span class="number">1</span>)&#123;</span><br><span class="line">            <span class="keyword">return</span> f[mask] = <span class="built_in">max</span>(<span class="built_in">solve</span>(mask ^ (<span class="number">1ll</span>&lt;&lt;i)), <span class="number">1</span> + <span class="built_in">solve</span>(mask &amp; G[i<span class="number">+1</span>]));</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">    &#125;;</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">solve</span>((<span class="number">1ll</span>&lt;&lt;n)<span class="number">-1</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="树">树</h2>
<h3 id="lca">LCA</h3>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">struct</span> <span class="title class_">LCA</span> &#123;</span><br><span class="line">    <span class="keyword">typedef</span> <span class="type">int</span> T;</span><br><span class="line">    <span class="type">int</span> n;</span><br><span class="line">    <span class="type">int</span> logsize;</span><br><span class="line">    vector&lt;vector&lt;pair&lt;<span class="type">int</span>, T&gt;&gt;&gt; G;</span><br><span class="line">    vector&lt;<span class="type">int</span>&gt; dep;</span><br><span class="line">    vector&lt;vector&lt;<span class="type">int</span>&gt;&gt; p;</span><br><span class="line">    vector&lt;vector&lt;T&gt;&gt; l;</span><br><span class="line"></span><br><span class="line">    <span class="function">T <span class="title">addt</span><span class="params">(T a, T b)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">max</span>(a, b);</span><br><span class="line">    &#125;</span><br><span class="line">    T zero = <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">    <span class="built_in">LCA</span>(vector&lt;vector&lt;pair&lt;<span class="type">int</span>, T&gt;&gt;&gt;&amp; tG, <span class="type">int</span> s) &#123;</span><br><span class="line">        G = tG;  logsize = <span class="number">1</span> + (<span class="type">int</span>)<span class="built_in">log2</span>(G.<span class="built_in">size</span>()<span class="number">+1</span>);</span><br><span class="line">        n = <span class="built_in">sz</span>(tG)<span class="number">-1</span>;</span><br><span class="line">        p = vector&lt;vector&lt;<span class="type">int</span>&gt;&gt;(G.<span class="built_in">size</span>(), <span class="built_in">vector</span>&lt;<span class="type">int</span>&gt;(logsize));</span><br><span class="line">        l = vector&lt;vector&lt;T&gt;&gt;(G.<span class="built_in">size</span>(), <span class="built_in">vector</span>&lt;T&gt;(logsize));</span><br><span class="line">        dep = <span class="built_in">vector</span>&lt;<span class="type">int</span>&gt;(G.<span class="built_in">size</span>());</span><br><span class="line">        dep[s] = <span class="number">1</span>; <span class="built_in">dfs</span>(s);</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> j = <span class="number">1</span>;j &lt; logsize; ++j) &#123;</span><br><span class="line">            <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">1</span>;i &lt;= n; ++i) <span class="keyword">if</span> (p[i][j<span class="number">-1</span>]) &#123;</span><br><span class="line">                p[i][j] = p[p[i][j<span class="number">-1</span>]][j<span class="number">-1</span>];</span><br><span class="line">                <span class="keyword">if</span> (p[i][j]) l[i][j] = <span class="built_in">addt</span>(l[i][j<span class="number">-1</span>], l[p[i][j<span class="number">-1</span>]][j<span class="number">-1</span>]);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">dfs</span><span class="params">(<span class="type">int</span> x)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">auto</span> [v, len] : G[x]) &#123;</span><br><span class="line">            <span class="keyword">if</span> (v != p[x][<span class="number">0</span>]) &#123; </span><br><span class="line">                dep[v] = dep[x] + <span class="number">1</span>;</span><br><span class="line">                p[v][<span class="number">0</span>] = x; l[v][<span class="number">0</span>] = len;</span><br><span class="line">                <span class="built_in">dfs</span>(v); </span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function">pair&lt;<span class="type">int</span>, T&gt; <span class="title">query</span><span class="params">(<span class="type">int</span> x, <span class="type">int</span> y)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (dep[x] &lt; dep[y]) <span class="built_in">swap</span>(x, y); <span class="comment">// let depx &gt;= depy </span></span><br><span class="line">        T ret = zero;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> j = logsize<span class="number">-1</span>; j &gt;= <span class="number">0</span>; --j) &#123;</span><br><span class="line">            <span class="keyword">if</span> (dep[p[x][j]] &gt;= dep[y]) &#123; ret = <span class="built_in">addt</span>(ret, l[x][j]); x = p[x][j]; &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> (x == y) <span class="keyword">return</span> &#123;x, ret&#125;;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> j = logsize<span class="number">-1</span>; j &gt;= <span class="number">0</span>; --j)&#123;</span><br><span class="line">            <span class="keyword">if</span> (p[x][j] != p[y][j]) &#123; </span><br><span class="line">                ret = <span class="built_in">addt</span>(ret, <span class="built_in">addt</span>(l[x][j], l[y][j]));</span><br><span class="line">                x = p[x][j]; y = p[y][j];</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> &#123;p[x][<span class="number">0</span>], <span class="built_in">addt</span>(ret, <span class="built_in">addt</span>(l[x][<span class="number">0</span>], l[y][<span class="number">0</span>]))&#125;;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<h4 id="lcaonly-node">LCA(only node)</h4>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">struct</span> <span class="title class_">LCA</span> &#123;</span><br><span class="line">    <span class="type">int</span> n;</span><br><span class="line">    <span class="type">int</span> logsize;</span><br><span class="line">    vector&lt;vector&lt;<span class="type">int</span>&gt;&gt; G;</span><br><span class="line">    vector&lt;<span class="type">int</span>&gt; dep;</span><br><span class="line">    vector&lt;vector&lt;<span class="type">int</span>&gt;&gt; p;</span><br><span class="line"></span><br><span class="line">    <span class="built_in">LCA</span>(vector&lt;vector&lt;<span class="type">int</span>&gt;&gt;&amp; tG, <span class="type">int</span> s) : <span class="built_in">G</span>(tG) &#123;</span><br><span class="line">        logsize = <span class="number">1</span> + (<span class="type">int</span>)<span class="built_in">log2</span>(G.<span class="built_in">size</span>()<span class="number">+1</span>);</span><br><span class="line">        n = <span class="built_in">sz</span>(tG)<span class="number">-1</span>;</span><br><span class="line">        p = vector&lt;vector&lt;<span class="type">int</span>&gt;&gt;(G.<span class="built_in">size</span>(), <span class="built_in">vector</span>&lt;<span class="type">int</span>&gt;(logsize));</span><br><span class="line">        dep = <span class="built_in">vector</span>&lt;<span class="type">int</span>&gt;(G.<span class="built_in">size</span>());</span><br><span class="line">        dep[s] = <span class="number">1</span>; <span class="built_in">dfs</span>(s);</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> j = <span class="number">1</span>;j &lt; logsize; ++j) </span><br><span class="line">            <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">1</span>;i &lt;= n; ++i) <span class="keyword">if</span> (p[i][j<span class="number">-1</span>]) </span><br><span class="line">                p[i][j] = p[p[i][j<span class="number">-1</span>]][j<span class="number">-1</span>];</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">dfs</span><span class="params">(<span class="type">int</span> x)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">auto</span> v : G[x]) <span class="keyword">if</span> (v != p[x][<span class="number">0</span>]) &#123;</span><br><span class="line">            dep[v] = dep[x] + <span class="number">1</span>;</span><br><span class="line">            p[v][<span class="number">0</span>] = x;</span><br><span class="line">            <span class="built_in">dfs</span>(v); </span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="type">int</span> <span class="title">query</span><span class="params">(<span class="type">int</span> x, <span class="type">int</span> y)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (dep[x] &lt; dep[y]) <span class="built_in">swap</span>(x, y); <span class="comment">// let depx &gt;= depy </span></span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> j = logsize<span class="number">-1</span>; j &gt;= <span class="number">0</span>; --j) </span><br><span class="line">            <span class="keyword">if</span> (dep[p[x][j]] &gt;= dep[y]) x = p[x][j]; </span><br><span class="line">        <span class="keyword">if</span> (x == y) <span class="keyword">return</span> x;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> j = logsize<span class="number">-1</span>; j &gt;= <span class="number">0</span>; --j) <span class="keyword">if</span> (p[x][j] != p[y][j]) </span><br><span class="line">            x = p[x][j], y = p[y][j];</span><br><span class="line">        <span class="keyword">return</span> p[x][<span class="number">0</span>];</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<h4 id="树剖lca">树剖LCA</h4>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">int</span> dep[maxn], fa[maxn], num[maxn], top[maxn], ind[maxn], son[maxn], way[maxn], lfa[maxn];</span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">Data</span> &#123;</span><br><span class="line">    <span class="type">int</span> len, x, y, lca;</span><br><span class="line">    <span class="type">bool</span> <span class="keyword">operator</span>&lt;(<span class="type">const</span> Data&amp; x) <span class="type">const</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> len &gt; x.len;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;A[maxn];</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">void</span> <span class="title">dfs1</span><span class="params">(<span class="type">int</span> x)</span> </span>&#123;</span><br><span class="line">    num[x] = <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> e = head[x]; e; e = nxt[e]) <span class="keyword">if</span> (to[e] != fa[x]) &#123;</span><br><span class="line">        <span class="type">int</span> v = to[e];</span><br><span class="line">        fa[v] = x; lfa[v] = lto[e];</span><br><span class="line">        dep[v] = dep[x] + <span class="number">1</span>;</span><br><span class="line">        <span class="built_in">dfs1</span>(v);</span><br><span class="line">        num[x] += num[v];</span><br><span class="line">        <span class="keyword">if</span> (num[v] &gt; num[son[x]]) son[x] = v;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">void</span> <span class="title">dfs2</span><span class="params">(<span class="type">int</span> x, <span class="type">int</span> topf)</span> </span>&#123;</span><br><span class="line">    top[x] = topf;</span><br><span class="line">    <span class="keyword">if</span> (x != topf) way[x] = way[fa[x]] + lfa[x];</span><br><span class="line">    <span class="keyword">if</span> (!son[x]) <span class="keyword">return</span>;</span><br><span class="line">    <span class="built_in">dfs2</span>(son[x], topf);</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> e = head[x]; e; e = nxt[e]) <span class="keyword">if</span> (to[e] != fa[x] &amp;&amp; to[e] != son[x]) &#123;</span><br><span class="line">        <span class="built_in">dfs2</span>(to[e], to[e]);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">inline</span> pii <span class="title">lca</span><span class="params">(<span class="type">int</span> x, <span class="type">int</span> y)</span> </span>&#123;</span><br><span class="line">    <span class="type">int</span> ret = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">while</span> (top[x] != top[y]) &#123;</span><br><span class="line">        <span class="keyword">if</span> (dep[top[x]] &lt; dep[top[y]]) <span class="built_in">swap</span>(x, y);</span><br><span class="line">        ret += way[x] + lfa[top[x]];</span><br><span class="line">        x = fa[top[x]];</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (dep[x] &gt; dep[y]) <span class="built_in">swap</span>(x, y);</span><br><span class="line">    <span class="keyword">return</span> &#123;ret + way[y] - way[x], x&#125;;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="直径重心">直径，重心</h3>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">struct</span> <span class="title class_">Diameter</span> &#123;</span><br><span class="line">    <span class="keyword">typedef</span> ll T;</span><br><span class="line"></span><br><span class="line">    vector&lt;vector&lt;pair&lt;<span class="type">int</span>, T&gt;&gt;&gt; G;</span><br><span class="line">    vector&lt;T&gt; d;</span><br><span class="line">    vector&lt;<span class="type">int</span>&gt; nxt;</span><br><span class="line">    vector&lt;<span class="type">int</span>&gt; path;</span><br><span class="line">    </span><br><span class="line">    <span class="type">int</span> ans1, ans2;</span><br><span class="line">    T ans, dep1, dep2;</span><br><span class="line"></span><br><span class="line">    <span class="built_in">Diameter</span>(vector&lt;vector&lt;pair&lt;<span class="type">int</span>,T&gt;&gt;&gt; &amp;tG) &#123;</span><br><span class="line">        G = tG;</span><br><span class="line">        nxt = <span class="built_in">vector</span>&lt;<span class="type">int</span>&gt;(G.<span class="built_in">size</span>());</span><br><span class="line">        d = <span class="built_in">vector</span>&lt;T&gt;(G.<span class="built_in">size</span>());</span><br><span class="line">        ans1 = <span class="number">0</span>; dep1 = <span class="number">-1</span>; <span class="built_in">dfs1</span>(<span class="number">1</span>, <span class="number">0</span>, <span class="number">0</span>);</span><br><span class="line">        ans2 = <span class="number">0</span>; dep2 = <span class="number">0</span>; ans = <span class="built_in">dfs2</span>(ans1, <span class="number">0</span>);</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> u = ans1; u != <span class="number">0</span>; u = nxt[u]) path.<span class="built_in">push_back</span>(u);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="function">T <span class="title">length</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> ans;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function">vector&lt;<span class="type">int</span>&gt;&amp; <span class="title">getPath</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> path;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="type">int</span> <span class="title">getNode</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> path[ans/<span class="number">2</span>];</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">dfs1</span><span class="params">(<span class="type">int</span> x, <span class="type">int</span> fa, T dep)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (dep1 &lt; dep) &#123; ans1 = x; dep1 = dep; &#125;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">auto</span> [v, len] : G[x]) <span class="keyword">if</span> (v != fa) <span class="built_in">dfs1</span>(v, x, dep + len);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function">T <span class="title">dfs2</span><span class="params">(<span class="type">int</span> x, <span class="type">int</span> fa)</span> </span>&#123;</span><br><span class="line">        d[x] = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">auto</span> [v, len] : G[x]) <span class="keyword">if</span> (v != fa) &#123;</span><br><span class="line">            T td = <span class="built_in">dfs2</span>(v, x);<span class="function">s</span></span><br><span class="line"><span class="function">            <span class="title">if</span> <span class="params">(td + len &gt; d[x])</span> </span>&#123;</span><br><span class="line">                d[x] = td + len;</span><br><span class="line">                nxt[x] = v;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> d[x];</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<h4 id="求点到直径的距离">求点到直径的距离</h4>
<p>把直径求出来，然后从直径bfs</p>
<h3 id="换根dp">换根dp</h3>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">typedef</span> <span class="type">int</span> T;</span><br><span class="line"><span class="type">static</span> T zero = <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">T f[maxn], g[maxn];</span><br><span class="line"></span><br><span class="line"><span class="comment">// f(x) = calc(x, addt(fi(x,v1), fi(x,v2)...))</span></span><br><span class="line"><span class="function">T <span class="title">calc</span><span class="params">(<span class="type">int</span> x, T gx)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">max</span>(<span class="number">1</span>, gx);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function">T <span class="title">addt</span><span class="params">(T a, <span class="type">int</span> x, <span class="type">int</span> v)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">max</span>(a, <span class="number">1</span> + f[v]);</span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">dsqueue</span> &#123;</span><br><span class="line">	<span class="keyword">struct</span> <span class="title class_">operation</span> &#123; <span class="type">int</span> x, v; &#125;;</span><br><span class="line">	<span class="keyword">struct</span> <span class="title class_">dat</span> &#123;</span><br><span class="line">		vector&lt;T&gt; a = &#123;zero&#125;;</span><br><span class="line">		<span class="function">T <span class="title">query</span><span class="params">()</span> </span>&#123; <span class="keyword">return</span> a.<span class="built_in">back</span>(); &#125;</span><br><span class="line">		<span class="function"><span class="type">void</span> <span class="title">undo</span><span class="params">()</span> </span>&#123; a.<span class="built_in">pop_back</span>(); &#125;</span><br><span class="line">		<span class="function"><span class="type">void</span> <span class="title">apply</span><span class="params">(operation o)</span> </span>&#123; a.<span class="built_in">push_back</span>(<span class="built_in">addt</span>(a.<span class="built_in">back</span>(), o.x, o.v)); &#125;</span><br><span class="line">	&#125;;</span><br><span class="line">	dat ds;</span><br><span class="line">	vector&lt;pair&lt;<span class="type">int</span>, operation&gt;&gt; a;</span><br><span class="line">	<span class="type">int</span> cnt = <span class="number">0</span>;</span><br><span class="line">	<span class="built_in">dsqueue</span>() &#123;&#125;</span><br><span class="line">	<span class="function"><span class="type">void</span> <span class="title">pop</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		<span class="keyword">if</span> (!cnt) &#123;</span><br><span class="line">			cnt = (<span class="type">int</span>)a.<span class="built_in">size</span>();</span><br><span class="line">			<span class="built_in">reverse</span>(a.<span class="built_in">begin</span>(), a.<span class="built_in">end</span>());</span><br><span class="line">			<span class="keyword">for</span> (<span class="keyword">auto</span>&amp; [t, o]: a)</span><br><span class="line">			ds.<span class="built_in">undo</span>(), t = <span class="number">0</span>;</span><br><span class="line">			<span class="keyword">for</span> (<span class="keyword">auto</span>&amp; [t, o]: a)</span><br><span class="line">			ds.<span class="built_in">apply</span>(o);</span><br><span class="line">		&#125;</span><br><span class="line">		deque&lt;operation&gt; b[<span class="number">2</span>];</span><br><span class="line">		<span class="keyword">for</span> (<span class="type">int</span> t : &#123;<span class="number">1</span>, <span class="number">0</span>&#125;) &#123;</span><br><span class="line">			<span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; !t ? i &lt; (cnt &amp; -cnt) : a.<span class="built_in">back</span>().first; i++) &#123;</span><br><span class="line">			b[t].<span class="built_in">push_front</span>(a.<span class="built_in">back</span>().second);</span><br><span class="line">			a.<span class="built_in">pop_back</span>();</span><br><span class="line">			ds.<span class="built_in">undo</span>();</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">for</span> (<span class="type">int</span> t : &#123;<span class="number">1</span>, <span class="number">0</span>&#125;) &#123;</span><br><span class="line">			<span class="keyword">for</span> (<span class="keyword">auto</span>&amp; o: b[t]) &#123;</span><br><span class="line">			ds.<span class="built_in">apply</span>(o);</span><br><span class="line">			a.<span class="built_in">emplace_back</span>(t, o);</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;</span><br><span class="line">		cnt--;</span><br><span class="line">		ds.<span class="built_in">undo</span>();</span><br><span class="line">		a.<span class="built_in">pop_back</span>();</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function"><span class="type">void</span> <span class="title">push</span><span class="params">(operation o)</span> </span>&#123;</span><br><span class="line">		a.<span class="built_in">emplace_back</span>(<span class="number">1</span>, o);</span><br><span class="line">		ds.<span class="built_in">apply</span>(o);</span><br><span class="line">	&#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">dfs1</span><span class="params">(<span class="type">int</span> x, <span class="type">int</span> fa)</span> </span>&#123;</span><br><span class="line">    g[x] = zero;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">auto</span> v : G[x]) <span class="keyword">if</span> (v != fa) &#123;</span><br><span class="line">        <span class="built_in">dfs1</span>(v, x);</span><br><span class="line">        g[x] = <span class="built_in">addt</span>(g[x], x, v);</span><br><span class="line">    &#125;</span><br><span class="line">    f[x] = <span class="built_in">calc</span>(x, g[x]);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">dfs</span><span class="params">(<span class="type">int</span> x, <span class="type">int</span> fa)</span> </span>&#123;</span><br><span class="line">    ans[x] = f[x];</span><br><span class="line">    dsqueue q;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">auto</span> v : G[x]) <span class="keyword">if</span> (v != fa) q.<span class="built_in">push</span>(&#123;x, v&#125;);</span><br><span class="line">    <span class="keyword">if</span> (fa) q.<span class="built_in">push</span>(&#123;x, fa&#125;);</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">auto</span> v : G[x]) <span class="keyword">if</span> (v != fa) &#123;</span><br><span class="line">        q.<span class="built_in">pop</span>();</span><br><span class="line">        T tfv = f[v], tgv = g[v];</span><br><span class="line">        g[x] = q.ds.<span class="built_in">query</span>();</span><br><span class="line">        f[x] = <span class="built_in">calc</span>(x, g[x]);</span><br><span class="line">        g[v] = <span class="built_in">addt</span>(g[v], v, x);</span><br><span class="line">        f[v] = <span class="built_in">calc</span>(v, g[v]);</span><br><span class="line">        <span class="built_in">dfs</span>(v, x);</span><br><span class="line">        f[v] = tfv, g[v] = tgv;</span><br><span class="line">        q.<span class="built_in">push</span>(&#123;x, v&#125;);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="点分治">点分治</h3>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;bits/stdc++.h&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"><span class="meta">#<span class="keyword">define</span> _ &lt;&lt;<span class="string">&quot; &quot;</span>&lt;&lt;</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> sz(x) ((int) (x).size())</span></span><br><span class="line"><span class="keyword">typedef</span> pair&lt;<span class="type">int</span>, <span class="type">int</span>&gt; pii;</span><br><span class="line"><span class="keyword">typedef</span> <span class="type">long</span> <span class="type">long</span> ll;</span><br><span class="line"><span class="type">const</span> <span class="type">int</span> maxn = <span class="number">3e5</span> + <span class="number">5</span>;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="type">int</span> n, m, T;</span><br><span class="line">ll h[maxn], ans;</span><br><span class="line"><span class="type">int</span> cnt[maxn], vis[maxn];</span><br><span class="line">vector&lt;pair&lt;<span class="type">int</span>,ll&gt;&gt; G[maxn];</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">count</span><span class="params">(<span class="type">int</span> x, <span class="type">int</span> fa)</span> </span>&#123;</span><br><span class="line">    cnt[x] = <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">auto</span> [v, len] : G[x]) <span class="keyword">if</span> (v != fa &amp;&amp; !vis[v]) &#123;</span><br><span class="line">        <span class="built_in">count</span>(v, x);</span><br><span class="line">        cnt[x] += cnt[v];</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">getCent</span><span class="params">(<span class="type">int</span> x,<span class="type">int</span> fa, <span class="type">int</span> sum)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">auto</span> [v, len] : G[x]) <span class="keyword">if</span> (v != fa &amp;&amp; !vis[v]) &#123;</span><br><span class="line">        <span class="keyword">if</span> (cnt[v] &gt; sum/<span class="number">2</span>) <span class="keyword">return</span> <span class="built_in">getCent</span>(v, x, sum);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> x;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">getval</span><span class="params">(vector&lt;pair&lt;ll,ll&gt;&gt; &amp;A, <span class="type">int</span> x, <span class="type">int</span> fa, ll dis)</span> </span>&#123;</span><br><span class="line">    A.<span class="built_in">push_back</span>(&#123;x, dis&#125;);</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">auto</span> [v, len] : G[x]) <span class="keyword">if</span> (v != fa &amp;&amp; !vis[v]) &#123;</span><br><span class="line">        <span class="built_in">getval</span>(A, v, x, dis + len);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">doit</span><span class="params">(<span class="type">int</span> x)</span> </span>&#123;</span><br><span class="line">    vector&lt;pair&lt;ll,ll&gt;&gt; A;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">auto</span> [v, len]: G[x]) <span class="keyword">if</span> (!vis[v]) &#123;</span><br><span class="line">        <span class="built_in">getval</span>(A, v, x, len);</span><br><span class="line">    &#125;</span><br><span class="line">    vector&lt;pair&lt;ll,<span class="type">int</span>&gt;&gt; B; <span class="comment">// i, dis, b/c</span></span><br><span class="line">    B.<span class="built_in">push_back</span>(&#123;h[x], -x&#125;);</span><br><span class="line">    B.<span class="built_in">push_back</span>(&#123;h[x], x&#125;);</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">auto</span> [v, dis] : A) &#123;</span><br><span class="line">        B.<span class="built_in">push_back</span>(&#123;h[v] - dis, -v&#125;);</span><br><span class="line">        B.<span class="built_in">push_back</span>(&#123;h[v] + dis, v&#125;);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">sort</span>(B.<span class="built_in">begin</span>(), B.<span class="built_in">end</span>(), [](<span class="keyword">auto</span> a, <span class="keyword">auto</span> b) &#123;</span><br><span class="line">        <span class="keyword">if</span> (a.first == b.first) <span class="keyword">return</span> a.second &gt; b.second;</span><br><span class="line">        <span class="keyword">return</span> a.first &lt; b.first;</span><br><span class="line">    &#125;);</span><br><span class="line">   </span><br><span class="line">    ll mn = INT_MAX;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">auto</span> [a, b] : B) &#123;</span><br><span class="line">        <span class="type">int</span> v = <span class="built_in">abs</span>(b);</span><br><span class="line">        <span class="keyword">if</span> (b &lt; <span class="number">0</span>) &#123;</span><br><span class="line">            ans = <span class="built_in">max</span>(ans, h[v] - mn);</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            mn = <span class="built_in">min</span>(mn, h[v]);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">solve</span><span class="params">(<span class="type">int</span> x)</span> </span>&#123;</span><br><span class="line">    vis[x] = <span class="number">1</span>; <span class="built_in">doit</span>(x);</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">auto</span> [v, len] : G[x]) <span class="keyword">if</span> (!vis[v]) &#123;</span><br><span class="line">        <span class="built_in">count</span>(v, x);</span><br><span class="line">        <span class="type">int</span> rt = <span class="built_in">getCent</span>(v, x, cnt[x]);</span><br><span class="line">        <span class="built_in">solve</span>(rt);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">run_case</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    cin &gt;&gt; n;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">1</span>;i &lt;= n; ++i) &#123;</span><br><span class="line">        cin &gt;&gt; h[i];</span><br><span class="line">        G[i].<span class="built_in">clear</span>();</span><br><span class="line">        vis[i] = <span class="number">0</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    ans = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">1</span>;i &lt; n; ++i) &#123;</span><br><span class="line">        <span class="type">int</span> x,y; ll w;</span><br><span class="line">        cin &gt;&gt; x &gt;&gt; y &gt;&gt; w;</span><br><span class="line">        G[x].<span class="built_in">push_back</span>(&#123;y, w&#125;);</span><br><span class="line">        G[y].<span class="built_in">push_back</span>(&#123;x, w&#125;);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">count</span>(<span class="number">1</span>, <span class="number">0</span>);</span><br><span class="line">    <span class="type">int</span> rt = <span class="built_in">getCent</span>(<span class="number">1</span>, <span class="number">0</span>, cnt[<span class="number">1</span>]);</span><br><span class="line">    <span class="built_in">solve</span>(rt);</span><br><span class="line">    cout &lt;&lt; ans &lt;&lt; endl;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    ios_base::<span class="built_in">sync_with_stdio</span>(<span class="number">0</span>);</span><br><span class="line">    cin.<span class="built_in">tie</span>(<span class="number">0</span>);</span><br><span class="line">    cin &gt;&gt; T;</span><br><span class="line">    <span class="keyword">while</span> (T--) <span class="built_in">run_case</span>();</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="dsu-on-tree">DSU on Tree</h3>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">vector&lt;<span class="type">int</span>&gt; G[maxn];</span><br><span class="line"><span class="type">int</span> num[maxn], son[maxn], hs;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">calc</span><span class="params">(<span class="type">int</span> x, <span class="type">int</span> fa, <span class="type">int</span> op)</span> </span>&#123; <span class="comment">// op = -1: reverse</span></span><br><span class="line">    <span class="comment">// do sth.</span></span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">auto</span> v : G[x]) <span class="keyword">if</span> (v != fa &amp;&amp; v != hs) &#123;</span><br><span class="line">        <span class="built_in">calc</span>(v, x, op);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">dsut</span><span class="params">(<span class="type">int</span> x, <span class="type">int</span> fa, <span class="type">int</span> kp)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">auto</span> v : G[x]) <span class="keyword">if</span> (v != fa &amp;&amp; v != son[x]) &#123;</span><br><span class="line">        <span class="built_in">dsut</span>(v, x, <span class="number">0</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (son[x]) <span class="built_in">dsut</span>(son[x], x, <span class="number">1</span>), vis[son[x]] = <span class="literal">true</span>, hs = son[x];</span><br><span class="line">    <span class="built_in">calc</span>(x, fa, <span class="number">1</span>);</span><br><span class="line">    ans[x] = res; <span class="comment">// count answer</span></span><br><span class="line">    hs = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">if</span> (!kp) <span class="built_in">calc</span>(x, fa, <span class="number">-1</span>); <span class="comment">// init variables</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">dfs1</span><span class="params">(<span class="type">int</span> x, <span class="type">int</span> fa)</span> </span>&#123;</span><br><span class="line">    num[x] = <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">auto</span> v : G[x]) <span class="keyword">if</span> (v != fa) &#123;</span><br><span class="line">        <span class="built_in">dfs1</span>(v, x); num[x] += num[v];</span><br><span class="line">        <span class="keyword">if</span> (!son[x] || num[v] &gt; num[son[x]]) son[x] = v;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="path-via-lca">Path via LCA</h4>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="type">void</span> <span class="title">dsut</span><span class="params">(<span class="type">int</span> x, <span class="type">int</span> fa, <span class="type">int</span> kp)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">auto</span> v : G[x]) <span class="keyword">if</span> (v != fa &amp;&amp; v != son[x]) <span class="built_in">dsut</span>(v, x, <span class="number">0</span>);</span><br><span class="line">    <span class="keyword">if</span> (son[x]) <span class="built_in">dsut</span>(son[x], x, <span class="number">1</span>), hs = son[x];</span><br><span class="line">    lca = x;</span><br><span class="line"></span><br><span class="line">    res = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">auto</span> v : G[x]) <span class="keyword">if</span> (v != fa &amp;&amp; v != hs &amp;&amp; !vis[v]) &#123;</span><br><span class="line">        <span class="built_in">getres</span>(v, x); <span class="comment">// calculate answer</span></span><br><span class="line">        <span class="built_in">calc</span>(v, x); <span class="comment">// add sum of children</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (cnt[sum[x] ^ A[lca]]) res = <span class="number">1</span>; <span class="comment">// add lca sum</span></span><br><span class="line">    cnt[sum[x]]++;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (res) ans++, vis[x] = <span class="number">1</span>;</span><br><span class="line">    hs = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">if</span> (!kp || vis[x]) cnt.<span class="built_in">clear</span>();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="字符串">字符串</h2>
<h3 id="kmp">KMP</h3>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">struct</span> <span class="title class_">KMP</span> &#123;</span><br><span class="line">    vector&lt;<span class="type">int</span>&gt; f;</span><br><span class="line">    string t; </span><br><span class="line"></span><br><span class="line">    <span class="built_in">KMP</span>(string &amp;t) : <span class="built_in">t</span>(t), <span class="built_in">f</span>(<span class="built_in">sz</span>(t)<span class="number">+1</span>) &#123;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">1</span>;i &lt; <span class="built_in">sz</span>(t); ++i) &#123;</span><br><span class="line">            <span class="type">int</span> j = f[i];</span><br><span class="line">            <span class="keyword">while</span> (j &amp;&amp; t[i] != t[j]) j = f[j];</span><br><span class="line">            f[i<span class="number">+1</span>] = t[i] == t[j] ? j<span class="number">+1</span> : <span class="number">0</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="function">vector&lt;<span class="type">int</span>&gt; <span class="title">match</span><span class="params">(string s)</span> </span>&#123;</span><br><span class="line">        vector&lt;<span class="type">int</span>&gt; ans;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>, j = <span class="number">0</span>;i &lt; <span class="built_in">sz</span>(s); ++i) &#123;</span><br><span class="line">            <span class="keyword">while</span> (j &amp;&amp; s[i] != t[j]) j = f[j];</span><br><span class="line">            <span class="keyword">if</span> (s[i] == t[j]) j++;</span><br><span class="line">            <span class="keyword">if</span> (j == <span class="built_in">sz</span>(t)) ans.<span class="built_in">push_back</span>(i<span class="number">+1</span>-<span class="built_in">sz</span>(t));</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> ans;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<h3 id="kmp-automaton">KMP Automaton</h3>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">struct</span> <span class="title class_">KMP</span> &#123;</span><br><span class="line">  string t;</span><br><span class="line">  vector&lt;<span class="type">int</span>&gt; f;</span><br><span class="line">  <span class="type">int</span> s = <span class="number">0</span>; <span class="comment">// #matches</span></span><br><span class="line">  <span class="built_in">KMP</span>(string &amp;t) : <span class="built_in">t</span>(t), <span class="built_in">f</span>(<span class="built_in">sz</span>(t)<span class="number">+1</span>) &#123;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">1</span>, j = f[i];i &lt; <span class="built_in">sz</span>(t); ++i) &#123;</span><br><span class="line">      <span class="keyword">while</span> (j &amp;&amp; t[i] != t[j]) j = f[j];</span><br><span class="line">      j = f[i<span class="number">+1</span>] = t[i] == t[j] ? j + <span class="number">1</span> : <span class="number">0</span>;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125; </span><br><span class="line">  <span class="function"><span class="type">void</span> <span class="title">add</span><span class="params">(<span class="type">char</span> c)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">while</span> (s &amp;&amp; c != t[s]) s = f[s];</span><br><span class="line">    <span class="keyword">if</span> (c == t[s]) s++;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<h4 id="z-function">Z function</h4>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">struct</span> <span class="title class_">KMPZ</span> &#123;</span><br><span class="line">    vector&lt;<span class="type">int</span>&gt; z;</span><br><span class="line">    <span class="built_in">KMPZ</span>(string s) : <span class="built_in">z</span>(<span class="built_in">sz</span>(s)) &#123;</span><br><span class="line">        <span class="type">int</span> l = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">1</span>;i &lt; <span class="built_in">sz</span>(s); ++i) &#123;</span><br><span class="line">            <span class="keyword">if</span> (l+z[l] &gt; i) z[i] = <span class="built_in">min</span>(z[i-l], l+z[l]-i);</span><br><span class="line">            <span class="keyword">while</span> (i+z[i] &lt; <span class="built_in">sz</span>(s) &amp;&amp; s[z[i]] == s[i+z[i]]) z[i]++;</span><br><span class="line">            <span class="keyword">if</span> (i+z[i] &gt; l+z[l]) l = i;</span><br><span class="line">        &#125;</span><br><span class="line">        z[<span class="number">0</span>] = <span class="built_in">sz</span>(s);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<h3 id="trie-1">Trie</h3>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">struct</span> <span class="title class_">Trie</span> &#123;</span><br><span class="line">    <span class="meta">#<span class="keyword">define</span> a0 <span class="string">&#x27;a&#x27;</span> <span class="comment">// lowercase</span></span></span><br><span class="line">    <span class="meta">#<span class="keyword">define</span> ind (c-a0)</span></span><br><span class="line"></span><br><span class="line">    vector&lt;vector&lt;<span class="type">int</span>&gt;&gt; ch;</span><br><span class="line">    vector&lt;<span class="type">int</span>&gt; cnt;</span><br><span class="line">    <span class="type">int</span> tot;</span><br><span class="line">    <span class="built_in">Trie</span>(<span class="type">int</span> n) : <span class="built_in">ch</span>(n<span class="number">+1</span>,<span class="built_in">vector</span>&lt;<span class="type">int</span>&gt;(<span class="number">26</span>)), <span class="built_in">cnt</span>(n<span class="number">+1</span>), <span class="built_in">tot</span>(<span class="number">0</span>) &#123;&#125;</span><br><span class="line">   </span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">insert</span><span class="params">(string s)</span> </span>&#123;</span><br><span class="line">        <span class="type">int</span> u = <span class="number">0</span>; </span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">auto</span> c : s) &#123;</span><br><span class="line">            <span class="keyword">if</span> (!ch[u][ind]) ch[u][ind] = ++tot;</span><br><span class="line">            u = ch[u][ind];</span><br><span class="line">        &#125;</span><br><span class="line">        cnt[u]++;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="type">int</span> <span class="title">find</span><span class="params">(string s)</span> </span>&#123;</span><br><span class="line">        <span class="type">int</span> u = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">auto</span> c : s) &#123;</span><br><span class="line">            <span class="keyword">if</span> (!ch[u][ind]) <span class="keyword">return</span> <span class="number">-1</span>; <span class="comment">// fail</span></span><br><span class="line">            u = ch[u][ind];</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> cnt[u];</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<h3 id="manacher">Manacher</h3>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">struct</span> <span class="title class_">Manacher</span> &#123;</span><br><span class="line">    vector&lt;<span class="type">int</span>&gt; p; </span><br><span class="line">    string s = <span class="string">&quot;~|&quot;</span>;</span><br><span class="line">    <span class="built_in">Manacher</span>(string &amp;t) : <span class="built_in">p</span>(<span class="built_in">sz</span>(t)*<span class="number">2</span><span class="number">+2</span>) &#123;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">auto</span> c : t) s += c, s += <span class="string">&#x27;|&#x27;</span>;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">1</span>,r = <span class="number">0</span>, mid = <span class="number">0</span>;i &lt; <span class="built_in">sz</span>(s); ++i) &#123;</span><br><span class="line">            <span class="keyword">if</span> (i &lt;= r) p[i] = <span class="built_in">min</span>(p[mid*<span class="number">2</span>-i],r-i<span class="number">+1</span>);</span><br><span class="line">            <span class="keyword">while</span> (s[i-p[i]] == s[i+p[i]]) p[i]++;</span><br><span class="line">            <span class="keyword">if</span> (p[i]+i &gt; r) r = p[i]+i<span class="number">-1</span>, mid = i;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="type">int</span> <span class="title">d1</span><span class="params">(<span class="type">int</span> i)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> p[i*<span class="number">2</span><span class="number">+2</span>]/<span class="number">2</span>;</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">    <span class="function"><span class="type">int</span> <span class="title">d2</span><span class="params">(<span class="type">int</span> i)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> p[i*<span class="number">2</span><span class="number">+3</span>]/<span class="number">2</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<h3 id="safast">SAfast</h3>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">struct</span> <span class="title class_">SuffixArray</span> &#123;</span><br><span class="line">    <span class="type">int</span> n,p=<span class="number">0</span>;</span><br><span class="line">    vector&lt;<span class="type">int</span>&gt;bu,rk,sa,id;</span><br><span class="line">    <span class="function"><span class="keyword">inline</span> <span class="type">void</span> <span class="title">upd</span><span class="params">(<span class="type">int</span> x,<span class="type">int</span> y,<span class="type">int</span> i)</span></span>&#123;rk[y] = id[x] == id[y] &amp;&amp; id[x+i] == id[y+i]?p:++p;&#125;</span><br><span class="line">    <span class="built_in">SuffixArray</span>(string &amp;s) : <span class="built_in">n</span>(<span class="built_in">sz</span>(s)), <span class="built_in">bu</span>(<span class="number">256</span>),<span class="built_in">rk</span>(n<span class="number">+2</span>),<span class="built_in">sa</span>(n<span class="number">+2</span>),<span class="built_in">id</span>(n<span class="number">+2</span>) &#123;</span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> i = <span class="number">1</span>;i &lt;= n;++i) ++bu[s[i<span class="number">-1</span>]];</span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> i = <span class="number">1</span>;i &lt; <span class="number">256</span>;++i) bu[i] += bu[i<span class="number">-1</span>];</span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> i = n;i;--i) sa[bu[s[i<span class="number">-1</span>]]--] = i;</span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> i = <span class="number">1</span>;i &lt;= n;++i) rk[sa[i]] = s[sa[i<span class="number">-1</span>]<span class="number">-1</span>] == s[sa[i]<span class="number">-1</span>]?p:++p;</span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> i = <span class="number">1</span>;i &lt; n &amp;&amp; p &lt; n;i &lt;&lt;= <span class="number">1</span>)&#123;</span><br><span class="line">            bu.<span class="built_in">assign</span>(p<span class="number">+1</span>,<span class="number">0</span>);</span><br><span class="line">            <span class="keyword">for</span>(<span class="type">int</span> j = n-i<span class="number">+1</span>;j &lt;= n;++j) id[j-n+i] = j;</span><br><span class="line">            <span class="keyword">for</span>(<span class="type">int</span> j = <span class="number">1</span>,k = i;j &lt;= n;++j)&#123;++bu[rk[j]];<span class="keyword">if</span>(sa[j] &gt; i) id[++k] = sa[j]-i;&#125;</span><br><span class="line">            <span class="keyword">for</span>(<span class="type">int</span> j = <span class="number">1</span>;j &lt;= p;++j) bu[j] += bu[j<span class="number">-1</span>];</span><br><span class="line">            <span class="keyword">for</span>(<span class="type">int</span> j = n;j;--j) sa[bu[rk[id[j]]]--] = id[j],id[j] = rk[j];</span><br><span class="line">            p = <span class="number">0</span>;</span><br><span class="line">            <span class="keyword">for</span>(<span class="type">int</span> j = <span class="number">1</span>;j &lt;= n;++j) <span class="built_in">upd</span>(sa[j<span class="number">-1</span>],sa[j],i);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> i = <span class="number">0</span>;i &lt; n;++i) sa[i] = sa[i<span class="number">+1</span>]<span class="number">-1</span>; <span class="comment">//indexed with 0</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">getheight</span><span class="params">(string &amp;s)</span> </span>&#123;</span><br><span class="line">        rk.<span class="built_in">assign</span>(n,<span class="number">0</span>); height.<span class="built_in">assign</span>(n,<span class="number">0</span>);</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>;i &lt; n; ++i) rk[sa[i]] = i;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>, k = <span class="number">0</span>; i &lt; n; ++i) &#123;</span><br><span class="line">            <span class="keyword">if</span> (rk[i] == <span class="number">0</span>) <span class="keyword">continue</span>;</span><br><span class="line">            <span class="keyword">if</span> (k) --k;</span><br><span class="line">            <span class="keyword">while</span> (s[i + k] == s[sa[rk[i] - <span class="number">1</span>] + k] &amp;&amp; s[i+k] != <span class="string">&#x27;#&#x27;</span>) ++k;</span><br><span class="line">            height[rk[i]] = k;</span><br><span class="line">   		&#125;</span><br><span class="line">        st.<span class="built_in">assign</span>(n,<span class="built_in">vector</span>&lt;<span class="type">int</span>&gt;(<span class="number">1</span>+(<span class="type">int</span>)<span class="built_in">log2</span>(n)));</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>;i &lt; n; ++i) st[i][<span class="number">0</span>] = height[i];</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> j = <span class="number">1</span>;j &lt; <span class="built_in">sz</span>(st[<span class="number">0</span>]); ++j) </span><br><span class="line">            <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>;i+(<span class="number">1</span>&lt;&lt;j)<span class="number">-1</span> &lt; n; ++i) </span><br><span class="line">                st[i][j] = <span class="built_in">min</span>(st[i][j<span class="number">-1</span>], st[i+(<span class="number">1</span>&lt;&lt;(j<span class="number">-1</span>))][j<span class="number">-1</span>]);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="type">int</span> <span class="title">getlcp</span><span class="params">(<span class="type">int</span> l, <span class="type">int</span> r)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(l == r) <span class="keyword">return</span> n - sa[l];</span><br><span class="line">        l++; <span class="type">int</span> k = <span class="built_in">log2</span>(r - l + <span class="number">1</span>);</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">min</span>(st[l][k],st[r-(<span class="number">1</span>&lt;&lt;k)<span class="number">+1</span>][k]);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<h3 id="ac-automaton">AC Automaton</h3>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Advanced: Build Suffix Tree</span></span><br><span class="line"><span class="comment">// maxn = sum of |s|</span></span><br><span class="line"><span class="type">int</span> ch[maxn][<span class="number">26</span>]; <span class="comment">// next state</span></span><br><span class="line"><span class="type">int</span> lnk[maxn]; <span class="comment">// suffix link</span></span><br><span class="line"><span class="type">int</span> fin[maxn]; <span class="comment">// if fin state</span></span><br><span class="line"><span class="type">int</span> tot; <span class="comment">// init=0</span></span><br><span class="line"><span class="type">int</span> cnt[maxn];</span><br><span class="line">vector&lt;<span class="type">int</span>&gt; ids[maxn];</span><br><span class="line">vector&lt;<span class="type">int</span>&gt; sG[maxn]; <span class="comment">// suffix tree graph</span></span><br><span class="line"><span class="type">int</span> ans[maxn];</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">acbuild</span><span class="params">(vector&lt;string&gt; &amp;vs)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>;i &lt; <span class="built_in">sz</span>(vs); ++i) &#123;</span><br><span class="line">        <span class="type">int</span> cur = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">auto</span> c : vs[i]) &#123; <span class="comment">// a is alphabet</span></span><br><span class="line">            <span class="keyword">if</span> (!ch[cur][c-<span class="string">&#x27;a&#x27;</span>]) ch[cur][c-<span class="string">&#x27;a&#x27;</span>] = ++tot;</span><br><span class="line">            cur = ch[cur][c-<span class="string">&#x27;a&#x27;</span>];</span><br><span class="line">        &#125;</span><br><span class="line">        ids[cur].<span class="built_in">push_back</span>(i<span class="number">+1</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    queue&lt;<span class="type">int</span>&gt; q;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>;i &lt; <span class="number">26</span>; ++i) </span><br><span class="line">        <span class="keyword">if</span> (ch[<span class="number">0</span>][i]) q.<span class="built_in">push</span>(ch[<span class="number">0</span>][i]);</span><br><span class="line">    <span class="keyword">while</span> (!q.<span class="built_in">empty</span>()) &#123;</span><br><span class="line">        <span class="type">int</span> u = q.<span class="built_in">front</span>(); q.<span class="built_in">pop</span>();</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>;i &lt; <span class="number">26</span>; ++i) &#123;</span><br><span class="line">            <span class="type">int</span> v = ch[u][i];</span><br><span class="line">            <span class="keyword">if</span> (v) lnk[v] = ch[lnk[u]][i], q.<span class="built_in">push</span>(v);</span><br><span class="line">            <span class="keyword">else</span> ch[u][i] = ch[lnk[u]][i];</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">1</span>;i &lt;= tot; ++i) &#123;</span><br><span class="line">        sG[lnk[i]].<span class="built_in">push_back</span>(i);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">dfs</span><span class="params">(<span class="type">int</span> x,<span class="type">int</span> fa)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">auto</span> v : sG[x]) &#123;</span><br><span class="line">        <span class="built_in">dfs</span>(v, x);</span><br><span class="line">        cnt[x] += cnt[v];</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">auto</span> id : ids[x]) &#123;</span><br><span class="line">        ans[id] = cnt[x];</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">query</span><span class="params">(string &amp;s)</span> </span>&#123;</span><br><span class="line">    <span class="type">int</span> i = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">auto</span> c : s) &#123;</span><br><span class="line">        i = ch[i][c-<span class="string">&#x27;a&#x27;</span>];</span><br><span class="line">        cnt[i]++;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">dfs</span>(<span class="number">0</span>, <span class="number">-1</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="suffixarray">SuffixArray</h3>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">struct</span> <span class="title class_">SA</span> &#123;</span><br><span class="line">    <span class="type">int</span> n, m;</span><br><span class="line">    vector&lt;<span class="type">int</span>&gt; sa, rk, height;</span><br><span class="line">    vector&lt;vector&lt;<span class="type">int</span>&gt;&gt; st;</span><br><span class="line">    <span class="built_in">SA</span>(string&amp; s) : <span class="built_in">n</span>(<span class="built_in">sz</span>(s)), <span class="built_in">m</span>(<span class="built_in">max</span>(<span class="number">256</span>, n)), <span class="built_in">sa</span>(n) &#123;</span><br><span class="line">        <span class="function">vector&lt;<span class="type">int</span>&gt; <span class="title">buc</span><span class="params">(m)</span>, <span class="title">x</span><span class="params">(n)</span></span>; <span class="comment">// counting sort</span></span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">auto</span> c : s) buc[c]++;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">1</span>;i &lt; m; ++i) buc[i] += buc[i<span class="number">-1</span>];</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> i = n<span class="number">-1</span>;i &gt;= <span class="number">0</span>; --i) sa[--buc[x[i] = s[i]]] = i;</span><br><span class="line">        vector&lt;<span class="type">int</span>&gt; y;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> k = <span class="number">1</span>; k &lt;= n; k &lt;&lt;= <span class="number">1</span>) &#123;</span><br><span class="line">            y.<span class="built_in">clear</span>();</span><br><span class="line">            <span class="keyword">for</span> (<span class="type">int</span> i = n-k; i &lt; n; ++i) y.<span class="built_in">push_back</span>(i);</span><br><span class="line">            <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>;i &lt; n; ++i) <span class="keyword">if</span> (sa[i] &gt;= k) y.<span class="built_in">push_back</span>(sa[i]-k);</span><br><span class="line">            </span><br><span class="line">            buc = <span class="built_in">vector</span>&lt;<span class="type">int</span>&gt;(m);</span><br><span class="line">            <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>;i &lt; n; ++i) buc[x[y[i]]]++;</span><br><span class="line">            <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">1</span>;i &lt; m; ++i) buc[i] += buc[i<span class="number">-1</span>];</span><br><span class="line">            <span class="keyword">for</span> (<span class="type">int</span> i = n<span class="number">-1</span>;i &gt;= <span class="number">0</span>; --i) sa[--buc[x[y[i]]]] = y[i];</span><br><span class="line">    </span><br><span class="line">            <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>;i &lt; n; ++i) y[i] = x[i];</span><br><span class="line">            <span class="type">int</span> p = <span class="number">1</span>; x[sa[<span class="number">0</span>]] = <span class="number">0</span>;</span><br><span class="line">            <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">1</span>;i &lt; n; ++i) </span><br><span class="line">                x[sa[i]] = (y[sa[i<span class="number">-1</span>]]==y[sa[i]] &amp;&amp; y[sa[i<span class="number">-1</span>]+k]==y[sa[i]+k]) ? p<span class="number">-1</span> : p++;</span><br><span class="line">            <span class="keyword">if</span> (p &gt;= n) <span class="keyword">break</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">getheight</span><span class="params">(string &amp;s)</span> </span>&#123;</span><br><span class="line">        rk.<span class="built_in">assign</span>(n,<span class="number">0</span>); height.<span class="built_in">assign</span>(n,<span class="number">0</span>);</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>;i &lt; n; ++i) rk[sa[i]] = i;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>, k = <span class="number">0</span>; i &lt; n; ++i) &#123;</span><br><span class="line">            <span class="keyword">if</span> (rk[i] == <span class="number">0</span>) <span class="keyword">continue</span>;</span><br><span class="line">            <span class="keyword">if</span> (k) --k;</span><br><span class="line">            <span class="keyword">while</span> (s[i + k] == s[sa[rk[i] - <span class="number">1</span>] + k] &amp;&amp; s[i+k] != <span class="string">&#x27;#&#x27;</span>) ++k;</span><br><span class="line">            height[rk[i]] = k;</span><br><span class="line">        &#125;</span><br><span class="line">        st.<span class="built_in">assign</span>(n,<span class="built_in">vector</span>&lt;<span class="type">int</span>&gt;(<span class="number">1</span>+(<span class="type">int</span>)<span class="built_in">log2</span>(n)));</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>;i &lt; n; ++i) st[i][<span class="number">0</span>] = height[i];</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> j = <span class="number">1</span>;j &lt; <span class="built_in">sz</span>(st[<span class="number">0</span>]); ++j) </span><br><span class="line">            <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>;i+(<span class="number">1</span>&lt;&lt;j)<span class="number">-1</span> &lt; n; ++i) </span><br><span class="line">                st[i][j] = <span class="built_in">min</span>(st[i][j<span class="number">-1</span>], st[i+(<span class="number">1</span>&lt;&lt;(j<span class="number">-1</span>))][j<span class="number">-1</span>]);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="type">int</span> <span class="title">getlcp</span><span class="params">(<span class="type">int</span> l, <span class="type">int</span> r)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(l == r) <span class="keyword">return</span> n - sa[l];</span><br><span class="line">        l++; <span class="type">int</span> k = <span class="built_in">log2</span>(r - l + <span class="number">1</span>);</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">min</span>(st[l][k],st[r-(<span class="number">1</span>&lt;&lt;k)<span class="number">+1</span>][k]);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<h3 id="suffixtree">SuffixTree</h3>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">struct</span> <span class="title class_">SuffixTree</span> &#123;</span><br><span class="line">    <span class="keyword">struct</span> <span class="title class_">node</span> &#123;</span><br><span class="line">        <span class="type">int</span> l=<span class="number">0</span>, r=<span class="number">0</span>, par=<span class="number">-1</span>, link=<span class="number">-1</span>,isleaf=<span class="number">-1</span>; <span class="comment">// [l,r)</span></span><br><span class="line">        map&lt;<span class="type">char</span>, <span class="type">int</span>&gt; next;</span><br><span class="line">        <span class="built_in">node</span>(<span class="type">int</span> l=<span class="number">0</span>, <span class="type">int</span> r=<span class="number">0</span>,<span class="type">int</span> par=<span class="number">-1</span>,<span class="type">int</span> isleaf=<span class="number">-1</span>) : <span class="built_in">l</span>(l),<span class="built_in">r</span>(r),<span class="built_in">par</span>(par),<span class="built_in">isleaf</span>(isleaf) &#123;</span><br><span class="line">            next.<span class="built_in">clear</span>();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;;</span><br><span class="line">    <span class="type">int</span> e=<span class="number">1</span>,last=<span class="number">1</span>,i=<span class="number">0</span>,tot=<span class="number">1</span>;</span><br><span class="line">    string s=<span class="string">&quot;&quot;</span>;</span><br><span class="line">    vector&lt;<span class="type">int</span>&gt; J;</span><br><span class="line">    vector&lt;node&gt; t;</span><br><span class="line">    <span class="built_in">SuffixTree</span>() : <span class="built_in">J</span>(<span class="number">2</span>),<span class="built_in">t</span>(<span class="number">2</span>) &#123;&#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">inline</span> <span class="type">int</span> <span class="title">getr</span><span class="params">(<span class="type">int</span> id)</span> </span>&#123; <span class="keyword">return</span> t[id].isleaf != <span class="number">-1</span> ? e : t[id].r; &#125;</span><br><span class="line">    <span class="function"><span class="keyword">inline</span> <span class="type">int</span> <span class="title">getlen</span><span class="params">(<span class="type">int</span> id)</span> </span>&#123; <span class="keyword">return</span> <span class="built_in">getr</span>(id) - t[id].l; &#125;</span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">addchar</span><span class="params">(<span class="type">char</span> c)</span> </span>&#123;</span><br><span class="line">        J.<span class="built_in">push_back</span>(<span class="number">0</span>); s += c; </span><br><span class="line">        <span class="keyword">if</span> (<span class="built_in">sz</span>(s)==<span class="number">1</span>) &#123;</span><br><span class="line">            t[<span class="number">0</span>].next[s[<span class="number">0</span>]] = <span class="number">1</span>;</span><br><span class="line">            t[<span class="number">1</span>] = <span class="built_in">node</span>(<span class="number">0</span>,<span class="number">1</span>,<span class="number">0</span>,<span class="number">0</span>);</span><br><span class="line">            J[<span class="number">1</span>] = <span class="number">0</span>; tot = <span class="number">1</span>; e = <span class="number">1</span>; last = <span class="number">1</span>;</span><br><span class="line">            <span class="keyword">return</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        i++;</span><br><span class="line">        <span class="type">int</span> pre = last; </span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> j = J[i]<span class="number">+1</span>; j &lt;= i; ++j) &#123; </span><br><span class="line">            <span class="type">int</span> cur = pre; J[i<span class="number">+1</span>] = j; <span class="type">int</span> g = <span class="number">0</span>;</span><br><span class="line">            <span class="keyword">if</span> (t[cur].isleaf == <span class="number">-1</span> &amp;&amp; t[cur].link != <span class="number">-1</span>) &#123; </span><br><span class="line">                cur = t[cur].link;</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                <span class="keyword">if</span> (cur) g = <span class="built_in">getlen</span>(cur), cur = t[cur].par; </span><br><span class="line">                <span class="keyword">if</span> (cur) cur = t[cur].link; </span><br><span class="line">                <span class="keyword">if</span> (!cur) g = i-j;</span><br><span class="line">                <span class="keyword">while</span> (g &gt; <span class="number">0</span>) g -= <span class="built_in">getlen</span>(cur = t[cur].next[s[i-g]]);            </span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">if</span> ((!g &amp;&amp; t[cur].next[s[i]]) || (g &amp;&amp; s[<span class="built_in">getr</span>(cur)+g] == s[i])) &#123;</span><br><span class="line">                <span class="keyword">if</span> (!g) t[pre].link = cur, pre = cur;</span><br><span class="line">                J[i<span class="number">+1</span>] = j<span class="number">-1</span>; <span class="keyword">break</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">if</span> (g) &#123;</span><br><span class="line">                <span class="type">int</span> fa = t[cur].par;</span><br><span class="line">                t.<span class="built_in">push_back</span>(<span class="built_in">node</span>(t[cur].l,<span class="built_in">getr</span>(cur)+g,fa)); tot++;</span><br><span class="line">                t[fa].next[s[t[tot].l]] = tot;</span><br><span class="line">                t[tot].next[s[<span class="built_in">getr</span>(cur)+g]] = cur;</span><br><span class="line">                t[cur].l = <span class="built_in">getr</span>(cur)+g;</span><br><span class="line">                t[cur].par = tot;</span><br><span class="line">                cur = tot;</span><br><span class="line">            &#125;</span><br><span class="line">            t[pre].link = cur;</span><br><span class="line">            pre = cur;</span><br><span class="line">            t.<span class="built_in">push_back</span>(<span class="built_in">node</span>(i,i<span class="number">+1</span>,cur,j)); tot++;</span><br><span class="line">            last = tot;</span><br><span class="line">            t[cur].next[s[i]] = tot; </span><br><span class="line">        &#125;</span><br><span class="line">        e++;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<h3 id="广义后缀自动机">广义后缀自动机</h3>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">struct</span> <span class="title class_">SAM</span> &#123;</span><br><span class="line">    <span class="keyword">struct</span> <span class="title class_">Node</span> &#123;</span><br><span class="line">        vector&lt;<span class="type">int</span>&gt; ch;</span><br><span class="line">        <span class="type">int</span> len=<span class="number">0</span>,fa=<span class="number">0</span>; <span class="comment">// len=longest,minlen = len[fa]+1</span></span><br><span class="line">        <span class="type">int</span> leaf=<span class="number">-1</span>; <span class="comment">// leaf &amp; endpos</span></span><br><span class="line">        <span class="built_in">Node</span>() : <span class="built_in">ch</span>(<span class="number">26</span>) &#123;&#125;</span><br><span class="line">    &#125;;</span><br><span class="line">    vector&lt;Node&gt; t;</span><br><span class="line">    <span class="type">int</span> las = <span class="number">1</span>,tot = <span class="number">1</span>,slen=<span class="number">0</span>;</span><br><span class="line">    <span class="built_in">SAM</span>() : <span class="built_in">t</span>(<span class="number">2</span>) &#123;&#125; <span class="comment">// root=1</span></span><br><span class="line">    <span class="function"><span class="type">int</span> <span class="title">newnode</span><span class="params">(<span class="type">int</span> l=<span class="number">-1</span>)</span> </span>&#123; <span class="keyword">if</span> (tot<span class="number">+1</span> == <span class="built_in">sz</span>(t)) t.<span class="built_in">resize</span>(<span class="built_in">sz</span>(t)&lt;&lt;<span class="number">1</span>);  t[tot<span class="number">+1</span>].leaf = l; <span class="keyword">return</span> ++tot;&#125;</span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">newstring</span><span class="params">()</span> </span>&#123; las = <span class="number">1</span>; &#125; <span class="comment">// general</span></span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">addchar</span><span class="params">(<span class="type">char</span> c)</span> </span>&#123;</span><br><span class="line">        c -= <span class="string">&#x27;a&#x27;</span>;</span><br><span class="line">        <span class="type">int</span> p = las; </span><br><span class="line">        <span class="keyword">if</span> (t[p].ch[c]) &#123; <span class="comment">// general</span></span><br><span class="line">            <span class="type">int</span> x = t[p].ch[c];</span><br><span class="line">            <span class="keyword">if</span> (t[p].len + <span class="number">1</span> == t[x].len) &#123;</span><br><span class="line">                las = x;</span><br><span class="line">                <span class="keyword">return</span>;</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                <span class="type">int</span> y = <span class="built_in">newnode</span>(); t[y].ch = t[x].ch; t[y].fa = t[x].fa;</span><br><span class="line">                t[y].len = t[p].len<span class="number">+1</span>;</span><br><span class="line">                <span class="keyword">while</span> (p &amp;&amp; t[p].ch[c]==x) t[p].ch[c]=y,p=t[p].fa;</span><br><span class="line">                t[x].fa = y;</span><br><span class="line">                las = y;</span><br><span class="line">                <span class="keyword">return</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125; <span class="comment">// general</span></span><br><span class="line">        las = <span class="built_in">newnode</span>(slen++); <span class="type">int</span> np = las;</span><br><span class="line">        t[np].len = t[p].len + <span class="number">1</span>;</span><br><span class="line">        <span class="keyword">while</span> (p &amp;&amp; !t[p].ch[c]) t[p].ch[c] = np, p = t[p].fa;</span><br><span class="line">        <span class="keyword">if</span> (!p) t[np].fa = <span class="number">1</span>;</span><br><span class="line">        <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="type">int</span> q = t[p].ch[c];</span><br><span class="line">            <span class="keyword">if</span> (t[p].len + <span class="number">1</span> == t[q].len) t[np].fa = q;</span><br><span class="line">            <span class="keyword">else</span> &#123;</span><br><span class="line">                <span class="type">int</span> nq = <span class="built_in">newnode</span>(); t[nq].ch = t[q].ch; t[nq].fa = t[q].fa;</span><br><span class="line">                t[nq].len = t[p].len + <span class="number">1</span>;</span><br><span class="line">                t[q].fa = t[np].fa = nq;</span><br><span class="line">                <span class="keyword">while</span> (p &amp;&amp; t[p].ch[c] == q) t[p].ch[c] = nq, p = t[p].fa;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    vector&lt;vector&lt;<span class="type">int</span>&gt;&gt; G;</span><br><span class="line">    vector&lt;<span class="type">int</span>&gt; cnt;</span><br><span class="line">    <span class="function"><span class="keyword">inline</span> <span class="type">void</span> <span class="title">solve</span><span class="params">()</span></span>&#123;</span><br><span class="line">        G.<span class="built_in">assign</span>(tot<span class="number">+1</span>,<span class="built_in">vector</span>&lt;<span class="type">int</span>&gt;());</span><br><span class="line">        cnt.<span class="built_in">assign</span>(tot<span class="number">+1</span>,<span class="number">0</span>);</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">2</span>;i &lt;= tot; ++i) &#123;</span><br><span class="line">            G[t[i].fa].<span class="built_in">push_back</span>(i);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    ll ans = <span class="number">0</span>;</span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">dfs</span><span class="params">(<span class="type">int</span> x,<span class="type">int</span> fa)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (t[x].leaf != <span class="number">-1</span>) &#123;</span><br><span class="line">            cnt[x] = <span class="number">1</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">auto</span> v : G[x]) &#123;</span><br><span class="line">            <span class="built_in">dfs</span>(v, x);</span><br><span class="line">            cnt[x] += cnt[v];</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> (fa &amp;&amp; cnt[x] &gt; <span class="number">1</span>)</span><br><span class="line">            ans = <span class="built_in">max</span>(ans, <span class="number">1ll</span> * cnt[x] * t[x].len);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<h2 id="网络流二分图">网络流/二分图</h2>
<h3 id="匈牙利算法">匈牙利算法</h3>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">struct</span> <span class="title class_">Match</span> &#123;</span><br><span class="line">    <span class="comment">// matching in O(|V| * |E|)</span></span><br><span class="line">    <span class="type">int</span> n, m, cnt;</span><br><span class="line">    vector&lt;vector&lt;<span class="type">int</span>&gt;&gt; G;</span><br><span class="line">    vector&lt;<span class="type">int</span>&gt; matched, vis;</span><br><span class="line">    <span class="built_in">Match</span>(<span class="type">int</span> n, <span class="type">int</span> m) : <span class="built_in">n</span>(n), <span class="built_in">m</span>(m), <span class="built_in">G</span>(n<span class="number">+1</span>) &#123;&#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">addedge</span><span class="params">(<span class="type">int</span> x, <span class="type">int</span> y)</span> </span>&#123;</span><br><span class="line">        G[x].<span class="built_in">push_back</span>(y);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="type">bool</span> <span class="title">dfs</span><span class="params">(<span class="type">int</span> x)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">auto</span> v : G[x]) <span class="keyword">if</span> (!vis[v]) &#123;</span><br><span class="line">            vis[v] = <span class="number">1</span>;</span><br><span class="line">            <span class="keyword">if</span> (!matched[v] || <span class="built_in">dfs</span>(matched[v])) &#123; </span><br><span class="line">                matched[v] = x; </span><br><span class="line">                <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="type">int</span> <span class="title">calc</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        cnt = <span class="number">0</span>;</span><br><span class="line">        matched.<span class="built_in">assign</span>(m<span class="number">+1</span>, <span class="number">0</span>);</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">1</span>;i &lt;= n; ++i) &#123;</span><br><span class="line">            vis.<span class="built_in">assign</span>(m<span class="number">+1</span>, <span class="number">0</span>);</span><br><span class="line">            <span class="keyword">if</span> (<span class="built_in">dfs</span>(i)) cnt++;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> cnt;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<h3 id="二分图最大权完美匹配">二分图最大权完美匹配</h3>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">struct</span> <span class="title class_">KM</span> &#123;</span><br><span class="line">    <span class="keyword">typedef</span> <span class="type">long</span> <span class="type">long</span> T;</span><br><span class="line">    <span class="type">const</span> T oo = <span class="number">1e18</span>;</span><br><span class="line"></span><br><span class="line">    <span class="type">int</span> n;</span><br><span class="line">    vector&lt;vector&lt;T&gt;&gt; G;</span><br><span class="line">    vector&lt;<span class="type">int</span>&gt; matched, pre;</span><br><span class="line">    vector&lt;T&gt; slack, ex, ey;</span><br><span class="line">    vector&lt;<span class="type">bool</span>&gt; vis;</span><br><span class="line"> </span><br><span class="line">    <span class="built_in">KM</span>(<span class="type">int</span> n) : <span class="built_in">n</span>(n), <span class="built_in">G</span>(n<span class="number">+1</span>,<span class="built_in">vector</span>&lt;T&gt;(n<span class="number">+1</span>, -oo)) &#123;&#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">addedge</span><span class="params">(<span class="type">int</span> x, <span class="type">int</span> y, T z)</span> </span>&#123; G[x][y] = z; &#125;</span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">match</span><span class="params">(<span class="type">int</span> u)</span> </span>&#123;	</span><br><span class="line">        <span class="type">int</span> x, y = <span class="number">0</span>, yy = <span class="number">0</span>; T delta = oo;</span><br><span class="line">        pre.<span class="built_in">assign</span>(n<span class="number">+1</span>, <span class="number">0</span>); slack.<span class="built_in">assign</span>(n<span class="number">+1</span>, oo);</span><br><span class="line">        matched[y] = u;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">while</span>(matched[y] != <span class="number">-1</span>) &#123;	</span><br><span class="line">            x = matched[y]; delta = oo; vis[y] = <span class="number">1</span>;</span><br><span class="line">            <span class="keyword">for</span>(<span class="type">int</span> i = <span class="number">1</span>;i &lt;= n; ++i) <span class="keyword">if</span> (!vis[i]) &#123;	</span><br><span class="line">                </span><br><span class="line">                <span class="keyword">if</span> (slack[i] &gt; ex[x] + ey[i] - G[x][i]) &#123;	</span><br><span class="line">                    slack[i] = ex[x] + ey[i] - G[x][i];</span><br><span class="line">                    pre[i] = y;</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="keyword">if</span>(slack[i] &lt; delta) delta = slack[i], yy = i;</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="keyword">for</span>(<span class="type">int</span> i = <span class="number">0</span>;i &lt;= n; ++i) &#123;	</span><br><span class="line">                <span class="keyword">if</span>(vis[i]) ex[matched[i]] -= delta, ey[i] += delta;</span><br><span class="line">                <span class="keyword">else</span> slack[i] -= delta;</span><br><span class="line">            &#125;</span><br><span class="line">            y = yy;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">while</span>(y) matched[y] = matched[pre[y]], y=pre[y];</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function">T <span class="title">calc</span><span class="params">()</span> </span>&#123;	</span><br><span class="line">        matched.<span class="built_in">assign</span>(n<span class="number">+1</span>,<span class="number">-1</span>);</span><br><span class="line">        ex.<span class="built_in">assign</span>(n<span class="number">+1</span>, <span class="number">0</span>); ey.<span class="built_in">assign</span>(n<span class="number">+1</span>, <span class="number">0</span>);</span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> i = <span class="number">1</span>;i &lt;= n; ++i) vis.<span class="built_in">assign</span>(n<span class="number">+1</span>, <span class="number">0</span>), <span class="built_in">match</span>(i);</span><br><span class="line">        T res = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> i = <span class="number">1</span>;i &lt;= n; ++i)</span><br><span class="line">            <span class="keyword">if</span>(matched[i] != <span class="number">-1</span>) res += G[matched[i]][i];</span><br><span class="line">        <span class="keyword">return</span> res;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<h3 id="dinicfrom-erik">Dinic(from Erik)</h3>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">struct</span> <span class="title class_">Dinic</span> &#123;</span><br><span class="line">  <span class="keyword">struct</span> <span class="title class_">edge</span> &#123;</span><br><span class="line">    ll j, c, f;</span><br><span class="line">  &#125;;</span><br><span class="line">  vector&lt;edge&gt; e;</span><br><span class="line">  vector&lt;vector&lt;<span class="type">int</span>&gt;&gt; adj;</span><br><span class="line">  vector&lt;<span class="type">int</span>&gt; lvl, ptr;</span><br><span class="line">  <span class="type">int</span> n, m = <span class="number">0</span>;</span><br><span class="line">  <span class="built_in">Dinic</span>(<span class="type">int</span> n) : <span class="built_in">n</span>(n<span class="number">+1</span>), <span class="built_in">adj</span>(n<span class="number">+1</span>), <span class="built_in">lvl</span>(n<span class="number">+1</span>), <span class="built_in">ptr</span>(n<span class="number">+1</span>) &#123;&#125;</span><br><span class="line">  <span class="function"><span class="type">int</span> <span class="title">addedge</span><span class="params">(<span class="type">int</span> i, <span class="type">int</span> j, ll c)</span> </span>&#123;</span><br><span class="line">    e.<span class="built_in">push_back</span>(&#123;j, c, <span class="number">0</span>&#125;);</span><br><span class="line">    e.<span class="built_in">push_back</span>(&#123;i, <span class="number">0</span>, <span class="number">0</span>&#125;);</span><br><span class="line">    adj[i].<span class="built_in">push_back</span>(m++);</span><br><span class="line">    adj[j].<span class="built_in">push_back</span>(m++);</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">sz</span>(e)<span class="number">-2</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="function"><span class="type">bool</span> <span class="title">bfs</span><span class="params">(<span class="type">int</span> s, <span class="type">int</span> t)</span> </span>&#123;</span><br><span class="line">    <span class="built_in">fill</span>(lvl.<span class="built_in">begin</span>(), lvl.<span class="built_in">end</span>(), <span class="number">-1</span>);</span><br><span class="line">    lvl[s] = <span class="number">0</span>;</span><br><span class="line">    queue&lt;<span class="type">int</span>&gt; q; </span><br><span class="line">    q.<span class="built_in">push</span>(s);</span><br><span class="line">    <span class="keyword">for</span> (; !q.<span class="built_in">empty</span>();) &#123;</span><br><span class="line">      <span class="type">int</span> v = q.<span class="built_in">front</span>(); q.<span class="built_in">pop</span>();</span><br><span class="line">      <span class="keyword">for</span> (<span class="type">int</span> i : adj[v])</span><br><span class="line">        <span class="keyword">if</span> (e[i].c &gt; e[i].f &amp;&amp; lvl[e[i].j] &lt; <span class="number">0</span>) &#123;</span><br><span class="line">          lvl[e[i].j] = lvl[v] + <span class="number">1</span>;</span><br><span class="line">          q.<span class="built_in">push</span>(e[i].j);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> lvl[t] != <span class="number">-1</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="function">ll <span class="title">dfs</span><span class="params">(<span class="type">int</span> v, <span class="type">int</span> t, ll push)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (push == <span class="number">0</span> || v == t)</span><br><span class="line">      <span class="keyword">return</span> push;</span><br><span class="line">    <span class="keyword">for</span> (; ptr[v] &lt; (<span class="type">int</span>)adj[v].<span class="built_in">size</span>(); ptr[v]++) &#123;</span><br><span class="line">      <span class="type">int</span> id = adj[v][ptr[v]];</span><br><span class="line">      <span class="keyword">if</span> (lvl[v] + <span class="number">1</span> != lvl[e[id].j] || e[id].c == e[id].f)</span><br><span class="line">        <span class="keyword">continue</span>;</span><br><span class="line">      ll f = <span class="built_in">dfs</span>(e[id].j, t, <span class="built_in">min</span>(push, e[id].c - e[id].f));</span><br><span class="line">      <span class="keyword">if</span> (f != <span class="number">0</span>) &#123;</span><br><span class="line">        e[id].f += f;</span><br><span class="line">        e[id ^ <span class="number">1</span>].f -= f;</span><br><span class="line">        <span class="keyword">return</span> f;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="function">ll <span class="title">maxflow</span><span class="params">(<span class="type">int</span> s, <span class="type">int</span> t)</span> </span>&#123;</span><br><span class="line">    ll ret = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">while</span> (<span class="built_in">bfs</span>(s, t)) &#123;</span><br><span class="line">      <span class="built_in">fill</span>(ptr.<span class="built_in">begin</span>(), ptr.<span class="built_in">end</span>(), <span class="number">0</span>);</span><br><span class="line">      <span class="keyword">while</span> (ll f = <span class="built_in">dfs</span>(s, t, <span class="number">1e18</span>))</span><br><span class="line">        ret += f;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> ret;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<h3 id="最小费用流">最小费用流</h3>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">typedef</span> <span class="type">long</span> <span class="type">long</span> ll;</span><br><span class="line"><span class="type">const</span> ll inf = LLONG_MAX / <span class="number">4</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">min_cost_max_flow</span> &#123;</span><br><span class="line">  <span class="keyword">typedef</span> __gnu_pbds::priority_queue&lt;pair&lt;ll,<span class="type">int</span>&gt;&gt; prio;</span><br><span class="line">  <span class="keyword">struct</span> <span class="title class_">edge</span> &#123;</span><br><span class="line">    ll j, f, c, p, r;</span><br><span class="line">  &#125;;</span><br><span class="line">  <span class="type">int</span> n;</span><br><span class="line">  vector&lt;<span class="type">int</span>&gt; p;</span><br><span class="line">  vector&lt;ll&gt; d, pi;</span><br><span class="line">  vector&lt;vector&lt;edge&gt;&gt; e;</span><br><span class="line">  vector&lt;prio::point_iterator&gt; its;</span><br><span class="line">  <span class="built_in">min_cost_max_flow</span>(<span class="type">int</span> n) : <span class="built_in">n</span>(n), <span class="built_in">p</span>(n), <span class="built_in">d</span>(n), <span class="built_in">e</span>(n), <span class="built_in">its</span>(n) &#123;&#125;</span><br><span class="line">  <span class="function"><span class="type">void</span> <span class="title">addEdge</span><span class="params">(<span class="type">int</span> i, <span class="type">int</span> j, ll c, ll p)</span> </span>&#123;</span><br><span class="line">    e[i].<span class="built_in">push_back</span>(&#123;j, <span class="number">0</span>, c, p, e[j].<span class="built_in">size</span>() + (i == j)&#125;);</span><br><span class="line">    e[j].<span class="built_in">push_back</span>(&#123;i, <span class="number">0</span>, <span class="number">0</span>, -p, e[i].<span class="built_in">size</span>() - <span class="number">1</span>&#125;);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="function"><span class="type">void</span> <span class="title">path</span><span class="params">(<span class="type">int</span> s)</span> </span>&#123;</span><br><span class="line">    <span class="built_in">swap</span>(d, pi);</span><br><span class="line">    d.<span class="built_in">assign</span>(n, inf);</span><br><span class="line">    d[s] = <span class="number">0</span>;</span><br><span class="line">    prio pq; its.<span class="built_in">assign</span>(n, pq.<span class="built_in">end</span>());</span><br><span class="line">    its[s] = pq.<span class="built_in">push</span>(&#123;<span class="number">0</span>, s&#125;);</span><br><span class="line">    <span class="keyword">while</span> (!pq.<span class="built_in">empty</span>()) &#123;</span><br><span class="line">      ll di = pq.<span class="built_in">top</span>().first;</span><br><span class="line">      <span class="type">int</span> i = pq.<span class="built_in">top</span>().second;</span><br><span class="line">      pq.<span class="built_in">pop</span>();</span><br><span class="line">      <span class="keyword">if</span> (-di != d[i] - pi[i])</span><br><span class="line">        <span class="keyword">continue</span>;</span><br><span class="line">      <span class="keyword">for</span> (edge &amp; ed : e[i]) &#123;</span><br><span class="line">        ll v = d[i] + ed.p;</span><br><span class="line">        <span class="keyword">if</span> (ed.c &gt; ed.f &amp;&amp; v &lt; d[ed.j]) &#123;</span><br><span class="line">          d[ed.j] = v; p[ed.j] = ed.r;</span><br><span class="line">          <span class="keyword">if</span> (its[ed.j] == pq.<span class="built_in">end</span>())</span><br><span class="line">            its[ed.j] = pq.<span class="built_in">push</span>(&#123;-(d[ed.j] - pi[ed.j]), ed.j&#125;);</span><br><span class="line">          <span class="keyword">else</span></span><br><span class="line">            pq.<span class="built_in">modify</span>(its[ed.j], &#123;-(d[ed.j] - pi[ed.j]), ed.j&#125;);</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="function">pair&lt;ll, ll&gt; <span class="title">minCostMaxFlow</span><span class="params">(<span class="type">int</span> s, <span class="type">int</span> t)</span> </span>&#123;</span><br><span class="line">    ll f = <span class="number">0</span>, c = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">while</span> (<span class="built_in">path</span>(s), d[t] &lt; inf) &#123;</span><br><span class="line">      ll w = inf;</span><br><span class="line">      <span class="keyword">for</span> (<span class="type">int</span> i = t; i != s; i = e[i][p[i]].j) &#123;</span><br><span class="line">        edge &amp; ed = e[e[i][p[i]].j][e[i][p[i]].r];</span><br><span class="line">        w = <span class="built_in">min</span>(w, ed.c - ed.f);</span><br><span class="line">      &#125;</span><br><span class="line">      f += w;</span><br><span class="line">      c += d[t] * w;</span><br><span class="line">      <span class="keyword">for</span> (<span class="type">int</span> i = t; i != s; i = e[i][p[i]].j) &#123;</span><br><span class="line">        edge &amp; ed = e[e[i][p[i]].j][e[i][p[i]].r];</span><br><span class="line">        e[i][p[i]].f -= w;</span><br><span class="line">        ed.f += w;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> &#123;f, c&#125;;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">// for negative costs, call this function before min cost max flow</span></span><br><span class="line">  <span class="function"><span class="type">void</span> <span class="title">setPi</span><span class="params">(<span class="type">int</span> s)</span> </span>&#123;</span><br><span class="line">    d.<span class="built_in">assign</span>(n, inf);</span><br><span class="line">    d[s] = <span class="number">0</span>;</span><br><span class="line">    <span class="type">bool</span> c = <span class="literal">true</span>;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; n &amp;&amp; c; i++) &#123;</span><br><span class="line">      c = <span class="literal">false</span>;</span><br><span class="line">      <span class="keyword">for</span> (<span class="type">int</span> j = <span class="number">0</span>; j &lt; n; j++)</span><br><span class="line">        <span class="keyword">for</span> (edge &amp; ed : e[j])</span><br><span class="line">          <span class="keyword">if</span> (ed.c &gt; ed.f &amp;&amp; d[j] + ed.p &lt; d[ed.j])</span><br><span class="line">            d[ed.j] = d[j] + ed.p, c = <span class="literal">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">assert</span>(!c);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<h1 id="python">Python</h1>
<h3 id="输入">输入</h3>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">calc = <span class="number">1</span></span><br><span class="line">nxt = [<span class="number">1</span>, <span class="number">0</span>]</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> _ <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">int</span>(<span class="built_in">input</span>())):</span><br><span class="line">  n = <span class="built_in">int</span>(<span class="built_in">input</span>())</span><br><span class="line">  a = <span class="built_in">sorted</span>(<span class="built_in">list</span>(<span class="built_in">map</span>(<span class="built_in">int</span>, <span class="built_in">input</span>().split())))</span><br><span class="line">  <span class="keyword">while</span> calc &lt;= n:</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(calc):</span><br><span class="line">      nxt.append(calc - i - <span class="number">1</span>)</span><br><span class="line">    calc *= <span class="number">2</span></span><br><span class="line">  left = []</span><br><span class="line">  <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(n + <span class="number">1</span>):</span><br><span class="line">    <span class="keyword">if</span> i == <span class="number">0</span> <span class="keyword">or</span> i == n <span class="keyword">or</span> a[i] != a[i - <span class="number">1</span>]:</span><br><span class="line">      left.append(i)</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">      left.append(left[-<span class="number">1</span>])</span><br><span class="line">  mid = <span class="number">1</span></span><br><span class="line">  ans = n + <span class="number">2</span></span><br><span class="line">  <span class="keyword">while</span> mid &lt;= n:</span><br><span class="line">    <span class="keyword">for</span> len1 <span class="keyword">in</span> <span class="built_in">range</span>(n + <span class="number">1</span>):</span><br><span class="line">      <span class="keyword">if</span> left[len1] == len1:</span><br><span class="line">        len2 = left[<span class="built_in">min</span>(n, len1 + mid)] - len1</span><br><span class="line">        len3 = n - len1 - len2</span><br><span class="line">        ans = <span class="built_in">min</span>(ans, nxt[len1] + (mid - len2) + nxt[len3])</span><br><span class="line">    mid *= <span class="number">2</span></span><br><span class="line">  <span class="built_in">print</span>(ans)</span><br></pre></td></tr></table></figure>
</article><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta"><i class="fas fa-circle-user fa-fw"></i>Author: </span><span class="post-copyright-info"><a href="http://fyind.de">Fyind</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta"><i class="fas fa-square-arrow-up-right fa-fw"></i>Link: </span><span class="post-copyright-info"><a href="http://fyind.de/2023/05/26/%E7%AE%97%E6%B3%95%E6%A8%A1%E6%9D%BF%E9%9B%86%E5%90%88/">http://fyind.de/2023/05/26/%E7%AE%97%E6%B3%95%E6%A8%A1%E6%9D%BF%E9%9B%86%E5%90%88/</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta"><i class="fas fa-circle-exclamation fa-fw"></i>Copyright Notice: </span><span class="post-copyright-info">All articles on this blog are licensed under <a target="_blank" rel="noopener" href="https://creativecommons.org/licenses/by-nc-sa/4.0/">CC BY-NC-SA 4.0</a> unless otherwise stated.</span></div></div><div class="tag_share"><div class="post-meta__tag-list"><a class="post-meta__tags" href="/tags/%E7%AE%97%E6%B3%95/">算法</a><a class="post-meta__tags" href="/tags/%E7%AE%97%E6%B3%95%E6%A8%A1%E6%9D%BF/">算法模板</a></div><div class="post-share"><div class="social-share" data-image="/img/pic1.PNG" data-sites="facebook,twitter,wechat,weibo,qq"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/butterfly-extsrc/sharejs/dist/css/share.min.css" media="print" onload="this.media='all'"><script src="https://cdn.jsdelivr.net/npm/butterfly-extsrc/sharejs/dist/js/social-share.min.js" defer></script></div></div><nav class="pagination-post" id="pagination"><a class="pagination-related" href="/2023/06/02/%E7%A1%AC%E4%BB%B6%E5%AE%89%E5%85%A8/" title="硬件安全"><div class="cover" style="background: var(--default-bg-color)"></div><div class="info"><div class="info-1"><div class="info-item-1">Previous</div><div class="info-item-2">硬件安全</div></div><div class="info-2"><div class="info-item-1">硬件安全 安全的定义  Create, maintain and attest a secure state for an embedded device Ensure confidentiality, integrity and availability of the data processed on the device Ensure the safety of the people and the environment interacting with the device Protect the device itself, its environment and other data from processed malicious data  Abstraction Layers and Attack Vectors skipped Secure Embedded System Design Typical Criteria  Time to market Design + manufacturing setup cost Component + manufact...</div></div></div></a><a class="pagination-related" href="/2023/04/27/%E6%A8%A1%E6%8B%9F%E7%94%B5%E5%AD%90%E6%8A%80%E6%9C%AF/" title="模拟电子技术"><div class="cover" style="background: var(--default-bg-color)"></div><div class="info text-right"><div class="info-1"><div class="info-item-1">Next</div><div class="info-item-2">模拟电子技术</div></div><div class="info-2"><div class="info-item-1">模拟电子技术 本征半导体 本征半导体是纯净的具有晶体结构的半导体。  载流子：运载电荷的粒子称为载流子。导体导电只有一种载流子, 即自由电子导电; 空穴：当电子挣脱共价键的束缚变成为自由电子后，在共价键中留下一个空位置，称为空穴  </div></div></div></a></nav><div class="relatedPosts"><div class="headline"><i class="fas fa-thumbs-up fa-fw"></i><span>Related Articles</span></div><div class="relatedPosts-list"><a class="pagination-related" href="/2020/08/10/AtCoder%E9%A2%98%E8%A7%A3/" title="AtCoder题解"><div class="cover" style="background: var(--default-bg-color)"></div><div class="info text-center"><div class="info-1"><div class="info-item-1"><i class="far fa-calendar-alt fa-fw"></i> 2020-08-10</div><div class="info-item-2">AtCoder题解</div></div><div class="info-2"><div class="info-item-1">AtCoder Grand Contest 047 AtCoder Grand Contest 047 A. Integer Product 给定 \(n\) 个浮点数，计算有多少个 \((i, j)\) 使得 \(A_{i} \cdot A_{j}\) 是整数 \(2\leq N \leq 200 \  000\) , $ 0 &lt; A_{i} ^{4}$ , \(A_{i}\) 最多 \(9\) 为小数. 思路  通过题设条件缩小范围， 枚举  由于数据比较大，不能直接暴力做。判断是整数这个条件不太好集体维护。所以要找出题目中的特性，看看有没有机会让范围缩小。最好是可以 先考虑 \(A_{i} \cdot A_{j}\) 什么情况下是整数。发现，对于任意有限小数 \(x\), 可以在乘上 \(10^{n}\) 后肯定会变成整数。所以每个数必然是 \(k\cdot 2^{m}\cdot 5^{n}\) 的形式, 通过乘 \(10^{n}\) 把分母上的 \(2^{m}\cdot 5^{n}\) 约去. 而之前的 \(k\) 不影响答案。所以我们只要考虑 \(2^{m}\cd...</div></div></div></a><a class="pagination-related" href="/2020/07/29/CodeForces%E9%A2%98%E8%A7%A3/" title="CodeForces题解"><div class="cover" style="background: var(--default-bg-color)"></div><div class="info text-center"><div class="info-1"><div class="info-item-1"><i class="far fa-calendar-alt fa-fw"></i> 2020-07-29</div><div class="info-item-2">CodeForces题解</div></div><div class="info-2"><div class="info-item-1">Educational Codeforces Round 92 (Rated for Div. 2) link A. LCM Problem  构造  给定区间 \([l,r]\) 求 \(2\) 个在里面的数，使得它们的最小公倍数也在区间内，否则输出-1 -1 . 可以知道 \(l, l*2\) 是2个最小的可能组合，只要判断 \(l*2 &gt; r\) 即可. B. Array Walk  贪心  由于可以折返的步数比较少。我们可以枚举折返的步数。当折返的步数固定为 \(j\) 的时候。有2种情况，  \(j\) 步都是折返后又回来。这种情况最远走到了 \([1,k-2j]\) \(j-1\) 步是折返后又回来，最后一步是折返后不回来。这种情况的区间是 \([1,k-2(j-1)-1]\)  可以证明：若折返，则必定是在当前区间的最大两个相邻元素间折返。 那么我们用前缀和的方式求出 \([1,i]\) 的和还有最大相邻元素的位置。那么分情况讨论这两种情况的最大值。最后取个更优的解即可 \(O(n)\) 123456789101112131415161718192021222...</div></div></div></a><a class="pagination-related" href="/2020/05/26/Python%E9%AB%98%E6%96%AF%E6%B6%88%E5%85%83/" title="三行写完高斯消元，这就是Python!!!"><div class="cover" style="background: var(--default-bg-color)"></div><div class="info text-center"><div class="info-1"><div class="info-item-1"><i class="far fa-calendar-alt fa-fw"></i> 2020-05-26</div><div class="info-item-2">三行写完高斯消元，这就是Python!!!</div></div><div class="info-2"><div class="info-item-1">三行写完高斯消元，这就是Python!!! 洛谷评测链接 先给大家看一眼核心代码 核心代码 123for i in range(len(a)):    row = [j for j in range(len(a)) if a[j][i] != 0 and sum(a[j][:i]) &lt; 1e-8][0]    a[:] = [r + a[row]*(-r[i]/a[row][i]) if j != row else r/a[row][i] for (j,r) in enumerate(a)] 没错，就只有三行，完成了高斯消元最核心的操作，把矩阵消元成主对角线为1，其余除了常数项全是0的形式。我只用了Python中的切片操作，列表解析式，还有numpy中array的性质。 为了方便大家理解，我先来介绍一些这些python中的语法 python语法介绍 切片 语法格式是 [开始:结束] 可以取出列表中的一段区间,如果不填写就是默认开始位置是0，结束位置是列表最后一个元素位置。注意这里的区间是左闭右开区间。并且支持倒着数，也就是使用负号 比如： 12345l = [0,2,3,4...</div></div></div></a><a class="pagination-related" href="/2020/08/10/Trie/" title="Trie"><div class="cover" style="background: var(--default-bg-color)"></div><div class="info text-center"><div class="info-1"><div class="info-item-1"><i class="far fa-calendar-alt fa-fw"></i> 2020-08-10</div><div class="info-item-2">Trie</div></div><div class="info-2"><div class="info-item-1">Trie Trie 是一个用树来存储字符串的结构。 基本操作  插入一个字符串 查找一个字符串是否在树中 维护对应字符串的附加信息(如个数之类的)  模板  P2580 于是他错误的点名开始了  1234567891011121314151617181920212223242526272829303132333435363738394041424344454647#include &lt;bits/stdc++.h&gt;using namespace std;const int maxn = 1e4 + 5;const int maxnode = maxn * 50;const int sigma_size = 26;#define c ((ch)-&#x27;a&#x27;)int child[maxnode][sigma_size], val[maxnode];int sz, n;void insert(string s) &#123;    int u = 0; // 从根节点 u = 0 开始插入    for (char ch : s) &#123;        i...</div></div></div></a><a class="pagination-related" href="/2020/08/14/%E5%81%9A%E9%A2%98%E7%BB%8F%E9%AA%8C%E4%B8%8E%E6%95%99%E8%AE%AD/" title="做题经验与教训"><div class="cover" style="background: var(--default-bg-color)"></div><div class="info text-center"><div class="info-1"><div class="info-item-1"><i class="far fa-calendar-alt fa-fw"></i> 2020-08-14</div><div class="info-item-2">做题经验与教训</div></div><div class="info-2"><div class="info-item-1">思维CheatSheet 思路 多角度思维 这个题有多少种思路，目前选择一条路。每个思路都要想一点。如果是dp，有多种方程，那每个都要考虑一下。 推导Observation  眼看出来的 基本公式，基于基本公式的Ob  卡住了 你想的题根本不是原问题  中间推导错了 题目读错了  换角度理解问题 转换问题的表示方法。换一种理解方式 常规推导  考虑答案由什么组成(拆分出可以维护的情况) 考虑最简单的几种情况(best case) 考虑状态的转移 什么会产生贡献，哪些会对答案产生贡献 考虑答案的单调性，时空转移  分类讨论  问题可以分为几种情况  贪心  什么构成答案最好（构造一个最好的答案）  计算操作的最大值最小值： 以某种贪心的策略一定可以达到最优，模拟这种策略的步骤  分析最大值  二分/枚举  如给定某个参数，是不是会好做一定  动态规划、递推  考虑问题的子结构 考虑状态是什么，如何转移 换一种更好的状态 简化子结构（去除冗余状态） 通过贪心优化转移，减少转移的数量 用数据结构维护一维度  整理思维 筛选合理的推断和考虑不确定的推断  题目的位置与代码量和思路深度对应...</div></div></div></a><a class="pagination-related" href="/2020/11/10/%E5%87%A0%E4%BD%95%E4%B9%A0%E9%A2%98/" title="几何习题"><div class="cover" style="background: var(--default-bg-color)"></div><div class="info text-center"><div class="info-1"><div class="info-item-1"><i class="far fa-calendar-alt fa-fw"></i> 2020-11-10</div><div class="info-item-2">几何习题</div></div><div class="info-2"><div class="info-item-1">几何习题 二分 ABC181F Silver Woods 题意 有 \(n \le 100\) 个木桩在 \(-100\le y \le100\) 的范围里。你有一个圆，圆的半径你可以选择的。求可以把圆从最左边移动到最右边的最大半径。 思路 首先题目具有单调性：如果一个半径可以移动，那么更小的也可以。如果一个半径不能移动，那么更大的肯定不行。所以我们考虑二分。那给定一个 \(r\) 怎么检查呢。对于两个点\(x,y\)，如果 \(r\) 不能从他们之间通过，那么我们就将这两个点连起来。对于上下界\((y=\pm 100)\) 如果不能这个线和这个点之间穿过去，那么我们就连上他们。我们枚举把所有的点都连线完。如果存在一条由上界连向下界的边，那么这个半径就被 “拦住了”不能通过。如果没有就一定存在一条路径可以通过。所以我们用并查集连接就好了，最后检查一下上下界有没有连起来即可。 代码 12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849505152535455...</div></div></div></a></div></div></div><div class="aside-content" id="aside-content"><div class="card-widget card-info text-center"><div class="avatar-img"><img src="/img/pic1.PNG" onerror="this.onerror=null;this.src='/img/friend_404.gif'" alt="avatar"/></div><div class="author-info-name">Fyind</div><div class="author-info-description"></div><div class="site-data"><a href="/archives/"><div class="headline">Articles</div><div class="length-num">85</div></a><a href="/tags/"><div class="headline">Tags</div><div class="length-num">83</div></a><a href="/categories/"><div class="headline">Categories</div><div class="length-num">26</div></a></div><a id="card-info-btn" target="_blank" rel="noopener" href="https://github.com/Fyind"><i class="fab fa-github"></i><span>Follow Me</span></a><div class="card-info-social-icons"><a class="social-icon" href="https://github.com/Fyind" target="_blank" title="Github"><i class="fab fa-github"></i></a><a class="social-icon" href="mailto:tarjan0025@gmail.com" target="_blank" title="Email"><i class="fas fa-envelope"></i></a><a class="social-icon" href="https://jq.qq.com/?_wv=1027&amp;k=d0kMY0nN" target="_blank" title="QQ"><i class="fab fa-qq"></i></a></div></div><div class="card-widget card-announcement"><div class="item-headline"><i class="fas fa-bullhorn fa-shake"></i><span>Announcement</span></div><div class="announcement_content">欢迎来逛逛我的博客</div></div><div class="sticky_layout"><div class="card-widget" id="card-toc"><div class="item-headline"><i class="fas fa-stream"></i><span>Contents</span><span class="toc-percentage"></span></div><div class="toc-content"><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#%E7%AE%97%E6%B3%95%E6%A8%A1%E6%9D%BF%E9%9B%86%E5%90%88"><span class="toc-number">1.</span> <span class="toc-text">算法模板集合</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%BC%96%E8%AF%91"><span class="toc-number">1.1.</span> <span class="toc-text">编译</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%AF%B9%E6%8B%8D"><span class="toc-number">1.1.1.</span> <span class="toc-text">对拍</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%B5%8B%E6%97%B6%E9%97%B4"><span class="toc-number">1.1.2.</span> <span class="toc-text">测时间</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#debug"><span class="toc-number">1.2.</span> <span class="toc-text">DEBUG</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#vscode-%E4%BB%A3%E7%A0%81%E7%89%87%E6%AE%B5"><span class="toc-number">1.3.</span> <span class="toc-text">VSCODE 代码片段</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E8%AE%A1%E7%AE%97%E5%87%A0%E4%BD%95"><span class="toc-number">1.4.</span> <span class="toc-text">计算几何</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%9C%86"><span class="toc-number">1.4.0.1.</span> <span class="toc-text">圆</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%8E%92%E5%BA%8F%E6%9E%81%E8%A7%92"><span class="toc-number">1.4.1.</span> <span class="toc-text">排序极角</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E8%AF%BB%E5%85%A5%E4%BC%98%E5%8C%96"><span class="toc-number">1.5.</span> <span class="toc-text">读入优化</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%BC%96%E8%AF%91%E4%BC%98%E5%8C%96"><span class="toc-number">1.5.1.</span> <span class="toc-text">编译优化</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#cin%E4%BC%98%E5%8C%96"><span class="toc-number">1.5.2.</span> <span class="toc-text">cin优化</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%BF%AB%E8%AF%BB%E5%BF%AB%E5%86%99"><span class="toc-number">1.5.3.</span> <span class="toc-text">快读快写</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%A4%9A%E4%B8%AA%E6%B5%8B%E8%AF%95%E6%95%B0%E6%8D%AE"><span class="toc-number">1.5.4.</span> <span class="toc-text">多个测试数据</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E4%BB%A5eof%E7%BB%93%E5%B0%BE"><span class="toc-number">1.5.4.1.</span> <span class="toc-text">以EOF结尾</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E4%BB%A50%E7%BB%93%E5%B0%BE"><span class="toc-number">1.5.4.2.</span> <span class="toc-text">以0结尾</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%BB%99%E5%AE%9A%E6%95%B0%E6%8D%AE%E7%BB%84%E6%95%B0"><span class="toc-number">1.5.4.3.</span> <span class="toc-text">给定数据组数</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#stl"><span class="toc-number">1.6.</span> <span class="toc-text">STL</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#struct"><span class="toc-number">1.6.1.</span> <span class="toc-text">struct</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#sort"><span class="toc-number">1.6.2.</span> <span class="toc-text">sort</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#vector"><span class="toc-number">1.6.3.</span> <span class="toc-text">vector</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#map"><span class="toc-number">1.6.4.</span> <span class="toc-text">map</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#set"><span class="toc-number">1.6.5.</span> <span class="toc-text">set</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#bitset"><span class="toc-number">1.6.6.</span> <span class="toc-text">bitset</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#pbds"><span class="toc-number">1.6.7.</span> <span class="toc-text">pbds</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%A8%A1%E6%8B%9F"><span class="toc-number">1.7.</span> <span class="toc-text">模拟</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%88%9D%E5%A7%8B%E5%8C%96"><span class="toc-number">1.7.1.</span> <span class="toc-text">初始化</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%9B%87%E5%BD%A2%E7%9F%A9%E9%98%B5%E9%81%8D%E5%8E%86"><span class="toc-number">1.7.2.</span> <span class="toc-text">蛇形矩阵遍历</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BA%8C%E5%88%86"><span class="toc-number">1.7.3.</span> <span class="toc-text">二分</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%A6%BB%E6%95%A3%E5%8C%96%E5%8E%BB%E9%87%8D"><span class="toc-number">1.8.</span> <span class="toc-text">离散化去重</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%A6%BB%E6%95%A3%E5%8C%96%E5%8E%BB%E9%87%8D-1"><span class="toc-number">1.8.1.</span> <span class="toc-text">离散化去重</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%A6%BB%E6%95%A3%E5%8C%96"><span class="toc-number">1.8.2.</span> <span class="toc-text">离散化</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%8E%BB%E9%87%8D%E5%A0%86%E5%9C%A8%E4%B8%80%E8%B5%B7"><span class="toc-number">1.8.3.</span> <span class="toc-text">去重（堆在一起）</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%AD%97%E7%AC%A6%E4%B8%B2%E8%BD%AC%E6%8D%A2"><span class="toc-number">1.8.4.</span> <span class="toc-text">字符串转换</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%A6%BB%E6%95%A3%E5%89%8D%E7%BC%80%E5%92%8C"><span class="toc-number">1.8.5.</span> <span class="toc-text">离散前缀和</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%95%B0%E5%AD%A6"><span class="toc-number">1.9.</span> <span class="toc-text">数学</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%90%91%E4%B8%8A%E5%90%91%E4%B8%8B%E5%8F%96%E6%95%B4"><span class="toc-number">1.9.0.1.</span> <span class="toc-text">向上&#x2F;向下取整</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E9%9A%8F%E6%9C%BA%E6%95%B0"><span class="toc-number">1.9.0.2.</span> <span class="toc-text">随机数</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%8F%96%E6%A8%A1%E7%BB%93%E6%9E%84%E4%BD%93"><span class="toc-number">1.9.1.</span> <span class="toc-text">取模结构体</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%8F%96%E6%A8%A1"><span class="toc-number">1.9.1.1.</span> <span class="toc-text">取模</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%BF%AB%E9%80%9F%E5%B9%82%E9%BE%9F%E9%80%9F%E4%B9%98"><span class="toc-number">1.9.1.2.</span> <span class="toc-text">快速幂&#x2F;龟速乘</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E8%B4%B9%E5%B0%94%E9%A9%AC%E5%B0%8F%E5%AE%9A%E7%90%86%E6%B1%82%E9%80%86%E5%85%83"><span class="toc-number">1.9.1.3.</span> <span class="toc-text">费尔马小定理求逆元</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#on%E6%B1%82n%E4%B8%AA%E9%80%86%E5%85%83"><span class="toc-number">1.9.1.4.</span> <span class="toc-text">O(n)求n个逆元</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E9%98%B6%E4%B9%98%E4%B8%8E%E9%98%B6%E4%B9%98%E7%9A%84%E9%80%86%E5%85%83"><span class="toc-number">1.9.1.5.</span> <span class="toc-text">阶乘与阶乘的逆元</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%B1%82%E7%BB%84%E5%90%88%E6%95%B0"><span class="toc-number">1.9.1.6.</span> <span class="toc-text">求组合数</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#%E6%B1%82%E5%A4%A7%E7%BB%84%E5%90%88%E6%95%B0-ok"><span class="toc-number">1.9.1.6.1.</span> <span class="toc-text">求大组合数 \(O(K)\)</span></a></li></ol></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%91%A8%E6%9C%9F%E8%AE%A1%E6%95%B0"><span class="toc-number">1.9.2.</span> <span class="toc-text">周期计数</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%89%A9%E5%B1%95%E6%AC%A7%E5%87%A0%E9%87%8C%E5%BE%97exgcd"><span class="toc-number">1.9.3.</span> <span class="toc-text">扩展欧几里得exgcd</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%90%8C%E4%BD%99%E6%96%B9%E7%A8%8B"><span class="toc-number">1.9.4.</span> <span class="toc-text">同余方程</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%AC%A7%E6%8B%89%E5%87%BD%E6%95%B0sqrtn"><span class="toc-number">1.9.5.</span> <span class="toc-text">欧拉函数\(\sqrt(n)\)</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#e%E6%B0%8F%E7%AD%9B%E6%B3%95"><span class="toc-number">1.9.6.</span> <span class="toc-text">E氏筛法</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%BA%BF%E6%80%A7%E7%AD%9B%E5%88%86%E8%A7%A3%E8%B4%A8%E5%9B%A0%E6%95%B0"><span class="toc-number">1.9.7.</span> <span class="toc-text">线性筛&#x2F;分解质因数</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E4%BD%8E%E5%B8%B8%E6%95%B0"><span class="toc-number">1.9.7.1.</span> <span class="toc-text">低常数</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%89%80%E6%9C%89%E5%9B%A0%E5%AD%90"><span class="toc-number">1.9.8.</span> <span class="toc-text">所有因子</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%8D%95%E4%B8%AA%E8%B4%A8%E5%9B%A0%E6%95%B0%E5%88%86%E8%A7%A3osqrt-x"><span class="toc-number">1.9.9.</span> <span class="toc-text">单个质因数分解\(O(\sqrt x)\)</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%95%B0%E8%AE%BA%E5%88%86%E5%9D%97"><span class="toc-number">1.9.10.</span> <span class="toc-text">数论分块</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%B4%A0%E6%95%B0%E6%B5%8B%E8%AF%95miller-rabin"><span class="toc-number">1.9.11.</span> <span class="toc-text">素数测试Miller-Rabin</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#pollard-rho%E6%89%BE%E4%B8%80%E4%B8%AA%E5%9B%A0%E5%AD%90-%E5%88%86%E8%A7%A3%E8%B4%A8%E5%9B%A0%E6%95%B0"><span class="toc-number">1.9.12.</span> <span class="toc-text">Pollard Rho找一个因子,
分解质因数</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%89%A9%E5%B1%95%E4%B8%AD%E5%9B%BD%E5%89%A9%E4%BD%99%E5%AE%9A%E7%90%86excrt"><span class="toc-number">1.9.13.</span> <span class="toc-text">扩展中国剩余定理EXCRT</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%BF%AB%E9%80%9F%E5%82%85%E9%87%8C%E5%8F%B6%E5%8F%98%E6%8D%A2fft"><span class="toc-number">1.9.14.</span> <span class="toc-text">快速傅里叶变换FFT</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%BF%AB%E9%80%9F%E6%95%B0%E8%AE%BA%E5%8F%98%E6%8D%A2ntt"><span class="toc-number">1.9.15.</span> <span class="toc-text">快速数论变换NTT</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%BA%BF%E6%80%A7%E4%BB%A3%E6%95%B0"><span class="toc-number">1.10.</span> <span class="toc-text">线性代数</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%9F%A9%E9%98%B5%E5%BF%AB%E9%80%9F%E5%B9%82"><span class="toc-number">1.10.1.</span> <span class="toc-text">矩阵快速幂</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%9F%A9%E9%98%B5%E6%B1%82%E9%80%86%E5%8F%96%E6%A8%A1"><span class="toc-number">1.10.2.</span> <span class="toc-text">矩阵求逆(取模)</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%BA%BF%E6%80%A7%E5%9F%BA"><span class="toc-number">1.10.3.</span> <span class="toc-text">线性基</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%AB%98%E6%96%AF%E6%B6%88%E5%85%83%E8%80%81"><span class="toc-number">1.10.4.</span> <span class="toc-text">高斯消元（老）</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%8A%A8%E6%80%81%E8%A7%84%E5%88%92"><span class="toc-number">1.11.</span> <span class="toc-text">动态规划</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%9C%80%E9%95%BF%E4%B8%8D%E4%B8%8B%E9%99%8D%E5%AD%90%E5%BA%8F%E5%88%97-onlogn"><span class="toc-number">1.11.1.</span> <span class="toc-text">最长不下降子序列 \(O(nlogn)\)</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%9C%80%E9%95%BF%E5%85%AC%E5%85%B1%E5%AD%90%E5%BA%8F%E5%88%97-onlogn"><span class="toc-number">1.11.2.</span> <span class="toc-text">最长公共子序列 \(O(nlogn)\)</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#dag%E6%9C%80%E9%95%BF%E8%B7%AF"><span class="toc-number">1.11.3.</span> <span class="toc-text">DAG最长路</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%A0%91%E5%BD%A2dp"><span class="toc-number">1.11.4.</span> <span class="toc-text">树形dp</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%A0%91%E5%BD%A2%E8%83%8C%E5%8C%85%E7%AE%80%E5%8D%95%E7%89%88"><span class="toc-number">1.11.4.1.</span> <span class="toc-text">树形背包（简单版）</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%A0%91%E5%BD%A2%E8%83%8C%E5%8C%85on2"><span class="toc-number">1.11.4.2.</span> <span class="toc-text">树形背包（\(O(n^2)\)）</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%8A%B6%E6%80%81%E5%8E%8B%E7%BC%A9%E4%BD%8D%E8%BF%90%E7%AE%97"><span class="toc-number">1.11.5.</span> <span class="toc-text">状态压缩位运算</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%95%B0%E4%BD%8Ddp"><span class="toc-number">1.11.6.</span> <span class="toc-text">数位dp</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#sos-dp"><span class="toc-number">1.11.7.</span> <span class="toc-text">SOS DP</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#convexhull-trick"><span class="toc-number">1.11.8.</span> <span class="toc-text">Convexhull Trick</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#changeroot"><span class="toc-number">1.11.9.</span> <span class="toc-text">Changeroot</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84"><span class="toc-number">1.12.</span> <span class="toc-text">数据结构</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%B7%AE%E5%88%86%E6%95%B0%E7%BB%84"><span class="toc-number">1.12.1.</span> <span class="toc-text">差分数组</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%8D%95%E8%B0%83%E9%98%9F%E5%88%97%E6%B1%82%E5%8C%BA%E9%97%B4%E6%9C%80%E5%80%BC"><span class="toc-number">1.12.2.</span> <span class="toc-text">单调队列求区间最值</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%8D%95%E8%B0%83%E6%A0%88%E6%B1%82%E5%8F%B3%E8%BE%B9%E4%B8%8B%E4%B8%80%E4%B8%AA%E6%AF%94%E8%87%AA%E5%B7%B1%E5%A4%A7%E7%9A%84%E4%BD%8D%E7%BD%AE"><span class="toc-number">1.12.3.</span> <span class="toc-text">单调栈求右边下一个比自己大的位置</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#minmaxqueue"><span class="toc-number">1.12.4.</span> <span class="toc-text">MinMaxQueue</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#propertyqueue"><span class="toc-number">1.12.5.</span> <span class="toc-text">PropertyQueue</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%8D%95%E6%A0%88%E9%98%9F%E5%88%97"><span class="toc-number">1.12.6.</span> <span class="toc-text">单栈队列</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%8F%8C%E6%8C%87%E9%92%88"><span class="toc-number">1.12.7.</span> <span class="toc-text">双指针</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%B0%8F%E7%9A%84%E5%8F%AF%E4%BB%A5%E9%82%A3%E4%B9%88%E5%A4%A7%E7%9A%84%E4%B9%9F%E5%8F%AF%E4%BB%A5"><span class="toc-number">1.12.7.1.</span> <span class="toc-text">小的可以那么大的也可以</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%A4%A7%E7%9A%84%E5%8F%AF%E4%BB%A5%E9%82%A3%E4%B9%88%E5%B0%8F%E7%9A%84%E4%B9%9F%E5%8F%AF%E4%BB%A5"><span class="toc-number">1.12.7.2.</span> <span class="toc-text">大的可以那么小的也可以</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#rmqst%E8%A1%A8"><span class="toc-number">1.12.8.</span> <span class="toc-text">RMQ&#x2F;ST表</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#trie"><span class="toc-number">1.12.9.</span> <span class="toc-text">01Trie</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%B9%B6%E6%9F%A5%E9%9B%86"><span class="toc-number">1.12.10.</span> <span class="toc-text">并查集</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%99%AE%E9%80%9A%E5%B9%B6%E6%9F%A5%E9%9B%86"><span class="toc-number">1.12.10.1.</span> <span class="toc-text">普通并查集</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%A0%91%E7%8A%B6%E6%95%B0%E7%BB%84"><span class="toc-number">1.12.11.</span> <span class="toc-text">树状数组</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%88%A0%E9%99%A4%E4%B8%80%E4%B8%AA%E7%82%B9%E5%9C%A8%E5%89%8D%E9%9D%A2%E5%90%8E%E9%9D%A2%E6%8F%92%E5%85%A5%E4%B8%80%E4%B8%AA%E7%82%B9"><span class="toc-number">1.12.11.1.</span> <span class="toc-text">删除一个点，在前面&#x2F;后面插入一个点</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%88%86%E5%9D%97"><span class="toc-number">1.12.12.</span> <span class="toc-text">分块</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%80%86%E5%BA%8F%E5%AF%B9"><span class="toc-number">1.12.13.</span> <span class="toc-text">逆序对</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%BA%BF%E6%AE%B5%E6%A0%91"><span class="toc-number">1.12.14.</span> <span class="toc-text">线段树</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%8A%A8%E6%80%81%E5%BC%80%E7%82%B9"><span class="toc-number">1.12.14.1.</span> <span class="toc-text">动态开点</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%89%AB%E6%8F%8F%E7%BA%BF"><span class="toc-number">1.12.15.</span> <span class="toc-text">扫描线</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%9D%83%E5%80%BC%E7%BA%BF%E6%AE%B5%E6%A0%91"><span class="toc-number">1.12.16.</span> <span class="toc-text">权值线段树</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#splay"><span class="toc-number">1.12.17.</span> <span class="toc-text">Splay</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#splay%E5%8E%8B%E8%A1%8C"><span class="toc-number">1.12.17.1.</span> <span class="toc-text">Splay压行</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%96%87%E8%89%BAsplay"><span class="toc-number">1.12.17.2.</span> <span class="toc-text">文艺Splay</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%96%87%E8%89%BA%E6%8C%87%E9%92%88splay"><span class="toc-number">1.12.18.</span> <span class="toc-text">文艺指针Splay</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%B8%BB%E5%B8%AD%E6%A0%91"><span class="toc-number">1.12.19.</span> <span class="toc-text">主席树</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%BA%A2%E9%BB%91%E6%A0%91pbds"><span class="toc-number">1.12.20.</span> <span class="toc-text">红黑树PBDS</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%93%88%E5%B8%8C%E8%A1%A8pbds"><span class="toc-number">1.12.21.</span> <span class="toc-text">哈希表pbds</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%8E%AB%E9%98%9F"><span class="toc-number">1.12.22.</span> <span class="toc-text">莫队</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%9B%BE%E8%AE%BA"><span class="toc-number">1.13.</span> <span class="toc-text">图论</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%8B%93%E6%89%91%E6%8E%92%E5%BA%8F"><span class="toc-number">1.13.1.</span> <span class="toc-text">拓扑排序</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BA%8C%E5%88%86%E5%9B%BE%E6%9F%93%E8%89%B2"><span class="toc-number">1.13.2.</span> <span class="toc-text">二分图染色</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%90%9C%E7%AE%80%E5%8D%95%E7%8E%AF"><span class="toc-number">1.13.3.</span> <span class="toc-text">搜简单环</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#spfabellman%E6%B1%82%E8%B4%9F%E7%8E%AF"><span class="toc-number">1.13.4.</span> <span class="toc-text">SPFA,Bellman求负环</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#dijkstra"><span class="toc-number">1.13.5.</span> <span class="toc-text">Dijkstra</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#k%E7%9F%AD%E8%B7%AF"><span class="toc-number">1.13.6.</span> <span class="toc-text">k短路</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%8A%BF%E8%83%BDdijkstra"><span class="toc-number">1.13.6.1.</span> <span class="toc-text">势能Dijkstra</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#floyd"><span class="toc-number">1.13.7.</span> <span class="toc-text">Floyd</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#johnson%E5%85%A8%E6%BA%90%E6%9C%80%E7%9F%AD%E8%B7%AF"><span class="toc-number">1.13.8.</span> <span class="toc-text">Johnson全源最短路</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%9C%80%E5%B0%8F%E7%94%9F%E6%88%90%E6%A0%91"><span class="toc-number">1.13.9.</span> <span class="toc-text">最小生成树</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#tarjan-%E7%BC%A9%E7%82%B9%E5%89%B2%E7%82%B9%E6%A1%A5"><span class="toc-number">1.13.10.</span> <span class="toc-text">Tarjan 缩点,割点,桥</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%9F%93%E8%89%B2"><span class="toc-number">1.13.11.</span> <span class="toc-text">2染色</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%9F%BA%E7%8E%AF%E6%A0%91"><span class="toc-number">1.13.12.</span> <span class="toc-text">基环树</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%97%A0%E5%90%91%E5%9B%BE%E5%9F%BA%E7%8E%AF%E6%A0%91"><span class="toc-number">1.13.12.1.</span> <span class="toc-text">无向图基环树</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%9C%80%E5%A4%A7%E5%9B%A2"><span class="toc-number">1.13.13.</span> <span class="toc-text">最大团</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%A0%91"><span class="toc-number">1.14.</span> <span class="toc-text">树</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#lca"><span class="toc-number">1.14.1.</span> <span class="toc-text">LCA</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#lcaonly-node"><span class="toc-number">1.14.1.1.</span> <span class="toc-text">LCA(only node)</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%A0%91%E5%89%96lca"><span class="toc-number">1.14.1.2.</span> <span class="toc-text">树剖LCA</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%9B%B4%E5%BE%84%E9%87%8D%E5%BF%83"><span class="toc-number">1.14.2.</span> <span class="toc-text">直径，重心</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%B1%82%E7%82%B9%E5%88%B0%E7%9B%B4%E5%BE%84%E7%9A%84%E8%B7%9D%E7%A6%BB"><span class="toc-number">1.14.2.1.</span> <span class="toc-text">求点到直径的距离</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%8D%A2%E6%A0%B9dp"><span class="toc-number">1.14.3.</span> <span class="toc-text">换根dp</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%82%B9%E5%88%86%E6%B2%BB"><span class="toc-number">1.14.4.</span> <span class="toc-text">点分治</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#dsu-on-tree"><span class="toc-number">1.14.5.</span> <span class="toc-text">DSU on Tree</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#path-via-lca"><span class="toc-number">1.14.5.1.</span> <span class="toc-text">Path via LCA</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%AD%97%E7%AC%A6%E4%B8%B2"><span class="toc-number">1.15.</span> <span class="toc-text">字符串</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#kmp"><span class="toc-number">1.15.1.</span> <span class="toc-text">KMP</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#kmp-automaton"><span class="toc-number">1.15.2.</span> <span class="toc-text">KMP Automaton</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#z-function"><span class="toc-number">1.15.2.1.</span> <span class="toc-text">Z function</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#trie-1"><span class="toc-number">1.15.3.</span> <span class="toc-text">Trie</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#manacher"><span class="toc-number">1.15.4.</span> <span class="toc-text">Manacher</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#safast"><span class="toc-number">1.15.5.</span> <span class="toc-text">SAfast</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#ac-automaton"><span class="toc-number">1.15.6.</span> <span class="toc-text">AC Automaton</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#suffixarray"><span class="toc-number">1.15.7.</span> <span class="toc-text">SuffixArray</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#suffixtree"><span class="toc-number">1.15.8.</span> <span class="toc-text">SuffixTree</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%B9%BF%E4%B9%89%E5%90%8E%E7%BC%80%E8%87%AA%E5%8A%A8%E6%9C%BA"><span class="toc-number">1.15.9.</span> <span class="toc-text">广义后缀自动机</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%BD%91%E7%BB%9C%E6%B5%81%E4%BA%8C%E5%88%86%E5%9B%BE"><span class="toc-number">1.16.</span> <span class="toc-text">网络流&#x2F;二分图</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%8C%88%E7%89%99%E5%88%A9%E7%AE%97%E6%B3%95"><span class="toc-number">1.16.1.</span> <span class="toc-text">匈牙利算法</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BA%8C%E5%88%86%E5%9B%BE%E6%9C%80%E5%A4%A7%E6%9D%83%E5%AE%8C%E7%BE%8E%E5%8C%B9%E9%85%8D"><span class="toc-number">1.16.2.</span> <span class="toc-text">二分图最大权完美匹配</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#dinicfrom-erik"><span class="toc-number">1.16.3.</span> <span class="toc-text">Dinic(from Erik)</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%9C%80%E5%B0%8F%E8%B4%B9%E7%94%A8%E6%B5%81"><span class="toc-number">1.16.4.</span> <span class="toc-text">最小费用流</span></a></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#python"><span class="toc-number">2.</span> <span class="toc-text">Python</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%BE%93%E5%85%A5"><span class="toc-number">2.0.1.</span> <span class="toc-text">输入</span></a></li></ol></li></ol></li></ol></div></div><div class="card-widget card-recent-post"><div class="item-headline"><i class="fas fa-history"></i><span>Recent Posts</span></div><div class="aside-list"><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/2025/07/17/C-%E9%AB%98%E6%80%A7%E8%83%BD%E7%BC%96%E7%A8%8B/" title="C++高性能编程">C++高性能编程</a><time datetime="2025-07-17T19:47:19.000Z" title="Created 2025-07-17 19:47:19">2025-07-17</time></div></div><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/2025/07/16/%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F%E6%A6%82%E5%BF%B5/" title="操作系统概念">操作系统概念</a><time datetime="2025-07-16T20:55:14.000Z" title="Created 2025-07-16 20:55:14">2025-07-16</time></div></div><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/2025/07/15/Kubuntu%E9%85%8D%E7%BD%AE/" title="Kubuntu配置">Kubuntu配置</a><time datetime="2025-07-15T05:25:37.000Z" title="Created 2025-07-15 05:25:37">2025-07-15</time></div></div><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/2025/07/12/%E6%88%91%E4%BB%AC%E5%9C%A8AI%E6%97%B6%E4%BB%A3%E8%AF%A5%E5%A6%82%E4%BD%95%E5%AD%A6%E4%B9%A0/" title="我们在AI时代该如何学习">我们在AI时代该如何学习</a><time datetime="2025-07-12T23:12:19.000Z" title="Created 2025-07-12 23:12:19">2025-07-12</time></div></div><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/2025/07/12/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9CA-Top-Down-Approach/" title="计算机网络A Top Down Approach">计算机网络A Top Down Approach</a><time datetime="2025-07-12T22:02:58.000Z" title="Created 2025-07-12 22:02:58">2025-07-12</time></div></div></div></div></div></div></main><footer id="footer"><div class="footer-other"><div class="footer-copyright"><span class="copyright">&copy;2025 By Fyind</span><span class="framework-info"><span>Framework </span><a target="_blank" rel="noopener" href="https://hexo.io">Hexo 7.3.0</a><span class="footer-separator">|</span><span>Theme </span><a target="_blank" rel="noopener" href="https://github.com/jerryc127/hexo-theme-butterfly">Butterfly 5.4.2</a></span></div></div></footer></div><div id="rightside"><div id="rightside-config-hide"><button id="readmode" type="button" title="Reading Mode"><i class="fas fa-book-open"></i></button><button id="darkmode" type="button" title="Toggle Between Light and Dark Mode"><i class="fas fa-adjust"></i></button><button id="hide-aside-btn" type="button" title="Toggle Between Single-column and Double-column"><i class="fas fa-arrows-alt-h"></i></button></div><div id="rightside-config-show"><button id="rightside-config" type="button" title="Settings"><i class="fas fa-cog fa-spin"></i></button><button class="close" id="mobile-toc-button" type="button" title="Table of Contents"><i class="fas fa-list-ul"></i></button><button id="go-up" type="button" title="Back to Top"><span class="scroll-percent"></span><i class="fas fa-arrow-up"></i></button></div></div><div><script src="/js/utils.js"></script><script src="/js/main.js"></script><div class="js-pjax"><script>(() => {
  const loadMathjax = () => {
    if (!window.MathJax) {
      window.MathJax = {
        tex: {
          inlineMath: [['$', '$'], ['\\(', '\\)']],
          tags: 'all',
        },
        chtml: {
          scale: 1.1
        },
        options: {
          enableMenu: true,
          renderActions: {
            findScript: [10, doc => {
              for (const node of document.querySelectorAll('script[type^="math/tex"]')) {
                const display = !!node.type.match(/; *mode=display/)
                const math = new doc.options.MathItem(node.textContent, doc.inputJax[0], display)
                const text = document.createTextNode('')
                node.parentNode.replaceChild(text, node)
                math.start = {node: text, delim: '', n: 0}
                math.end = {node: text, delim: '', n: 0}
                doc.math.push(math)
              }
            }, '']
          }
        }
      }

      const script = document.createElement('script')
      script.src = 'https://cdn.jsdelivr.net/npm/mathjax/es5/tex-mml-chtml.min.js'
      script.id = 'MathJax-script'
      script.async = true
      document.head.appendChild(script)
    } else {
      MathJax.startup.document.state(0)
      MathJax.texReset()
      MathJax.typesetPromise()
    }
  }

  btf.addGlobalFn('encrypt', loadMathjax, 'mathjax')
  window.pjax ? loadMathjax() : window.addEventListener('load', loadMathjax)
})()</script></div><script async data-pjax src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script></div></body></html>